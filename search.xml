<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€è¶…çº§å¹²è´§ï¼ã€‘8ä¸ªå…è´¹GPT-4ç½‘ç«™ï¼ğŸ¤¯ç«‹çœ$20ä¸é¦™å—ï¼Ÿæ•™ä½ å¦‚ä½•ç™½å«–ä½¿ç”¨GPT-4ğŸ¤– | How to Access GPT-4 for Free!</title>
      <link href="/article/112231.html"/>
      <url>/article/112231.html</url>
      
        <content type="html"><![CDATA[<h2 id="8ä¸ªèƒ½ä½¿ç”¨GPT-4çš„ç½‘ç«™ï¼Œå¸¦ä½ é¢†ç•¥äººå·¥æ™ºèƒ½çš„å¼ºå¤§ï¼"><a href="#8ä¸ªèƒ½ä½¿ç”¨GPT-4çš„ç½‘ç«™ï¼Œå¸¦ä½ é¢†ç•¥äººå·¥æ™ºèƒ½çš„å¼ºå¤§ï¼" class="headerlink" title="8ä¸ªèƒ½ä½¿ç”¨GPT-4çš„ç½‘ç«™ï¼Œå¸¦ä½ é¢†ç•¥äººå·¥æ™ºèƒ½çš„å¼ºå¤§ï¼"></a>8ä¸ªèƒ½ä½¿ç”¨GPT-4çš„ç½‘ç«™ï¼Œå¸¦ä½ é¢†ç•¥äººå·¥æ™ºèƒ½çš„å¼ºå¤§ï¼</h2><p>GPT-4ï¼Œç”±OpenAIå¼€å‘çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œæ‹¥æœ‰å¼ºå¤§çš„æ–‡æœ¬ç”Ÿæˆã€ç¿»è¯‘ã€é—®ç­”ç­‰èƒ½åŠ›ï¼Œæ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸçš„æœ€æ–°çªç ´ã€‚</p><p>æƒ³è¦ä½“éªŒGPT-4çš„é­…åŠ›ï¼Œä½†è‹¦äºæ²¡æœ‰å¼€å‘ç¯å¢ƒï¼Ÿåˆ«æ‹…å¿ƒï¼è¿™é‡Œä¸ºä½ æ¨è8ä¸ªèƒ½ä½¿ç”¨GPT-4çš„ç½‘ç«™ï¼Œè®©ä½ è½»æ¾æ„Ÿå—äººå·¥æ™ºèƒ½çš„å¼ºå¤§ã€‚</p><h3 id="merlin"><a href="#merlin" class="headerlink" title="merlin"></a>merlin</h3><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://www.getmerlin.in/fr">https://www.getmerlin.in/fr</a></p></blockquote><p>Merlin AI çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>æ–‡æœ¬ç”Ÿæˆï¼šå¯ä»¥ç”Ÿæˆå„ç§æ–‡æœ¬æ ¼å¼ï¼Œä¾‹å¦‚è¯—æ­Œã€ä»£ç ã€å‰§æœ¬ã€éŸ³ä¹ä½œå“ã€ç”µå­é‚®ä»¶ã€ä¿¡ä»¶ç­‰ã€‚</li><li>ç¿»è¯‘ï¼šå¯ä»¥ç¿»è¯‘å¤šç§è¯­è¨€ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§è¯­è¨€ä¹‹é—´çš„äº’è¯‘ã€‚</li><li>é—®ç­”ï¼šå¯ä»¥å›ç­”æ‚¨çš„é—®é¢˜ï¼Œå³ä½¿æ˜¯å¼€æ”¾å¼ã€å…·æœ‰æŒ‘æˆ˜æ€§æˆ–å¥‡æ€ªçš„é—®é¢˜ã€‚</li></ul><p>Merlin AI çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ul><li>å¼ºå¤§ï¼šæ‹¥æœ‰å¼ºå¤§çš„è¯­è¨€ç†è§£å’Œå¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥å®Œæˆå„ç§å¤æ‚çš„ä»»åŠ¡ã€‚</li><li>çµæ´»ï¼šå¯ä»¥æ ¹æ®æ‚¨çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼Œä»¥æ»¡è¶³æ‚¨çš„ç‰¹å®šéœ€æ±‚ã€‚</li><li>æ˜“ç”¨ï¼šæä¾›ä¾¿æ·çš„æ“ä½œç•Œé¢ï¼Œå³ä½¿æ²¡æœ‰ç¼–ç¨‹ç»éªŒï¼Œä¹Ÿèƒ½è½»æ¾ä½¿ç”¨ã€‚</li></ul><p>Merlin AI çš„åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>å†™ä½œï¼šå¯ä»¥å¸®åŠ©æ‚¨å®Œæˆå†™ä½œä»»åŠ¡ï¼Œä¾‹å¦‚å†™æ–‡ç« ã€å†™ä»£ç ã€å†™å‰§æœ¬ç­‰ã€‚</li><li>ç¿»è¯‘ï¼šå¯ä»¥å¸®åŠ©æ‚¨å…‹æœè¯­è¨€éšœç¢ï¼Œä¸æ¥è‡ªä¸åŒå›½å®¶çš„äººäº¤æµã€‚</li><li>å­¦ä¹ ï¼šå¯ä»¥å¸®åŠ©æ‚¨å­¦ä¹ æ–°çŸ¥è¯†ï¼Œå›ç­”æ‚¨çš„ç–‘é—®ã€‚</li><li>å¨±ä¹ï¼šå¯ä»¥å¸®åŠ©æ‚¨åˆ›ä½œå„ç§å¨±ä¹å†…å®¹ï¼Œä¾‹å¦‚è¯—æ­Œã€éŸ³ä¹ã€æ•…äº‹ç­‰ã€‚</li></ul><h4 id="merlinå¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#merlinå¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="merlinå¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>merlinå¦‚ä½•ä½¿ç”¨ï¼Ÿ</h4><p>é¦–å…ˆè¿›å…¥é“¾æ¥ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ç•Œé¢ï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸ªæ’ä»¶å³å¯ã€‚å¦‚æœæ˜¯edgeæµè§ˆå™¨ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ä¸å†èµ˜è¿°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/Merlin1.png"></p><p>å®‰è£…å¥½ä¹‹åï¼Œä¼šå‡ºç°åœ¨æµè§ˆå™¨çš„å³ä¾§ï¼Œç‚¹å‡»å°±å¯ä»¥ä½¿ç”¨å•¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/Merlin2.png"></p><p>ä½¿ç”¨ç•Œé¢å¦‚ä¸‹ï¼Œå¯ä»¥ä¸Šä¼ pdfã€docã€txtç­‰æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆå›¾ç‰‡ç­‰AIåŠŸèƒ½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/Merlin3.png"></p><p>å¤§æ¨¡å‹çš„ç§ç±»ä¹Ÿæ˜¯å¾ˆå¤šï¼Œåƒå¸¸è§çš„googleçš„geminiã€chatgpt3.5ã€Llama-2æ¨¡å‹åº”æœ‰å°½æœ‰ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/Merlin4.png"></p><h2 id="perplexity"><a href="#perplexity" class="headerlink" title="perplexity"></a>perplexity</h2><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://www.perplexity.ai/">https://www.perplexity.ai</a></p></blockquote><p>Perplexity.AI çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>Pro Searchï¼šæä¾›æ›´å¼ºå¤§çš„æœç´¢åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ‰¾åˆ°æ›´å‡†ç¡®ã€æ›´ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç”Ÿæˆå›¾ç‰‡ã€‚(å…¶å®å°±æ˜¯chatgpt-4)ã€‚</li><li>AI Assistantï¼šæä¾›ä¸ªæ€§åŒ–çš„ AI åŠ©æ‰‹ï¼Œå¯ä»¥æ ¹æ®æ‚¨çš„éœ€æ±‚æä¾›å¸®åŠ©ã€‚</li><li>APIï¼šæä¾› API æ¥å£ï¼Œå¯ä»¥å°† Perplexity.AI çš„åŠŸèƒ½é›†æˆåˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚</li></ul><h4 id="perplexityå¦‚ä½•ä½¿ç”¨ï¼Ÿ"><a href="#perplexityå¦‚ä½•ä½¿ç”¨ï¼Ÿ" class="headerlink" title="perplexityå¦‚ä½•ä½¿ç”¨ï¼Ÿ"></a>perplexityå¦‚ä½•ä½¿ç”¨ï¼Ÿ</h4><p>ç‚¹å‡»é“¾æ¥è¿›å…¥å³å¯ä½¿ç”¨ï¼Œéœ€åˆ‡æ¢æˆproã€‚<br><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/perplexity2.png"></p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/perplexity1.png"></p><p>æ­¤å¤–è¿˜å¯ä»¥åœ¨discoveré‡Œçœ‹åˆ°å½“å‰æœ€æ–°çš„AIæ–°é—»ã€‚<br><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/perplexity3.png"></p><h2 id="copilot"><a href="#copilot" class="headerlink" title="copilot"></a>copilot</h2><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://www.microsoft.com/zh-cn/edge/features/copilot?form=MA13FJ">https://www.microsoft.com/zh-cn/edge/features/copilot?form=MA13FJ</a></p></blockquote><p>Copilot æ˜¯ GitHub æ¨å‡ºçš„ä¸€æ¬¾ AI è¾…åŠ©ç¼–ç¨‹å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…æé«˜ç¼–ç æ•ˆç‡ã€‚å®ƒåŸºäº OpenAI çš„ Codex æ¨¡å‹ï¼Œå¯ä»¥ç†è§£ä»£ç å¹¶ç”Ÿæˆä»£ç å»ºè®®ï¼Œåˆæ¬¡ä¹‹å¤–è¿˜å¯ä»¥<strong>è¯­éŸ³å¯¹è¯</strong>ã€‚</p><p>Copilot çš„ç‰¹æ®ŠåŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>è‡ªåŠ¨è¡¥å…¨ä»£ç : Copilot å¯ä»¥è‡ªåŠ¨è¡¥å…¨ä»£ç ï¼ŒåŒ…æ‹¬å‡½æ•°ã€å˜é‡ã€ç±»ç­‰ã€‚å®ƒè¿˜å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡ç”Ÿæˆä»£ç å»ºè®®ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®Œæˆç¼–ç ä»»åŠ¡ã€‚</li><li>ä»£ç ç”Ÿæˆ: Copilot å¯ä»¥æ ¹æ®è‡ªç„¶è¯­è¨€æè¿°ç”Ÿæˆä»£ç ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¾“å…¥â€œåˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ â€ï¼ŒCopilot ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚</li><li>ä»£ç è§£é‡Š: Copilot å¯ä»¥è§£é‡Šä»£ç çš„ä½œç”¨å’Œç”¨æ³•ã€‚æ‚¨å¯ä»¥å°†å…‰æ ‡æ‚¬åœåœ¨ä»£ç ä¸Šï¼ŒCopilot ä¼šæ˜¾ç¤ºä»£ç çš„è§£é‡Šã€‚</li><li>ä»£ç ä¿®å¤: Copilot å¯ä»¥å¸®åŠ©æ‚¨ä¿®å¤ä»£ç é”™è¯¯ã€‚å®ƒå¯ä»¥è¯†åˆ«ä»£ç é”™è¯¯å¹¶æä¾›ä¿®å¤å»ºè®®ã€‚</li><li>ä»£ç é£æ ¼æ£€æŸ¥: Copilot å¯ä»¥æ£€æŸ¥ä»£ç é£æ ¼æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚å®ƒå¯ä»¥æ ¹æ®ç¼–ç è§„èŒƒæå‡ºå»ºè®®ï¼Œå¸®åŠ©æ‚¨æé«˜ä»£ç è´¨é‡ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/copilot.png"></p><h2 id="skype"><a href="#skype" class="headerlink" title="skype"></a>skype</h2><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://you.com/">https://you.com/</a></p></blockquote><p>æ‹¥æœ‰è¶…å¼ºçš„ååº”é€Ÿåº¦å’Œè®°å¿†åŠ›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/skype3.png"></p><h2 id="you-AI"><a href="#you-AI" class="headerlink" title="you AI"></a>you AI</h2><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://you.com/">https://you.com/</a></p></blockquote><p>æ¯æ—¥æœ‰æ¬¡ä½¿ç”¨æœºä¼šï¼Œè¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/you.png"> </p><h2 id="pop-AI"><a href="#pop-AI" class="headerlink" title="pop AI"></a>pop AI</h2><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://www.popai.pro/">https://www.popai.pro/</a></p></blockquote><p>å¯ä»¥ç”ŸæˆPPTï¼Œå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œç”Ÿæˆå›¾ç‰‡ç­‰åŠŸèƒ½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/pop1.png"></p><h2 id="coze-AI"><a href="#coze-AI" class="headerlink" title="coze AI"></a>coze AI</h2><blockquote><p>é“¾æ¥åœ°å€ï¼š<a href="https://www.coze.com/">https://www.coze.com/</a></p></blockquote><p>è¿™æ˜¯ä¸€æ¬¾å­—èŠ‚æ——ä¸‹é¢å‘æµ·å¤–çš„AIã€‚æœ‰éå¸¸éå¸¸å¤šå¥½ç©çš„æ’ä»¶å“¦ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/1137882300/images@master/images/coze.png"></p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
          <category> ç™½å«– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chatgpt </tag>
            
            <tag> gpt-4 </tag>
            
            <tag> gpt-3.5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¦™æ¸¯æ¾³é—¨æ—…æ¸¸</title>
      <link href="/article/112224.html"/>
      <url>/article/112224.html</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="2114a8e8e51478fa0a6868948772525d6cd3a1cb9dfa6a78d8aad5e5913947c5">234db99cd52a97edc76dee15a0b78a9cfbb2fe72764757b7bf506403d2181f91e83e4da17640f2ceae9783073b7bc0b166891eec70ccebc480ce813bc01236e2c9dd1707a7654171e7e58de0e34a56e63fbcf90a4ad6625f117ae7e6509a29ca1b45416cfde1bde438f01ca966b4946f2a1365c378e1a34065d0603c9bc122558d4df4bfe65a0d01c97b5eb40ee0c23a9643bb78c7d30612d3c7a942a9d30ca90f29b662cc6b23c9ca2c2943c91f7c8a12f225982506a9c88d3c960da248e3f60e22dfc4c212a3e4ee6669773174795b0a1b1c6d9eb1feab82bf1d870b5b4b94f9e000d630f896c127b86f897695783c01b9bf9f93b3a43e4c2a7b24755ab482a663a57daf36a0b4d33158d112296117ed2bb4cbd205236c779976795c3ed0d71e297b09de7ee96bd0a5140bb21cf74a03f706c37b25dc3222933d4440bee09a6f2b9fbf521c0175ba86828aef1da182d53bbf246330664509e424b75491c1cd214a1f4257ece26708ec6b5b599dafed0d658a5e20804d3c52962ab44b6a05b904d7bfba555d2c685d585c359455bc95c5c9e7b8b2424be2a801d4f21d7d46077e3637b5574e28990a23de44ac5279667cbb66bd3bb152d446e5a6f8e756b16e0eb87be84a909ca8db3b7661c79b21c3fb53fa8724a3aac6ad28ae5b61f0e58cc992c02f7d826289310993ad03684e64d85aebbca08c9e511a854cb4d7040dc369e6852742f48c3f9008018f26c0059acc70e2c39c7d6c61534ea35e4e5d0414e55173713183df7b2742bdc0b31369663cd16974a6458dbc5f42ea33a0ebc00bb8b20596b28e80496d5fc473455197be41935622e7fcd048fb2591f441b16ae253e6b8e08b1e561f6aee3a611ebde612086e73d2b3df961c78177e902b8b92180bb4a4d8b0ee45932bb3d384aa4db20f239e99ded5c63390afae3de96f60ba6c735df3647625a4093750e43561e8ceebe7633fc3c9fa43636ca3cd34550f3f572db52cec5754f1042f13025513506a7d765d15c1c67d8890c5fe4f5f0ac300d004799a484aae0e983ce7965a40131674eb20d7ee800ba198c32c8aafb140e4fd2573fefd7390d800156814c0f30f8ccddd39da1d2080fb9193214f508d631ad62015b534ba9508fc7442ec171a79d4458eb7c13bc0eccc03427e6b3eaa8e74731c851b414ce7df1d4d6959d716fe314ec624d1e25d2564a8e156ffadb0da2586eedc22b399ae7dcb0d87bbfd777583174a77758d265d9be84aefb10053cfa653b57081d3239a6aed47d993b90dceb579af1dac21657caad26175728b0c876cdf4526d4cf46f1e5a8e8c6fc96792f9f39818daeed467406fdc890526f802c2e896d35622e10e766c2c229cefd3c626ecc647bcf628d395b03ef8ff18d84757d036fa102f6c37ca0199054195fe2db0519385eed164880beee22556ae1164f2b6965a9499f647dda28e7347e28c062cac8dbd8f8c66e728ef6f65965d1c05fdfbc26f697af0d36e9f7e227882e243e505d6bc973d7f20db82e87dd5e29480ba26849f4bef16d6a41dfe64d6adc159617ef6a37bf9dce5fd4b90e87cbbf2273cd084620cf96ec281231cd5d3967e775dcecbd5154c8061f2e130cdc1ab10861c586d0610b61d20f906b3ac748cc2b25703f67eda405a86aaeb83df9e675f0b4c46dd52e45fd57636f6a0cd23770edbec84776248f94bbdcfe78ccca665e0c890c99ff886cff4f6057c7e8855e7319b83fcd02af9bbeb0a4e5c18b107eff660458a0a69e148b2f23108ee68d77d1e1a60294feace01d7719b9df135fe971450f6d50e11a649d5346708aa9c51912d6e02330743992e767f7aab79df15ccc0807c1c6e5f8a742f9483162be5792c61e8174e53ad8d6570540b2d07d87b01b807be34eae496602f680626b95e5d0bce725f57a5c9788cb1b04ab4df23b04838ac96c30ceb5dea1e519587b555cf79114148919226ede8e2a0a621b59201b4a0c58b9a9791d14229a0976fa10dd3c360673ab3398cda63153aab6d31a912ec3da91d9cb9f4de0a623236706b5a505f4606e2dcaae4ce948f8c7e619aa3d57e4fab319dbfd576279f1e4a5db20daa678bc3539f6c4e8ae1c06effcaec65be0152916a6a53b295466f7acddab9cdae3bef7c9abc86fc53c25d8b225a8b3e66ad69160262d3d1fd98261403af5cd0d4129053c63febefcfefae7988f1c2b9b5dfd8f9a177657e43c76584171066479ba8c56260401157b3ff39016ef78b4c87d7de7a295a0aa4175957e312cd94cda38db19e469877cc74d6c0e5e1c3cc7cbeb37399ee4bdfc9c19e035dc439d9fae79077feba7fc7c0a2542560cd4628ed59f7769378fa95551331a39f442e1678e076212db866c8c0747361791352c0e24030978150a6a5300c5124c45988e7474b85a380d765b9331fa5d4883e8214bc588a72538ef973aa6775325d071090a21f77c10b700ed2ffc884879c7e9400819e81565fbbb2a5673301a880d831f7f5189951c574f8fd84c58171fdce497fc1cb78260e50d7949d1cf1c99a1eef2e0f5c4d8a0fd3d01d6bd5d4161f0edc26906f3d7601c6d4d8eb0abb4507113516c173d954de58da55ca2940dc4d95f1a06fb23a30cf8e7102037d60f1433d03c1956499c64872719078f9db30de0a110e56c52893ebccee1f1340533080d112ae47f04800d88a0fa8553d36873beb8ccc9ccf83f5947aae6734823a7e1a08339ce9ddc73e1c475743f7682a1834498f757a720e3a95bc3c7ae2743bfa4f8b404679bdbd1e60f2d8e059b617db622e20da0077fabe689f0f2b124470297b359041f5d65d5b94fc0450df8a27679ee54decef489e08f9b8f68d97a25b40ef1b3fe79e94cfa960f5d656a48b1e6977e139755ddb438114f6432a9064f533139dcf311cf0eb4a9c9559f81a018ad71fdaeca688107ee24367e9cbff705880d9100a9d986fab17717fa8d6e2227ac50a8279cee7d9da68d8c9d8d5d1db1e1d48207f00ccc5847131108103a7bc523b3e227abbdfd44025a039946d50dcb22e2a2ffe316b0dcec5942bfcc1ff2a3596e68f65e1dc6cb3929a1626a03c96b68e87453ecd42d2017049c4e921a973df7846569e3bd9beabdfbbda9cf87bbc6dc4584243ccd706ec559520eec2de4598481a64bdf5149eead88eb445c864391095e066b6cc06db39ebc06e53724aaa4cfa6efac08cbb897db40b5eba41666d969c1c0d0ac77df9ad3b5464b7d70d848a00a038f88f36a8f148d0b9f5b2396e72957260f96002e7b2a1165869ad17bdcd8495bba87a30ecff621b7308cc86d7c9637075e189c4ca2090f9975638cf8a1b8086c3c4de4c534c5a5f96dd08970f65546d10fce72cd488805250a12eabae1e4e587c0b2e1aa851f6910440be1160d199703dfb69608e187ca013eeb01d6d4b4bb884ff3c04ba88127d7c20119a23156eba9deaece0fee313b534cc25ac4a2aeb8eb89bdadfeb629a7610085af58443def5b2bf7fe53c8957e06471f4bde0db6226f33282243ea49ed57b8ae8e620f18ad55c34c64d32d26270c005297d75d72f1f446d663cecbf8b5e713a98dc5d4d1de827e0f18f5c6dd02fc3f6a7642f19910f93726d6daa49254848c296d24088e1fe74e4bd8b0172715cc3c9f47c01850c294fee4e2822144670a58bc4ceea84a5fe66acfe29f95aa032e3953b130b0f3b9c464d670f71b88549a762e130737ec1f94ad515b621d835e9984f8e7c811f200ddca24bf05c86d83263d9693713035cad677cc84ddc5be0a6f04bf1cc157aaf7fddd53786ebd46850d002e2639d05be0c9dbe30290201727caab0224a63f5abc738931ebec8dc893252686bbde82653e0e19752c6d33a156be37a6ef0693d18c2543adb8f2cf9d6f3b9638e10784a6d50597da79fbffffa879d71801d5c7a0b5d7b7ab53c371891fa5efc7e876a9fdf0846a340521973a7a28c4517daa4a0630c7d0d0e40ad092f4800d1d669bc6bd2f65334d5a00d0f002d6deb4b913720904e73f1a8360485ad308d732a66eff3beae216904c97b955bc2d6abc1164b31d41005e4a62cfbea6d2135fb860bc7d645d9d72dcddea8e60761e824f0d9f6623a90c06cf8a2637c47486e3487b880c789e621eabbbb632d42e9418900de27da4c8ed17971bff6a9510f29349bfa9657b991789a45b2dfe59fd62398d1f573292688482257652dab1fc97d26a42eb5f0fb4f431aa03c7b8a65a0fa736dad733a8a0646b1d1d1fb9cc57f77b4c76e9614544c6e061fc97e8b8a5096eda860c15054e4ee365be34fd24de02216862e6c3c95c69edf92ae6e37948c48d1ac7249c74650ff23492d75d624400974e3e9bb7e460050ff27e8a6d7762c4ff440032aeb9b02c0a107398f0d2bb3b6ec8ead6fe67f36b7103809d6f6f5081a8edeb17e103c33626e834819f0827fcefde88cce351e8eba78435a9b2e4d0c40e0aae64f0dc6ae60822473a6226afd019c17aa3ed81180a19d0d79a24655ff7c7789f9c38f5603a9242e7a3afbe73219f94cce849354d53e28b98c61009357309d852535c6e7f297a17439c6c0416e1be5bf639e4d608eea25233192b55e36ac0c1eba64ad52b67c95b0562e061e2185cec8fa00fa7bc888d0422b8892e8ef168933a785a36eaf7b5741ca55c2fb43ac727f9584d870c96a64d26fc2de1585af0a4461143f2a3099ce2b118f097983e3004818c322b108aacb6c9de2e8fa3a1b31106f9d780919f7f52c86cd37fda08f3cbe16b398ea359ad1f309bae07c7d0243ce08a8ebd0850e63ad059c64416d09c7129150e9ddc7f73f055fa8fa23d6324f50b5848287f8194b46fd3c43894f43eb67c51d79189f9132944c7603c1af0a3e1f9ebc618f16d4d2852fef8278abca3afabf7ecddf2b072f565872408c07a5e656039600c6d6546ac020a613a18927d168ea8cd12451c7a18724340330d8b09d71f016dabadf8727b0624cdfc8eeffadc863a9bae63c64336dd10fb6a89366dacc43a5817091197c7266276a06a80372d3fc0ab7390e5dcb551240e1faecb854ba0d83a965c25bbe175aa2ccde9951de68c28ff39d79d4cc7c49740bd471c75ac816ebe1f39a05005db5d7040f1de3f726ba5877c021d70adf58374cfc0b831ffb31f6cbe98b3db5fc6c9aaaf7e0342a10a744845176dc17e0f688a6ef3f004cfeeaf0e1fd8d5ed163eb920b6c00c44f018e9ed81a29cc783f70dea6030769f101a729cafe12499036664545f636275cb0ba8f3950f5ad3840c13b239a1fae686dbbe5fda3e265ab53645ac2bb9d13154e284faefc83615233a0e335c9168be1d4dbb7f3af895510d5bd85b7e4948e1e0f4800f4669d85a951dec252686f8e2c2f69c1baf67df1805b8ca6df7bb3183d0c3fcfff1c600822c55e9323b402be687e4bce29db2985c49191c9b57752fa70ea0cabe75cf3f31ded680daeb3304bf31fc0688e3034c9e14c932a9d5fa0294b6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ—…æ¸¸ </category>
          
          <category> æ”»ç•¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ”»ç•¥ </tag>
            
            <tag> æ¾³é—¨ </tag>
            
            <tag> æ—…æ¸¸ </tag>
            
            <tag> é¦™æ¸¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Serializableæ¥å£ä½ çœŸçš„äº†è§£å—ï¼Ÿ</title>
      <link href="/article/112219.html"/>
      <url>/article/112219.html</url>
      
        <content type="html"><![CDATA[<h3 id="ç†è®º"><a href="#ç†è®º" class="headerlink" title="ç†è®º"></a>ç†è®º</h3><p>Java åºåˆ—åŒ–æ˜¯ JDK 1.1 æ—¶å¼•å…¥çš„ä¸€ç»„å¼€åˆ›æ€§çš„ç‰¹æ€§ï¼Œç”¨äºå°† Java å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä¾¿äºå­˜å‚¨æˆ–ä¼ è¾“ã€‚æ­¤åï¼Œä»ç„¶å¯ä»¥å°†å­—èŠ‚æ•°ç»„è½¬æ¢å›<br>Java å¯¹è±¡åŸæœ‰çš„çŠ¶æ€ã€‚</p><p>åºåˆ—åŒ–çš„æ€æƒ³æ˜¯â€œå†»ç»“â€å¯¹è±¡çŠ¶æ€ï¼Œç„¶åå†™åˆ°ç£ç›˜æˆ–è€…åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼›</p><p>åºåˆ—åŒ–æœ‰ä¸€æ¡è§„åˆ™ï¼Œå°±æ˜¯è¦åºåˆ—åŒ–çš„å¯¹è±¡å¿…é¡»å®ç° <code>Serializbale</code> æ¥å£ï¼Œå¦åˆ™å°±ä¼šæŠ¥ NotSerializableException å¼‚å¸¸ã€‚</p><p>å¥½ï¼Œæ¥çœ‹çœ‹ <code>Serializbale</code> æ¥å£çš„å®šä¹‰å§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±ä¸€ä¸ªç©ºçš„æ¥å£å˜›ï¼Œç«Ÿç„¶èƒ½å¤Ÿä¿è¯å®ç°äº†å®ƒçš„â€œç±»å¯¹è±¡â€è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿ</p><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><p>åœ¨å›ç­”ä¸Šè¿°é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸€ä¸ªç±»ï¼ˆåªæœ‰ä¸¤ä¸ªå­—æ®µï¼Œå’Œå¯¹åº”çš„ <code>getter/setter</code>ï¼‰ï¼Œç”¨äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ï¼Œç”±äº <code>Obj</code> æ²¡æœ‰å®ç° <code>Serializbale</code> æ¥å£ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæµ‹è¯•ç±»çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå †æ ˆä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.io.NotSerializableException: com.cmower.java_demo.xuliehua.Obj</span><br><span class="line">at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)</span><br><span class="line">at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)</span><br><span class="line">at com.cmower.java_demo.xuliehua.Test.main(Test.java:21)</span><br></pre></td></tr></table></figure><p>é¡ºç€å †æ ˆä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>ObjectOutputStream</code> çš„ <code>writeObject0()</code> æ–¹æ³•ã€‚å…¶éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeString æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span><br><span class="line">if(obj instanceof String)&#123;</span><br><span class="line"></span><br><span class="line">writeString((String) obj,unshared);</span><br><span class="line">        &#125;</span><br><span class="line">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeArray æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span><br><span class="line">        else if(cl.</span><br><span class="line"></span><br><span class="line">isArray())&#123;</span><br><span class="line"></span><br><span class="line">writeArray(obj, desc, unshared);</span><br><span class="line">&#125;</span><br><span class="line">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºæšä¸¾ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeEnum æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span><br><span class="line">        else if(obj instanceof Enum)&#123;</span><br><span class="line"></span><br><span class="line">writeEnum((Enum&lt;?&gt;) obj,desc,unshared);</span><br><span class="line">        &#125;</span><br><span class="line">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºå¯åºåˆ—åŒ–ç±»å‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨ writeOrdinaryObject æ–¹æ³•è¿›è¡Œåºåˆ—åŒ–</span><br><span class="line">        else if(obj instanceof Serializable)&#123;</span><br><span class="line"></span><br><span class="line">writeOrdinaryObject(obj, desc, unshared);</span><br><span class="line">&#125;</span><br><span class="line">// å¦‚æœå¯¹è±¡ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œåˆ™æŠ›å‡º NotSerializableException å¼‚å¸¸</span><br><span class="line">        else&#123;</span><br><span class="line">        if(extendedDebugInfo)&#123;</span><br><span class="line">        throw new</span><br><span class="line"></span><br><span class="line">NotSerializableException(</span><br><span class="line">        cl.getName() +&quot;\n&quot;+debugInfoStack.</span><br><span class="line"></span><br><span class="line">toString());</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">        throw new</span><br><span class="line"></span><br><span class="line">NotSerializableException(cl.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>ObjectOutputStream</code> åœ¨åºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šåˆ¤æ–­è¢«åºåˆ—åŒ–çš„å¯¹è±¡æ˜¯å“ªä¸€ç§ç±»å‹ï¼Œå­—ç¬¦ä¸²ï¼Ÿæ•°ç»„ï¼Ÿæšä¸¾ï¼Ÿè¿˜æ˜¯ <code>Serializable</code><br>ï¼Œå¦‚æœå…¨éƒ½ä¸æ˜¯çš„è¯ï¼ŒæŠ›å‡º <code>NotSerializableException</code>ã€‚</p><p>å‡å¦‚ <code>Obj</code> å®ç°äº† <code>Serializable</code> æ¥å£ï¼Œå°±å¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“æ€ä¹ˆåºåˆ—åŒ–å‘¢ï¼Ÿ</p><p>ä»¥ <code>ObjectOutputStream</code><br>ä¸ºä¾‹å§ï¼Œå®ƒåœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ <code>writeObject()</code>â†’<code>writeObject0()</code>â†’<code>writeOrdinaryObject()</code>â†’<code>writeSerialData()</code>â†’<code>invokeWriteObject()</code>â†’<code>defaultWriteFields()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">defaultWriteFields</span><span class="params">(Object obj, ObjectStreamClass desc)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„ç±»ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿›è¡Œé»˜è®¤çš„åºåˆ—åŒ–</span></span><br><span class="line">    Class&lt;?&gt; cl = desc.forClass();</span><br><span class="line">    desc.checkDefaultSerialize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡ï¼Œä»¥åŠè¿™äº›å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">primDataSize</span> <span class="operator">=</span> desc.getPrimDataSize();</span><br><span class="line">    desc.getPrimFieldValues(obj, primVals);</span><br><span class="line">    <span class="comment">// å°†åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">    bout.write(primVals, <span class="number">0</span>, primDataSize, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">    ObjectStreamField[] fields = desc.getFields(<span class="literal">false</span>);</span><br><span class="line">    Object[] objVals = <span class="keyword">new</span> <span class="title class_">Object</span>[desc.getNumObjFields()];</span><br><span class="line">    <span class="type">int</span> <span class="variable">numPrimFields</span> <span class="operator">=</span> fields.length - objVals.length;</span><br><span class="line">    desc.getObjFieldValues(obj, objVals);</span><br><span class="line">    <span class="comment">// å¾ªç¯å†™å…¥å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objVals.length; i++) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ writeObject0 æ–¹æ³•å°†å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µåºåˆ—åŒ–å†™å…¥è¾“å‡ºæµ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writeObject0(objVals[i], fields[numPrimFields + i].isUnshared());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼Œåˆ™å°†å¼‚å¸¸åŒ…è£…æˆ IOException æŠ›å‡º</span></span><br><span class="line">        <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (abortIOException == <span class="literal">null</span>) &#123;</span><br><span class="line">                abortIOException = ex;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£æ€ä¹ˆååºåˆ—åŒ–å‘¢ï¼Ÿ</p><p>ä»¥ <code>ObjectInputStream</code><br>ä¸ºä¾‹ï¼Œå®ƒåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šä¾æ¬¡è°ƒç”¨ <code>readObject()</code>â†’<code>readObject0()</code>â†’<code>readOrdinaryObject()</code>â†’<code>readSerialData()</code>â†’<code>defaultReadFields()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">defaultReadFields</span><span class="params">(Object obj, ObjectStreamClass desc)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„ç±»ï¼Œå¹¶æ£€æŸ¥å¯¹è±¡æ˜¯å¦å±äºè¯¥ç±»</span></span><br><span class="line">    Class&lt;?&gt; cl = desc.forClass();</span><br><span class="line">    <span class="keyword">if</span> (cl != <span class="literal">null</span> &amp;&amp; obj != <span class="literal">null</span> &amp;&amp; !cl.isInstance(obj)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassCastException</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„åŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡å’Œå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">primDataSize</span> <span class="operator">=</span> desc.getPrimDataSize();</span><br><span class="line">    <span class="keyword">if</span> (primVals == <span class="literal">null</span> || primVals.length &lt; primDataSize) &#123;</span><br><span class="line">        primVals = <span class="keyword">new</span> <span class="title class_">byte</span>[primDataSize];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»è¾“å…¥æµä¸­è¯»å–åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼ï¼Œå¹¶å­˜å‚¨åœ¨ primVals æ•°ç»„ä¸­</span></span><br><span class="line">    bin.readFully(primVals, <span class="number">0</span>, primDataSize, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å°† primVals æ•°ç»„ä¸­çš„åŸºæœ¬ç±»å‹å­—æ®µçš„å€¼è®¾ç½®åˆ°å¯¹è±¡çš„ç›¸åº”å­—æ®µä¸­</span></span><br><span class="line">        desc.setPrimFieldValues(obj, primVals);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„æ•°é‡å’Œå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">objHandle</span> <span class="operator">=</span> passHandle;</span><br><span class="line">    ObjectStreamField[] fields = desc.getFields(<span class="literal">false</span>);</span><br><span class="line">    Object[] objVals = <span class="keyword">new</span> <span class="title class_">Object</span>[desc.getNumObjFields()];</span><br><span class="line">    <span class="type">int</span> <span class="variable">numPrimFields</span> <span class="operator">=</span> fields.length - objVals.length;</span><br><span class="line">    <span class="comment">// å¾ªç¯è¯»å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; objVals.length; i++) &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨ readObject0 æ–¹æ³•è¯»å–å¯¹è±¡çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼</span></span><br><span class="line">        <span class="type">ObjectStreamField</span> <span class="variable">f</span> <span class="operator">=</span> fields[numPrimFields + i];</span><br><span class="line">        objVals[i] = readObject0(Object.class, f.isUnshared());</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥å­—æ®µæ˜¯ä¸€ä¸ªå¼•ç”¨å­—æ®µï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºä¾èµ–è¯¥å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span> (f.getField() != <span class="literal">null</span>) &#123;</span><br><span class="line">            handles.markDependency(objHandle, passHandle);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (obj != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// å°† objVals æ•°ç»„ä¸­çš„éåŸºæœ¬ç±»å‹å­—æ®µçš„å€¼è®¾ç½®åˆ°å¯¹è±¡çš„ç›¸åº”å­—æ®µä¸­</span></span><br><span class="line">        desc.setObjFieldValues(obj, objVals);</span><br><span class="line">    &#125;</span><br><span class="line">    passHandle = objHandle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Serializable</code>æ¥å£ä¹‹æ‰€ä»¥å®šä¹‰ä¸ºç©ºï¼Œæ˜¯å› ä¸ºå®ƒåªèµ·åˆ°äº†ä¸€ä¸ªæ ‡è¯†çš„ä½œç”¨ï¼Œå‘Šè¯‰ç¨‹åºå®ç°äº†å®ƒçš„å¯¹è±¡æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ï¼Œä½†çœŸæ­£åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ“ä½œå¹¶ä¸éœ€è¦å®ƒæ¥å®Œæˆã€‚</p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><p>å¼€é—¨è§å±±çš„è¯´å§ï¼Œ<code>static</code>å’Œ <code>transient</code>ä¿®é¥°çš„å­—æ®µæ˜¯ä¸ä¼šè¢«åºåˆ—åŒ–çš„ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥è¯æ˜ï¼Œå†æ¥è§£é‡ŠåŸå› ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ <code>Obj</code> ç±»ä¸­å¢åŠ ä¸¤ä¸ªå­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="string">&quot;å“ˆå“ˆ&quot;</span>;</span><br><span class="line">    <span class="keyword">transient</span> <span class="type">String</span> <span class="variable">meizi</span> <span class="operator">=</span> <span class="string">&quot;å°ç±³&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Obj&#123;&quot;</span> + <span class="string">&quot;name=&quot;</span> + name + <span class="string">&quot;,age=&quot;</span> + age + <span class="string">&quot;,pre=&quot;</span> + pre + <span class="string">&quot;,meizi=&quot;</span> + meizi + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œåœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ï¼Œå¹¶åœ¨åºåˆ—åŒ–åå’Œååºåˆ—åŒ–å‰æ”¹å˜ <code>static</code> å­—æ®µçš„å€¼ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">// åˆå§‹åŒ–</span><br><span class="line">Obj Obj = new Obj();</span><br><span class="line">Obj.</span><br><span class="line"></span><br><span class="line">setName(&quot;å°ç±³&quot;);</span><br><span class="line">Obj.</span><br><span class="line"></span><br><span class="line">setAge(18);</span><br><span class="line">System.out.</span><br><span class="line"></span><br><span class="line">println(Obj);</span><br><span class="line"></span><br><span class="line">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span><br><span class="line">try(</span><br><span class="line">ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;chenmo&quot;));)&#123;</span><br><span class="line">        oos.</span><br><span class="line"></span><br><span class="line">writeObject(Obj);</span><br><span class="line">    &#125;catch(</span><br><span class="line">IOException e)&#123;</span><br><span class="line">        e.</span><br><span class="line"></span><br><span class="line">printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">// æ”¹å˜ static å­—æ®µçš„å€¼</span><br><span class="line">Obj.pre =&quot;ä¸ç«é”…&quot;;</span><br><span class="line"></span><br><span class="line">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span><br><span class="line">        try(</span><br><span class="line">ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File(&quot;chenmo&quot;)));)&#123;</span><br><span class="line">Obj Obj1 = (Obj) ois.readObject();</span><br><span class="line">    System.out.</span><br><span class="line"></span><br><span class="line">println(Obj1);</span><br><span class="line">&#125;catch(IOException |</span><br><span class="line">ClassNotFoundException e)&#123;</span><br><span class="line">        e.</span><br><span class="line"></span><br><span class="line">printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Obj&#123;name=å°ç±³,age=18,pre=ç«é”…,meizi=å°ç±³&#125;</span><br><span class="line">Obj&#123;name=å°ç±³,age=18,pre=ä¸ç«é”…,meizi=null&#125;</span><br></pre></td></tr></table></figure><p>ä»ç»“æœçš„å¯¹æ¯”å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><p>1ï¼‰åºåˆ—åŒ–å‰ï¼Œ<code>pre</code> çš„å€¼ä¸ºâ€œç«é”…â€ï¼Œåºåˆ—åŒ–åï¼Œ<code>pre</code> çš„å€¼ä¿®æ”¹ä¸ºâ€œä¸ç«é”…â€ï¼Œååºåˆ—åŒ–åï¼Œ<code>pre</code> çš„å€¼ä¸ºâ€œä¸ç«é”…â€ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œç«é”…â€ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºåºåˆ—åŒ–ä¿å­˜çš„æ˜¯å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œ <code>static</code> ä¿®é¥°çš„å­—æ®µå±äºç±»çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥è¯æ˜åºåˆ—åŒ–å¹¶ä¸ä¿å­˜ <code>static</code> ä¿®é¥°çš„å­—æ®µã€‚</p><p>2ï¼‰åºåˆ—åŒ–å‰ï¼Œ<code>meizi</code> çš„å€¼ä¸ºâ€œå°ç±³â€ï¼Œååºåˆ—åŒ–åï¼Œ<code>meizi</code> çš„å€¼ä¸º <code>null</code>ï¼Œè€Œä¸æ˜¯åºåˆ—åŒ–å‰çš„çŠ¶æ€â€œå°ç±³â€ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<code>transient</code> çš„ä¸­æ–‡å­—ä¹‰ä¸ºâ€œä¸´æ—¶çš„â€ï¼ˆè®ºè‹±è¯­çš„é‡è¦æ€§ï¼‰ï¼Œå®ƒå¯ä»¥é˜»æ­¢å­—æ®µè¢«åºåˆ—åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨è¢«ååºåˆ—åŒ–åï¼Œ<code>transient</code><br>å­—æ®µçš„å€¼è¢«è®¾ä¸ºåˆå§‹å€¼ï¼Œæ¯”å¦‚ <code>int</code> å‹çš„åˆå§‹å€¼ä¸º 0ï¼Œå¯¹è±¡å‹çš„åˆå§‹å€¼ä¸º <code>null</code>ã€‚</p><p>å¦‚æœæƒ³è¦æ·±ç©¶æºç çš„è¯ï¼Œä½ å¯ä»¥åœ¨ <code>ObjectStreamClass</code> ä¸­å‘ç°ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ObjectStreamField[] getDefaultSerialFields(Class&lt;?&gt; cl) &#123;</span><br><span class="line">    <span class="comment">// è·å–è¯¥ç±»ä¸­å£°æ˜çš„æ‰€æœ‰å­—æ®µ</span></span><br><span class="line">    Field[] clFields = cl.getDeclaredFields();</span><br><span class="line">    ArrayList&lt;ObjectStreamField&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">mask</span> <span class="operator">=</span> Modifier.STATIC | Modifier.TRANSIENT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰å­—æ®µï¼Œå°†é static å’Œ transient çš„å­—æ®µæ·»åŠ åˆ° list ä¸­</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; clFields.length; i++) &#123;</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clFields[i];</span><br><span class="line">        <span class="type">int</span> <span class="variable">mods</span> <span class="operator">=</span> field.getModifiers();</span><br><span class="line">        <span class="keyword">if</span> ((mods &amp; mask) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å­—æ®µåã€å­—æ®µç±»å‹å’Œå­—æ®µæ˜¯å¦å¯åºåˆ—åŒ–åˆ›å»ºä¸€ä¸ª ObjectStreamField å¯¹è±¡</span></span><br><span class="line">            <span class="type">ObjectStreamField</span> <span class="variable">osf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>(field.getName(), field.getType(), !Serializable.class.isAssignableFrom(cl));</span><br><span class="line">            list.add(osf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> list.size();</span><br><span class="line">    <span class="comment">// å¦‚æœ list ä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ ObjectStreamField æ•°ç»„ï¼Œå¦åˆ™å°† list è½¬æ¢ä¸º ObjectStreamField æ•°ç»„å¹¶è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> (size == <span class="number">0</span>) ? NO_FIELDS :</span><br><span class="line">            list.toArray(<span class="keyword">new</span> <span class="title class_">ObjectStreamField</span>[size]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ° <code>Modifier.STATIC | Modifier.TRANSIENT</code> äº†å§ï¼Œè¿™ä¸¤ä¸ªä¿®é¥°ç¬¦æ ‡è®°çš„å­—æ®µå°±æ²¡æœ‰è¢«æ”¾å…¥åˆ°åºåˆ—åŒ–çš„å­—æ®µä¸­ï¼Œæ˜ç™½äº†å§ï¼Ÿ</p><h3 id="å¹²è´§"><a href="#å¹²è´§" class="headerlink" title="å¹²è´§"></a>å¹²è´§</h3><p>é™¤äº† <code>Serializable</code> ä¹‹å¤–ï¼ŒJava è¿˜æä¾›äº†ä¸€ä¸ªåºåˆ—åŒ–æ¥å£ <code>Externalizable</code>ï¼ˆå¿µèµ·æ¥æœ‰ç‚¹æ‹—å£ï¼‰ã€‚</p><p>ä¸¤ä¸ªæ¥å£æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„å—ï¼Ÿè¯•ä¸€è¯•å°±çŸ¥é“äº†ã€‚</p><p>é¦–å…ˆï¼ŒæŠŠ <code>Obj</code> ç±»å®ç°çš„æ¥å£  <code>Serializable</code> æ›¿æ¢ä¸º <code>Externalizable</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> <span class="keyword">implements</span> <span class="title class_">Externalizable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Obj</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Obj&#123;&quot;</span> + <span class="string">&quot;name=&quot;</span> + name + <span class="string">&quot;,age=&quot;</span> + age + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeExternal</span><span class="params">(ObjectOutput out)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readExternal</span><span class="params">(ObjectInput in)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç° <code>Externalizable</code> æ¥å£çš„ <code>Obj</code> ç±»å’Œå®ç° <code>Serializable</code> æ¥å£çš„ <code>Obj</code> ç±»æœ‰ä¸€äº›ä¸åŒï¼š</p><p>1ï¼‰æ–°å¢äº†ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ã€‚</p><p>ä½¿ç”¨ <code>Externalizable</code> è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¢«åºåˆ—åŒ–ç±»çš„æ— å‚æ„é€ æ–¹æ³•å»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åå†å°†è¢«ä¿å­˜å¯¹è±¡çš„å­—æ®µå€¼å¤åˆ¶è¿‡å»ã€‚å¦åˆ™çš„è¯ï¼Œä¼šæŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException: com.cmower.java_demo.xuliehua1.Obj; no valid constructor</span><br><span class="line">at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:150)</span><br><span class="line">at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:790)</span><br><span class="line">at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1782)</span><br><span class="line">at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1353)</span><br><span class="line">at java.io.ObjectInputStream.readObject(ObjectInputStream.java:373)</span><br><span class="line">at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span><br></pre></td></tr></table></figure><p>2ï¼‰æ–°å¢äº†ä¸¤ä¸ªæ–¹æ³• <code>writeExternal()</code> å’Œ <code>readExternal()</code>ï¼Œå®ç° <code>Externalizable</code> æ¥å£æ‰€å¿…é¡»çš„ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å†åœ¨æµ‹è¯•ç±»ä¸­æ‰“å°åºåˆ—åŒ–å‰å’Œååºåˆ—åŒ–åçš„å¯¹è±¡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// åˆå§‹åŒ–</span><br><span class="line">Obj Obj = new Obj();</span><br><span class="line">Obj.</span><br><span class="line"></span><br><span class="line">setName(&quot;å°ç±³&quot;);</span><br><span class="line">Obj.</span><br><span class="line"></span><br><span class="line">setAge(18);</span><br><span class="line">System.out.</span><br><span class="line"></span><br><span class="line">println(Obj);</span><br><span class="line"></span><br><span class="line">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span><br><span class="line">try(</span><br><span class="line">ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;chenmo&quot;));)&#123;</span><br><span class="line">        oos.</span><br><span class="line"></span><br><span class="line">writeObject(Obj);</span><br><span class="line">&#125;catch(</span><br><span class="line">IOException e)&#123;</span><br><span class="line">        e.</span><br><span class="line"></span><br><span class="line">printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ä»æ–‡ä»¶ä¸­è¯»å‡ºå¯¹è±¡</span><br><span class="line">        try(</span><br><span class="line">ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File(&quot;chenmo&quot;)));)&#123;</span><br><span class="line">Obj Obj1 = (Obj) ois.readObject();</span><br><span class="line">System.out.</span><br><span class="line"></span><br><span class="line">println(Obj1);</span><br><span class="line">&#125;catch(IOException |</span><br><span class="line">ClassNotFoundException e)&#123;</span><br><span class="line">        e.</span><br><span class="line"></span><br><span class="line">printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">// Obj&#123;name=å°ç±³,age=18&#125;</span><br><span class="line">// Obj&#123;name=null,age=0&#125;</span><br></pre></td></tr></table></figure><p>ä»è¾“å‡ºçš„ç»“æœçœ‹ï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„å¯¹è±¡å­—æ®µéƒ½å˜æˆäº†é»˜è®¤å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåºåˆ—åŒ–ä¹‹å‰çš„å¯¹è±¡çŠ¶æ€æ²¡æœ‰è¢«â€œå†»ç»“â€ä¸‹æ¥ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¸º <code>Obj</code> ç±»é‡å†™å…·ä½“çš„ <code>writeExternal()</code> å’Œ <code>readExternal()</code> æ–¹æ³•ã€‚é‚£è¯¥æ€ä¹ˆé‡å†™å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeExternal</span><span class="params">(ObjectOutput out)</span> &#123;</span><br><span class="line">    out.writeObject(name);</span><br><span class="line">    out.writeInt(age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readExternal</span><span class="params">(ObjectInput in)</span> &#123;</span><br><span class="line">    name = (String) in.readObject();</span><br><span class="line">    age = in.readInt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ï¼‰è°ƒç”¨ <code>ObjectOutput</code> çš„ <code>writeObject()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code>name</code> å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›</p><p>2ï¼‰è°ƒç”¨ <code>ObjectOutput</code> çš„ <code>writeInt()</code> æ–¹æ³•å°†æ•´å‹çš„ <code>age</code> å†™å…¥åˆ°è¾“å‡ºæµä¸­ï¼›</p><p>3ï¼‰è°ƒç”¨ <code>ObjectInput</code> çš„ <code>readObject()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code>name</code> è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›</p><p>4ï¼‰è°ƒç”¨ <code>ObjectInput</code> çš„ <code>readInt()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç±»å‹çš„ <code>age</code> è¯»å…¥åˆ°è¾“å…¥æµä¸­ï¼›</p><p>å†è¿è¡Œä¸€æ¬¡æµ‹è¯•äº†ç±»ï¼Œä½ ä¼šå‘ç°å¯¹è±¡å¯ä»¥æ­£å¸¸åœ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†ã€‚</p><blockquote><p>åºåˆ—åŒ–å‰ï¼šObj{name&#x3D;å°ç±³,age&#x3D;18}<br>åºåˆ—åŒ–åï¼šObj{name&#x3D;å°ç±³,age&#x3D;18}</p></blockquote><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>Externalizable å’Œ Serializable éƒ½æ˜¯ç”¨äºå®ç° Java å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¥å£ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><p>â‘ ã€Serializable æ˜¯ Java æ ‡å‡†åº“æä¾›çš„æ¥å£ï¼Œè€Œ Externalizable æ˜¯ Serializable çš„å­æ¥å£;</p><p>â‘¡ã€Serializable æ¥å£ä¸éœ€è¦å®ç°ä»»ä½•æ–¹æ³•ï¼Œåªéœ€è¦å°†éœ€è¦åºåˆ—åŒ–çš„ç±»æ ‡è®°ä¸º Serializable å³å¯ï¼Œè€Œ Externalizable æ¥å£éœ€è¦å®ç°<br>writeExternal å’Œ readExternal ä¸¤ä¸ªæ–¹æ³•ï¼›</p><p>â‘¢ã€Externalizable æ¥å£æä¾›äº†æ›´é«˜çš„åºåˆ—åŒ–æ§åˆ¶èƒ½åŠ›ï¼Œå¯ä»¥åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹å¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„å¤„ç†ï¼Œå¦‚å¯¹ä¸€äº›æ•æ„Ÿä¿¡æ¯è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚</p><h3 id="é¢å¤–"><a href="#é¢å¤–" class="headerlink" title="é¢å¤–"></a>é¢å¤–</h3><p>ä½ çŸ¥é“ <code> private static final long serialVersionUID = -2095916884810199532L;</code> è¿™æ®µä»£ç çš„ä½œç”¨å—ï¼Ÿ</p><p><code>serialVersionUID</code> è¢«ç§°ä¸ºåºåˆ—åŒ– IDï¼Œå®ƒæ˜¯å†³å®š Java å¯¹è±¡èƒ½å¦ååºåˆ—åŒ–æˆåŠŸçš„é‡è¦å› å­ã€‚åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒJava<br>è™šæ‹Ÿæœºä¼šæŠŠå­—èŠ‚æµä¸­çš„ <code>serialVersionUID</code> ä¸è¢«åºåˆ—åŒ–ç±»ä¸­çš„ <code>serialVersionUID</code> è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™å¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºåºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ã€‚</p><p>å½“ä¸€ä¸ªç±»å®ç°äº† <code>Serializable</code> æ¥å£åï¼ŒIDE å°±ä¼šæé†’è¯¥ç±»æœ€å¥½äº§ç”Ÿä¸€ä¸ªåºåˆ—åŒ– IDï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><p>1ï¼‰æ·»åŠ ä¸€ä¸ªé»˜è®¤ç‰ˆæœ¬çš„åºåˆ—åŒ– IDï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br></pre></td></tr></table></figure><p>2ï¼‰æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„ä¸é‡å¤çš„åºåˆ—åŒ– IDã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br></pre></td></tr></table></figure><p>3ï¼‰æ·»åŠ  <code>@SuppressWarnings</code> æ³¨è§£ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@SuppressWarnings(&quot;serial&quot;);</span><br></pre></td></tr></table></figure><p>æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§åŠæ³•ï¼Œåœ¨è¢«åºåˆ—åŒ–ç±»ä¸­æ·»åŠ ä¸€ä¸ªéšæœºç”Ÿæˆçš„åºåˆ—åŒ– IDã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199532L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–ä»£ç å¿½ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåºåˆ—åŒ–ä¸€ä¸ª <code>Obj</code> å¯¹è±¡åˆ°æ–‡ä»¶ä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// åˆå§‹åŒ–</span><br><span class="line">Obj Obj = new Obj();</span><br><span class="line">Obj.setName(&quot;å°ç±³&quot;);</span><br><span class="line">Obj.setAge(18);</span><br><span class="line">System.out.println(Obj);</span><br><span class="line"></span><br><span class="line">// æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶ä¸­</span><br><span class="line">try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;chenmo&quot;));) &#123;</span><br><span class="line">oos.writeObject(Obj);</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬æ‚„æ‚„åœ°æŠŠ <code>Obj</code> ç±»çš„åºåˆ—åŒ– ID å·æ¢æ¢æŸ±ä¸€ä¸‹ï¼Œå˜¿å˜¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// private static final long serialVersionUID = -2095916884810199532L;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> -<span class="number">2095916884810199533L</span>;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå‡†å¤‡ååºåˆ—åŒ–å§ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">try(ObjectInputStream ois = new ObjectInputStream(new FileInputStream(new File(&quot;chenmo&quot;)));)&#123;</span><br><span class="line">Obj Obj = (Obj) ois.readObject();</span><br><span class="line">System.out.</span><br><span class="line"></span><br><span class="line">println(Obj);</span><br><span class="line">&#125;catch(IOException |</span><br><span class="line">ClassNotFoundException e)&#123;</span><br><span class="line">        e.</span><br><span class="line"></span><br><span class="line">printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å“å‘€ï¼Œå‡ºé”™äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException:  local class incompatible: stream classdesc </span><br><span class="line">serialVersionUID = -2095916884810199532,</span><br><span class="line">local class serialVersionUID = -2095916884810199533</span><br><span class="line">at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)</span><br><span class="line">at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œä»æŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID å’Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚</p><p>é‚£å‡å¦‚æˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä¸º <code>Obj</code> ç±»æ·»åŠ ä¸ª <code>@SuppressWarnings(&quot;serial&quot;)</code> æ³¨è§£å‘¢ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"><span class="comment">// çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œå†æ¥ä¸€æ¬¡ååºåˆ—åŒ–å§ã€‚å¯æƒœä¾ç„¶æŠ¥é”™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException:  local class incompatible: stream classdesc </span><br><span class="line">serialVersionUID = -2095916884810199532, </span><br><span class="line">local class serialVersionUID = -3818877437117647968</span><br><span class="line">at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)</span><br><span class="line">at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span><br></pre></td></tr></table></figure><p>å¼‚å¸¸å †æ ˆä¿¡æ¯é‡Œé¢å‘Šè¯‰æˆ‘ä»¬ï¼Œæœ¬åœ°çš„åºåˆ—åŒ– ID ä¸º -3818877437117647968ï¼Œå’ŒæŒä¹…åŒ–æ–‡ä»¶é‡Œé¢è¯»å–åˆ°çš„åºåˆ—åŒ– ID<br>ä»ç„¶ä¸ä¸€è‡´ï¼Œæ— æ³•ååºåˆ—åŒ–ã€‚è¿™è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨ <code>@SuppressWarnings(&quot;serial&quot;)</code> æ³¨è§£æ—¶ï¼Œè¯¥æ³¨è§£ä¼šä¸ºè¢«åºåˆ—åŒ–ç±»è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªéšæœºçš„åºåˆ—åŒ–<br>IDã€‚</p><p>ç”±æ­¤å¯ä»¥è¯æ˜ï¼Œ**Java è™šæ‹Ÿæœºæ˜¯å¦å…è®¸ååºåˆ—åŒ–ï¼Œä¸ä»…å–å†³äºç±»è·¯å¾„å’ŒåŠŸèƒ½ä»£ç æ˜¯å¦ä¸€è‡´ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ å°±æ˜¯åºåˆ—åŒ– ID æ˜¯å¦ä¸€è‡´<br>**ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œé‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ– IDï¼ˆ1Lï¼‰å°±å¯ä»¥ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä»£ç ä¸€è‡´æ—¶ååºåˆ—åŒ–æˆåŠŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Obj</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"><span class="comment">// çœç•¥å…¶ä»–ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaæ ¸å¿ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java IO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OSSåŸºæœ¬æ“ä½œ</title>
      <link href="/article/112218.html"/>
      <url>/article/112218.html</url>
      
        <content type="html"><![CDATA[<h3 id="å¼€é€š-OSS"><a href="#å¼€é€š-OSS" class="headerlink" title="å¼€é€š OSS"></a>å¼€é€š OSS</h3><p>OSS ä¹Ÿå°±æ˜¯ Object Storage Serviceï¼Œæ˜¯é˜¿é‡Œäº‘æä¾›çš„ä¸€å¥—å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œå›½å†…çš„ç«å“è¿˜æœ‰ä¸ƒç‰›äº‘çš„ Kodoå’Œè…¾è®¯äº‘çš„COSã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œç™»å½•é˜¿é‡Œäº‘å®˜ç½‘ï¼Œæœç´¢â€œOSSâ€å…³é”®å­—ï¼Œè¿›å…¥ OSS äº§å“é¡µã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œå¦‚æœæ˜¯ OSS æ–°ç”¨æˆ·çš„è¯ï¼Œå¯ä»¥äº«å— 6 ä¸ªæœˆçš„æ–°äººä¸“äº«ä¼˜æƒ ä»·ï¼Œä¸è¿‡ç»­è´¹çš„æ—¶å€™è¿˜æ˜¯ä¼šè‚‰ç–¼ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œè¿›å…¥ OSS ç®¡ç†æ§åˆ¶å°ï¼Œç‚¹å‡»ã€ŒBucket åˆ—è¡¨ã€ï¼Œç‚¹å‡»ã€Œåˆ›å»º Bucketã€ã€‚</p><p>Bucket çš„è¯é¢æ„æ€æ˜¯æ¡¶ï¼Œè¿™é‡ŒæŒ‡å­˜å‚¨ç©ºé—´ï¼Œå°±æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡çš„å®¹å™¨ã€‚æ³¨æ„è¯»å†™æƒé™ä¸ºâ€œå…¬å…±è¯»â€ï¼Œä¹Ÿå°±æ˜¯å…è®¸äº’è”ç½‘ç”¨æˆ·è®¿é—®äº‘ç©ºé—´ä¸Šçš„å›¾ç‰‡ã€‚</p><p>ç¬¬å››æ­¥ï¼Œç‚¹å‡»ã€Œç¡®å®šã€å°±ç®—æ˜¯å¼€é€šæˆåŠŸäº†ã€‚</p><h3 id="æ•´åˆ-OSS"><a href="#æ•´åˆ-OSS" class="headerlink" title="æ•´åˆ OSS"></a>æ•´åˆ OSS</h3><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ  OSS çš„ä¾èµ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- é˜¿é‡Œäº‘ OSS --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.10.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œåœ¨ application.yml æ–‡ä»¶ä¸­æ·»åŠ  OSS é…ç½®é¡¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">aliyun:</span><br><span class="line">  oss:</span><br><span class="line">      # osså¯¹å¤–æœåŠ¡çš„è®¿é—®åŸŸå</span><br><span class="line">    endpoint: oss-cn-beijing.aliyuncs.com</span><br><span class="line">      # è®¿é—®èº«ä»½éªŒè¯ä¸­ç”¨åˆ°ç”¨æˆ·æ ‡è¯†</span><br><span class="line">    accessKeyId: LTAI5</span><br><span class="line">      # ç”¨æˆ·ç”¨äºåŠ å¯†ç­¾åå­—ç¬¦ä¸²å’Œossç”¨æ¥éªŒè¯ç­¾åå­—ç¬¦ä¸²çš„å¯†é’¥</span><br><span class="line">    accessKeySecret: RYN</span><br><span class="line">      # ossçš„å­˜å‚¨ç©ºé—´</span><br><span class="line">    bucketName: itwanger-oss1</span><br><span class="line">      # ä¸Šä¼ æ–‡ä»¶å¤§å°(M)</span><br><span class="line">    maxSize: 3</span><br><span class="line">      # ä¸Šä¼ æ–‡ä»¶å¤¹è·¯å¾„å‰ç¼€</span><br><span class="line">    dir:</span><br><span class="line">      prefix: codingmore/images/</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œæ–°å¢ OssClientConfig.java é…ç½®ç±»ï¼Œä¸»è¦å°±æ˜¯é€šè¿‡  @Value æ³¨è§£ä»é…ç½®æ–‡ä»¶ä¸­è·å–é…ç½®é¡¹ï¼Œç„¶ååˆ›å»º OSSClientã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssClientConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span></span><br><span class="line">    String endpoint ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.accessKeyId&#125;&quot;)</span></span><br><span class="line">    String accessKeyId ;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.accessKeySecret&#125;&quot;)</span></span><br><span class="line">    String accessKeySecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OSSClient <span class="title function_">createOssClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (OSSClient)<span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬å››æ­¥ï¼Œæ–°å¢æ–‡ä»¶ä¸Šä¼ æ¥å£ OssController.javaï¼Œå‚æ•°ä¸º MultipartFileã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;ä¸Šä¼ &quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ossController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IOssService ossService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/upload&quot;,method=RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;ä¸Šä¼ &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResultObject&lt;String&gt; <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, HttpServletRequest req)</span>  &#123;</span><br><span class="line">        <span class="keyword">return</span> ResultObject.success(ossService.upload(file));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äº”æ­¥ï¼Œæ–°å¢ Serviceï¼Œå°†æ–‡ä»¶ä¸Šä¼ åˆ° OSSï¼Œå¹¶è¿”å›æ–‡ä»¶ä¿å­˜è·¯å¾„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IOssService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.maxSize&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxSize;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.bucketName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.dir.prefix&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dirPrefix;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OSSClient ossClient;   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> upload(file.getInputStream(), file.getOriginalFilename());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOGGER.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(InputStream inputStream,String name)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> getBucketName(name);</span><br><span class="line">        <span class="comment">// åˆ›å»ºPutObjectè¯·æ±‚ã€‚</span></span><br><span class="line">        ossClient.putObject(bucketName, objectName, inputStream);</span><br><span class="line">        <span class="keyword">return</span> formatPath(objectName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getBucketName</span><span class="params">(String url)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ext</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(String extItem:imageExtension)&#123;</span><br><span class="line">            <span class="keyword">if</span>(url.indexOf(extItem) != -<span class="number">1</span>)&#123;</span><br><span class="line">                ext = extItem;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dirPrefix+ DateUtil.today()+<span class="string">&quot;/&quot;</span>+ IdUtil.randomUUID()+ext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">formatPath</span><span class="params">(String objectName)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;https://&quot;</span>  +bucketName+<span class="string">&quot;.&quot;</span>+ ossClient.getEndpoint().getHost() + <span class="string">&quot;/&quot;</span> + objectName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨-OSS-è¿›è¡Œè‡ªåŠ¨è½¬é“¾"><a href="#åˆ©ç”¨-OSS-è¿›è¡Œè‡ªåŠ¨è½¬é“¾" class="headerlink" title="åˆ©ç”¨ OSS è¿›è¡Œè‡ªåŠ¨è½¬é“¾"></a>åˆ©ç”¨ OSS è¿›è¡Œè‡ªåŠ¨è½¬é“¾</h3><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨ PostsServiceImpl.java ä¸­æ·»åŠ å›¾ç‰‡è½¬é“¾çš„æ–¹æ³•ï¼Œä¸»è¦åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ‰¾å‡ºæ–‡ç« å†…å®¹ä¸­çš„å¤–é“¾ï¼Œç„¶åå°†å¤–é“¾çš„å›¾ç‰‡ä¸Šä¼ åˆ° OSSï¼Œç„¶åå†æ›¿æ¢æ‰åŸæ¥çš„å¤–é“¾å›¾ç‰‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒ¹é…å›¾ç‰‡çš„ markdown è¯­æ³•</span></span><br><span class="line"><span class="comment">// ![](hhhx.png)</span></span><br><span class="line"><span class="comment">// ![xx](hhhx.png?ax)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IMG_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;\\!\\[.*\\]\\((.*)\\)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleContentImg</span><span class="params">(Posts posts)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> posts.getPostContent();</span><br><span class="line"></span><br><span class="line">    <span class="type">Pattern</span> <span class="variable">p</span> <span class="operator">=</span> Pattern.compile(IMG_PATTERN, Pattern.CASE_INSENSITIVE);</span><br><span class="line">    <span class="type">Matcher</span> <span class="variable">m</span> <span class="operator">=</span> p.matcher(content);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Future&lt;String&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (m.find()) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">imageTag</span> <span class="operator">=</span> m.group();</span><br><span class="line">        LOGGER.info(<span class="string">&quot;ä½¿ç”¨åˆ†ç»„è¿›è¡Œæ›¿æ¢&#123;&#125;&quot;</span>, imageTag);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">imageUrl</span> <span class="operator">=</span> imageTag.substring(imageTag.indexOf(<span class="string">&quot;(&quot;</span>) + <span class="number">1</span>, imageTag.indexOf(<span class="string">&quot;)&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¡®è®¤æ˜¯æœ¬ç«™é“¾æ¥ï¼Œä¸å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (imageUrl.indexOf(iOssService.getEndPoint()) != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡çº¿ç¨‹æ± å°†å›¾ç‰‡ä¸Šä¼ åˆ° OSS</span></span><br><span class="line">        Future&lt;String&gt; future = ossUploadImageExecutor.submit(() -&gt; iOssService.upload(imageUrl));</span><br><span class="line">        map.put(imageUrl, future);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (String oldUrl : map.keySet()) &#123;</span><br><span class="line">        Future&lt;String&gt; future = map.get(oldUrl);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">imageUrl</span> <span class="operator">=</span> future.get();</span><br><span class="line">           content = content.replace(oldUrl, imageUrl);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">&quot;è·å–å›¾ç‰‡é“¾æ¥å‡ºé”™&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    posts.setPostContent(content);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œåœ¨ OssServiceImpl.java ä¸­æ·»åŠ æ ¹æ®å¤–é“¾åœ°å€ä¸Šä¼ å›¾ç‰‡åˆ° OSS çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">objectName</span> <span class="operator">=</span> getFileName(url);</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url).openStream()) &#123;</span><br><span class="line">        ossClient.putObject(bucketName, objectName, inputStream);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        LOGGER.error(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> formatOSSPath(objectName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaä¼ä¸šçº§å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024å¹´å…è´¹åŸŸåæ³¨å†Œç½‘ç«™å¤§å…¨(æŒç»­æ›´æ–°,å»ºè®®æ”¶è—)</title>
      <link href="/article/112230.html"/>
      <url>/article/112230.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŸŸåå…è´¹ä¹Ÿèƒ½æ‹¥æœ‰ï¼Œä½ çš„ç½‘ç»œåç‰‡ç”±ä½ å®šä¹‰ï¼"><a href="#åŸŸåå…è´¹ä¹Ÿèƒ½æ‹¥æœ‰ï¼Œä½ çš„ç½‘ç»œåç‰‡ç”±ä½ å®šä¹‰ï¼" class="headerlink" title="åŸŸåå…è´¹ä¹Ÿèƒ½æ‹¥æœ‰ï¼Œä½ çš„ç½‘ç»œåç‰‡ç”±ä½ å®šä¹‰ï¼"></a>åŸŸåå…è´¹ä¹Ÿèƒ½æ‹¥æœ‰ï¼Œä½ çš„ç½‘ç»œåç‰‡ç”±ä½ å®šä¹‰ï¼</h2><p>åŸŸåï¼Œå¦‚åŒäº’è”ç½‘ä¸Šçš„é—¨ç‰Œå·ï¼Œæ˜¯æˆ‘ä»¬åœ¨æ•°å­—ä¸–ç•Œä¸­çš„èº«ä»½è±¡å¾ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œæ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„åŸŸåï¼Œæ˜¯è¿ˆå…¥ç½‘ç»œä¸–ç•Œçš„ç¬¬ä¸€æ­¥ã€‚</p><p>ç„¶è€Œï¼Œå¯¹äºæ²¡æœ‰å»ºç«™éœ€æ±‚æˆ–åªæ˜¯ä¸´æ—¶ä½¿ç”¨åŸŸåçš„äººæ¥è¯´ï¼ŒèŠ±é’±è´­ä¹°åŸŸåä¼¼ä¹æœ‰äº›æµªè´¹ã€‚éš¾é“å°±æ²¡æœ‰å…è´¹çš„åŸŸåå¯ä¾›é€‰æ‹©å—ï¼Ÿ</p><p>å½“ç„¶æœ‰ï¼ä»Šå¤©ï¼Œå°±è®©æˆ‘ä»¬ä¸€èµ·æ¢ç§˜å…è´¹åŸŸåæ³¨å†Œçš„å¥‡å¦™ä¸–ç•Œï¼Œå¼€å¯ä½ çš„ä¸ªæ€§åŒ–ç½‘ç»œä¹‹æ—…ï¼</p>]]></content>
      
      
      <categories>
          
          <category> åŸŸå </category>
          
          <category> ç™½å«– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸŸå </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZooKeeperä¸€çœ‹ä¸€ä¸ªä¸å±å£°</title>
      <link href="/article/112221.html"/>
      <url>/article/112221.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h2><p>Apache ZooKeeper æ˜¯ç”±Apache Hadoopçš„å­é¡¹ç›®å‘å±•è€Œæ¥ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›é«˜æ•ˆä¸”å¯é çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ã€‚</p><p>åœ¨è§£å†³åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§æ–¹é¢ï¼ŒZKæ²¡æœ‰ç›´æ¥é‡‡ç”¨Paxosç®—æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ZABï¼ˆZooKeeper Atomic Broadcastï¼‰åè®®ã€‚<br>ZKå¯ä»¥æä¾›è¯¸å¦‚æ•°æ®å‘å¸ƒ&#x2F;è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ&#x2F;é€šçŸ¥ï¼Œé›†ç¾¤ç®¡ç†ï¼ŒMasteré€‰ä¸¾ï¼Œåˆ†å¸ƒå¼é”ï¼Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚</p><p>ã€Œå®ƒå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼šã€</p><ul><li>ã€Œé¡ºåºä¸€è‡´æ€§ã€ï¼šä»ä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆéƒ½ä¼šä¸¥æ ¼æŒ‰ç…§å…¶å‘èµ·é¡ºåºè¢«åº”ç”¨åˆ° Zookeeper ä¸­ï¼›</li><li>ã€ŒåŸå­æ€§ã€ï¼šè¦ä¹ˆæ‰€æœ‰åº”ç”¨ï¼Œè¦ä¹ˆä¸åº”ç”¨ï¼›ä¸å­˜åœ¨éƒ¨åˆ†æœºå™¨åº”ç”¨äº†è¯¥äº‹åŠ¡ï¼Œè€Œã€Œå¦ä¸€éƒ¨åˆ†æ²¡æœ‰åº”ç”¨ã€çš„æƒ…å†µï¼›</li><li>ã€Œå•ä¸€è§†å›¾ã€ï¼šæ‰€æœ‰å®¢æˆ·ç«¯çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡å‹éƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ— è®ºå®¢æˆ·è¿æ¥çš„æ˜¯å“ªä¸ªZKæœåŠ¡å™¨ï¼›</li><li>ã€Œå¯é æ€§ã€ï¼šä¸€æ—¦æœåŠ¡ç«¯æˆåŠŸåº”ç”¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œåˆ™å…¶å¼•èµ·çš„æ”¹å˜ä¼šä¸€ç›´ä¿ç•™ï¼Œç›´åˆ°è¢«å¦å¤–ä¸€ä¸ªäº‹åŠ¡æ‰€æ›´æ”¹ï¼›</li><li>ã€Œå®æ—¶æ€§ã€ï¼šä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡è¢«æˆåŠŸåº”ç”¨åï¼ŒZookeeper å¯ä»¥ä¿è¯å®¢æˆ·ç«¯ç«‹å³å¯ä»¥è¯»å–åˆ°è¿™ä¸ªäº‹åŠ¡å˜æ›´åçš„æœ€æ–°çŠ¶æ€çš„æ•°æ®ï¼ˆã€Œä¸€æ®µæ—¶é—´ã€ï¼‰ã€‚</li></ul><h2 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h2><p>ZooKeeper ä¸­çš„æ•°æ®æ¨¡å‹æ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ï¼Œéå¸¸åƒç”µè„‘ä¸­çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæœ‰ä¸€ä¸ªæ ¹æ–‡ä»¶å¤¹ï¼Œä¸‹é¢è¿˜æœ‰å¾ˆå¤šå­æ–‡ä»¶å¤¹ã€‚</p><ul><li><p>ZooKeeperçš„æ•°æ®æ¨¡å‹ä¹Ÿå…·æœ‰ä¸€ä¸ªå›ºå®šçš„æ ¹èŠ‚ç‚¹<code>ï¼ˆ/ï¼‰</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ¹èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ï¼Œå¹¶åœ¨å­èŠ‚ç‚¹ä¸‹ç»§ç»­åˆ›å»ºä¸‹ä¸€çº§èŠ‚ç‚¹ã€‚</p></li><li><p>ZooKeeper æ ‘ä¸­çš„æ¯ä¸€å±‚çº§ç”¨æ–œæ <code>ï¼ˆ/ï¼‰</code>åˆ†éš”å¼€ï¼Œä¸”åªèƒ½ç”¨ç»å¯¹è·¯å¾„ï¼ˆå¦‚<code>get /work/task</code>ï¼‰çš„æ–¹å¼æŸ¥è¯¢ ZooKeeper èŠ‚ç‚¹ï¼Œè€Œä¸èƒ½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚</p></li></ul><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/shujumoxing-1.png"></p><p><strong>ã€Œä¸ºä»€ä¹ˆ ZooKeeper ä¸èƒ½é‡‡ç”¨ç›¸å¯¹è·¯å¾„æŸ¥æ‰¾èŠ‚ç‚¹å‘¢ï¼Ÿã€</strong></p><blockquote><p>â</p><p>è¿™æ˜¯å› ä¸º ZooKeeper å¤§å¤šæ˜¯åº”ç”¨åœºæ™¯æ˜¯å®šä½æ•°æ®æ¨¡å‹ä¸Šçš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨ç›¸å…³èŠ‚ç‚¹ä¸Šè¿›è¡Œæ“ä½œã€‚</p><p>â</p></blockquote><p>åƒè¿™ç§æŸ¥æ‰¾ä¸ç»™å®šå€¼ç›¸ç­‰çš„è®°å½•é—®é¢˜æœ€é€‚åˆç”¨æ•£åˆ—æ¥è§£å†³ã€‚</p><p>å› æ­¤ ZooKeeper åœ¨åº•å±‚å®ç°çš„æ—¶å€™ï¼Œä½¿ç”¨äº†ä¸€ä¸ª hashtableï¼Œå³ <code>hashtableConcurrentHashMap&lt;String, DataNode&gt; nodes</code>ï¼Œç”¨èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„æ¥ä½œä¸º key å­˜å‚¨èŠ‚ç‚¹æ•°æ®ã€‚</p><p>è¿™æ ·å°±å¤§å¤§æé«˜äº† ZooKeeper çš„æ€§èƒ½ã€‚</p><p><strong>ã€ŒèŠ‚ç‚¹ç±»å‹ã€</strong></p><p>ZooKeeper ä¸­çš„æ•°æ®èŠ‚ç‚¹ä¹Ÿåˆ†ä¸ºæŒä¹…èŠ‚ç‚¹ã€ä¸´æ—¶èŠ‚ç‚¹å’Œæœ‰åºèŠ‚ç‚¹ä¸‰ç§ç±»å‹ï¼š</p><blockquote><p>â</p><p>1ã€æŒä¹…èŠ‚ç‚¹</p><p>â</p></blockquote><p>ä¸€æ—¦å°†èŠ‚ç‚¹åˆ›å»ºä¸ºæŒä¹…èŠ‚ç‚¹ï¼Œè¯¥æ•°æ®èŠ‚ç‚¹ä¼šä¸€ç›´å­˜å‚¨åœ¨ ZooKeeper æœåŠ¡å™¨ä¸Šï¼Œå³ä½¿åˆ›å»ºè¯¥èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„ä¼šè¯å…³é—­äº†ï¼Œè¯¥èŠ‚ç‚¹ä¾ç„¶ä¸ä¼šè¢«åˆ é™¤ã€‚å¦‚æœæˆ‘ä»¬æƒ³åˆ é™¤æŒä¹…èŠ‚ç‚¹ï¼Œå°±è¦æ˜¾å¼è°ƒç”¨ delete å‡½æ•°è¿›è¡Œåˆ é™¤æ“ä½œã€‚</p><blockquote><p>â</p><p>2ã€ä¸´æ—¶èŠ‚ç‚¹</p><p>â</p></blockquote><p>å¦‚æœå°†èŠ‚ç‚¹åˆ›å»ºä¸ºä¸´æ—¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹æ•°æ®ä¸ä¼šä¸€ç›´å­˜å‚¨åœ¨ ZooKeeper æœåŠ¡å™¨ä¸Šã€‚</p><p>å½“åˆ›å»ºè¯¥ä¸´æ—¶èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ä¼šè¯å› è¶…æ—¶æˆ–å‘ç”Ÿå¼‚å¸¸è€Œå…³é—­æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¹Ÿç›¸åº”åœ¨ ZooKeeper æœåŠ¡å™¨ä¸Šè¢«åˆ é™¤ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åƒåˆ é™¤æŒä¹…èŠ‚ç‚¹ä¸€æ ·ä¸»åŠ¨åˆ é™¤ä¸´æ—¶èŠ‚ç‚¹ã€‚</p><p>åœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸´æ—¶èŠ‚ç‚¹çš„è¿™ä¸€ç‰¹æ€§æ¥åšæœåŠ¡å™¨é›†ç¾¤å†…æœºå™¨è¿è¡Œæƒ…å†µçš„ç»Ÿè®¡ï¼Œå°†é›†ç¾¤è®¾ç½®ä¸º<code>/servers</code>èŠ‚ç‚¹ï¼Œå¹¶ä¸ºé›†ç¾¤ä¸‹çš„æ¯å°æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹<code>/servers/host</code>ï¼Œå½“æœåŠ¡å™¨ä¸‹çº¿æ—¶è¯¥èŠ‚ç‚¹è‡ªåŠ¨è¢«åˆ é™¤ï¼Œæœ€åç»Ÿè®¡ä¸´æ—¶èŠ‚ç‚¹ä¸ªæ•°å°±å¯ä»¥çŸ¥é“é›†ç¾¤ä¸­çš„è¿è¡Œæƒ…å†µã€‚</p><blockquote><p>â</p><p>3ã€æœ‰åºèŠ‚ç‚¹</p><p>â</p></blockquote><p>èŠ‚ç‚¹æœ‰åºæ˜¯è¯´åœ¨æˆ‘ä»¬åˆ›å»ºæœ‰åºèŠ‚ç‚¹çš„æ—¶å€™ï¼ŒZooKeeper æœåŠ¡å™¨ä¼šè‡ªåŠ¨ä½¿ç”¨ä¸€ä¸ªå•è°ƒé€’å¢çš„æ•°å­—ä½œä¸ºåç¼€ï¼Œè¿½åŠ åˆ°æˆ‘ä»¬åˆ›å»ºèŠ‚ç‚¹çš„åè¾¹ã€‚</p><p>ä¾‹å¦‚ä¸€ä¸ªå®¢æˆ·ç«¯åˆ›å»ºäº†ä¸€ä¸ªè·¯å¾„ä¸º <code>works/task-</code>çš„æœ‰åºèŠ‚ç‚¹ï¼Œé‚£ä¹ˆ ZooKeeper å°†ä¼šç”Ÿæˆä¸€ä¸ªåºå·å¹¶è¿½åŠ åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„åï¼Œæœ€åè¯¥èŠ‚ç‚¹çš„è·¯å¾„ä¸º<code>works/task-1</code>ã€‚</p><ul><li>é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å¯ä»¥ç›´è§‚çš„æŸ¥çœ‹åˆ°èŠ‚ç‚¹çš„åˆ›å»ºé¡ºåºã€‚</li></ul><p>ZooKeeper ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤æœ‰è¿™äº›å†…å®¹ï¼šä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„<code>ï¼ˆbyte data[]ï¼‰</code>ï¼Œç”¨æ¥å­˜å‚¨èŠ‚ç‚¹çš„æ•°æ®ã€ACL è®¿é—®æ§åˆ¶ä¿¡æ¯ã€å­èŠ‚ç‚¹æ•°æ®ï¼ˆå› ä¸ºä¸´æ—¶èŠ‚ç‚¹ä¸å…è®¸æœ‰å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥å…¶å­èŠ‚ç‚¹å­—æ®µä¸º nullï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–æ¯ä¸ªæ•°æ®èŠ‚ç‚¹è¿˜æœ‰ä¸€ä¸ªè®°å½•è‡ªèº«çŠ¶æ€ä¿¡æ¯çš„å­—æ®µ statã€‚</p><p><strong>ã€ŒèŠ‚ç‚¹çš„çŠ¶æ€ç»“æ„ã€</strong></p><p>æ‰§è¡Œ<code>stat /zk_test</code>ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºäº†ä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›å°±æ˜¯èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ã€‚</p><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„çŠ¶æ€å±æ€§ï¼Œè®°å½•äº†èŠ‚ç‚¹æœ¬èº«çš„ä¸€äº›ä¿¡æ¯ï¼š</p><table><thead><tr><th><strong>ã€ŒçŠ¶æ€å±æ€§ã€</strong></th><th><strong>ã€Œè¯´æ˜ã€</strong></th></tr></thead><tbody><tr><td>czxid</td><td>æ•°æ®èŠ‚ç‚¹åˆ›å»ºæ—¶çš„äº‹åŠ¡ ID</td></tr><tr><td>ctime</td><td>æ•°æ®èŠ‚ç‚¹åˆ›å»ºæ—¶çš„æ—¶é—´</td></tr><tr><td>mzxid</td><td>æ•°æ®èŠ‚ç‚¹æœ€åä¸€æ¬¡æ›´æ–°æ—¶çš„äº‹åŠ¡ ID</td></tr><tr><td>mtime</td><td>æ•°æ®èŠ‚ç‚¹æœ€åä¸€æ¬¡æ›´æ–°æ—¶çš„æ—¶é—´</td></tr><tr><td>pzxid</td><td>æ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æœ€åä¸€æ¬¡è¢«ä¿®æ”¹æ—¶çš„äº‹åŠ¡ ID</td></tr><tr><td><strong>ã€Œcversionã€</strong></td><td><strong>ã€Œå­èŠ‚ç‚¹çš„ç‰ˆæœ¬ã€</strong></td></tr><tr><td><strong>ã€Œversionã€</strong></td><td><strong>ã€Œå½“å‰èŠ‚ç‚¹æ•°æ®çš„ç‰ˆæœ¬ã€</strong></td></tr><tr><td><strong>ã€Œaversionã€</strong></td><td><strong>ã€ŒèŠ‚ç‚¹çš„ ACL çš„ç‰ˆæœ¬ã€</strong></td></tr><tr><td>ephemeralOwner</td><td>å¦‚æœèŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œåˆ™è¡¨ç¤ºåˆ›å»ºè¯¥èŠ‚ç‚¹çš„ä¼šè¯çš„ SessionIDï¼›å¦‚æœèŠ‚ç‚¹æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Œåˆ™è¯¥å±æ€§å€¼ä¸º 0</td></tr><tr><td>dataLength</td><td>æ•°æ®å†…å®¹çš„é•¿åº¦</td></tr><tr><td>numChildren</td><td>æ•°æ®èŠ‚ç‚¹å½“å‰çš„å­èŠ‚ç‚¹ä¸ªæ•°</td></tr></tbody></table><p><strong>ã€Œæ•°æ®èŠ‚ç‚¹çš„ç‰ˆæœ¬ã€</strong></p><p>åœ¨ ZooKeeper ä¸­ä¸ºæ•°æ®èŠ‚ç‚¹å¼•å…¥äº†ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œæ¯ä¸ªæ•°æ®èŠ‚ç‚¹æœ‰ 3 ç§ç±»å‹çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå¯¹æ•°æ®èŠ‚ç‚¹çš„ä»»ä½•æ›´æ–°æ“ä½œéƒ½ä¼šå¼•èµ·ç‰ˆæœ¬å·çš„å˜åŒ–ã€‚</p><p>ZooKeeper çš„ç‰ˆæœ¬ä¿¡æ¯è¡¨ç¤ºçš„æ˜¯å¯¹èŠ‚ç‚¹æ•°æ®å†…å®¹ã€å­èŠ‚ç‚¹ä¿¡æ¯æˆ–è€…æ˜¯ ACL ä¿¡æ¯çš„ä¿®æ”¹æ¬¡æ•°ã€‚</p><h2 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h2><p>ä»å­˜å‚¨ä½ç½®ä¸Šæ¥è¯´ï¼Œäº‹åŠ¡æ—¥å¿—å’Œæ•°æ®å¿«ç…§ä¸€æ ·ï¼Œéƒ½å­˜å‚¨åœ¨æœ¬åœ°ç£ç›˜ä¸Šï¼›è€Œä»ä¸šåŠ¡è§’åº¦æ¥è®²ï¼Œå†…å­˜æ•°æ®å°±æ˜¯æˆ‘ä»¬åˆ›å»ºæ•°æ®èŠ‚ç‚¹ã€æ·»åŠ ç›‘æ§ç­‰è¯·æ±‚æ—¶ç›´æ¥æ“ä½œçš„æ•°æ®ã€‚</p><p>äº‹åŠ¡æ—¥å¿—æ•°æ®ä¸»è¦ç”¨äºè®°å½•æœ¬åœ°äº‹åŠ¡æ€§ä¼šè¯æ“ä½œï¼Œç”¨äº ZooKeeper é›†ç¾¤æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®åŒæ­¥ã€‚</p><p>äº‹åŠ¡å¿«ç…§åˆ™æ˜¯å°†å†…å­˜æ•°æ®æŒä¹…åŒ–åˆ°æœ¬åœ°ç£ç›˜ã€‚</p><p>â<br>è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ•°æ®å¿«ç…§æ˜¯æ¯é—´éš”ä¸€æ®µæ—¶é—´æ‰æŠŠå†…å­˜æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ç£ç›˜ï¼Œå› æ­¤æ•°æ®å¹¶ä¸ä¼šä¸€ç›´ä¸å†…å­˜æ•°æ®ä¿æŒä¸€è‡´ã€‚<br>â<br>åœ¨å•å° ZooKeeper æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­å› ä¸ºå¼‚å¸¸è€Œå…³é—­æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸¢å¤±ç­‰æƒ…å†µã€‚</p><p>ã€Œå†…å­˜æ•°æ®ã€</p><p>ZooKeeper çš„æ•°æ®æ¨¡å‹å¯ä»¥çœ‹ä½œä¸€æ£µæ ‘å½¢ç»“æ„ï¼Œè€Œæ•°æ®èŠ‚ç‚¹å°±æ˜¯è¿™æ£µæ ‘ä¸Šçš„å¶å­èŠ‚ç‚¹ã€‚</p><p>ä»æ•°æ®å­˜å‚¨çš„è§’åº¦çœ‹ï¼ŒZooKeeper çš„æ•°æ®æ¨¡å‹æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠ ZooKeeper çš„æ•°æ®æ¨¡å‹çœ‹ä½œæ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®åº“ï¼Œè€Œè¿™ä¸ªæ•°æ®åº“ä¸ä½†å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¿˜å­˜å‚¨æ¯ä¸ªæ•°æ®èŠ‚ç‚¹çš„ ACL æƒé™ä¿¡æ¯ä»¥åŠ stat çŠ¶æ€ä¿¡æ¯ç­‰ã€‚</p><p>è€Œåœ¨åº•å±‚å®ç°ä¸­ï¼ŒZooKeeper æ•°æ®æ¨¡å‹æ˜¯é€šè¿‡ DataTree ç±»æ¥å®šä¹‰çš„ã€‚<br>DataTree ç±»å®šä¹‰äº†ä¸€ä¸ª ZooKeeper æ•°æ®çš„å†…å­˜ç»“æ„ã€‚</p><p>DataTree çš„å†…éƒ¨å®šä¹‰ç±» nodes èŠ‚ç‚¹ç±»å‹ã€root æ ¹èŠ‚ç‚¹ä¿¡æ¯ã€å­èŠ‚ç‚¹çš„ WatchManager ç›‘æ§ä¿¡æ¯ç­‰æ•°æ®æ¨¡å‹ä¸­çš„ç›¸å…³ä¿¡æ¯ã€‚</p><p>å¯ä»¥è¯´ï¼Œä¸€ä¸ª DataTree ç±»å®šä¹‰äº† ZooKeeper å†…å­˜æ•°æ®çš„é€»è¾‘ç»“æ„ã€‚</p><p>ã€Œäº‹åŠ¡æ—¥å¿—ã€</p><p>ä¸ºäº†æ•´ä¸ª ZooKeeper é›†ç¾¤ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼ŒLeader æœåŠ¡å™¨ä¼šå‘ ZooKeeper é›†ç¾¤ä¸­çš„å…¶ä»–è§’è‰²æœåŠ¡å‘é€æ•°æ®åŒæ­¥ä¿¡æ¯ï¼Œåœ¨æ¥æ”¶åˆ°æ•°æ®åŒæ­¥ä¿¡æ¯åï¼Œ ZooKeeper é›†ç¾¤ä¸­çš„ Follow å’Œ Observer æœåŠ¡å™¨å°±ä¼šè¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p><p>â<br>è€Œè¿™ä¸¤ç§è§’è‰²æœåŠ¡å™¨æ‰€æ¥æ”¶åˆ°çš„ä¿¡æ¯å°±æ˜¯ Leader æœåŠ¡å™¨çš„äº‹åŠ¡æ—¥å¿—ã€‚<br>â<br>åœ¨æ¥æ”¶åˆ°äº‹åŠ¡æ—¥å¿—åï¼Œå¹¶åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šæ‰§è¡Œã€‚è¿™ç§æ•°æ®åŒæ­¥çš„æ–¹å¼ï¼Œé¿å…äº†ç›´æ¥ä½¿ç”¨å®é™…çš„ä¸šåŠ¡æ•°æ®ï¼Œå‡å°‘äº†ç½‘ç»œä¼ è¾“çš„å¼€é”€ï¼Œæå‡äº†æ•´ä¸ª ZooKeeper é›†ç¾¤çš„æ‰§è¡Œæ€§èƒ½ã€‚</p><h2 id="Watchæœºåˆ¶"><a href="#Watchæœºåˆ¶" class="headerlink" title="Watchæœºåˆ¶"></a>Watchæœºåˆ¶</h2><p>ZooKeeper çš„å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ Watch æœºåˆ¶æ¥è®¢é˜…å½“æœåŠ¡å™¨ä¸ŠæŸä¸€èŠ‚ç‚¹çš„æ•°æ®æˆ–çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶æ”¶åˆ°ç›¸åº”çš„é€šçŸ¥ï¼›</p><p><strong>ã€Œå¦‚ä½•å®ç°ï¼šã€</strong></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘ ZooKeeper å®¢æˆ·ç«¯çš„æ„é€ æ–¹æ³•ä¸­ä¼ é€’ Watcher å‚æ•°çš„æ–¹å¼å®ç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new ZooKeeper(String connectString, int sessionTimeout, Watcher watcher)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„æ„æ€æ˜¯å®šä¹‰äº†ä¸€ä¸ªäº† ZooKeeper å®¢æˆ·ç«¯å¯¹è±¡å®ä¾‹ï¼Œå¹¶ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li><p>connectString æœåŠ¡ç«¯åœ°å€</p></li><li><p>sessionTimeoutï¼šè¶…æ—¶æ—¶é—´</p></li><li><p>Watcherï¼šç›‘æ§äº‹ä»¶</p></li></ul><p>è¿™ä¸ª Watcher å°†ä½œä¸ºæ•´ä¸ª ZooKeeper ä¼šè¯æœŸé—´çš„ä¸Šä¸‹æ–‡ ï¼Œä¸€ç›´è¢«ä¿å­˜åœ¨å®¢æˆ·ç«¯ ZKWatchManager çš„ defaultWatcher ä¸­ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒZooKeeper å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡ getDataã€exists å’Œ getChildren ä¸‰ä¸ªæ¥å£æ¥å‘ ZooKeeper æœåŠ¡å™¨æ³¨å†Œ Watcherï¼Œä»è€Œæ–¹ä¾¿åœ°åœ¨ä¸åŒçš„æƒ…å†µä¸‹æ·»åŠ  Watch äº‹ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getData(String path, Watcher watcher, Stat stat)</span><br></pre></td></tr></table></figure><p>è§¦å‘é€šçŸ¥çš„æ¡ä»¶ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/watch-1.png"></p><p>ä¸Šå›¾ä¸­åˆ—å‡ºäº†å®¢æˆ·ç«¯åœ¨ä¸åŒä¼šè¯çŠ¶æ€ä¸‹ï¼Œç›¸åº”çš„åœ¨æœåŠ¡å™¨èŠ‚ç‚¹æ‰€èƒ½æ”¯æŒçš„äº‹ä»¶ç±»å‹ã€‚</p><ul><li>ä¾‹å¦‚åœ¨å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œå¯ä»¥å¯¹æ•°æ®èŠ‚ç‚¹çš„åˆ›å»ºã€åˆ é™¤ã€æ•°æ®å˜æ›´ã€å­èŠ‚ç‚¹çš„æ›´æ–°ç­‰æ“ä½œè¿›è¡Œç›‘æ§ã€‚</li></ul><p><strong>ã€Œå½“æœåŠ¡ç«¯æŸä¸€èŠ‚ç‚¹å‘ç”Ÿæ•°æ®å˜æ›´æ“ä½œæ—¶ï¼Œæ‰€æœ‰æ›¾ç»è®¾ç½®äº†è¯¥èŠ‚ç‚¹ç›‘æ§äº‹ä»¶çš„å®¢æˆ·ç«¯éƒ½ä¼šæ”¶åˆ°æœåŠ¡å™¨çš„é€šçŸ¥å—ï¼Ÿã€</strong></p><p>ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼ŒWatch äº‹ä»¶çš„è§¦å‘æœºåˆ¶å–å†³äºä¼šè¯çš„è¿æ¥çŠ¶æ€å’Œå®¢æˆ·ç«¯æ³¨å†Œäº‹ä»¶çš„ç±»å‹ï¼Œæ‰€ä»¥å½“å®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€æˆ–æ•°æ®èŠ‚ç‚¹å‘ç”Ÿæ”¹å˜æ—¶ï¼Œéƒ½ä¼šè§¦å‘å¯¹åº”çš„ Watch äº‹ä»¶ã€‚</p><p><strong>ã€Œè®¢é˜…å‘å¸ƒåœºæ™¯å®ç°ã€</strong></p><blockquote><p>â</p><p>æåˆ° ZooKeeper çš„åº”ç”¨åœºæ™¯ï¼Œä½ å¯èƒ½ç¬¬ä¸€æ—¶é—´ä¼šæƒ³åˆ°æœ€ä¸ºå…¸å‹çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ã€‚</p><p>â</p></blockquote><p>å‘å¸ƒè®¢é˜…åŠŸèƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå³ä¸€ä¸ªæœåŠ¡æˆ–æ•°æ®çš„å‘å¸ƒè€…å¯ä»¥è¢«å¤šä¸ªä¸åŒçš„æ¶ˆè´¹è€…è°ƒç”¨ã€‚</p><p>ä¸€èˆ¬ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼çš„æ•°æ®äº¤äº’å¯ä»¥åˆ†ä¸ºæ¶ˆè´¹è€…ä¸»åŠ¨è¯·æ±‚ç”Ÿäº§è€…ä¿¡æ¯çš„æ‹‰å–æ¨¡å¼ï¼Œå’Œç”Ÿäº§è€…æ•°æ®å˜æ›´æ—¶ä¸»åŠ¨æ¨é€ç»™æ¶ˆè´¹è€…çš„æ¨é€æ¨¡å¼ã€‚</p><p>ZooKeeper é‡‡ç”¨äº†ä¸¤ç§æ¨¡å¼ç»“åˆçš„æ–¹å¼å®ç°è®¢é˜…å‘å¸ƒåŠŸèƒ½ã€‚</p><blockquote><p>â</p><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸ªå…·ä½“æ¡ˆä¾‹ï¼š</p><p>â</p></blockquote><p>åœ¨ç³»ç»Ÿå¼€å‘çš„è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°å„ç§å„æ ·çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“é…ç½®é¡¹ã€ç¬¬ä¸‰æ–¹æ¥å£ã€æœåŠ¡åœ°å€ç­‰ï¼Œè¿™äº›é…ç½®æ“ä½œåœ¨æˆ‘ä»¬å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å®Œæˆï¼Œä½†æ˜¯æ”¾åˆ°ä¸€ä¸ªå¤§è§„æ¨¡çš„é›†ç¾¤ä¸­é…ç½®èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚</p><p>é€šå¸¸è¿™ç§é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é…ç½®ç®¡ç†åŠŸèƒ½è‡ªåŠ¨å®ŒæˆæœåŠ¡å™¨é…ç½®ä¿¡æ¯çš„ç»´æŠ¤ï¼Œåˆ©ç”¨ZooKeeper çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠè¯¸å¦‚æ•°æ®åº“é…ç½®é¡¹è¿™æ ·çš„ä¿¡æ¯å­˜å‚¨åœ¨ ZooKeeper æ•°æ®èŠ‚ç‚¹ä¸­ã€‚</p><p>å¦‚<code>/confs/data_item1</code>ã€‚</p><ul><li><p>æœåŠ¡å™¨é›†ç¾¤å®¢æˆ·ç«¯å¯¹è¯¥èŠ‚ç‚¹æ·»åŠ  Watch äº‹ä»¶ç›‘æ§ï¼Œå½“é›†ç¾¤ä¸­çš„æœåŠ¡å¯åŠ¨æ—¶ï¼Œä¼šè¯»å–è¯¥èŠ‚ç‚¹æ•°æ®è·å–æ•°æ®é…ç½®ä¿¡æ¯ã€‚</p></li><li><p>è€Œå½“è¯¥èŠ‚ç‚¹æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒZooKeeper æœåŠ¡å™¨ä¼šå‘é€ Watch äº‹ä»¶ç»™å„ä¸ªå®¢æˆ·ç«¯ï¼Œé›†ç¾¤ä¸­çš„å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°è¯¥é€šçŸ¥åï¼Œé‡æ–°è¯»å–èŠ‚ç‚¹çš„æ•°æ®åº“é…ç½®ä¿¡æ¯ã€‚</p></li></ul><p>æˆ‘ä»¬ä½¿ç”¨ Watch æœºåˆ¶å®ç°äº†ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é…ç½®ç®¡ç†åŠŸèƒ½ï¼Œé€šè¿‡å¯¹ ZooKeeper æœåŠ¡å™¨èŠ‚ç‚¹æ·»åŠ æ•°æ®å˜æ›´äº‹ä»¶ï¼Œå®ç°å½“æ•°æ®åº“é…ç½®é¡¹ä¿¡æ¯å˜æ›´åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªå®¢æˆ·ç«¯èƒ½æ¥æ”¶åˆ°è¯¥å˜æ›´äº‹ä»¶çš„é€šçŸ¥ï¼Œå¹¶è·å–æœ€æ–°çš„é…ç½®ä¿¡æ¯ã€‚</p><blockquote><p>â</p><p>è¦æ³¨æ„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬æåˆ° Watch å…·æœ‰ä¸€æ¬¡æ€§ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è·å¾—æœåŠ¡å™¨é€šçŸ¥åè¦å†æ¬¡æ·»åŠ  Watch äº‹ä»¶ã€‚</p><p>â</p></blockquote><h2 id="ä¼šè¯æœºåˆ¶"><a href="#ä¼šè¯æœºåˆ¶" class="headerlink" title="ä¼šè¯æœºåˆ¶"></a>ä¼šè¯æœºåˆ¶</h2><p>ZooKeeper çš„å·¥ä½œæ–¹å¼ä¸€èˆ¬æ˜¯é€šè¿‡å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚è€Œå®ç°çš„ã€‚</p><p>è€Œåœ¨ä¸€ä¸ªè¯·æ±‚çš„å‘é€è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆï¼Œå®¢æˆ·ç«¯è¦ä¸æœåŠ¡ç«¯è¿›è¡Œè¿æ¥ï¼Œè€Œä¸€ä¸ªè¿æ¥å°±æ˜¯ä¸€ä¸ªä¼šè¯ã€‚</p><blockquote><p>â</p><p>åœ¨ ZooKeeper ä¸­ï¼Œä¸€ä¸ªä¼šè¯å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç”¨äºè¡¨ç¤ºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯è¿æ¥çš„æ•°æ®ç»“æ„ Sessionã€‚</p><p>â</p></blockquote><p>è¿™ä¸ªæ•°æ®ç»“æ„ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šåˆ†åˆ«æ˜¯ä¼šè¯ IDï¼ˆsessionIDï¼‰ã€ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆTimeOutï¼‰ã€ä¼šè¯å…³é—­çŠ¶æ€ï¼ˆisClosingï¼‰</p><ul><li><p>ä¼šè¯ IDï¼šä¼šè¯ ID ä½œä¸ºä¸€ä¸ªä¼šè¯çš„æ ‡è¯†ç¬¦ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€æ¬¡ä¼šè¯çš„æ—¶å€™ï¼ŒZooKeeper ä¼šè‡ªåŠ¨ä¸ºå…¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ ID ç¼–ç ã€‚</p></li><li><p>ä¼šè¯è¶…æ—¶æ—¶é—´ï¼šä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªä¼šè¯çš„è¶…æ—¶æ—¶é—´å°±æ˜¯æŒ‡ä¸€æ¬¡ä¼šè¯ä»å‘èµ·ååˆ°è¢«æœåŠ¡å™¨å…³é—­çš„æ—¶é•¿ã€‚è€Œè®¾ç½®ä¼šè¯è¶…æ—¶æ—¶é—´åï¼ŒæœåŠ¡å™¨ä¼šå‚è€ƒè®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œæœ€ç»ˆè®¡ç®—ä¸€ä¸ªæœåŠ¡ç«¯è‡ªå·±çš„è¶…æ—¶æ—¶é—´ã€‚è€Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åˆ™æ˜¯æœ€ç»ˆçœŸæ­£ç”¨äº ZooKeeper ä¸­æœåŠ¡ç«¯ç”¨æˆ·ä¼šè¯ç®¡ç†çš„è¶…æ—¶æ—¶é—´ã€‚</p></li><li><p>ä¼šè¯å…³é—­çŠ¶æ€ï¼šä¼šè¯å…³é—­ isClosing çŠ¶æ€å±æ€§å­—æ®µè¡¨ç¤ºä¸€ä¸ªä¼šè¯æ˜¯å¦å·²ç»å…³é—­ã€‚å¦‚æœæœåŠ¡å™¨æ£€æŸ¥åˆ°ä¸€ä¸ªä¼šè¯å·²ç»å› ä¸ºè¶…æ—¶ç­‰åŸå› å¤±æ•ˆæ—¶ï¼Œ ZooKeeper ä¼šåœ¨è¯¥ä¼šè¯çš„ isClosing å±æ€§å€¼æ ‡è®°ä¸ºå…³é—­ï¼Œå†ä¹‹åå°±ä¸å¯¹è¯¥ä¼šè¯è¿›è¡Œæ“ä½œäº†ã€‚</p></li></ul><p><strong>ã€Œä¼šè¯çŠ¶æ€ã€</strong></p><p>åœ¨ ZooKeeper æœåŠ¡çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè¯ä¼šç»å†ä¸åŒçš„çŠ¶æ€å˜åŒ–ã€‚</p><p>è¿™äº›çŠ¶æ€åŒ…æ‹¬ï¼š</p><blockquote><p>â</p><p>æ­£åœ¨è¿æ¥ï¼ˆCONNECTINGï¼‰ã€å·²ç»è¿æ¥ï¼ˆCONNECTIEDï¼‰ã€æ­£åœ¨é‡æ–°è¿æ¥ï¼ˆRECONNECTINGï¼‰ã€å·²ç»é‡æ–°è¿æ¥ï¼ˆRECONNECTEDï¼‰ã€ä¼šè¯å…³é—­ï¼ˆCLOSEï¼‰ç­‰ã€‚</p><p>â</p></blockquote><p>å½“å®¢æˆ·ç«¯å¼€å§‹åˆ›å»ºä¸€ä¸ªä¸æœåŠ¡ç«¯çš„ä¼šè¯æ“ä½œæ—¶ï¼Œå®ƒçš„ä¼šè¯çŠ¶æ€å°±ä¼šå˜æˆ CONNECTINGï¼Œä¹‹åå®¢æˆ·ç«¯ä¼šæ ¹æ®æœåŠ¡å™¨åœ°å€åˆ—è¡¨ä¸­çš„æœåŠ¡å™¨ IP åœ°å€åˆ†åˆ«å°è¯•è¿›è¡Œè¿æ¥ã€‚å¦‚æœé‡åˆ°ä¸€ä¸ª IP åœ°å€å¯ä»¥è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€å°†å˜ä¸º CONNECTIEDã€‚</p><p>å¦‚æœå› ä¸ºç½‘ç»œåŸå› é€ æˆå·²ç»è¿æ¥çš„å®¢æˆ·ç«¯ä¼šè¯æ–­å¼€æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šé‡æ–°å°è¯•è¿æ¥æœåŠ¡ç«¯ã€‚è€Œå¯¹åº”çš„å®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€åˆå˜æˆ CONNECTING ï¼Œç›´åˆ°è¯¥ä¼šè¯è¿æ¥åˆ°æœåŠ¡ç«¯æœ€ç»ˆåˆå˜æˆ CONNECTIEDã€‚</p><blockquote><p>â</p><p>åœ¨ ZooKeeper æœåŠ¡çš„æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè¯çŠ¶æ€ç»å¸¸ä¼šåœ¨ CONNECTING ä¸ CONNECTIED ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚</p><p>â</p></blockquote><p>æœ€åï¼Œå½“å‡ºç°è¶…æ—¶æˆ–è€…å®¢æˆ·ç«¯ä¸»åŠ¨é€€å‡ºç¨‹åºç­‰æƒ…å†µæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè¯çŠ¶æ€åˆ™ä¼šå˜ä¸º CLOSE çŠ¶æ€ã€‚</p><p><strong>ã€Œä¼šè¯å¼‚å¸¸ã€</strong></p><p>åœ¨ ZooKeeper ä¸­ï¼Œä¼šè¯çš„è¶…æ—¶å¼‚å¸¸åŒ…æ‹¬å®¢æˆ·ç«¯ readtimeout å¼‚å¸¸å’ŒæœåŠ¡å™¨ç«¯ sessionTimeout å¼‚å¸¸ã€‚</p><ul><li>åœ¨æˆ‘ä»¬å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œè¦æ˜ç¡®è¿™ä¸¤ä¸ªå¼‚å¸¸çš„ä¸åŒä¹‹å¤„åœ¨äºä¸€ä¸ªæ˜¯å‘ç”Ÿåœ¨å®¢æˆ·ç«¯ï¼Œè€Œå¦ä¸€ä¸ªæ˜¯å‘ç”Ÿåœ¨æœåŠ¡ç«¯ã€‚</li></ul><p>è€Œå¯¹äºé‚£äº›å¯¹ ZooKeeper æ¥è§¦ä¸æ·±çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œä»–ä»¬å¸¸å¸¸è¸©å‘çš„åœ°æ–¹åœ¨äºï¼Œè™½ç„¶è®¾ç½®äº†è¶…æ—¶é—´ï¼Œä½†æ˜¯åœ¨å®é™…æœåŠ¡è¿è¡Œçš„æ—¶å€™ ZooKeeper å¹¶æ²¡æœ‰æŒ‰ç…§è®¾ç½®çš„è¶…æ—¶æ—¶é—´æ¥ç®¡ç†ä¼šè¯ã€‚</p><ul><li>è¿™æ˜¯å› ä¸º ZooKeeper å®é™…èµ·ä½œç”¨çš„è¶…æ—¶æ—¶é—´æ˜¯é€šè¿‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åå•†å†³å®šã€‚</li></ul><p>ZooKeeper å®¢æˆ·ç«¯åœ¨å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œä¼šæäº¤ä¸€ä¸ªå®¢æˆ·ç«¯è®¾ç½®çš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œè€Œè¯¥è¶…æ—¶æ—¶é—´ä¼šå’ŒæœåŠ¡ç«¯è®¾ç½®çš„æœ€å¤§è¶…æ—¶æ—¶é—´å’Œæœ€å°è¶…æ—¶æ—¶é—´è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæ­£å¥½åœ¨å…¶å…è®¸çš„èŒƒå›´å†…ï¼Œåˆ™é‡‡ç”¨å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´ç®¡ç†ä¼šè¯ã€‚</p><p>å¦‚æœå¤§äºæˆ–è€…å°äºæœåŠ¡ç«¯è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œåˆ™é‡‡ç”¨æœåŠ¡ç«¯è®¾ç½®çš„å€¼ç®¡ç†ä¼šè¯ã€‚</p><p><strong>ã€Œåˆ†æ¡¶ç­–ç•¥ã€</strong></p><p>æˆ‘ä»¬çŸ¥é“åœ¨ ZooKeeper ä¸­ä¸ºäº†ä¿è¯ä¸€ä¸ªä¼šè¯çš„å­˜æ´»çŠ¶æ€ï¼Œå®¢æˆ·ç«¯éœ€è¦å‘æœåŠ¡å™¨å‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³ä¿¡æ¯ã€‚</p><ul><li>è€Œå®¢æˆ·ç«¯æ‰€å‘é€çš„å¿ƒè·³ä¿¡æ¯å¯ä»¥æ˜¯ä¸€ä¸ª ping è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„ä¸šåŠ¡è¯·æ±‚ã€‚</li></ul><p>ZooKeeper æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚åï¼Œä¼šæ›´æ–°ä¼šè¯çš„è¿‡æœŸæ—¶é—´ï¼Œæ¥ä¿è¯ä¼šè¯çš„å­˜æ´»çŠ¶æ€ã€‚</p><ul><li>æ‰€ä»¥åœ¨ ZooKeeper çš„ä¼šè¯ç®¡ç†ä¸­ï¼Œæœ€ä¸»è¦çš„å·¥ä½œå°±æ˜¯ç®¡ç†ä¼šè¯çš„è¿‡æœŸæ—¶é—´ã€‚</li></ul><blockquote><p>â</p><p>ZooKeeper ä¸­é‡‡ç”¨äº†ç‹¬ç‰¹çš„ä¼šè¯ç®¡ç†æ–¹å¼æ¥ç®¡ç†ä¼šè¯çš„è¿‡æœŸæ—¶é—´ã€‚</p><p>â</p></blockquote><p>åœ¨ ZooKeeper ä¸­ï¼Œä¼šè¯å°†æŒ‰ç…§ä¸åŒçš„æ—¶é—´é—´éš”è¿›è¡Œåˆ’åˆ†ï¼Œè¶…æ—¶æ—¶é—´ç›¸è¿‘çš„ä¼šè¯å°†è¢«æ”¾åœ¨åŒä¸€ä¸ªé—´éš”åŒºé—´ä¸­ï¼Œè¿™ç§æ–¹å¼é¿å…äº† ZooKeeper å¯¹æ¯ä¸€ä¸ªä¼šè¯è¿›è¡Œæ£€æŸ¥ï¼Œè€Œæ˜¯é‡‡ç”¨åˆ†æ‰¹æ¬¡çš„æ–¹å¼ç®¡ç†ä¼šè¯ã€‚</p><p>è¿™å°±é™ä½äº†ä¼šè¯ç®¡ç†çš„éš¾åº¦ï¼Œå› ä¸ºæ¯æ¬¡å°æ‰¹é‡çš„å¤„ç†ä¼šè¯è¿‡æœŸä¹Ÿæé«˜äº†ä¼šè¯å¤„ç†çš„æ•ˆç‡ã€‚</p><p><strong>ã€ŒZooKeeper è¿™ç§ä¼šè¯ç®¡ç†çš„å¥½å¤„ï¼Ÿã€</strong></p><p>ZooKeeper è¿™ç§åˆ†æ®µçš„ä¼šè¯ç®¡ç†ç­–ç•¥å¤§å¤§æé«˜äº†è®¡ç®—ä¼šè¯è¿‡æœŸçš„æ•ˆç‡ï¼Œå¦‚æœæ˜¯åœ¨ä¸€ä¸ªå®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªå¤§å‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¾€å¾€å…·æœ‰å¾ˆé«˜çš„è®¿é—®é‡ã€‚</p><p>è€Œ ZooKeeper ä½œä¸ºå…¶ä¸­çš„ç»„ä»¶ï¼Œå¯¹å¤–æä¾›æœåŠ¡å¾€å¾€è¦æ‰¿æ‹…æ•°åƒä¸ªå®¢æˆ·ç«¯çš„è®¿é—®ï¼Œè¿™å…¶ä¸­å°±è¦å¯¹è¿™å‡ åƒä¸ªä¼šè¯è¿›è¡Œç®¡ç†ã€‚</p><p>åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œè¦æƒ³é€šè¿‡å¯¹æ¯ä¸€ä¸ªä¼šè¯è¿›è¡Œç®¡ç†å’Œæ£€æŸ¥å¹¶ä¸åˆé€‚ï¼Œæ‰€ä»¥é‡‡ç”¨å°†åŒä¸€ä¸ªæ—¶é—´æ®µçš„ä¼šè¯è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œè¿™æ ·å°±å¤§å¤§æé«˜äº†æœåŠ¡çš„è¿è¡Œæ•ˆç‡ã€‚</p><p><strong>ã€Œåº•å±‚å®ç°ã€</strong></p><p>ZooKeeper åº•å±‚å®ç°çš„åŸç†ï¼Œæ ¸å¿ƒçš„ä¸€ç‚¹å°±æ˜¯è¿‡æœŸé˜Ÿåˆ—è¿™ä¸ªæ•°æ®ç»“æ„ã€‚æ‰€æœ‰ä¼šè¯è¿‡æœŸçš„ç›¸å…³æ“ä½œéƒ½æ˜¯å›´ç»•è¿™ä¸ªé˜Ÿåˆ—è¿›è¡Œçš„ã€‚</p><ul><li>å¯ä»¥è¯´ ZooKeeper åº•å±‚å°±æ˜¯é‡‡ç”¨è¿™ä¸ªé˜Ÿåˆ—ç»“æ„æ¥ç®¡ç†ä¼šè¯è¿‡æœŸçš„ã€‚</li></ul><p><strong>ã€Œä¸€ä¸ªä¼šè¯è¿‡æœŸé˜Ÿåˆ—æ˜¯ç”±è‹¥å¹²ä¸ª bucket ç»„æˆçš„ã€‚ã€</strong></p><ul><li><p>bucket æ˜¯ä¸€ä¸ªæŒ‰ç…§æ—¶é—´åˆ’åˆ†çš„åŒºé—´ã€‚</p></li><li><p>åœ¨ ZooKeeper ä¸­ï¼Œé€šå¸¸ä»¥ expirationInterval ä¸ºå•ä½è¿›è¡Œæ—¶é—´åŒºé—´çš„åˆ’åˆ†ï¼Œå®ƒæ˜¯ ZooKeeper åˆ†æ¡¶ç­–ç•¥ä¸­ç”¨äºåˆ’åˆ†æ—¶é—´åŒºé—´çš„æœ€å°å•ä½ã€‚</p></li><li><p>åœ¨ ZooKeeper ä¸­ï¼Œä¸€ä¸ªè¿‡æœŸé˜Ÿåˆ—ç”±ä¸åŒçš„ bucket ç»„æˆã€‚</p></li><li><p>æ¯ä¸ª bucket ä¸­å­˜æ”¾äº†åœ¨æŸä¸€æ—¶é—´å†…è¿‡æœŸçš„ä¼šè¯ã€‚</p></li></ul><p>å°†ä¼šè¯æŒ‰ç…§ä¸åŒçš„è¿‡æœŸæ—¶é—´æ®µåˆ†åˆ«ç»´æŠ¤åˆ°è¿‡æœŸé˜Ÿåˆ—ä¹‹åï¼Œåœ¨ ZooKeeper æœåŠ¡è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/huihuajizhi-1.png"></p><p>é¦–å…ˆï¼ŒZooKeeper æœåŠ¡ä¼šå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨ç”¨æ¥æ£€ç´¢è¿‡æœŸé˜Ÿåˆ—ï¼Œæ‰¾å‡ºè¦è¿‡æœŸçš„ bucketï¼Œè€Œ ZooKeeper æ¯æ¬¡åªä¼šè®©ä¸€ä¸ª bucket çš„ä¼šè¯è¿‡æœŸï¼Œæ¯å½“è¦è¿›è¡Œä¼šè¯è¿‡æœŸæ“ä½œæ—¶ï¼ŒZooKeeper ä¼šå”¤é†’ä¸€ä¸ªå¤„äºä¼‘çœ çŠ¶æ€çš„çº¿ç¨‹è¿›è¡Œä¼šè¯è¿‡æœŸæ“ä½œï¼Œä¹‹åä¼šæŒ‰ç…§ä¸Šé¢ä»‹ç»çš„æ“ä½œæ£€ç´¢è¿‡æœŸé˜Ÿåˆ—ï¼Œå–å‡ºè¿‡æœŸçš„ä¼šè¯åä¼šæ‰§è¡Œè¿‡æœŸæ“ä½œã€‚</p><h2 id="ACLæƒé™"><a href="#ACLæƒé™" class="headerlink" title="ACLæƒé™"></a>ACLæƒé™</h2><p>ZooKeeperçš„ACLå¯é’ˆå¯¹znodesè®¾ç½®ç›¸åº”çš„æƒé™ä¿¡æ¯ã€‚</p><p>ä¸€ä¸ª ACL æƒé™è®¾ç½®é€šå¸¸å¯ä»¥åˆ†ä¸º 3 éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼šæƒé™æ¨¡å¼ï¼ˆSchemeï¼‰ã€æˆæƒå¯¹è±¡ï¼ˆIDï¼‰ã€æƒé™ä¿¡æ¯ï¼ˆPermissionï¼‰ã€‚</p><p>æœ€ç»ˆç»„æˆä¸€æ¡ä¾‹å¦‚scheme:id:permissionæ ¼å¼çš„ ACL è¯·æ±‚ä¿¡æ¯ã€‚<br>ã€Œæƒé™æ¨¡å¼ï¼šSchemeã€</p><p>ZooKeeper çš„æƒé™éªŒè¯æ–¹å¼å¤§ä½“åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯èŒƒå›´éªŒè¯ï¼Œå¦å¤–ä¸€ç§æ˜¯å£ä»¤éªŒè¯ã€‚</p><p>â<br>èŒƒå›´éªŒè¯<br>â<br>æ‰€è°“çš„èŒƒå›´éªŒè¯å°±æ˜¯è¯´ ZooKeeper å¯ä»¥é’ˆå¯¹ä¸€ä¸ª IP æˆ–è€…ä¸€æ®µ IP åœ°å€æˆäºˆæŸç§æƒé™ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è®©ä¸€ä¸ª IP åœ°å€ä¸ºipï¼š192.168.0.11çš„æœºå™¨å¯¹æœåŠ¡å™¨ä¸Šçš„æŸä¸ªæ•°æ®èŠ‚ç‚¹å…·æœ‰å†™å…¥çš„æƒé™ã€‚</p><p>æˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ip:192.168.0.11&#x2F;22ç»™ä¸€æ®µ IP åœ°å€çš„æœºå™¨èµ‹æƒã€‚</p><p>â<br>å£ä»¤éªŒè¯<br>â<br>å¯ä»¥ç†è§£ä¸ºç”¨æˆ·åå¯†ç çš„æ–¹å¼ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ€ç†Ÿæ‚‰ä¹Ÿæ˜¯æ—¥å¸¸ç”Ÿæ´»ä¸­ç»å¸¸ä½¿ç”¨çš„æ¨¡å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰“å¼€è‡ªå·±çš„ç”µè„‘æˆ–è€…å»é“¶è¡Œå–é’±éƒ½éœ€è¦æä¾›ç›¸åº”çš„å¯†ç ã€‚</p><p>åœ¨ ZooKeeper ä¸­è¿™ç§éªŒè¯æ–¹å¼æ˜¯ Digest è®¤è¯ï¼Œæˆ‘ä»¬çŸ¥é“é€šè¿‡ç½‘ç»œä¼ è¾“ç›¸å¯¹æ¥è¯´å¹¶ä¸å®‰å…¨ï¼Œæ‰€ä»¥ç»ä¸é€šè¿‡æ˜æ–‡åœ¨ç½‘ç»œå‘é€å¯†ç ä¹Ÿæ˜¯ç¨‹åºè®¾è®¡ä¸­å¾ˆé‡è¦çš„åŸåˆ™ä¹‹ä¸€ï¼Œè€Œ Digest è¿™ç§è®¤è¯æ–¹å¼é¦–å…ˆåœ¨å®¢æˆ·ç«¯ä¼ é€username:passwordè¿™ç§å½¢å¼çš„æƒé™è¡¨ç¤ºç¬¦åï¼ŒZooKeeper æœåŠ¡ç«¯ä¼šå¯¹å¯†ç éƒ¨åˆ†ä½¿ç”¨ SHA-1 å’Œ BASE64 ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œä»¥ä¿è¯å®‰å…¨æ€§ã€‚</p><p>â<br>Super æƒé™æ¨¡å¼<br>â<br>æƒé™æ¨¡å¼ Super å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹æ®Šçš„ Digest è®¤è¯ã€‚</p><p>å…·æœ‰ Super æƒé™çš„å®¢æˆ·ç«¯å¯ä»¥å¯¹ ZooKeeper ä¸Šçš„ä»»æ„æ•°æ®èŠ‚ç‚¹è¿›è¡Œä»»æ„æ“ä½œã€‚</p><p>ä¸‹é¢è¿™æ®µä»£ç ç»™å‡ºäº† Digest æ¨¡å¼ä¸‹å®¢æˆ·ç«¯çš„è°ƒç”¨æ–¹å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//åˆ›å»ºèŠ‚ç‚¹</span><br><span class="line">create /digest_node1</span><br><span class="line">//è®¾ç½®digestæƒé™éªŒè¯</span><br><span class="line">setAcl /digest_node1 digest:ç”¨æˆ·å:base64æ ¼å¼å¯†ç :rwadc </span><br><span class="line">//æŸ¥è¯¢èŠ‚ç‚¹Aclæƒé™</span><br><span class="line">getAcl /digest_node1 </span><br><span class="line">//æˆæƒæ“ä½œ</span><br><span class="line">addauth digest user:passwd</span><br></pre></td></tr></table></figure><p>â<br>å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨ä¸Šçš„ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®äº†åªæœ‰å®ƒè‡ªå·±æ‰èƒ½æ“ä½œçš„æƒé™ï¼Œé‚£ä¹ˆç­‰è¿™ä¸ªå®¢æˆ·ç«¯ä¸‹çº¿æˆ–è¢«åˆ é™¤åã€‚<br>â<br>å¯¹å…¶åˆ›å»ºçš„èŠ‚ç‚¹è¦æƒ³è¿›è¡Œä¿®æ”¹åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ã€Œsuper æ¨¡å¼ã€å³è¶…çº§ç®¡ç†å‘˜çš„æ–¹å¼åˆ é™¤è¯¥èŠ‚ç‚¹æˆ–å˜æ›´è¯¥èŠ‚ç‚¹çš„æƒé™éªŒè¯æ–¹å¼ã€‚</p><p>æ­£å› ä¸ºã€Œsuper æ¨¡å¼ã€æœ‰å¦‚æ­¤å¤§çš„æƒé™ï¼Œæˆ‘ä»¬åœ¨å¹³æ—¶ä½¿ç”¨æ—¶ä¹Ÿåº”è¯¥æ›´åŠ è°¨æ…ã€‚</p><p>â<br>world æ¨¡å¼<br>â<br>è¿™ç§æˆæƒæ¨¡å¼å¯¹åº”äºç³»ç»Ÿä¸­çš„æ‰€æœ‰ç”¨æˆ·ï¼Œæœ¬è´¨ä¸Šèµ·ä¸åˆ°ä»»ä½•ä½œç”¨ã€‚</p><p>è®¾ç½®äº† world æƒé™æ¨¡å¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰ç”¨æˆ·æ“ä½œéƒ½å¯ä»¥ä¸è¿›è¡Œæƒé™éªŒè¯ã€‚</p><p>ã€Œæˆæƒå¯¹è±¡ï¼ˆIDï¼‰ã€</p><p>æ‰€è°“çš„æˆæƒå¯¹è±¡å°±æ˜¯è¯´æˆ‘ä»¬è¦æŠŠæƒé™èµ‹äºˆè°ï¼Œè€Œå¯¹åº”äº 4 ç§ä¸åŒçš„æƒé™æ¨¡å¼æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ IP æ–¹å¼ï¼Œä½¿ç”¨çš„æˆæƒå¯¹è±¡å¯ä»¥æ˜¯ä¸€ä¸ª IP åœ°å€æˆ– IP åœ°å€æ®µï¼›è€Œå¦‚æœä½¿ç”¨ Digest æˆ– Super æ–¹å¼ï¼Œåˆ™å¯¹åº”äºä¸€ä¸ªç”¨æˆ·åã€‚</p><p>å¦‚æœæ˜¯ World æ¨¡å¼ï¼Œæ˜¯æˆæƒç³»ç»Ÿä¸­æ‰€æœ‰çš„ç”¨æˆ·ã€‚</p><p>ã€Œæƒé™ä¿¡æ¯ï¼ˆPermissionï¼‰ã€</p><p>æƒé™å°±æ˜¯æŒ‡æˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„æ“ä½œç§ç±»ï¼Œåœ¨ ZooKeeper ä¸­å·²ç»å®šä¹‰å¥½çš„æƒé™æœ‰ 5 ç§ï¼š</p><ul><li><p>æ•°æ®èŠ‚ç‚¹ï¼ˆcreateï¼‰åˆ›å»ºæƒé™ï¼Œæˆäºˆæƒé™çš„å¯¹è±¡å¯ä»¥åœ¨æ•°æ®èŠ‚ç‚¹ä¸‹åˆ›å»ºå­èŠ‚ç‚¹ï¼›</p></li><li><p>æ•°æ®èŠ‚ç‚¹ï¼ˆwirteï¼‰æ›´æ–°æƒé™ï¼Œæˆäºˆæƒé™çš„å¯¹è±¡å¯ä»¥æ›´æ–°è¯¥æ•°æ®èŠ‚ç‚¹ï¼›</p></li><li><p>æ•°æ®èŠ‚ç‚¹ï¼ˆreadï¼‰è¯»å–æƒé™ï¼Œæˆäºˆæƒé™çš„å¯¹è±¡å¯ä»¥è¯»å–è¯¥èŠ‚ç‚¹çš„å†…å®¹ä»¥åŠå­èŠ‚ç‚¹çš„ä¿¡æ¯ï¼›</p></li><li><p>æ•°æ®èŠ‚ç‚¹ï¼ˆdeleteï¼‰åˆ é™¤æƒé™ï¼Œæˆäºˆæƒé™çš„å¯¹è±¡å¯ä»¥åˆ é™¤è¯¥æ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼›</p></li><li><p>æ•°æ®èŠ‚ç‚¹ï¼ˆadminï¼‰ç®¡ç†è€…æƒé™ï¼Œæˆäºˆæƒé™çš„å¯¹è±¡å¯ä»¥å¯¹è¯¥æ•°æ®èŠ‚ç‚¹ä½“è¿›è¡Œ ACL æƒé™è®¾ç½®ã€‚</p></li></ul><p>â<br>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ç»´æŠ¤è‡ªèº«çš„ ACL æƒé™æ•°æ®ï¼Œå³ä½¿æ˜¯è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¹Ÿæ˜¯æœ‰è‡ªå·±çš„ ACL æƒé™è€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿å…¶çˆ¶èŠ‚ç‚¹çš„æƒé™ã€‚<br>â<br>ã€Œå®ç°è‡ªå·±çš„æƒé™å£æ§åˆ¶ã€</p><p>è™½ç„¶ ZooKeeper è‡ªèº«çš„æƒé™æ§åˆ¶æœºåˆ¶å·²ç»åšå¾—å¾ˆç»†ï¼Œä½†æ˜¯å®ƒè¿˜æ˜¯æä¾›äº†ä¸€ç§æƒé™æ‰©å±•æœºåˆ¶æ¥è®©ç”¨æˆ·å®ç°è‡ªå·±çš„æƒé™æ§åˆ¶æ–¹å¼ã€‚</p><p>å®˜æ–¹æ–‡æ¡£ä¸­å¯¹è¿™ç§æœºåˆ¶çš„å®šä¹‰æ˜¯ Pluggable ZooKeeper Authenicationï¼Œæ„æ€æ˜¯å¯æ’æ‹”çš„æˆæƒæœºåˆ¶ï¼Œä»åç§°ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒçš„çµæ´»æ€§ã€‚é‚£ä¹ˆè¿™ç§æœºåˆ¶æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>â<br>è¦æƒ³å®ç°è‡ªå®šä¹‰çš„æƒé™æ§åˆ¶æœºåˆ¶ï¼Œæœ€æ ¸å¿ƒçš„ä¸€ç‚¹æ˜¯å®ç° ZooKeeper æä¾›çš„æƒé™æ§åˆ¶å™¨æ¥å£ AuthenticationProviderã€‚<br>â<br>å®ç°äº†è‡ªå®šä¹‰æƒé™åï¼Œå¦‚ä½•æ‰èƒ½è®© ZooKeeper æœåŠ¡ç«¯ä½¿ç”¨è‡ªå®šä¹‰çš„æƒé™éªŒè¯æ–¹å¼å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥å°±éœ€è¦å°†è‡ªå®šä¹‰çš„æƒé™æ§åˆ¶æ³¨å†Œåˆ° ZooKeeper æœåŠ¡å™¨ä¸­ï¼Œè€Œæ³¨å†Œçš„æ–¹å¼é€šå¸¸æœ‰ä¸¤ç§ã€‚</p><p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡è®¾ç½®ç³»ç»Ÿå±æ€§æ¥æ³¨å†Œè‡ªå®šä¹‰çš„æƒé™æ§åˆ¶å™¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dzookeeper.authProvider.x=CustomAuthenticationProvider</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ˜¯åœ¨é…ç½®æ–‡ä»¶zoo.cfgä¸­è¿›è¡Œé…ç½®ï¼š</p><p><code>authProvider.x=CustomAuthenticationProvider</code></p><p>ã€Œå®ç°åŸç†ã€</p><p>é¦–å…ˆæ˜¯å°è£…è¯¥è¯·æ±‚çš„ç±»å‹ï¼Œä¹‹åå°†æƒé™ä¿¡æ¯å°è£…åˆ° request ä¸­å¹¶å‘é€ç»™æœåŠ¡ç«¯ã€‚è€ŒæœåŠ¡å™¨çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œé¦–å…ˆåˆ†æè¯·æ±‚ç±»å‹æ˜¯å¦æ˜¯æƒé™ç›¸å…³æ“ä½œï¼Œä¹‹åæ ¹æ®ä¸åŒçš„æƒé™æ¨¡å¼ï¼ˆschemeï¼‰è°ƒç”¨ä¸åŒçš„å®ç°ç±»éªŒè¯æƒé™æœ€åå­˜å‚¨æƒé™ä¿¡æ¯ã€‚</p><p>åœ¨æˆæƒæ¥å£ä¸­ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¼šè¯çš„æˆæƒä¿¡æ¯å­˜å‚¨åœ¨ ZooKeeper æœåŠ¡ç«¯çš„å†…å­˜ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¼šè¯å…³é—­ï¼Œæˆæƒä¿¡æ¯ä¼šè¢«åˆ é™¤ã€‚</p><p>ä¸‹æ¬¡è¿æ¥æœåŠ¡å™¨åï¼Œéœ€è¦é‡æ–°è°ƒç”¨æˆæƒæ¥å£è¿›è¡Œæˆæƒã€‚</p><h2 id="åºåˆ—åŒ–æ–¹å¼"><a href="#åºåˆ—åŒ–æ–¹å¼" class="headerlink" title="åºåˆ—åŒ–æ–¹å¼"></a>åºåˆ—åŒ–æ–¹å¼</h2><p>åœ¨ ZooKeeper ä¸­å¹¶æ²¡æœ‰é‡‡ç”¨å’Œ Java ä¸€æ ·çš„åºåˆ—åŒ–æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ä¸ª Jute çš„åºåˆ—è§£å†³æ–¹æ¡ˆä½œä¸º ZooKeeper æ¡†æ¶è‡ªèº«çš„åºåˆ—åŒ–æ–¹å¼ã€‚</p><p>â<br>ZooKeeper ä»æœ€å¼€å§‹å°±é‡‡ç”¨ Jute ä½œä¸ºå…¶åºåˆ—åŒ–è§£å†³æ–¹æ¡ˆï¼Œç›´åˆ°å…¶æœ€æ–°çš„ç‰ˆæœ¬ä¾ç„¶æ²¡æœ‰æ›´æ”¹ã€‚<br>â<br>è™½ç„¶ ZooKeeper ä¸€ç›´å°† Jute æ¡†æ¶ä½œä¸ºåºåˆ—åŒ–è§£å†³æ–¹æ¡ˆï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€ Jute ç›¸å¯¹å…¶ä»–æ¡†æ¶æ€§èƒ½æ›´å¥½ï¼Œåå€’æ˜¯ Apache Avroã€Thrift ç­‰æ¡†æ¶åœ¨æ€§èƒ½ä¸Šä¼˜äºå‰è€…ã€‚</p><p>ä¹‹æ‰€ä»¥ ZooKeeper ä¸€ç›´é‡‡ç”¨ Jute ä½œä¸ºåºåˆ—åŒ–è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦æ˜¯æ–°è€ç‰ˆæœ¬çš„å…¼å®¹ç­‰é—®é¢˜ã€‚</p><p>ã€Œå¦‚ä½• ä½¿ç”¨ Jute å®ç°åºåˆ—åŒ–ã€</p><p>å¦‚æœæˆ‘ä»¬è¦æƒ³å°†æŸä¸ªå®šä¹‰çš„ç±»è¿›è¡Œåºåˆ—åŒ–ï¼Œé¦–å…ˆéœ€è¦è¯¥ç±»å®ç° Record æ¥å£çš„ serilize å’Œ deserialize æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ã€‚</p><p>â<br>ä¸‹è¾¹è¿™æ®µä»£ç ç»™å‡ºäº†æˆ‘ä»¬ä¸€èˆ¬åœ¨ ZooKeeper ä¸­è¿›è¡Œåºåˆ—åŒ–çš„å…·ä½“å®ç°ï¼š<br>â<br>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªtest_juteç±»ï¼Œä¸ºäº†èƒ½å¤Ÿå¯¹å®ƒè¿›è¡Œåºåˆ—åŒ–ï¼Œéœ€è¦è¯¥test_juteç±»å®ç° Record æ¥å£ï¼Œå¹¶åœ¨å¯¹åº”çš„ serialize åºåˆ—åŒ–æ–¹æ³•å’Œ deserialize ååºåˆ—åŒ–æ–¹æ³•ä¸­ç¼–è¾‘å…·ä½“çš„å®ç°é€»è¾‘ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class test_jute implements Record&#123;</span><br><span class="line">  private long idsï¼›</span><br><span class="line">  private String name;</span><br><span class="line">  ...</span><br><span class="line">  public void serialize(OutpurArchive a_,String tag)&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  public void deserialize(INputArchive a_,String tag)&#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åºåˆ—åŒ–æ–¹æ³• serialize ä¸­ï¼Œæˆ‘ä»¬è¦å®ç°çš„é€»è¾‘æ˜¯ï¼Œé¦–å…ˆé€šè¿‡å­—ç¬¦ç±»å‹å‚æ•° tag ä¼ é€’æ ‡è®°åºåˆ—åŒ–æ ‡è¯†ç¬¦ï¼Œä¹‹åä½¿ç”¨ writeLong å’Œ writeString ç­‰æ–¹æ³•åˆ†åˆ«å°†å¯¹è±¡å±æ€§å­—æ®µè¿›è¡Œåºåˆ—åŒ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void serialize(OutpurArchive a_,String tag) throws ...&#123;</span><br><span class="line">  a_.startRecord(this.tag);</span><br><span class="line">  a_.writeLong(ids,&quot;ids&quot;);</span><br><span class="line">  a_.writeString(type,&quot;name&quot;);</span><br><span class="line">  a_.endRecord(this,tag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ derseralize åœ¨å®ç°ååºåˆ—åŒ–çš„è¿‡ç¨‹åˆ™ä¸æˆ‘ä»¬ä¸Šè¾¹è¯´çš„åºåˆ—åŒ–è¿‡ç¨‹æ­£å¥½ç›¸åã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void deserialize(INputArchive a_,String tag) throws &#123;</span><br><span class="line">  a_.startRecord(tag);</span><br><span class="line">  ids = a_.readLong(&quot;ids&quot;);</span><br><span class="line">  name = a_.readString(&quot;name&quot;);</span><br><span class="line">  a_.endRecord(tag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å®ç°é€»è¾‘ç¼–ç æ–¹å¼ç›¸å¯¹å›ºå®šï¼Œé¦–å…ˆé€šè¿‡ startRecord å¼€å¯ä¸€æ®µåºåˆ—åŒ–æ“ä½œï¼Œä¹‹åé€šè¿‡ writeLongã€writeString æˆ– readLongã€ readString ç­‰æ–¹æ³•æ‰§è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ã€‚</p><p>æœ¬ä¾‹ä¸­åªæ˜¯å®ç°äº†é•¿æ•´å‹å’Œå­—ç¬¦å‹çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œï¼Œé™¤æ­¤ä¹‹å¤– ZooKeeper ä¸­çš„ Jute æ¡†æ¶è¿˜æ”¯æŒæ•´æ•°ç±»å‹ï¼ˆIntï¼‰ã€å¸ƒå°”ç±»å‹ï¼ˆBoolï¼‰ã€åŒç²¾åº¦ç±»å‹ï¼ˆDoubleï¼‰ä»¥åŠ Byte&#x2F;Buffer ç±»å‹ã€‚</p><h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>ã€ŒZooKeeperé›†ç¾¤æ¨¡å¼çš„ç‰¹ç‚¹ã€</p><p>åœ¨ ZooKeeper é›†ç¾¤ä¸­å°†æœåŠ¡å™¨åˆ†æˆ ã€ŒLeader ã€Follow ã€Observer ä¸‰ã€ç§è§’è‰²æœåŠ¡å™¨ï¼Œåœ¨é›†ç¾¤è¿è¡ŒæœŸé—´è¿™ä¸‰ç§æœåŠ¡å™¨æ‰€è´Ÿè´£çš„å·¥ä½œå„ä¸ç›¸åŒï¼š</p><p>Leader è§’è‰²æœåŠ¡å™¨è´Ÿè´£ç®¡ç†é›†ç¾¤ä¸­å…¶ä»–çš„æœåŠ¡å™¨ï¼Œæ˜¯é›†ç¾¤ä¸­å·¥ä½œçš„åˆ†é…å’Œè°ƒåº¦è€…ï¼Œæ—¢å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›å†™æœåŠ¡åˆèƒ½æä¾›è¯»æœåŠ¡ã€‚</p><p>Follow æœåŠ¡å™¨çš„ä¸»è¦å·¥ä½œæ˜¯é€‰ä¸¾å‡º Leader æœåŠ¡å™¨ï¼Œåœ¨å‘ç”Ÿ Leader æœåŠ¡å™¨é€‰ä¸¾çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šä» Follow æœåŠ¡å™¨ä¹‹é—´æ ¹æ®å¤šæ•°æŠ•ç¥¨åŸåˆ™ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ª Follow æœåŠ¡å™¨ä½œä¸ºæ–°çš„ Leader æœåŠ¡å™¨ï¼Œåªèƒ½æä¾›è¯»æœåŠ¡ã€‚</p><p>Observer æœåŠ¡å™¨åˆ™ä¸»è¦è´Ÿè´£å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è·å–æ•°æ®ç­‰è¯·æ±‚ï¼Œå¹¶ä¸å‚ä¸ Leader æœåŠ¡å™¨çš„é€‰ä¸¾æ“ä½œï¼Œä¹Ÿä¸ä¼šä½œä¸ºå€™é€‰è€…è¢«é€‰ä¸¾ä¸º Leader æœåŠ¡å™¨ï¼Œåªèƒ½æä¾›è¯»æœåŠ¡ã€‚</p><p>åœ¨ ZooKeeper é›†ç¾¤æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„ä¼šè¯è¯·æ±‚æ“ä½œåï¼Œé¦–å…ˆä¼šåˆ¤æ–­è¯¥æ¡è¯·æ±‚æ˜¯å¦æ˜¯äº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚ã€‚</p><p>â<br>å¯¹äºäº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚ï¼ŒZooKeeper é›†ç¾¤æœåŠ¡ç«¯ä¼šå°†è¯¥è¯·æ±‚ç»Ÿä¸€è½¬å‘ç»™ Leader æœåŠ¡å™¨è¿›è¡Œæ“ä½œã€‚<br>æ‰€è°“äº‹åŠ¡æ€§è¯·æ±‚ï¼Œæ˜¯æŒ‡ ZooKeeper æœåŠ¡å™¨æ‰§è¡Œå®Œè¯¥æ¡ä¼šè¯è¯·æ±‚åï¼Œæ˜¯å¦ä¼šå¯¼è‡´æ‰§è¡Œè¯¥æ¡ä¼šè¯è¯·æ±‚çš„æœåŠ¡å™¨çš„æ•°æ®æˆ–çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œè¿›è€Œå¯¼è‡´ä¸å…¶ä»–é›†ç¾¤ä¸­çš„æœåŠ¡å™¨å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚<br>â<br>Leader æœåŠ¡å™¨å†…éƒ¨æ‰§è¡Œè¯¥æ¡äº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚åï¼Œå†å°†æ•°æ®åŒæ­¥ç»™å…¶ä»–è§’è‰²æœåŠ¡å™¨ï¼Œä»è€Œä¿è¯äº‹åŠ¡æ€§ä¼šè¯è¯·æ±‚çš„æ‰§è¡Œé¡ºåºï¼Œè¿›è€Œä¿è¯æ•´ä¸ª ZooKeeper é›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ã€‚</p><p>â<br>åœ¨ ZooKeeper é›†ç¾¤çš„å†…éƒ¨å®ç°ä¸­ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹æ³•ä¿è¯æ‰€æœ‰ ZooKeeper é›†ç¾¤æ¥æ”¶åˆ°çš„äº‹åŠ¡æ€§ä¼šè¯è¯·æ±‚éƒ½èƒ½äº¤ç»™ Leader æœåŠ¡å™¨è¿›è¡Œå¤„ç†çš„å‘¢ï¼Ÿ<br>â<br>åœ¨ ZooKeeper é›†ç¾¤å†…éƒ¨ï¼Œé›†ç¾¤ä¸­é™¤ Leader æœåŠ¡å™¨å¤–çš„å…¶ä»–è§’è‰²æœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„äº‹åŠ¡æ€§ä¼šè¯è¯·æ±‚åï¼Œå¿…é¡»å°†è¯¥æ¡ä¼šè¯è¯·æ±‚è½¬å‘ç»™ Leader æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>ZooKeeper é›†ç¾¤ä¸­çš„ Follow å’Œ Observer æœåŠ¡å™¨ï¼Œéƒ½ä¼šæ£€æŸ¥å½“å‰æ¥æ”¶åˆ°çš„ä¼šè¯è¯·æ±‚æ˜¯å¦æ˜¯äº‹åŠ¡æ€§çš„è¯·æ±‚ï¼Œå¦‚æœæ˜¯äº‹åŠ¡æ€§çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å°†è¯¥è¯·æ±‚ä»¥ REQUEST æ¶ˆæ¯ç±»å‹è½¬å‘ç»™ Leader æœåŠ¡å™¨ã€‚</p><p>åœ¨ ZooKeeperé›†ç¾¤ä¸­çš„æœåŠ¡å™¨æ¥æ”¶åˆ°è¯¥æ¡æ¶ˆæ¯åï¼Œä¼šå¯¹è¯¥æ¡æ¶ˆæ¯è¿›è¡Œè§£æã€‚</p><p>åˆ†æå‡ºè¯¥æ¡æ¶ˆæ¯æ‰€åŒ…å«çš„åŸå§‹å®¢æˆ·ç«¯ä¼šè¯è¯·æ±‚ã€‚</p><p>ä¹‹åå°†è¯¥æ¡æ¶ˆæ¯æäº¤åˆ°è‡ªå·±çš„ Leader æœåŠ¡å™¨è¯·æ±‚å¤„ç†é“¾ä¸­ï¼Œå¼€å§‹è¿›è¡Œäº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚æ“ä½œã€‚</p><p>å¦‚æœä¸æ˜¯äº‹åŠ¡æ€§è¯·æ±‚ï¼ŒZooKeeper é›†ç¾¤åˆ™äº¤ç”± Follow å’Œ Observer è§’è‰²æœåŠ¡å™¨å¤„ç†è¯¥æ¡ä¼šè¯è¯·æ±‚ï¼Œå¦‚æŸ¥è¯¢æ•°æ®èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><p>å½“ä¸€ä¸ªä¸šåŠ¡åœºæ™¯åœ¨æŸ¥è¯¢æ“ä½œå¤šè€Œåˆ›å»ºåˆ é™¤ç­‰äº‹åŠ¡æ€§æ“ä½œå°‘çš„æƒ…å†µä¸‹ï¼ŒZooKeeper é›†ç¾¤çš„æ€§èƒ½è¡¨ç°çš„å°±ä¼šå¾ˆå¥½ã€‚</p><p>â<br>å¦‚æœæ˜¯åœ¨æç«¯æƒ…å†µä¸‹ï¼ŒZooKeeper é›†ç¾¤åªæœ‰äº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚è€Œæ²¡æœ‰æŸ¥è¯¢æ“ä½œï¼Œé‚£ä¹ˆ Follow å’Œ Observer æœåŠ¡å™¨å°±åªèƒ½å……å½“ä¸€ä¸ªè¯·æ±‚è½¬å‘æœåŠ¡å™¨çš„è§’è‰²ï¼Œ æ‰€æœ‰çš„ä¼šè¯çš„å¤„ç†å‹åŠ›éƒ½åœ¨ Leader æœåŠ¡å™¨ã€‚<br>â<br>åœ¨å¤„ç†æ€§èƒ½ä¸Šæ•´ä¸ªé›†ç¾¤æœåŠ¡å™¨çš„ç“¶é¢ˆå–å†³äº Leader æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</p><p>â<br>ZooKeeper é›†ç¾¤çš„ä½œç”¨åªèƒ½ä¿è¯åœ¨ Leader èŠ‚ç‚¹å´©æºƒçš„æ—¶å€™ï¼Œé‡æ–°é€‰ä¸¾å‡º Leader æœåŠ¡å™¨ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚<br>â<br>è¿™ä¹Ÿæ˜¯ ZooKeeper è®¾è®¡çš„ä¸€ä¸ªç¼ºç‚¹ã€‚</p><p>ã€ŒLeaderé€‰ä¸¾ã€</p><p>Leader æœåŠ¡å™¨çš„é€‰ä¸¾æ“ä½œä¸»è¦å‘ç”Ÿåœ¨ä¸¤ç§æƒ…å†µä¸‹ã€‚</p><p>ç¬¬ä¸€ç§å°±æ˜¯ ZooKeeper é›†ç¾¤æœåŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œç¬¬äºŒç§å°±æ˜¯åœ¨ ZooKeeper é›†ç¾¤ä¸­æ—§çš„ Leader æœåŠ¡å™¨å¤±æ•ˆæ—¶ï¼Œè¿™æ—¶ ZooKeeper é›†ç¾¤éœ€è¦é€‰ä¸¾å‡ºæ–°çš„ Leader æœåŠ¡å™¨ã€‚</p><p>â<br>ZooKeeper é›†ç¾¤é‡æ–°é€‰ä¸¾ Leader çš„è¿‡ç¨‹åªæœ‰ Follow æœåŠ¡å™¨å‚ä¸å·¥ä½œã€‚<br>â<br>â<br>æœåŠ¡å™¨çŠ¶æ€<br>â<br>æœåŠ¡å™¨å…·æœ‰å››ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯LOOKINGã€FOLLOWINGã€LEADINGã€OBSERVINGã€‚</p><p>ã€ŒLOOKINGã€ï¼šå¯»æ‰¾LeaderçŠ¶æ€ã€‚å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰Leaderï¼Œå› æ­¤éœ€è¦è¿›å…¥Leaderé€‰ä¸¾çŠ¶æ€ã€‚</p><p>ã€ŒFOLLOWINGã€ï¼šè·Ÿéšè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Followerã€‚</p><p>ã€ŒLEADINGã€ï¼šé¢†å¯¼è€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Leaderã€‚</p><p>ã€ŒOBSERVINGã€ï¼šè§‚å¯Ÿè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Observerã€‚</p><p>ã€Œäº‹åŠ¡IDï¼ˆzxidï¼‰ã€</p><p>Zookeeperçš„çŠ¶æ€å˜åŒ–ï¼Œéƒ½ä¼šç”±ä¸€ä¸ªZookeeperäº‹åŠ¡IDï¼ˆZXIDï¼‰æ ‡è¯†ã€‚</p><p>â<br>å†™å…¥Zookeeperï¼Œä¼šå¯¼è‡´çŠ¶æ€å˜åŒ–ï¼Œæ¯æ¬¡å†™å…¥éƒ½ä¼šå¯¼è‡´ZXIDå‘ç”Ÿå˜åŒ–ã€‚<br>â<br>ZXIDç”±Leaderç»Ÿä¸€åˆ†é…ï¼Œå…¨å±€å”¯ä¸€ï¼Œé•¿åº¦64ä½ï¼Œé€’å¢ã€‚</p><p>ZXIDå±•ç¤ºäº†æ‰€æœ‰çš„Zookeeperè½¬å°å˜æ›´é¡ºåºï¼Œæ¯æ¬¡å˜æ›´éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€ZXIDï¼Œå¦‚æœzxid1å°äºzxid2ï¼Œåˆ™è¯´æ˜zxid1çš„äº‹åŠ¡åœ¨zxid2çš„äº‹åŠ¡ä¹‹å‰å‘ç”Ÿã€‚</p><p>ã€Œé€‰ä¸¾è¿‡ç¨‹ã€</p><p>åœ¨ ZooKeeper é›†ç¾¤é‡æ–°é€‰ä¸¾ Leader èŠ‚ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦å¯ä»¥åˆ†ä¸º Leader å¤±æ•ˆå‘ç°ã€é‡æ–°é€‰ä¸¾ Leader ã€Follow æœåŠ¡å™¨è§’è‰²å˜æ›´ã€é›†ç¾¤åŒæ­¥è¿™å‡ ä¸ªæ­¥éª¤ã€‚</p><p>â<br>Leader å¤±æ•ˆå‘ç°<br>â<br>åœ¨ ZooKeeper é›†ç¾¤ä¸­ï¼Œå½“ Leader æœåŠ¡å™¨å¤±æ•ˆæ—¶ï¼ŒZooKeeper é›†ç¾¤ä¼šé‡æ–°é€‰ä¸¾å‡ºæ–°çš„ Leader æœåŠ¡å™¨ã€‚</p><p>åœ¨ ZooKeeper é›†ç¾¤ä¸­ï¼Œæ¢æµ‹ Leader æœåŠ¡å™¨æ˜¯å¦å­˜æ´»çš„æ–¹å¼ä¸ä¿æŒå®¢æˆ·ç«¯æ´»è·ƒæ€§çš„æ–¹æ³•éå¸¸ç›¸ä¼¼ã€‚<br>é¦–å…ˆï¼ŒFollow æœåŠ¡å™¨ä¼šå®šæœŸå‘ Leader æœåŠ¡å™¨å‘é€ ç½‘ç»œè¯·æ±‚ï¼Œåœ¨æ¥æ”¶åˆ°è¯·æ±‚åï¼ŒLeader æœåŠ¡å™¨ä¼šè¿”å›å“åº”æ•°æ®åŒ…ç»™ Follow æœåŠ¡å™¨ï¼Œè€Œåœ¨ Follow æœåŠ¡å™¨æ¥æ”¶åˆ° Leader æœåŠ¡å™¨çš„å“åº”åï¼Œå¦‚æœåˆ¤æ–­ Leader æœåŠ¡å™¨è¿è¡Œæ­£å¸¸ï¼Œåˆ™ç»§ç»­è¿›è¡Œæ•°æ®åŒæ­¥å’ŒæœåŠ¡è½¬å‘ç­‰å·¥ä½œï¼Œåä¹‹ï¼Œåˆ™è¿›è¡Œ Leader æœåŠ¡å™¨çš„é‡æ–°é€‰ä¸¾æ“ä½œã€‚</p><p>â<br>Leaderé‡æ–°é€‰ä¸¾<br>â<br>å½“ Follow æœåŠ¡å™¨å‘ Leader æœåŠ¡å™¨å‘é€çŠ¶æ€è¯·æ±‚åŒ…åï¼Œå¦‚æœæ²¡æœ‰å¾—åˆ° Leader æœåŠ¡å™¨çš„è¿”å›ä¿¡æ¯ï¼Œè¿™æ—¶ï¼Œå¦‚æœæ˜¯é›†ç¾¤ä¸­ä¸ªåˆ«çš„ Follow æœåŠ¡å™¨å‘ç°è¿”å›é”™è¯¯ï¼Œå¹¶ä¸ä¼šå¯¼è‡´ ZooKeeper é›†ç¾¤ç«‹åˆ»é‡æ–°é€‰ä¸¾ Leader æœåŠ¡å™¨ï¼Œè€Œæ˜¯å°†è¯¥ Follow æœåŠ¡å™¨çš„çŠ¶æ€å˜æ›´ä¸º LOOKING çŠ¶æ€ï¼Œå¹¶å‘ç½‘ç»œä¸­å‘èµ·æŠ•ç¥¨ï¼Œå½“ ZooKeeper é›†ç¾¤ä¸­æœ‰æ›´å¤šçš„æœºå™¨å‘èµ·æŠ•ç¥¨ï¼Œæœ€åå½“æŠ•ç¥¨ç»“æœæ»¡è¶³å¤šæ•°åŸåˆ™çš„æƒ…å†µä¸‹ã€‚</p><p>ZooKeeper ä¼šé‡æ–°é€‰ä¸¾å‡º Leader æœåŠ¡å™¨ã€‚</p><p>â<br>Follow è§’è‰²å˜æ›´<br>â<br>åœ¨ ZooKeeper é›†ç¾¤ä¸­ï¼ŒFollow æœåŠ¡å™¨ä½œä¸º Leader æœåŠ¡å™¨çš„å€™é€‰è€…ï¼Œå½“è¢«é€‰ä¸¾ä¸º Leader æœåŠ¡å™¨ä¹‹åï¼Œå…¶åœ¨ ZooKeeper é›†ç¾¤ä¸­çš„ Follow è§’è‰²ï¼Œä¹Ÿéšä¹‹å‘ç”Ÿæ”¹å˜ã€‚ä¹Ÿå°±æ˜¯è¦è½¬å˜ä¸º Leader æœåŠ¡å™¨ï¼Œå¹¶ä½œä¸º ZooKeeper é›†ç¾¤ä¸­çš„ Leader è§’è‰²æœåŠ¡å™¨å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><p>â<br>é›†ç¾¤åŒæ­¥æ•°æ®<br>â<br>åœ¨ ZooKeeper é›†ç¾¤æˆåŠŸé€‰ä¸¾ Leader æœåŠ¡å™¨ï¼Œå¹¶ä¸”å€™é€‰ Follow æœåŠ¡å™¨çš„è§’è‰²å˜æ›´åã€‚</p><p>ä¸ºé¿å…åœ¨è¿™æœŸé—´å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼ŒZooKeeper é›†ç¾¤åœ¨å¯¹å¤–æä¾›æœåŠ¡ä¹‹å‰ï¼Œä¼šé€šè¿‡ Leader è§’è‰²æœåŠ¡å™¨ç®¡ç†åŒæ­¥å…¶ä»–è§’è‰²æœåŠ¡å™¨ã€‚</p><p>ã€Œåº•å±‚å®ç°ã€</p><p>é¦–å…ˆï¼ŒZooKeeper é›†ç¾¤ä¼šå…ˆåˆ¤æ–­ Leader æœåŠ¡å™¨æ˜¯å¦å¤±æ•ˆï¼Œè€Œåˆ¤æ–­çš„æ–¹å¼å°±æ˜¯ Follow æœåŠ¡å™¨å‘ Leader æœåŠ¡å™¨å‘é€è¯·æ±‚åŒ…ï¼Œä¹‹å Follow æœåŠ¡å™¨æ¥æ”¶åˆ°å“åº”æ•°æ®åï¼Œè¿›è¡Œè§£æï¼ŒFollow æœåŠ¡å™¨ä¼šæ ¹æ®è¿”å›çš„æ•°æ®ï¼Œåˆ¤æ–­ Leader æœåŠ¡å™¨çš„è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœè¿”å›çš„æ˜¯ LOOKING å…³é”®å­—ï¼Œè¡¨æ˜ä¸é›†ç¾¤ä¸­ Leader æœåŠ¡å™¨æ— æ³•æ­£å¸¸é€šä¿¡ã€‚</p><p>ä¹‹åï¼Œåœ¨ ZooKeeper é›†ç¾¤é€‰ä¸¾ Leader æœåŠ¡å™¨æ—¶ï¼Œæ˜¯é€šè¿‡ ã€ŒFastLeaderElectionã€ ç±»å®ç°çš„ã€‚<br>è¯¥ç±»å®ç°äº† TCP æ–¹å¼çš„é€šä¿¡è¿æ¥ï¼Œç”¨äºåœ¨ ZooKeeper é›†ç¾¤ä¸­ä¸å…¶ä»– Follow æœåŠ¡å™¨è¿›è¡Œåè°ƒæ²Ÿé€šã€‚</p><p>FastLeaderElection ç±»ç»§æ‰¿äº† Election æ¥å£ï¼Œå®šä¹‰å…¶æ˜¯ç”¨æ¥è¿›è¡Œé€‰ä¸¾çš„å®ç°ç±»ã€‚</p><p>è€Œåœ¨å…¶å†…éƒ¨ï¼Œåˆå®šä¹‰äº†é€‰ä¸¾é€šä¿¡ç›¸å…³çš„ä¸€äº›é…ç½®å‚æ•°ï¼Œæ¯”å¦‚ finalizeWait æœ€ç»ˆç­‰å¾…æ—¶é—´ã€æœ€å¤§é€šçŸ¥é—´éš”æ—¶é—´ maxNotificationInterval ç­‰ã€‚<br>åœ¨é€‰ä¸¾çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè°ƒç”¨ ToSend å‡½æ•°å‘ ZooKeeper é›†ç¾¤ä¸­çš„å…¶ä»–è§’è‰²æœåŠ¡å™¨å‘é€æœ¬æœºçš„æŠ•ç¥¨ä¿¡æ¯ï¼Œå…¶ä»–æœåŠ¡å™¨åœ¨æ¥æ”¶æŠ•ç¥¨ä¿¡æ¯åï¼Œä¼šå¯¹æŠ•ç¥¨ä¿¡æ¯è¿›è¡Œæœ‰æ•ˆæ€§éªŒè¯ç­‰æ“ä½œï¼Œä¹‹å ZooKeeper é›†ç¾¤ç»Ÿè®¡æŠ•ç¥¨ä¿¡æ¯ï¼Œå¦‚æœè¿‡åŠæ•°çš„æœºå™¨æŠ•ç¥¨ä¿¡æ¯ä¸€è‡´ï¼Œåˆ™é›†ç¾¤å°±é‡æ–°é€‰å‡ºæ–°çš„ Leader æœåŠ¡å™¨ã€‚</p><p>â<br>è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åœ¨é‡æ–°é€‰ä¸¾ Leader æœåŠ¡å™¨çš„è¿‡ç¨‹ä¸­ï¼ŒZooKeeper é›†ç¾¤ç†è®ºä¸Šæ˜¯æ— æ³•è¿›è¡Œäº‹åŠ¡æ€§çš„è¯·æ±‚å¤„ç†çš„ã€‚<br>â<br>å› æ­¤ï¼Œå‘é€åˆ° ZooKeeper é›†ç¾¤ä¸­çš„äº‹åŠ¡æ€§ä¼šè¯ä¼šè¢«æŒ‚èµ·ï¼Œæš‚æ—¶ä¸æ‰§è¡Œï¼Œç­‰åˆ°é€‰ä¸¾å‡ºæ–°çš„ Leader æœåŠ¡å™¨åå†è¿›è¡Œæ“ä½œã€‚</p><p>ã€ŒObserverã€</p><p>åœ¨ ZooKeeper é›†ç¾¤æœåŠ¡è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒObserver æœåŠ¡å™¨ä¸ Follow æœåŠ¡å™¨å…·æœ‰ä¸€ä¸ªç›¸åŒçš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯è´Ÿè´£å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯¸å¦‚æŸ¥è¯¢æ•°æ®èŠ‚ç‚¹ç­‰éäº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚æ“ä½œã€‚</p><p>ä½†ä¸ Follow æœåŠ¡å™¨ä¸åŒçš„æ˜¯ï¼ŒObserver ä¸å‚ä¸ Leader æœåŠ¡å™¨çš„é€‰ä¸¾å·¥ä½œï¼Œä¹Ÿä¸ä¼šè¢«é€‰ä¸¾ä¸º Leader æœåŠ¡å™¨ã€‚<br>åœ¨æ—©æœŸçš„ ZooKeeper é›†ç¾¤æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œåªæœ‰ Leader æœåŠ¡å™¨å’Œ Follow æœåŠ¡å™¨ã€‚</p><p>ä¸è¿‡éšç€ ZooKeeper åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å¹¿æ³›åº”ç”¨ï¼Œæ—©æœŸæ¨¡å¼çš„è®¾è®¡ç¼ºç‚¹ä¹Ÿéšä¹‹äº§ç”Ÿï¼Œä¸»è¦å¸¦æ¥çš„é—®é¢˜æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p><p>éšç€é›†ç¾¤è§„æ¨¡çš„å˜å¤§ï¼Œé›†ç¾¤å¤„ç†å†™å…¥çš„æ€§èƒ½åè€Œä¸‹é™ã€‚</p><p>ZooKeeper é›†ç¾¤æ— æ³•åšåˆ°è·¨åŸŸéƒ¨ç½²ã€‚</p><p>å…¶ä¸­æœ€ä¸»è¦çš„é—®é¢˜åœ¨äºï¼Œå½“ ZooKeeper é›†ç¾¤çš„è§„æ¨¡å˜å¤§ï¼Œé›†ç¾¤ä¸­ Follow æœåŠ¡å™¨æ•°é‡é€æ¸å¢å¤šçš„æ—¶å€™ï¼ŒZooKeeper å¤„ç†åˆ›å»ºæ•°æ®èŠ‚ç‚¹ç­‰äº‹åŠ¡æ€§è¯·æ±‚æ“ä½œçš„æ€§èƒ½å°±ä¼šé€æ¸ä¸‹é™ã€‚</p><p>è¿™æ˜¯å› ä¸º ZooKeeper é›†ç¾¤åœ¨å¤„ç†äº‹åŠ¡æ€§è¯·æ±‚æ“ä½œæ—¶ï¼Œè¦åœ¨ ZooKeeper é›†ç¾¤ä¸­å¯¹è¯¥äº‹åŠ¡æ€§çš„è¯·æ±‚å‘èµ·æŠ•ç¥¨ï¼Œåªæœ‰è¶…è¿‡åŠæ•°çš„ Follow æœåŠ¡å™¨æŠ•ç¥¨ä¸€è‡´ï¼Œæ‰ä¼šæ‰§è¡Œè¯¥æ¡å†™å…¥æ“ä½œã€‚</p><p>æ­£å› å¦‚æ­¤ï¼Œéšç€é›†ç¾¤ä¸­ Follow æœåŠ¡å™¨çš„æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œä¸€æ¬¡å†™å…¥ç­‰ç›¸å…³æ“ä½œçš„æŠ•ç¥¨ä¹Ÿå°±å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œå¹¶ä¸” Follow æœåŠ¡å™¨ä¹‹é—´å½¼æ­¤çš„ç½‘ç»œé€šä¿¡ä¹Ÿå˜å¾—è¶Šæ¥è¶Šè€—æ—¶ï¼Œå¯¼è‡´éšç€ Follow æœåŠ¡å™¨æ•°é‡çš„é€æ­¥å¢åŠ ï¼Œäº‹åŠ¡æ€§çš„å¤„ç†æ€§èƒ½åè€Œå˜å¾—è¶Šæ¥è¶Šä½ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œåœ¨ ZooKeeper 3.6 ç‰ˆæœ¬åï¼ŒZooKeeper é›†ç¾¤ä¸­åˆ›å»ºäº†ä¸€ç§æ–°çš„æœåŠ¡å™¨è§’è‰²ï¼Œå³ Observerâ€”â€”è§‚å¯Ÿè€…è§’è‰²æœåŠ¡å™¨ã€‚<br>Observer å¯ä»¥å¤„ç† ZooKeeper é›†ç¾¤ä¸­çš„éäº‹åŠ¡æ€§è¯·æ±‚ï¼Œå¹¶ä¸”ä¸å‚ä¸ Leader èŠ‚ç‚¹ç­‰æŠ•ç¥¨ç›¸å…³çš„æ“ä½œã€‚</p><p>è¿™æ ·æ—¢ä¿è¯äº† ZooKeeper é›†ç¾¤æ€§èƒ½çš„æ‰©å±•æ€§ï¼Œåˆé¿å…äº†å› ä¸ºè¿‡å¤šçš„æœåŠ¡å™¨å‚ä¸æŠ•ç¥¨ç›¸å…³çš„æ“ä½œè€Œå½±å“ ZooKeeper é›†ç¾¤å¤„ç†äº‹åŠ¡æ€§ä¼šè¯è¯·æ±‚çš„èƒ½åŠ›ã€‚</p><p>åœ¨å®é™…éƒ¨ç½²çš„æ—¶å€™ï¼Œå› ä¸º Observer ä¸å‚ä¸ Leader èŠ‚ç‚¹ç­‰æ“ä½œï¼Œå¹¶ä¸ä¼šåƒ Follow æœåŠ¡å™¨é‚£æ ·é¢‘ç¹çš„ä¸ Leader æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚<br>å› æ­¤ï¼Œå¯ä»¥å°† Observer æœåŠ¡å™¨éƒ¨ç½²åœ¨ä¸åŒçš„ç½‘ç»œåŒºé—´ä¸­ï¼Œè¿™æ ·ä¹Ÿä¸ä¼šå½±å“æ•´ä¸ª ZooKeeper é›†ç¾¤çš„æ€§èƒ½ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„è·¨åŸŸéƒ¨ç½²ã€‚</p><p>ã€Œåœ¨æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨ ZooKeeper é›†ç¾¤æœåŠ¡å™¨çš„æ—¶å€™ï¼Œé›†ç¾¤ä¸­çš„æœºå™¨ä¸ªæ•°åº”è¯¥é€‰æ‹©å¥‡æ•°ä¸ªï¼Ÿã€</p><p>ä¸¤ä¸ªåŸå› ï¼š</p><p>â<br>åœ¨å®¹é”™èƒ½åŠ›ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå¥‡æ•°å°æ›´èŠ‚çœèµ„æº<br>â<br>Zookeeperä¸­ Leader é€‰ä¸¾ç®—æ³•é‡‡ç”¨äº†Zabåè®®ã€‚</p><p>Zabæ ¸å¿ƒæ€æƒ³æ˜¯å½“å¤šæ•° Server å†™æˆåŠŸï¼Œåˆ™å†™æˆåŠŸã€‚</p><p>ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š</p><p>å‡å¦‚zookeeperé›†ç¾¤1 ï¼Œæœ‰3ä¸ªèŠ‚ç‚¹ï¼Œ3&#x2F;2&#x3D;1.5 ,  å³zookeeperæƒ³è¦æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ï¼ˆå³leaderé€‰ä¸¾æˆåŠŸï¼‰ï¼Œè‡³å°‘éœ€è¦2ä¸ªèŠ‚ç‚¹æ˜¯æ­£å¸¸çš„ã€‚æ¢å¥è¯è¯´ï¼Œ3ä¸ªèŠ‚ç‚¹çš„zookeeperé›†ç¾¤ï¼Œå…è®¸æœ‰ä¸€ä¸ªèŠ‚ç‚¹å®•æœºã€‚</p><p>å‡å¦‚zookeeperé›†ç¾¤2ï¼Œæœ‰4ä¸ªèŠ‚ç‚¹ï¼Œ4&#x2F;2&#x3D;2 , å³zookeeperæƒ³è¦æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ï¼ˆå³leaderé€‰ä¸¾æˆåŠŸï¼‰ï¼Œè‡³å°‘éœ€è¦3ä¸ªèŠ‚ç‚¹æ˜¯æ­£å¸¸çš„ã€‚æ¢å¥è¯è¯´ï¼Œ4ä¸ªèŠ‚ç‚¹çš„zookeeperé›†ç¾¤ï¼Œä¹Ÿå…è®¸æœ‰ä¸€ä¸ªèŠ‚ç‚¹å®•æœºã€‚</p><p>é›†ç¾¤1ä¸é›†ç¾¤2éƒ½æœ‰ å…è®¸1ä¸ªèŠ‚ç‚¹å®•æœº çš„å®¹é”™èƒ½åŠ›ï¼Œä½†æ˜¯é›†ç¾¤2æ¯”é›†ç¾¤1å¤šäº†1ä¸ªèŠ‚ç‚¹ã€‚åœ¨ç›¸åŒå®¹é”™èƒ½åŠ›çš„æƒ…å†µä¸‹ï¼Œæœ¬ç€èŠ‚çº¦èµ„æºçš„åŸåˆ™ï¼Œzookeeperé›†ç¾¤çš„èŠ‚ç‚¹æ•°ç»´æŒå¥‡æ•°ä¸ªæ›´å¥½ä¸€äº›ã€‚</p><p>â<br>é˜²æ­¢ç”±è„‘è£‚é€ æˆçš„é›†ç¾¤ä¸å¯ç”¨ã€‚<br>â<br>é›†ç¾¤çš„è„‘è£‚é€šå¸¸æ˜¯å‘ç”Ÿåœ¨èŠ‚ç‚¹ä¹‹é—´é€šä¿¡ä¸å¯è¾¾çš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¼šåˆ†è£‚æˆä¸åŒçš„å°é›†ç¾¤ï¼Œå°é›†ç¾¤å„è‡ªé€‰å‡ºè‡ªå·±çš„masterèŠ‚ç‚¹ï¼Œå¯¼è‡´åŸæœ‰çš„é›†ç¾¤å‡ºç°å¤šä¸ªmasterèŠ‚ç‚¹çš„æƒ…å†µï¼Œè¿™å°±æ˜¯è„‘è£‚ã€‚</p><p>ä¸‹é¢ä¸¾ä¾‹è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆé‡‡ç”¨å¥‡æ•°å°èŠ‚ç‚¹ï¼Œå°±å¯ä»¥é˜²æ­¢ç”±äºè„‘è£‚é€ æˆçš„æœåŠ¡ä¸å¯ç”¨ï¼š</p><p>å‡å¦‚zookeeperé›†ç¾¤æœ‰ 5 ä¸ªèŠ‚ç‚¹ï¼Œå‘ç”Ÿäº†è„‘è£‚ï¼Œè„‘è£‚æˆäº†Aã€Bä¸¤ä¸ªå°é›†ç¾¤ï¼š</p><p>A ï¼š1ä¸ªèŠ‚ç‚¹ ï¼ŒB ï¼š4ä¸ªèŠ‚ç‚¹</p><p>A ï¼š2ä¸ªèŠ‚ç‚¹ï¼Œ B ï¼š3ä¸ªèŠ‚ç‚¹</p><p>å¯ä»¥çœ‹å‡ºï¼Œä¸Šé¢è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼ŒAã€Bä¸­æ€»ä¼šæœ‰ä¸€ä¸ªå°é›†ç¾¤æ»¡è¶³ å¯ç”¨èŠ‚ç‚¹æ•°é‡ &gt; æ€»èŠ‚ç‚¹æ•°é‡&#x2F;2 ã€‚</p><p>æ‰€ä»¥zookeeperé›†ç¾¤ä»ç„¶èƒ½å¤Ÿé€‰ä¸¾å‡ºleader ï¼Œ ä»ç„¶èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œåªä¸è¿‡æ˜¯æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆäº†è€Œå·²ã€‚</p><p>å‡å¦‚zookeeperé›†ç¾¤æœ‰4ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ ·å‘ç”Ÿè„‘è£‚ï¼Œè„‘è£‚æˆäº†Aã€Bä¸¤ä¸ªå°é›†ç¾¤ï¼š</p><p>Aï¼š1ä¸ªèŠ‚ç‚¹ ï¼Œ  Bï¼š3ä¸ªèŠ‚ç‚¹</p><p>Aï¼š2ä¸ªèŠ‚ç‚¹ ï¼Œ Bï¼š2ä¸ªèŠ‚ç‚¹</p><p>å› ä¸ºAå’ŒBéƒ½æ˜¯2ä¸ªèŠ‚ç‚¹ï¼Œéƒ½ä¸æ»¡è¶³ å¯ç”¨èŠ‚ç‚¹æ•°é‡ &gt; æ€»èŠ‚ç‚¹æ•°é‡&#x2F;2 çš„é€‰ä¸¾æ¡ä»¶ï¼Œ æ‰€ä»¥æ­¤æ—¶zookeeperå°±å½»åº•ä¸èƒ½æä¾›æœåŠ¡äº†ã€‚</p><h2 id="ZABåè®®"><a href="#ZABåè®®" class="headerlink" title="ZABåè®®"></a>ZABåè®®</h2><p><strong>ã€ŒZAB åè®®ç®—æ³•ã€</strong></p><p>ZooKeeper æœ€æ ¸å¿ƒçš„ä½œç”¨å°±æ˜¯ä¿è¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®ä¸€è‡´æ€§ï¼Œè€Œæ— è®ºæ˜¯å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ä¼šè¯è¯·æ±‚æ—¶ï¼Œè¿˜æ˜¯é›†ç¾¤ Leader èŠ‚ç‚¹å‘ç”Ÿé‡æ–°é€‰ä¸¾æ—¶ï¼Œéƒ½ä¼šäº§ç”Ÿæ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><blockquote><p>â</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒZooKeeper é‡‡ç”¨äº† ZAB åè®®ç®—æ³•ã€‚</p><p>â</p></blockquote><p>ZAB åè®®ç®—æ³•ï¼ˆZookeeper Atomic Broadcast  ï¼ŒZookeeper åŸå­å¹¿æ’­åè®®ï¼‰æ˜¯ ZooKeeper ä¸“é—¨è®¾è®¡ç”¨æ¥è§£å†³é›†ç¾¤æœ€ç»ˆä¸€è‡´æ€§é—®é¢˜çš„ç®—æ³•ï¼Œå®ƒçš„ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ç‚¹æ˜¯å´©æºƒæ¢å¤å’ŒåŸå­å¹¿æ’­åè®®ã€‚</p><ul><li>åœ¨æ•´ä¸ª ZAB åè®®çš„åº•å±‚å®ç°ä¸­ï¼ŒZooKeeper é›†ç¾¤ä¸»è¦é‡‡ç”¨ä¸»ä»æ¨¡å¼çš„ç³»ç»Ÿæ¶æ„æ–¹å¼æ¥ä¿è¯ ZooKeeper é›†ç¾¤ç³»ç»Ÿçš„ä¸€è‡´æ€§ã€‚</li></ul><p>å½“æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„äº‹åŠ¡æ€§ä¼šè¯è¯·æ±‚åï¼Œç³»ç»Ÿé›†ç¾¤é‡‡ç”¨ä¸»æœåŠ¡å™¨æ¥å¤„ç†è¯¥æ¡ä¼šè¯è¯·æ±‚ï¼Œç»è¿‡ä¸»æœåŠ¡å™¨å¤„ç†çš„ç»“æœä¼šé€šè¿‡ç½‘ç»œå‘é€ç»™é›†ç¾¤ä¸­å…¶ä»–ä»èŠ‚ç‚¹æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥æ“ä½œã€‚</p><blockquote><p>â</p><p>ä»¥ ZooKeeper é›†ç¾¤ä¸ºä¾‹ï¼Œè¿™ä¸ªæ“ä½œè¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºï¼š</p><p>â</p></blockquote><p>å½“ ZooKeeper é›†ç¾¤æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„äº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚åï¼Œé›†ç¾¤ä¸­çš„å…¶ä»– Follow è§’è‰²æœåŠ¡å™¨ä¼šå°†è¯¥è¯·æ±‚è½¬å‘ç»™ Leader è§’è‰²æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚</p><p>å½“ Leader èŠ‚ç‚¹æœåŠ¡å™¨åœ¨å¤„ç†å®Œè¯¥æ¡ä¼šè¯è¯·æ±‚åï¼Œä¼šå°†ç»“æœé€šè¿‡æ“ä½œæ—¥å¿—çš„æ–¹å¼åŒæ­¥ç»™é›†ç¾¤ä¸­çš„ Follow è§’è‰²æœåŠ¡å™¨ã€‚</p><p>ç„¶å Follow è§’è‰²æœåŠ¡å™¨æ ¹æ®æ¥æ”¶åˆ°çš„æ“ä½œæ—¥å¿—ï¼Œåœ¨æœ¬åœ°æ‰§è¡Œç›¸å…³çš„æ•°æ®å¤„ç†æ“ä½œï¼Œæœ€ç»ˆå®Œæˆæ•´ä¸ª ZooKeeper é›†ç¾¤å¯¹å®¢æˆ·ç«¯ä¼šè¯çš„å¤„ç†å·¥ä½œã€‚</p><p><strong>ã€Œå´©æºƒæ¢å¤ã€</strong></p><p>å½“é›†ç¾¤ä¸­çš„ Leader å‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œæ•´ä¸ªé›†ç¾¤å°±ä¼šå› ä¸ºç¼ºå°‘ Leader æœåŠ¡å™¨è€Œæ— æ³•å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„äº‹åŠ¡æ€§çš„ä¼šè¯è¯·æ±‚ã€‚</p><blockquote><p>â</p><p>å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨ ZAB åè®®ä¸­ä¹Ÿè®¾ç½®äº†å¤„ç†è¯¥é—®é¢˜çš„å´©æºƒæ¢å¤æœºåˆ¶ã€‚</p><p>â</p></blockquote><p>å´©æºƒæ¢å¤æœºåˆ¶æ˜¯ä¿è¯ ZooKeeper é›†ç¾¤æœåŠ¡é«˜å¯ç”¨çš„å…³é”®ã€‚è§¦å‘ ZooKeeper é›†ç¾¤æ‰§è¡Œå´©æºƒæ¢å¤çš„äº‹ä»¶æ˜¯é›†ç¾¤ä¸­çš„ Leader èŠ‚ç‚¹æœåŠ¡å™¨å‘ç”Ÿäº†å¼‚å¸¸è€Œæ— æ³•å·¥ä½œï¼Œäºæ˜¯ Follow æœåŠ¡å™¨ä¼šé€šè¿‡æŠ•ç¥¨æ¥å†³å®šæ˜¯å¦é€‰å‡ºæ–°çš„ Leader èŠ‚ç‚¹æœåŠ¡å™¨ã€‚</p><blockquote><p>â</p><p>æŠ•ç¥¨è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>â</p></blockquote><p>å½“å´©æºƒæ¢å¤æœºåˆ¶å¼€å§‹çš„æ—¶å€™ï¼Œæ•´ä¸ª ZooKeeper é›†ç¾¤çš„æ¯å° Follow æœåŠ¡å™¨ä¼šå‘èµ·æŠ•ç¥¨ï¼Œå¹¶åŒæ­¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»– Follow æœåŠ¡å™¨ã€‚</p><p>åœ¨æ¥æ”¶åˆ°æ¥è‡ªé›†ç¾¤ä¸­çš„å…¶ä»– Follow æœåŠ¡å™¨çš„æŠ•ç¥¨ä¿¡æ¯åï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ª Follow æœåŠ¡å™¨éƒ½ä¼šä¸è‡ªèº«çš„æŠ•ç¥¨ä¿¡æ¯è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœåˆ¤æ–­æ–°çš„æŠ•ç¥¨ä¿¡æ¯æ›´åˆé€‚ï¼Œåˆ™é‡‡ç”¨æ–°çš„æŠ•ç¥¨ä¿¡æ¯ä½œä¸ºè‡ªå·±çš„æŠ•ç¥¨ä¿¡æ¯ã€‚åœ¨é›†ç¾¤ä¸­çš„æŠ•ç¥¨ä¿¡æ¯è¿˜æ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°åŸåˆ™çš„æƒ…å†µä¸‹ï¼Œå†è¿›è¡Œæ–°ä¸€è½®çš„æŠ•ç¥¨ï¼Œæœ€ç»ˆå½“æ•´ä¸ª ZooKeeper é›†ç¾¤ä¸­çš„ Follow æœåŠ¡å™¨è¶…è¿‡åŠæ•°æŠ•å‡ºçš„ç»“æœç›¸åŒçš„æ—¶å€™ï¼Œå°±ä¼šäº§ç”Ÿæ–°çš„ Leader æœåŠ¡å™¨ã€‚</p><blockquote><p>â</p><p>é€‰ç¥¨ç»“æ„ï¼š</p><p>â</p></blockquote><p>ä»¥ Fast Leader Election é€‰ä¸¾çš„å®ç°æ–¹å¼æ¥è®²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªé€‰ç¥¨çš„æ•´ä½“ç»“æœå¯ä»¥åˆ†ä¸ºä¸€ä¸‹å…­ä¸ªéƒ¨åˆ†ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/zab-1.png"></p><ul><li><p>logicClockï¼šç”¨æ¥è®°å½•æœåŠ¡å™¨çš„æŠ•ç¥¨è½®æ¬¡ã€‚logicClock ä¼šä» 1 å¼€å§‹è®¡æ•°ï¼Œæ¯å½“è¯¥å°æœåŠ¡ç»è¿‡ä¸€è½®æŠ•ç¥¨åï¼ŒlogicClock çš„æ•°å€¼å°±ä¼šåŠ  1 ã€‚</p></li><li><p>stateï¼šç”¨æ¥æ ‡è®°å½“å‰æœåŠ¡å™¨çš„çŠ¶æ€ã€‚åœ¨ ZooKeeper é›†ç¾¤ä¸­ä¸€å°æœåŠ¡å™¨å…·æœ‰ LOOKINGã€FOLLOWINGã€LEADERINGã€OBSERVING è¿™å››ç§çŠ¶æ€ã€‚</p></li><li><p><code>self_id</code>ï¼šç”¨æ¥è¡¨ç¤ºå½“å‰æœåŠ¡å™¨çš„ ID ä¿¡æ¯ï¼Œè¯¥å­—æ®µåœ¨ ZooKeeper é›†ç¾¤ä¸­ä¸»è¦ç”¨æ¥ä½œä¸ºæœåŠ¡å™¨çš„èº«ä»½æ ‡è¯†ç¬¦ã€‚</p></li><li><p><code>self_zxid</code>ï¼šå½“å‰æœåŠ¡å™¨ä¸Šæ‰€ä¿å­˜çš„æ•°æ®çš„æœ€å¤§äº‹åŠ¡ ID ï¼Œä» 0 å¼€å§‹è®¡æ•°ã€‚</p></li><li><p><code>vote_id</code>ï¼šæŠ•ç¥¨è¦è¢«æ¨ä¸¾çš„æœåŠ¡å™¨çš„å”¯ä¸€ ID ã€‚</p></li><li><p><code>vote_zxid</code>ï¼šè¢«æ¨ä¸¾çš„æœåŠ¡å™¨ä¸Šæ‰€ä¿å­˜çš„æ•°æ®çš„æœ€å¤§äº‹åŠ¡ ID ï¼Œä» 0 å¼€å§‹è®¡æ•°ã€‚</p></li></ul><p>å½“ ZooKeeper é›†ç¾¤éœ€è¦é‡æ–°é€‰ä¸¾å‡ºæ–°çš„ Leader æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå°±ä¼šæ ¹æ®ä¸Šé¢ä»‹ç»çš„æŠ•ç¥¨ä¿¡æ¯å†…å®¹è¿›è¡Œå¯¹æ¯”ï¼Œä»¥æ‰¾å‡ºæœ€é€‚åˆçš„æœåŠ¡å™¨ã€‚</p><blockquote><p>â</p><p>é€‰ç¥¨ç­›é€‰</p><p>â</p></blockquote><p>å½“ä¸€å° Follow æœåŠ¡å™¨æ¥æ”¶åˆ°ç½‘ç»œä¸­çš„å…¶ä»– Follow æœåŠ¡å™¨çš„æŠ•ç¥¨ä¿¡æ¯åï¼Œæ˜¯å¦‚ä½•è¿›è¡Œå¯¹æ¯”æ¥æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ä¿¡æ¯çš„ã€‚</p><p>Follow æœåŠ¡å™¨è¿›è¡Œé€‰ç¥¨å¯¹æ¯”çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/zab-2.png"></p><p>é¦–å…ˆï¼Œä¼šå¯¹æ¯” logicClock æœåŠ¡å™¨çš„æŠ•ç¥¨è½®æ¬¡ï¼Œå½“ logicClock ç›¸åŒæ—¶ï¼Œè¡¨æ˜ä¸¤å¼ é€‰ç¥¨å¤„äºç›¸åŒçš„æŠ•ç¥¨é˜¶æ®µï¼Œå¹¶è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼Œå¦åˆ™è·³è¿‡ã€‚</p><p>æ¥ä¸‹æ¥å†å¯¹æ¯”<code>vote_zxid</code>è¢«é€‰ä¸¾çš„æœåŠ¡å™¨ ID ä¿¡æ¯ï¼Œè‹¥æ¥æ”¶åˆ°çš„å¤–éƒ¨æŠ•ç¥¨ä¿¡æ¯ä¸­çš„ <code>vote_zxid</code>å­—æ®µè¾ƒå¤§ï¼Œåˆ™å°†è‡ªå·±çš„ç¥¨ä¸­çš„<code>vote_zxid</code>ä¸<code>vote_myid</code>æ›´æ–°ä¸ºæ”¶åˆ°çš„ç¥¨ä¸­çš„<code>vote_zxid</code>ä¸<code>vote_myid</code>ï¼Œå¹¶å¹¿æ’­å‡ºå»ã€‚</p><p>è¦æ˜¯å¯¹æ¯”çš„ç»“æœç›¸åŒï¼Œåˆ™ç»§ç»­å¯¹æ¯”<code>vote_myid</code>è¢«é€‰ä¸¾æœåŠ¡å™¨ä¸Šæ‰€ä¿å­˜çš„æœ€å¤§äº‹åŠ¡ ID ï¼Œè‹¥å¤–éƒ¨æŠ•ç¥¨çš„<code>vote_myid</code> æ¯”è¾ƒå¤§ï¼Œåˆ™å°†è‡ªå·±çš„ç¥¨ä¸­çš„ <code>vote_myid</code>æ›´æ–°ä¸ºæ”¶åˆ°çš„ç¥¨ä¸­çš„<code>vote_myid</code> ã€‚</p><p>ç»è¿‡è¿™äº›å¯¹æ¯”å’Œæ›¿æ¢åï¼Œæœ€ç»ˆè¯¥å° Follow æœåŠ¡å™¨ä¼šäº§ç”Ÿæ–°çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œå¹¶åœ¨ä¸‹ä¸€è½®çš„æŠ•ç¥¨ä¸­å‘é€åˆ° ZooKeeper é›†ç¾¤ä¸­ã€‚</p><p><strong>ã€Œæ¶ˆæ¯å¹¿æ’­ã€</strong></p><p>åœ¨ Leader èŠ‚ç‚¹æœåŠ¡å™¨å¤„ç†è¯·æ±‚åï¼Œéœ€è¦é€šçŸ¥é›†ç¾¤ä¸­çš„å…¶ä»–è§’è‰²æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥ã€‚ZooKeeper é›†ç¾¤é‡‡ç”¨æ¶ˆæ¯å¹¿æ’­çš„æ–¹å¼å‘é€é€šçŸ¥ã€‚</p><p>ZooKeeper é›†ç¾¤ä½¿ç”¨åŸå­å¹¿æ’­åè®®è¿›è¡Œæ¶ˆæ¯å‘é€ï¼Œè¯¥åè®®çš„åº•å±‚å®ç°è¿‡ç¨‹ä¸äºŒé˜¶æ®µæäº¤è¿‡ç¨‹éå¸¸ç›¸ä¼¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/zab-3.png"></p><p>å½“è¦åœ¨é›†ç¾¤ä¸­çš„å…¶ä»–è§’è‰²æœåŠ¡å™¨è¿›è¡Œæ•°æ®åŒæ­¥çš„æ—¶å€™ï¼ŒLeader æœåŠ¡å™¨å°†è¯¥æ“ä½œè¿‡ç¨‹å°è£…æˆä¸€ä¸ª Proposal æäº¤äº‹åŠ¡ï¼Œå¹¶å°†å…¶å‘é€ç»™é›†ç¾¤ä¸­å…¶ä»–éœ€è¦è¿›è¡Œæ•°æ®åŒæ­¥çš„æœåŠ¡å™¨ã€‚</p><p>å½“è¿™äº›æœåŠ¡å™¨æ¥æ”¶åˆ° Leader æœåŠ¡å™¨çš„æ•°æ®åŒæ­¥äº‹åŠ¡åï¼Œä¼šå°†è¯¥æ¡äº‹åŠ¡èƒ½å¦åœ¨æœ¬åœ°æ­£å¸¸æ‰§è¡Œçš„ç»“æœåé¦ˆç»™ Leader æœåŠ¡å™¨ï¼ŒLeader æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å…¶ä»– Follow æœåŠ¡å™¨çš„åé¦ˆä¿¡æ¯åè¿›è¡Œç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨é›†ç¾¤ä¸­æ‰§è¡Œæœ¬æ¬¡äº‹åŠ¡æ“ä½œã€‚</p><p>è¿™é‡Œè¯·æ³¨æ„ ï¼Œä¸äºŒé˜¶æ®µæäº¤è¿‡ç¨‹ä¸åŒï¼ˆå³éœ€è¦é›†ç¾¤ä¸­æ‰€æœ‰æœåŠ¡å™¨éƒ½åé¦ˆå¯ä»¥æ‰§è¡Œäº‹åŠ¡æ“ä½œåï¼Œä¸»æœåŠ¡å™¨å†æ¬¡å‘é€ commit æäº¤è¯·æ±‚æ‰§è¡Œæ•°æ®å˜æ›´ï¼‰ ï¼ŒZAB åè®®ç®—æ³•çœå»äº†ä¸­æ–­çš„é€»è¾‘ï¼Œå½“ ZooKeeper é›†ç¾¤ä¸­æœ‰è¶…è¿‡ä¸€åŠçš„ Follow æœåŠ¡å™¨èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œäº‹åŠ¡æ“ä½œåï¼Œæ•´ä¸ª ZooKeeper é›†ç¾¤å°±å¯ä»¥æäº¤ Proposal äº‹åŠ¡äº†ã€‚</p><h2 id="æ—¥å¿—æ¸…ç†"><a href="#æ—¥å¿—æ¸…ç†" class="headerlink" title="æ—¥å¿—æ¸…ç†"></a>æ—¥å¿—æ¸…ç†</h2><p>ã€Œæ—¥å¿—ç±»å‹ã€</p><p>åœ¨ ZooKeeper æœåŠ¡è¿è¡Œçš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šäº§ç”Ÿæ•°æ®å¿«ç…§å’Œæ—¥å¿—æ–‡ä»¶ï¼Œæ•°æ®å¿«ç…§ç”¨äºé›†ç¾¤æœåŠ¡ä¸­çš„æ•°æ®åŒæ­¥ï¼Œè€Œæ•°æ®æ—¥å¿—åˆ™è®°å½•äº† ZooKeeper æœåŠ¡è¿è¡Œçš„ç›¸å…³çŠ¶æ€ä¿¡æ¯ã€‚</p><p>â<br>å…¶ä¸­ï¼Œæ•°æ®æ—¥å¿—æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦å®šæœŸç»´æŠ¤å’Œç®¡ç†çš„æ–‡ä»¶ã€‚<br>â<br>ã€Œæ¸…ç†æ–¹æ¡ˆã€</p><p>å¦‚ä¸Šé¢æ‰€ä»‹ç»çš„ï¼Œé¢å¯¹ç”Ÿäº§ç³»ç»Ÿä¸­äº§ç”Ÿçš„æ—¥å¿—ï¼Œä¸€èˆ¬çš„ç»´æŠ¤æ“ä½œæ˜¯å¤‡ä»½å’Œæ¸…ç†ã€‚</p><p>å¤‡ä»½æ˜¯ä¸ºäº†ä¹‹åå¯¹ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µè¿›è¡Œæ’æŸ¥å’Œä¼˜åŒ–ï¼Œè€Œæ¸…ç†ä¸»è¦å› ä¸ºéšç€ç³»ç»Ÿæ—¥å¿—çš„å¢åŠ ï¼Œæ—¥å¿—ä¼šé€æ¸å ç”¨ç³»ç»Ÿçš„å­˜å‚¨ç©ºé—´ï¼Œå¦‚æœä¸€ç›´ä¸è¿›è¡Œæ¸…ç†ï¼Œå¯èƒ½è€—å°½ç³»ç»Ÿçš„ç£ç›˜å­˜å‚¨ç©ºé—´ï¼Œå¹¶æœ€ç»ˆå½±å“æœåŠ¡çš„è¿è¡Œã€‚</p><p>ã€Œæ¸…ç†å·¥å…·ã€</p><p>â<br>Corntab<br>â<br>é¦–å…ˆï¼Œæˆ‘ä»¬ä»‹ç»çš„æ˜¯ Linux corntab ï¼Œå®ƒæ˜¯ Linux ç³»ç»Ÿä¸‹çš„è½¯ä»¶ï¼Œå¯ä»¥è‡ªåŠ¨åœ°æŒ‰ç…§æˆ‘ä»¬è®¾å®šçš„æ—¶é—´ï¼Œå‘¨æœŸæ€§åœ°æ‰§è¡Œæˆ‘ä»¬ç¼–å†™çš„ç›¸å…³è„šæœ¬ã€‚</p><p>crontab å®šæ—¶è„šæœ¬çš„æ–¹å¼ç›¸å¯¹çµæ´»ï¼Œå¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚æ¥è®¾ç½®å¤„ç†æ—¥å¿—çš„ç»´æŠ¤æ–¹å¼ï¼Œæ¯”å¦‚è¿™é‡Œæˆ‘ä»¬å¸Œæœ›å®šæœŸæ¸…é™¤ ZooKeeper æœåŠ¡è¿è¡Œçš„æ—¥å¿—ï¼Œè€Œä¸æƒ³æ¸…é™¤æ•°æ®å¿«ç…§çš„æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€šè¿‡è„šæœ¬è®¾ç½®ï¼Œè¾¾åˆ°åªå¯¹æ•°æ®æ—¥å¿—æ–‡ä»¶è¿›è¡Œæ¸…ç†çš„ç›®çš„ã€‚</p><p>â<br>PurgeTxnLog<br>â<br>ZooKeeper è‡ªèº«è¿˜æä¾›äº† PurgeTxnLog å·¥å…·ç±»ï¼Œç”¨æ¥æ¸…ç† snapshot æ•°æ®å¿«ç…§æ–‡ä»¶å’Œç³»ç»Ÿæ—¥å¿—ã€‚</p><p>PurgeTxnLog æ¸…ç†æ–¹å¼å’Œæˆ‘ä»¬ä¸Šé¢ä»‹ç»çš„æ–¹å¼ååˆ†ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯é€šè¿‡å®šæ—¶è„šæœ¬æ‰§è¡Œä»»åŠ¡ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯ï¼Œä¸Šé¢æåˆ°åœ¨ç¼–å†™æ—¥å¿—æ¸…é™¤ logsCleanWeek çš„æ—¶å€™ ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åŸç”Ÿ shell è„šæœ¬è‡ªå·±æ‰‹åŠ¨ç¼–å†™çš„æ•°æ®æ—¥å¿—æ¸…ç†é€»è¾‘ï¼Œè€Œä½¿ç”¨ PurgeTxnLog åˆ™å¯ä»¥åœ¨ç¼–å†™æ¸…é™¤è„šæœ¬çš„æ—¶å€™è°ƒç”¨ ZooKeeper ä¸ºæˆ‘ä»¬æä¾›çš„å·¥å…·ç±»å®Œæˆæ—¥å¿—æ¸…ç†å·¥ä½œã€‚</p><p>å¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬åœ¨&#x2F;usr&#x2F;binç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª PurgeLogsClean è„šæœ¬ã€‚æ³¨æ„è¿™é‡Œçš„è„šæœ¬ä¹Ÿæ˜¯ä¸€ä¸ª shell æ–‡ä»¶ã€‚</p><p>åœ¨è„šæœ¬ä¸­æˆ‘ä»¬åªéœ€è¦ç¼–å†™ PurgeTxnLog ç±»çš„è°ƒç”¨ç¨‹åºï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨é€šè¿‡ PurgeTxnLog å·¥å…·ç±»ä¸ºæˆ‘ä»¬å®Œæˆå¯¹åº”æ—¥å¿—æ–‡ä»¶çš„æ¸…ç†å·¥ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh  </span><br><span class="line">java -cp &quot;$CLASSPATH&quot; org.apache.zookeeper.server.PurgeTxnLog </span><br><span class="line">echo &quot;æ¸…ç†å®Œæˆ&quot; </span><br></pre></td></tr></table></figure><p>PurgeTxnLog æ–¹å¼ä¸ crontab ç›¸æ¯”ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ å®¹æ˜“è€Œä¸”ä¹Ÿæ›´åŠ ç¨³å®šå®‰å…¨ï¼Œä¸è¿‡ crontab æ–¹å¼æ›´åŠ çµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ç¼–å†™è‡ªå·±çš„æ¸…ç†é€»è¾‘ã€‚</p><h2 id="å®ç°åˆ†å¸ƒå¼é”"><a href="#å®ç°åˆ†å¸ƒå¼é”" class="headerlink" title="å®ç°åˆ†å¸ƒå¼é”"></a>å®ç°åˆ†å¸ƒå¼é”</h2><p>åˆ†å¸ƒå¼é”çš„ç›®çš„æ˜¯ä¿è¯åœ¨åˆ†å¸ƒå¼éƒ¨ç½²çš„åº”ç”¨é›†ç¾¤ä¸­ï¼Œå¤šä¸ªæœåŠ¡åœ¨è¯·æ±‚åŒä¸€ä¸ªæ–¹æ³•æˆ–è€…åŒä¸€ä¸ªä¸šåŠ¡æ“ä½œçš„æƒ…å†µä¸‹ï¼Œå¯¹åº”ä¸šåŠ¡é€»è¾‘åªèƒ½è¢«ä¸€å°æœºå™¨ä¸Šçš„ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œé¿å…å‡ºç°å¹¶å‘é—®é¢˜ã€‚</p><blockquote><p>â</p><p>å®ç°åˆ†å¸ƒå¼é”ç›®å‰æœ‰ä¸‰ç§æµè¡Œæ–¹æ¡ˆï¼Œå³åŸºäºæ•°æ®åº“ã€Redisã€ZooKeeper çš„æ–¹æ¡ˆ</p><p>â</p></blockquote><p><strong>ã€Œæ–¹æ¡ˆä¸€ï¼šã€</strong></p><p>ä½¿ç”¨èŠ‚ç‚¹ä¸­çš„å­˜å‚¨æ•°æ®åŒºåŸŸï¼ŒZKä¸­èŠ‚ç‚¹å­˜å‚¨æ•°æ®çš„å¤§å°ä¸èƒ½è¶…è¿‡1Mï¼Œä½†æ˜¯åªæ˜¯å­˜æ”¾ä¸€ä¸ªæ ‡è¯†æ˜¯è¶³å¤Ÿçš„ï¼Œçº¿ç¨‹è·å¾—é”æ—¶ï¼Œå…ˆæ£€æŸ¥è¯¥æ ‡è¯†æ˜¯å¦æ˜¯æ— é”æ ‡è¯†ï¼Œè‹¥æ˜¯å¯ä¿®æ”¹ä¸ºå ç”¨æ ‡è¯†ï¼Œä½¿ç”¨å®Œå†æ¢å¤ä¸ºæ— é”æ ‡è¯†</p><p><strong>ã€Œæ–¹æ¡ˆäºŒï¼šã€</strong></p><p>ä½¿ç”¨å­èŠ‚ç‚¹ï¼Œæ¯å½“æœ‰çº¿ç¨‹æ¥è¯·æ±‚é”çš„æ—¶å€™ï¼Œä¾¿åœ¨é”çš„èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹ç±»å‹å¿…é¡»ç»´æŠ¤ä¸€ä¸ªé¡ºåºï¼Œå¯¹å­èŠ‚ç‚¹çš„è‡ªå¢åºå·è¿›è¡Œæ’åºï¼Œé»˜è®¤æ€»æ˜¯æœ€å°çš„å­èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹è·å¾—é”ï¼Œé‡Šæ”¾é”æ—¶åˆ é™¤å¯¹åº”å­èŠ‚ç‚¹ä¾¿å¯</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/fenbushisuo-1.png"></p><p><strong>ã€Œæ­»é”é£é™©:ã€</strong></p><p>ä¸¤ç§æ–¹æ¡ˆå…¶å®éƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ä½¿ç”¨é”çš„æ—¶å€™ä¸€å®šè¦å»è§„é¿æ­»é”</p><ul><li><p>æ–¹æ¡ˆä¸€çœ‹ä¸Šå»æ˜¯æ²¡é—®é¢˜çš„ï¼Œç”¨çš„æ—¶å€™è®¾ç½®æ ‡è¯†ï¼Œç”¨å®Œæ¸…é™¤æ ‡è¯†ï¼Œä½†æ˜¯è¦æ˜¯æŒæœ‰é”çš„çº¿ç¨‹å‘ç”Ÿäº†æ„å¤–ï¼Œé‡Šæ”¾é”çš„ä»£ç æ— æ³•æ‰§è¡Œï¼Œé”å°±æ— æ³•é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹å°±ä¼šä¸€ç›´ç­‰å¾…é”ï¼Œç›¸å…³åŒæ­¥ä»£ç ä¾¿æ— æ³•æ‰§è¡Œ</p></li><li><p>æ–¹æ¡ˆäºŒä¹Ÿå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œä½†æ–¹æ¡ˆäºŒå¯ä»¥åˆ©ç”¨ZKçš„ä¸´æ—¶é¡ºåºèŠ‚ç‚¹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªè¦çº¿ç¨‹å‘ç”Ÿäº†å¼‚å¸¸å¯¼è‡´ç¨‹åºä¸­æ–­ï¼Œå°±ä¼šä¸¢å¤±ä¸ZKçš„è¿æ¥ï¼ŒZKæ£€æµ‹åˆ°è¯¥é“¾æ¥æ–­å¼€ï¼Œå°±ä¼šè‡ªåŠ¨åˆ é™¤è¯¥é“¾æ¥åˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°å³ä½¿å ç”¨é”çš„çº¿ç¨‹ç¨‹åºå‘ç”Ÿæ„å¤–ï¼Œä¹Ÿèƒ½ä¿è¯é”æ­£å¸¸é‡Šæ”¾çš„ç›®çš„</p></li></ul><p><strong>ã€Œé¿å…ç¾Šç¾¤æ•ˆåº”ã€</strong></p><p>æŠŠé”è¯·æ±‚è€…æŒ‰ç…§åç¼€æ•°å­—è¿›è¡Œæ’é˜Ÿï¼Œåç¼€æ•°å­—å°çš„é”è¯·æ±‚è€…å…ˆè·å–é”ã€‚</p><p>å¦‚æœæ‰€æœ‰çš„é”è¯·æ±‚è€…éƒ½ watch é”æŒæœ‰è€…ï¼Œå½“ä»£è¡¨é”è¯·æ±‚è€…çš„ znode è¢«åˆ é™¤ä»¥åï¼Œæ‰€æœ‰çš„é”è¯·æ±‚è€…éƒ½ä¼šé€šçŸ¥åˆ°ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªé”è¯·æ±‚è€…èƒ½æ‹¿åˆ°é”ã€‚è¿™å°±æ˜¯ç¾Šç¾¤æ•ˆåº”ã€‚</p><blockquote><p>â</p><p>ä¸ºäº†é¿å…ç¾Šç¾¤æ•ˆåº”ï¼Œæ¯ä¸ªé”è¯·æ±‚è€… watch å®ƒå‰é¢çš„é”è¯·æ±‚è€…ã€‚</p><p>â</p></blockquote><p>æ¯æ¬¡é”è¢«é‡Šæ”¾ï¼Œåªä¼šæœ‰ä¸€ä¸ªé”è¯·æ±‚è€… ä¼šè¢«é€šçŸ¥åˆ°ã€‚</p><p>è¿™æ ·åšè¿˜è®©é”çš„åˆ†é…å…·æœ‰å…¬å¹³æ€§ï¼Œé”å®šçš„åˆ†é…éµå¾ªå…ˆåˆ°å…ˆå¾—çš„åŸåˆ™ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/fenbushisuo-2.png"></p><p><strong>ã€Œç”¨ ZooKeeper å®ç°åˆ†å¸ƒå¼é”çš„ç®—æ³•æµç¨‹ï¼Œæ ¹èŠ‚ç‚¹ä¸º &#x2F;lockï¼šã€</strong></p><ul><li><p>å®¢æˆ·ç«¯è¿æ¥ ZooKeeperï¼Œå¹¶<code>åœ¨/lock</code>ä¸‹åˆ›å»ºä¸´æ—¶æœ‰åºå­èŠ‚ç‚¹ï¼Œç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„å­èŠ‚ç‚¹ä¸º<code>/lock/lock01/00000001</code>ï¼Œç¬¬äºŒä¸ªä¸º <code>/lock/lock01/00000002</code>ï¼›</p></li><li><p>å…¶ä»–å®¢æˆ·ç«¯è·å–<code>/lock01</code>ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹æ˜¯å¦ä¸ºå½“å‰åˆ—è¡¨ä¸­åºå·æœ€å°çš„å­èŠ‚ç‚¹ï¼›</p></li><li><p>å¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼Œæ‰§è¡Œä¸šåŠ¡ä»£ç ï¼Œå¦åˆ™é€šè¿‡ watch äº‹ä»¶ç›‘å¬<code>/lock01</code>çš„å­èŠ‚ç‚¹å˜æ›´æ¶ˆæ¯ï¼Œè·å¾—å˜æ›´é€šçŸ¥åé‡å¤æ­¤æ­¥éª¤ç›´è‡³è·å¾—é”ï¼›</p></li><li><p>å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„å­èŠ‚ç‚¹ï¼Œé‡Šæ”¾åˆ†å¸ƒå¼é”ï¼›</p></li></ul><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯ä»¥åº”ç”¨ Apache Curator æ¥å¿«é€Ÿå®ç°åˆ†å¸ƒå¼é”ï¼ŒCurator æ˜¯ Netflix å…¬å¸å¼€æºçš„ä¸€ä¸ª ZooKeeper å®¢æˆ·ç«¯ï¼Œå¯¹ ZooKeeper åŸç”Ÿ API åšäº†æŠ½è±¡å’Œå°è£…ã€‚</p><h2 id="å®ç°åˆ†å¸ƒå¼ID"><a href="#å®ç°åˆ†å¸ƒå¼ID" class="headerlink" title="å®ç°åˆ†å¸ƒå¼ID"></a>å®ç°åˆ†å¸ƒå¼ID</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ ZooKeeper è‡ªèº«çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿è¡Œæ¨¡å¼ï¼Œæ¥å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼ç½‘ç»œç¯å¢ƒä¸‹çš„ ID è¯·æ±‚å’Œåˆ†å‘è¿‡ç¨‹ã€‚</p><p>â<br>æ¯ä¸ªéœ€è¦ ID ç¼–ç çš„ä¸šåŠ¡æœåŠ¡å™¨å¯ä»¥çœ‹ä½œæ˜¯ ZooKeeper çš„å®¢æˆ·ç«¯ã€‚ID ç¼–ç ç”Ÿæˆå™¨å¯ä»¥ä½œä¸º ZooKeeper çš„æœåŠ¡ç«¯ã€‚<br>â<br>å®¢æˆ·ç«¯é€šè¿‡å‘é€è¯·æ±‚åˆ° ZooKeeper æœåŠ¡å™¨ï¼Œæ¥è·å–ç¼–ç ä¿¡æ¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå‘é€ ID ç¼–ç ç»™å®¢æˆ·ç«¯ã€‚</p><p>ã€Œå®ç°åŸç†ï¼šã€</p><p>å¯ä»¥åˆ©ç”¨ ZooKeeper æ•°æ®æ¨¡å‹ä¸­çš„é¡ºåºèŠ‚ç‚¹ä½œä¸º ID ç¼–ç ã€‚</p><p>å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ create å‡½æ•°åˆ›å»ºé¡ºåºèŠ‚ç‚¹ã€‚æœåŠ¡å™¨æˆåŠŸåˆ›å»ºèŠ‚ç‚¹åï¼Œä¼šå“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæŠŠåˆ›å»ºå¥½çš„èŠ‚ç‚¹ä¿¡æ¯å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p><p>å®¢æˆ·ç«¯ç”¨æ•°æ®èŠ‚ç‚¹åç§°ä½œä¸º ID ç¼–ç ï¼Œè¿›è¡Œä¹‹åçš„æœ¬åœ°ä¸šåŠ¡æ“ä½œã€‚</p><p>åˆ©ç”¨ ZooKeeper ä¸­çš„é¡ºåºèŠ‚ç‚¹ç‰¹æ€§ï¼Œå¾ˆå®¹æ˜“ä½¿æˆ‘ä»¬åˆ›å»ºçš„ ID ç¼–ç å…·æœ‰æœ‰åºçš„ç‰¹æ€§ã€‚å¹¶ä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ä¼ é€’èŠ‚ç‚¹çš„åç§°ï¼Œæ ¹æ®ä¸åŒçš„ä¸šåŠ¡ç¼–ç åŒºåˆ†ä¸åŒçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œä»è€Œä½¿ç¼–ç çš„æ‰©å±•èƒ½åŠ›æ›´å¼ºã€‚</p><p>â<br>è™½ç„¶ä½¿ç”¨ ZooKeeper çš„å®ç°æ–¹å¼æœ‰è¿™ä¹ˆå¤šä¼˜ç‚¹ï¼Œä½†ä¹Ÿä¼šæœ‰ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚<br>â<br>å…¶ä¸­æœ€ä¸»è¦çš„æ˜¯ï¼Œåœ¨å®šä¹‰ç¼–ç çš„è§„åˆ™ä¸Šè¿˜æ˜¯å¼ºçƒˆä¾èµ–äºç¨‹åºå‘˜è‡ªèº«çš„èƒ½åŠ›å’Œå¯¹ä¸šåŠ¡çš„æ·±å…¥ç†è§£ã€‚</p><p>å¾ˆå®¹æ˜“å‡ºç°å› ä¸ºè€ƒè™‘ä¸å‘¨ï¼Œé€ æˆè®¾ç½®çš„è§„åˆ™åœ¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚æˆ–è€…å®‰å…¨æ€§ä¸å¤Ÿç­‰é—®é¢˜ã€‚</p><h2 id="å®ç°è´Ÿè½½å‡è¡¡"><a href="#å®ç°è´Ÿè½½å‡è¡¡" class="headerlink" title="å®ç°è´Ÿè½½å‡è¡¡"></a>å®ç°è´Ÿè½½å‡è¡¡</h2><p><strong>ã€Œå¸¸è§è´Ÿè½½å‡è¡¡ç®—æ³•ã€</strong></p><blockquote><p>â</p><p>è½®è¯¢æ³•</p><p>â</p></blockquote><p>è½®è¯¢æ³•æ˜¯æœ€ä¸ºç®€å•çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå½“æ¥æ”¶åˆ°æ¥è‡ªç½‘ç»œä¸­çš„å®¢æˆ·ç«¯è¯·æ±‚åï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¼šæŒ‰é¡ºåºé€ä¸ªåˆ†é…ç»™åç«¯æœåŠ¡ã€‚</p><p>æ¯”å¦‚é›†ç¾¤ä¸­æœ‰ 3 å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«æ˜¯ server1ã€server2ã€server3ï¼Œè½®è¯¢æ³•ä¼šæŒ‰ç…§ sever1ã€server2ã€server3 è¿™ä¸ªé¡ºåºä¾æ¬¡åˆ†å‘ä¼šè¯è¯·æ±‚ç»™æ¯ä¸ªæœåŠ¡å™¨ã€‚å½“ç¬¬ä¸€æ¬¡è½®è¯¢ç»“æŸåï¼Œä¼šé‡æ–°å¼€å§‹ä¸‹ä¸€è½®çš„å¾ªç¯ã€‚</p><blockquote><p>â</p><p>éšæœºæ³•</p><p>â</p></blockquote><p>éšæœºç®—æ³•æ˜¯æŒ‡è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œä¼šæ ¹æ®ä¸€å®šçš„éšæœºç®—æ³•é€‰ä¸­åå°é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨æ¥å¤„ç†è¿™æ¬¡ä¼šè¯è¯·æ±‚ã€‚</p><p>ä¸è¿‡ï¼Œå½“é›†ç¾¤ä¸­å¤‡é€‰æœºå™¨å˜çš„è¶Šæ¥è¶Šå¤šæ—¶ï¼Œé€šè¿‡ç»Ÿè®¡å­¦æˆ‘ä»¬å¯ä»¥çŸ¥é“æ¯å°æœºå™¨è¢«æŠ½ä¸­çš„æ¦‚ç‡åŸºæœ¬ç›¸ç­‰ï¼Œå› æ­¤éšæœºç®—æ³•çš„å®é™…æ•ˆæœè¶Šæ¥è¶Šè¶‹è¿‘è½®è¯¢ç®—æ³•ã€‚</p><blockquote><p>â</p><p>åŸåœ°å€å“ˆå¸Œæ³•</p><p>â</p></blockquote><p>åŸåœ°å€å“ˆå¸Œç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œç”¨è®¡ç®—ç»“æœè¿›è¡Œå–æ¨¡åï¼Œæ ¹æ®æœ€ç»ˆç»“æœé€‰æ‹©æœåŠ¡å™¨åœ°å€åˆ—è¡¨ä¸­çš„ä¸€å°æœºå™¨ï¼Œå¤„ç†è¯¥æ¡ä¼šè¯è¯·æ±‚ã€‚</p><p>é‡‡ç”¨è¿™ç§ç®—æ³•åï¼Œå½“åŒä¸€ IP çš„å®¢æˆ·ç«¯å†æ¬¡è®¿é—®æœåŠ¡ç«¯åï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨æœ€ç»ˆé€‰ä¸¾çš„è¿˜æ˜¯ä¸Šæ¬¡å¤„ç†è¯¥å°æœºå™¨ä¼šè¯è¯·æ±‚çš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½ä¼šåˆ†é…åŒä¸€å°æœåŠ¡å™¨ç»™å®¢æˆ·ç«¯ã€‚</p><blockquote><p>â</p><p>åŠ æƒè½®è¯¢æ³•</p><p>â</p></blockquote><p>åŠ æƒè½®è¯¢çš„æ–¹å¼ä¸è½®è¯¢ç®—æ³•çš„æ–¹å¼å¾ˆç›¸ä¼¼ï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºé€‰æ‹©æœºå™¨çš„æ—¶å€™ï¼Œä¸åªæ˜¯å•çº¯æŒ‰ç…§é¡ºåºçš„æ–¹å¼é€‰æ‹©ï¼Œè¿˜æ ¹æ®æœºå™¨çš„é…ç½®å’Œæ€§èƒ½é«˜ä½æœ‰æ‰€ä¾§é‡ï¼Œé…ç½®æ€§èƒ½å¥½çš„æœºå™¨å¾€å¾€é¦–å…ˆåˆ†é…ã€‚</p><blockquote><p>â</p><p>åŠ æƒéšæœºæ³•</p><p>â</p></blockquote><p>åŠ æƒéšæœºæ³•å’Œæˆ‘ä»¬ä¸Šé¢æåˆ°çš„éšæœºç®—æ³•ä¸€æ ·ï¼Œåœ¨é‡‡ç”¨éšæœºç®—æ³•é€‰ä¸¾æœåŠ¡å™¨çš„æ—¶å€™ï¼Œä¼šè€ƒè™‘ç³»ç»Ÿæ€§èƒ½ä½œä¸ºæƒå€¼æ¡ä»¶ã€‚</p><blockquote><p>â</p><p>æœ€å°è¿æ¥æ•°æ³•</p><p>â</p></blockquote><p>æœ€å°è¿æ¥æ•°ç®—æ³•æ˜¯æŒ‡ï¼Œæ ¹æ®åå°å¤„ç†å®¢æˆ·ç«¯çš„è¿æ¥ä¼šè¯æ¡æ•°ï¼Œè®¡ç®—åº”è¯¥æŠŠæ–°ä¼šè¯åˆ†é…ç»™å“ªä¸€å°æœåŠ¡å™¨ã€‚</p><p>ä¸€èˆ¬è®¤ä¸ºï¼Œè¿æ¥æ•°è¶Šå°‘çš„æœºå™¨ï¼Œåœ¨ç½‘ç»œå¸¦å®½å’Œè®¡ç®—æ€§èƒ½ä¸Šéƒ½æœ‰å¾ˆå¤§ä¼˜åŠ¿ï¼Œä¼šä½œä¸ºæœ€ä¼˜å…ˆåˆ†é…çš„å¯¹è±¡ã€‚</p><p><strong>ã€Œåˆ©ç”¨ ZooKeeper å®ç° è´Ÿè½½å‡è¡¡ ç®—æ³•ã€</strong></p><blockquote><p>â</p><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡é‡‡ç”¨æœ€å°è¿æ¥æ•°ç®—æ³•ï¼Œæ¥ç¡®å®šç©¶ç«Ÿå¦‚ä½•å‡è¡¡åœ°åˆ†é…ç½‘ç»œä¼šè¯è¯·æ±‚ç»™åå°å®¢æˆ·ç«¯ã€‚</p><p>â</p></blockquote><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå»ºç«‹çš„ ZooKeeper æ•°æ®æ¨¡å‹ä¸­ Severs èŠ‚ç‚¹å¯ä»¥ä½œä¸ºå­˜å‚¨æœåŠ¡å™¨åˆ—è¡¨çš„çˆ¶èŠ‚ç‚¹ã€‚</p><p>åœ¨å®ƒä¸‹é¢åˆ›å»º servers_host1ã€servers_host2ã€servers_host3ç­‰ä¸´æ—¶èŠ‚ç‚¹æ¥å­˜å‚¨é›†ç¾¤ä¸­çš„æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€ä¿¡æ¯ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/fuzaijunheng-1.png"></p><p>æ•´ä¸ªå®ç°çš„è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/fuzaijunheng-2.png"></p><ul><li><p>é¦–å…ˆï¼Œåœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„è¯·æ±‚åï¼Œé€šè¿‡ getData æ–¹æ³•è·å–æœåŠ¡ç«¯ Severs èŠ‚ç‚¹ä¸‹çš„æœåŠ¡å™¨åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯éƒ½å­˜å‚¨æœ‰å½“å‰æœåŠ¡å™¨çš„è¿æ¥æ•°ã€‚</p></li><li><p>é€šè¿‡åˆ¤æ–­é€‰æ‹©æœ€å°‘çš„è¿æ¥æ•°ä½œä¸ºå½“å‰ä¼šè¯çš„å¤„ç†æœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡ setData æ–¹æ³•å°†è¯¥èŠ‚ç‚¹è¿æ¥æ•°åŠ  1ã€‚</p></li><li><p>æœ€åï¼Œå½“å®¢æˆ·ç«¯æ‰§è¡Œå®Œæ¯•ï¼Œå†è°ƒç”¨ setData æ–¹æ³•å°†è¯¥èŠ‚ç‚¹ä¿¡æ¯å‡ 1ã€‚</p></li><li><p>æˆ‘ä»¬å®šä¹‰å½“æœåŠ¡å™¨æ¥æ”¶åˆ°ä¼šè¯è¯·æ±‚åã€‚åœ¨ ZooKeeper æœåŠ¡ç«¯å¢åŠ è¿æ¥æ•°çš„ addBlance æ–¹æ³•ã€‚</p></li><li><p>æˆ‘ä»¬é€šè¿‡ readData æ–¹æ³•è·å–æœåŠ¡å™¨æœ€æ–°çš„è¿æ¥æ•°ï¼Œä¹‹åå°†è¯¥è¿æ¥æ•°åŠ  1ï¼Œå†é€šè¿‡ writeData æ–¹æ³•å°†æ–°çš„è¿æ¥æ•°ä¿¡æ¯å†™å…¥åˆ°æœåŠ¡ç«¯å¯¹åº”èŠ‚ç‚¹ä¿¡æ¯ä¸­ã€‚</p></li><li><p>å½“æœåŠ¡å™¨å¤„ç†å®Œè¯¥ä¼šè¯è¯·æ±‚åï¼Œéœ€è¦æ›´æ–°æœåŠ¡ç«¯ç›¸å…³èŠ‚ç‚¹çš„è¿æ¥æ•°ã€‚</p></li><li><p>å…·ä½“çš„æ“ä½œä¸ addBlance æ–¹æ³•åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯å¯¹è·å–çš„è¿æ¥ä¿¡æ¯è¿›è¡Œå‡ä¸€æ“ä½œã€‚</p></li></ul><p><strong>ã€Œè¿™é‡Œæ³¨æ„ï¼šã€</strong></p><p>æˆ‘ä»¬æ—¥å¸¸ç”¨åˆ°çš„è´Ÿè½½å‡è¡¡å™¨ä¸»è¦æ˜¯é€‰æ‹©åå°å¤„ç†çš„æœåŠ¡å™¨ï¼Œå¹¶ç»™å…¶åˆ†å‘è¯·æ±‚ã€‚</p><blockquote><p>â</p><p>è€Œé€šè¿‡ ZooKeeper å®ç°çš„æœåŠ¡å™¨ï¼Œåªæä¾›äº†æœåŠ¡å™¨çš„ç­›é€‰å·¥ä½œã€‚</p><p>â</p></blockquote><p>åœ¨è¯·æ±‚åˆ†å‘çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯é€šè¿‡è´Ÿè½½ç®—æ³•è®¡ç®—å‡ºè¦è®¿é—®çš„æœåŠ¡å™¨ï¼Œä¹‹åå®¢æˆ·ç«¯è‡ªå·±è¿æ¥è¯¥æœåŠ¡å™¨ï¼Œå®Œæˆè¯·æ±‚æ“ä½œã€‚</p><h2 id="å¼€æºæ¡†æ¶ä½¿ç”¨æ¡ˆä¾‹"><a href="#å¼€æºæ¡†æ¶ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="å¼€æºæ¡†æ¶ä½¿ç”¨æ¡ˆä¾‹"></a>å¼€æºæ¡†æ¶ä½¿ç”¨æ¡ˆä¾‹</h2><p><strong>ã€ŒDubboä¸ZooKeeperã€</strong></p><p>Dubbo æ˜¯é˜¿é‡Œå·´å·´å¼€å‘çš„ä¸€å¥—å¼€æºçš„æŠ€æœ¯æ¡†æ¶ï¼Œæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java RPC æ¡†æ¶ã€‚</p><p><strong>ã€Œç”¨ZooKeeperåšæ³¨å†Œä¸­å¿ƒã€</strong></p><p>åœ¨æ•´ä¸ª Dubbo æ¡†æ¶çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæ³¨å†Œä¸­å¿ƒæ˜¯å…¶ä¸­æœ€ä¸ºå…³é”®çš„ä¸€ç‚¹ï¼Œå®ƒä¿è¯äº†æ•´ä¸ª PRC è¿‡ç¨‹ä¸­æœåŠ¡å¯¹å¤–çš„é€æ˜æ€§ã€‚</p><p>è€Œ Dubbo çš„æ³¨å†Œä¸­å¿ƒä¹Ÿæ˜¯é€šè¿‡ ZooKeeper æ¥å®ç°çš„ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨æ•´ä¸ª Dubbo æœåŠ¡çš„å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡æä¾›è€…ä¼šåœ¨å¯åŠ¨æ—¶å‘ <code>/dubbo/com.foo.BarService/providers</code>ç›®å½•å†™å…¥è‡ªå·±çš„ URL åœ°å€ï¼Œè¿™ä¸ªæ“ä½œå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª ZooKeeper å®¢æˆ·ç«¯åœ¨ ZooKeeper æœåŠ¡å™¨çš„æ•°æ®æ¨¡å‹ä¸Šåˆ›å»ºä¸€ä¸ªæ•°æ®èŠ‚ç‚¹ã€‚</p><p>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶è®¢é˜… <code>/dubbo/com.foo.BarService/providers</code> ç›®å½•ä¸‹çš„æä¾›è€… URL åœ°å€ï¼Œå¹¶å‘ <code>/dubbo/com.foo.BarService/consumers</code> ç›®å½•å†™å…¥è‡ªå·±çš„ URL åœ°å€ã€‚</p><p>è¯¥æ“ä½œæ˜¯é€šè¿‡ ZooKeeper æœåŠ¡å™¨åœ¨ &#x2F;consumers èŠ‚ç‚¹è·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªå­æ•°æ®èŠ‚ç‚¹ï¼Œç„¶åå†åœ¨è¯·æ±‚ä¼šè¯ä¸­å‘èµ·å¯¹ &#x2F;providers èŠ‚ç‚¹çš„ watch ç›‘æ§</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/shiyonganli-1.png"></p><p><strong>ã€ŒKafkaä¸ZooKeeperã€</strong></p><p><strong>ã€ŒZookeeperçš„ä½œç”¨ã€</strong></p><p>ç”±äº Broker æœåŠ¡å™¨é‡‡ç”¨åˆ†å¸ƒå¼é›†ç¾¤çš„æ–¹å¼å·¥ä½œï¼Œé‚£ä¹ˆåœ¨æœåŠ¡çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œéš¾å…å‡ºç°æŸå°æœºå™¨å› å¼‚å¸¸è€Œå…³é—­çš„çŠ¶å†µã€‚</p><p>ä¸ºäº†ä¿è¯æ•´ä¸ª Kafka é›†ç¾¤çš„å¯ç”¨æ€§ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç›‘æ§æ•´ä¸ªæœºå™¨çš„è¿è¡Œæƒ…å†µã€‚è€Œ Kafka å¯ä»¥é€šè¿‡ ZooKeeper ä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼Œå°†ç½‘ç»œä¸­æœºå™¨çš„è¿è¡Œç»Ÿè®¡å­˜å‚¨åœ¨æ•°æ®æ¨¡å‹ä¸­çš„ brokers èŠ‚ç‚¹ä¸‹ã€‚</p><p>åœ¨ Kafka çš„ Topic ä¿¡æ¯æ³¨å†Œä¸­ä¹Ÿéœ€è¦ä½¿ç”¨åˆ° ZooKeeper ï¼Œåœ¨ Kafka ä¸­åŒä¸€ä¸ªTopic æ¶ˆæ¯å®¹å™¨å¯ä»¥åˆ†æˆå¤šä¸ªä¸åŒç‰‡ï¼Œè€Œè¿™äº›åˆ†åŒºæ—¢å¯ä»¥å­˜åœ¨äºä¸€å° Broker æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜åœ¨äºä¸åŒçš„ Broker æœåŠ¡å™¨ä¸­ã€‚</p><p>è€Œåœ¨ Kafka é›†ç¾¤ä¸­ï¼Œæ¯å° Broker æœåŠ¡å™¨åˆç›¸å¯¹ç‹¬ç«‹ã€‚</p><p>ä¸ºäº†èƒ½å¤Ÿè¯»å–è¿™äº›ä»¥åˆ†å¸ƒå¼æ–¹å¼å­˜å‚¨çš„åˆ†åŒºä¿¡æ¯ï¼ŒKafka ä¼šå°†è¿™äº›åˆ†åŒºä¿¡æ¯åœ¨ Broker æœåŠ¡å™¨ä¸­çš„å¯¹åº”å…³ç³»å­˜å‚¨åœ¨ ZooKeeper æ•°æ®æ¨¡å‹çš„ topic èŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸€ä¸ª topic åœ¨ ZooKeeper æ•°æ®èŠ‚ç‚¹ä¸Šéƒ½ä¼šä»¥ <code>/brokers/topics/[topic]</code> çš„å½¢å¼å­˜åœ¨ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/zookeeper/shiyonganli-2.png"></p>]]></content>
      
      
      <categories>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZooKeeper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5åˆ†é’Ÿå¸¦ä½ æ·±å…¥æµ…å‡ºææ‡‚ Nginx</title>
      <link href="/article/112217.html"/>
      <url>/article/112217.html</url>
      
        <content type="html"><![CDATA[<p>ä½œä¸ºå¼€å‘è€…ï¼Œç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ Nginx çš„é‡è¦æ€§ã€‚Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ï¼Œç”±ä¿„ç½—æ–¯çš„ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«å¼€å‘ï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒäº 2004 å¹´ 10 æœˆ 4 æ—¥ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-01.png"></p><p>Nginx çš„ç‰¹ç‚¹æ˜¯ï¼š</p><ul><li>å†…å­˜å ç”¨å°‘</li><li>å¹¶å‘èƒ½åŠ›å¼ºï¼ˆå¯æ”¯æŒå¤§çº¦ 50000 ä¸ªå¹¶å‘è¿æ¥ï¼‰</li><li>é…ç½®è¶…ç®€æ´</li><li>bug éå¸¸å°‘</li><li>å®‰è£…è¶…ç®€å•</li><li>æœåŠ¡ç‰¹åˆ«ç¨³ï¼ˆå‡ ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡å¯ï¼‰</li></ul><p>åŸºäºè¿™äº›ç‰¹ç‚¹ï¼Œè¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å¼€å§‹ä½¿ç”¨ Nginxã€‚äºæ˜¯ï¼ŒæŒæ¡ Nginx å°±å˜æˆäº†å¼€å‘è€…çš„ä¸€é¡¹å¿…ä¸å¯å°‘çš„æŠ€èƒ½ã€‚</p><h2 id="Nginx-çš„ä½œç”¨"><a href="#Nginx-çš„ä½œç”¨" class="headerlink" title="Nginx çš„ä½œç”¨"></a>Nginx çš„ä½œç”¨</h2><p><strong>åå‘ä»£ç†</strong>æ˜¯ Nginx ä½œä¸º Web æœåŠ¡å™¨æœ€å¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä»€ä¹ˆæ˜¯åå‘ä»£ç†å‘¢ï¼Ÿå¾ˆå¤šåˆå­¦è€…åœ¨ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸ªåè¯çš„æ—¶å€™æ€»å…ä¸äº†å‡ºç°å¾ˆå¤šé—®å·ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-02.png"></p><p>é‚£è¦æƒ³ææ˜ç™½ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Œå°±å¿…é¡»å¾—ææ˜ç™½ä»€ä¹ˆæ˜¯æ­£å‘ä»£ç†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå°äºŒçš„æµè§ˆå™¨æ˜¯æ— æ³•ç›´æ¥è®¿é—®è°·å“¥çš„ï¼Œä½†é¦™æ¸¯çš„ä»£ç†æœåŠ¡å™¨æ˜¯å¯ä»¥è®¿é—®è°·å“¥çš„ï¼Œäºæ˜¯å°äºŒè®¿é—®äº†é¦™æ¸¯çš„ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿå°±é—´æ¥åœ°è®¿é—®äº†è°·å“¥ã€‚é‚£è¿™å°ä»£ç†æœåŠ¡å™¨ä¹Ÿå°±æ˜¯<strong>æ­£å‘ä»£ç†</strong>ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-03.png"></p><p>æ€»ç»“ä¸€å¥å°±æ˜¯ï¼Œ<strong>æ­£å‘ä»£ç†æ˜¯ä»£ç†å®¢æˆ·ç«¯çš„</strong>ï¼Œè®©ä½ èƒ½æ­£å¸¸è®¿é—®ç›®çš„æœåŠ¡å™¨ã€‚</p><p>ä¸ä¹‹ç›¸åï¼Œ<strong>åå‘ä»£ç†æ˜¯ä»£ç†æœåŠ¡å™¨çš„</strong>ï¼Œè®©å¤§é‡çš„è¯·æ±‚å‡è¡¡åœ°è®¿é—®åˆ°æŸä¸€å°æœåŠ¡å™¨ä¸Šã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œ10 ä¸‡ä¸ªå°äºŒåŒæ—¶åœ¨è®¿é—® <a href="https://www.itwanger.com/">itwanger.com</a>ï¼Œ å¦‚æœåªæœ‰ä¸€å°æœåŠ¡å™¨çš„è¯ï¼Œå¾ˆå®¹æ˜“å°±ç˜«ç—ªäº†ï¼Œäºæ˜¯é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¼šæœ‰å¾ˆå¤šå°æœåŠ¡å™¨ï¼ˆå‡å¦‚ 10 å°å§ï¼‰æ¥æ¥è¿™ä¸ªæ´»ï¼Œé‚£æ€ä¹ˆè®© 10 ä¸‡ä¸ªå°äºŒè®¿é—®åˆ°è¿™ 10 å°æœåŠ¡å™¨å‘¢ï¼Ÿ</p><p>è¿™å°±éœ€è¦ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨äº†ï¼Œåå‘ä»£ç†æœåŠ¡å™¨è®© 1 ä¸‡ä¸ªå°äºŒè®¿é—®æœåŠ¡å™¨ Aï¼Œ1 ä¸‡ä¸ªå°äºŒè®¿é—®æœåŠ¡å™¨ Bï¼Œ1 ä¸ªå°äºŒè®¿é—®æœåŠ¡å™¨ Cï¼Œè¿™æ ·çš„è¯ï¼Œæ¯å°æœåŠ¡å™¨çš„å‹åŠ›å°±ç›¸åº”å‡å°äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆ niceï¼Ÿ</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-04.png"></p><p>é‚£é—®é¢˜æ¥äº†ã€‚æ¯å°æœåŠ¡å™¨çš„èƒ½åŠ›å¯èƒ½ä¸åŒï¼Œæ¯”å¦‚è¯´æœåŠ¡å™¨ A çš„å†…å­˜æ¯”è¾ƒå¤§ä¸€ç‚¹ï¼Œæœ‰ 100 ä¸ª Gï¼›æœåŠ¡å™¨ B çš„å†…å­˜å°ä¸€ç‚¹ï¼Œæœ‰ 10 ä¸ª Gï¼›æœåŠ¡å™¨ C çš„å†…å­˜æ›´å°ä¸€ç‚¹ï¼Œåªæœ‰ 1 ä¸ª Gã€‚æ€ä¹ˆæ‰èƒ½è®©æ²¡å°æœåŠ¡å™¨æ‰¿æ‹…èµ·å®ƒèƒ½åŠ›èŒƒå›´å†…çš„è®¿é—®å‘¢ï¼Ÿ</p><p><strong>Nginx å†…ç½®äº†è½®è¯¢å’ŒåŠ æƒè½®è¯¢æ¥è¾¾åˆ°è´Ÿè½½å‡è¡¡çš„ç›®çš„</strong>ã€‚æœåŠ¡å™¨ A ç‰›é€¼å°±æŠŠå®ƒçš„æƒé‡åŠ å¤§ä¸€ç‚¹ï¼Œè®© 5 ä¸‡ä¸ªå°äºŒè®¿é—®å®ƒï¼›æœåŠ¡å™¨ B å¼±ä¸€ç‚¹ï¼Œæƒé‡å°±å†å°ä¸€ç‚¹ï¼Œè®© 2 ä¸‡ä¸ªå°äºŒè®¿é—®å®ƒï¼›æœåŠ¡å™¨ C æ›´å¼±ï¼Œæƒé‡å°±æœ€å°ï¼Œè®© 1 ä¸‡ä¸ªå°äºŒè®¿é—®å®ƒã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒNginx è¿˜æœ‰ä¸€ä¸ªå¾ˆç‰›é€¼çš„åŠŸèƒ½æ˜¯<strong>åŠ¨é™åˆ†ç¦»</strong>ã€‚</p><p>åœ¨æˆ‘ä»¬çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæœ‰äº›è¯·æ±‚æ˜¯éœ€è¦åå°å¤„ç†çš„ï¼›æœ‰äº›è¯·æ±‚æ˜¯ä¸éœ€è¦åå°å¤„ç†çš„ï¼Œæ¯”å¦‚è¯´ cssã€js è¿™äº›æ–‡ä»¶è¯·æ±‚ï¼Œè¿™äº›ä¸éœ€è¦ç»è¿‡åå°å¤„ç†çš„æ–‡ä»¶å°±å«é™æ€æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸€äº›è§„åˆ™ï¼ŒæŠŠåŠ¨æ€èµ„æºå’Œé™æ€èµ„æºåˆ†å¼€ï¼Œç„¶åé€šè¿‡ Nginx æŠŠè¯·æ±‚åˆ†å¼€ï¼Œé™æ€èµ„æºçš„è¯·æ±‚å°±ä¸éœ€è¦ç»è¿‡ Web æœåŠ¡å™¨å¤„ç†äº†ï¼Œä»è€Œæé«˜æ•´ä½“ä¸Šçš„èµ„æºçš„å“åº”é€Ÿåº¦ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-05.png"></p><h2 id="Nginx-çš„å®‰è£…"><a href="#Nginx-çš„å®‰è£…" class="headerlink" title="Nginx çš„å®‰è£…"></a>Nginx çš„å®‰è£…</h2><p>é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼ŒNginx çš„å®‰è£…å„ä¸ç›¸åŒã€‚</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>Windows å¯ä»¥ç›´æ¥åˆ°å®˜ç½‘ä¸‹è½½ zip ç»¿è‰²å®‰è£…åŒ…ï¼Œè§£å‹åå°±å¯ä»¥äº†ã€‚</p><blockquote><p><a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p></blockquote><h3 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h3><p>macOS å¯ä»¥é€šè¿‡ Homebrew æ¥å®‰è£…ï¼Œä¹‹å‰æ²¡æœ‰å®‰è£…çš„è¯å¯ä»¥æˆ³<a href="https://javabetter.cn/gongju/brew.html">è¿™ä¸ªé“¾æ¥</a>ï¼Œç»ˆç«¯çš„è¯ï¼Œå»ºè®®å¤§å®¶ä½¿ç”¨ <a href="https://javabetter.cn/gongju/warp.html">wrap</a>ï¼Œæœ‰ AI æç¤ºï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure><p>å¤§ä½“çš„è¿‡ç¨‹å°±æ˜¯ï¼Œä½ é—®ä¸€ä¸‹ wrapï¼Œæˆ‘æ€ä¹ˆå®‰è£… Nginx å•Šï¼Œå®ƒå°±ä¼šå‘Šè¯‰ä½ å®Œæ•´çš„å®‰è£…å’Œå¯åŠ¨æ­¥éª¤ï¼Œå¹¶ä¸”ä¼šå‘Šè¯‰ä½  Nginx çš„é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/nginx-20231209205522.png"></p><p>å¦‚æœç«¯å£ä¸æ˜¯ 80 çš„è¯ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶é‡Œè¿›è¡Œä¿®æ”¹ï¼Œæ¯”å¦‚è¯´æˆ‘æ”¹æˆäº† 8088ã€‚</p><p>é‚£å®‰è£…æˆåŠŸåå°±å¯ä»¥é€šè¿‡ <code>http://localhost:8088</code> æ¥è®¿é—®äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/nginx-20231209205810.png"></p><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>Linux çš„å®‰è£…æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯ä¸€å®¶çš„æœåŠ¡å™¨å‚å•†éƒ½ä¼šæœ‰ doc æ–‡æ¡£ã€‚æ¯”å¦‚è¯´<a href="https://curl.qcloud.com/gIsvte7E">è…¾è®¯äº‘</a>çš„ä½ æœä¸€ä¸‹ Nginx å…³é”®å­—å°±å¯ä»¥çœ‹åˆ°äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/nginx-20231209210202.png"></p><p>æˆ‘è¿™é‡Œä»¥ macOS ç¯å¢ƒä¸ºä¾‹ï¼Œæ¥æ¼”ç¤ºä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ <code>brew info nginx</code> å‘½ä»¤æŸ¥çœ‹ Nginx æ˜¯å¦å®‰è£…ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-07.png"></p><p>ç¬¬äºŒæ­¥ï¼Œé€šè¿‡ <code>brew install nginx</code> å‘½ä»¤å®‰è£… Nginxã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-08.png"></p><p>ä»ä»¥ä¸Šä¿¡æ¯å¯ä»¥å¾—å‡ºï¼š</p><ul><li>æ ¹ç›®å½•æ˜¯ <code>/usr/local/var/www</code></li><li>é…ç½®æ–‡ä»¶æ˜¯ <code>/usr/local/etc/nginx/nginx.conf</code></li><li>é»˜è®¤ç«¯å£æ˜¯ 8080</li></ul><p>ç¬¬ä¸‰æ­¥ï¼Œé€šè¿‡ <code>nginx</code> å‘½ä»¤å¯åŠ¨ Nginxã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-09.png"></p><p>ç¬¬å››æ­¥ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ é€šè¿‡ <code>localhost:8080</code> è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹æ¬¢è¿é¡µé¢ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-10.png"></p><h2 id="Nginx-å¸¸ç”¨å‘½ä»¤"><a href="#Nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Nginx å¸¸ç”¨å‘½ä»¤"></a>Nginx å¸¸ç”¨å‘½ä»¤</h2><p>é€šå¸¸æ¥è¯´ï¼ŒNginx ä¸€æ—¦å¯åŠ¨åï¼Œæˆ‘ä»¬æ˜¯å¾ˆå°‘è®©å®ƒé€€å‡ºçš„ï¼Œä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ reload å‘½ä»¤ã€‚å½“æˆ‘ä»¬ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œæ˜¯éœ€è¦æ‰§è¡Œä¸€æ¬¡ reload å‘½ä»¤è®© Nginx ç”Ÿæ•ˆçš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nginx  å¯åŠ¨</span><br><span class="line">nginx -s stop  åœæ­¢</span><br><span class="line">nginx -s quit  å®‰å…¨é€€å‡º</span><br><span class="line">nginx -s reload  é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶</span><br><span class="line">nginx -t  æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span><br><span class="line">ps aux|grep nginx  æŸ¥çœ‹nginxè¿›ç¨‹</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å¼ºè°ƒä¸€ä¸‹ <code>nginx -t</code> å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®çš„è¯ï¼Œä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx: the configuration file /usr/local/etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure><p>å‡å¦‚ä½ å¿˜è®°é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼Œé‚£è¿™ä¸ªå‘½ä»¤å°±å®åœ¨æ˜¯å¤ªæœ‰ç”¨äº†ã€‚</p><p>å¦å¤–ï¼ŒNginx çš„ reload å¯¹ç”¨æˆ·æ˜¯æ— æ„Ÿçš„ï¼Œè¿™ä¸€ç‚¹æˆ‘è§‰å¾—å¾ˆç‰›é€¼ï¼Œä½ é‡å¯äº† Nginxï¼Œä½†ç”¨æˆ·å°±ä»¿ä½›æ²¡æœ‰æ„Ÿè§‰ï¼Œè¿˜åœ¨ç»§ç»­è®¿é—®ç½‘ç«™ï¼Œè¿™å°±æ˜¯ Nginx çš„ä¼˜åŠ¿ã€‚</p><h2 id="Nginx-çš„é…ç½®"><a href="#Nginx-çš„é…ç½®" class="headerlink" title="Nginx çš„é…ç½®"></a>Nginx çš„é…ç½®</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ Nginx çš„é…ç½®ç»“æ„å›¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">main        # å…¨å±€é…ç½®</span><br><span class="line">â”œâ”€â”€ events  # é…ç½®ç½‘ç»œè¿æ¥</span><br><span class="line">â”œâ”€â”€ http    # é…ç½®ä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—ç­‰</span><br><span class="line">â”‚   â”œâ”€â”€ upstream # é…ç½®è´Ÿè½½å‡è¡¡</span><br><span class="line">â”‚   â”œâ”€â”€ server   # é…ç½®è™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥æœ‰å¤šä¸ª server</span><br><span class="line">â”‚   â”œâ”€â”€ server</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ location  # ç”¨äºåŒ¹é… URIï¼ˆURL æ˜¯ URI çš„ä¸€ç§ï¼‰ï¼Œå¯ä»¥æœ‰å¤šä¸ª location</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ location</span><br><span class="line">â”‚   â”‚   â””â”€â”€ ...</span><br><span class="line">â”‚   â””â”€â”€ ...</span><br><span class="line">â””â”€â”€ ...</span><br></pre></td></tr></table></figure><p>å†æŠŠ Nginx çš„é»˜è®¤é…ç½®æ‹‰å‡ºæ¥çœ‹ä¸€ä¸‹ï¼Œæˆ‘æŠŠæ³¨é‡ŠåŠ äº†è¿›å»ï¼Œè¿™æ ·å¤§å®¶å¾ˆå®¹æ˜“å°±æ˜ç™½è¿™è¡Œé…ç½®æ˜¯ç”¨æ¥å¹²å˜›çš„äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1; # Nginx è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’Œ CPU æ ¸æ•°ä¸€æ ·</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024; # æ¯ä¸ªè¿›ç¨‹å…è®¸æœ€å¤§å¹¶å‘æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types; # æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    sendfile        on; # å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span><br><span class="line">    keepalive_timeout  65; # ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8080; # é…ç½®ç›‘å¬çš„ç«¯å£</span><br><span class="line">        server_name  localhost; # é…ç½®çš„åŸŸå</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html; # ç½‘ç«™æ ¹ç›®å½•</span><br><span class="line">            index  index.html index.htm; # é»˜è®¤é¦–é¡µæ–‡ä»¶</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html; # é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    include servers/*; # åŠ è½½å­é…ç½®é¡¹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»¥ç”Ÿäº§ç¯å¢ƒ Linux ä¸ºä¾‹ã€‚</p><p>ç”±äºæˆ‘çš„æœåŠ¡å™¨ä¸Š 80 ç«¯å£æ˜¯é»˜è®¤æ‰“å¼€çš„ï¼Œæ‰€ä»¥æˆ‘å°†ç›‘å¬ç«¯å£é…ç½®æˆäº† 80ï¼Œå¦‚æœä½ é…ç½®æˆå…¶ä»–ç«¯å£çš„è¯ï¼Œè®°å¾—äº‘æœåŠ¡çš„å®‰å…¨ç»„é‡ŒæŠŠç«¯å£æ‰“å¼€ã€‚</p><p>root æˆ‘æŒ‡å®šäº† <code>/home/www</code> ç›®å½•ï¼Œé¦–é¡µæ–‡ä»¶ä¸º index.htmlã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯æˆ‘è‡ªå®šä¹‰çš„ï¼Œæ¥çœ‹ä¸€ä¸‹å†…å®¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;é©¬æ–¯å…‹&lt;/title&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;img src=&quot;niubi.jpeg&quot; /&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>å¥½ï¼Œä¿å­˜é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸” reload Nginxï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°çš„æµè§ˆå™¨ä¸­è¾“å…¥æœåŠ¡å™¨çš„ IP åœ°å€å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-12.png"></p><h2 id="Nginx-çš„å­¦ä¹ èµ„æ–™"><a href="#Nginx-çš„å­¦ä¹ èµ„æ–™" class="headerlink" title="Nginx çš„å­¦ä¹ èµ„æ–™"></a>Nginx çš„å­¦ä¹ èµ„æ–™</h2><p>å…³äº Nginx çš„è´Ÿè½½å‡è¡¡ï¼Œè¿˜æœ‰åŠ¨é™åˆ†ç¦»ï¼Œæˆ‘ä»¬ä»¥åæœ‰æœºä¼šå†è®²ã€‚Nginx çš„å…¥é—¨éå¸¸ç®€å•ï¼Œä½†æœ‰ä¸€è¯´ä¸€ï¼Œå¦‚æœæƒ³è¦åœ¨å·¥ä½œä¸­ç”¨å¥½ Nginxï¼Œè¿˜æ˜¯éœ€è¦èŠ±è´¹ä¸€ç•ªåŠŸå¤«çš„ã€‚</p><p>æˆ‘è¿™é‡Œå†ç»™å¤§å®¶æ¨èä¸€äº›ä¸é”™çš„å­¦ä¹ èµ„æ–™å§ã€‚</p><p><strong>1ï¼‰ç‹‚ç¥è¯´çš„è§†é¢‘å…¥é—¨æ•™ç¨‹</strong>ï¼Œæˆ‘ä¸ªäººè§‰å¾—ï¼Œç‹‚ç¥çš„å…¥é—¨æ•™ç¨‹è¿˜æ˜¯éå¸¸èˆ’é€‚çš„ï¼Œè¯­é€Ÿå’Œå†…å®¹éƒ½åˆšåˆšå¥½ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-13.png"></p><blockquote><p><a href="https://www.bilibili.com/video/BV1F5411J7vK">https://www.bilibili.com/video/BV1F5411J7vK</a></p></blockquote><p><strong>2ï¼‰é»‘é©¬ç¨‹åºå‘˜Nginxæ•™ç¨‹</strong>ï¼Œæ€»å…± 159 è®²ï¼ŒåŸºæœ¬ä¸Šç®—æ˜¯éå¸¸å…¨é¢çš„ Nginx çš„è§†é¢‘æ•™ç¨‹äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-14.png"></p><blockquote><p><a href="https://www.bilibili.com/video/BV1ov41187bq">https://www.bilibili.com/video/BV1ov41187bq</a></p></blockquote><p><strong>3ï¼‰æå®¢æ—¶é—´ä¸Šçš„ Nginx100 è®²</strong>ï¼Œè®²çš„æ¯”è¾ƒæ·±ä¸€ç‚¹ï¼Œæ¶‰åŠåˆ°ä¸å°‘åŸç†å±‚é¢çš„ä¸œè¥¿ã€‚é’±åŒ…æ¯”è¾ƒé¼“çš„è¯ï¼Œå¯ä»¥å»ä»˜è´¹ä¸‹ï¼š<a href="http://gk.link/a/12eru">http://gk.link/a/12eru</a></p><p><strong>4ï¼‰Nginx ä»å…¥é—¨åˆ°å®è·µï¼Œä¸‡å­—è¯¦è§£</strong>ï¼Œå›¾æ–‡ç‰ˆçš„ï¼Œå¯ä»¥åˆ°æ˜é‡‘ä¸Šçœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œå†…å®¹åŸºæœ¬ä¸Šé¢é¢ä¿±åˆ°äº†ï¼ˆå¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ç›®å½•ï¼‰ï¼Œé…åˆå‰é¢çš„è§†é¢‘è¯¾ï¼Œæ‹¿ä¸‹ Nginx åŸºæœ¬ä¸Šæ˜¯ç¨³äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/nginx/nginx-15.png"></p><blockquote><p><a href="https://juejin.cn/post/6844904144235413512">https://juejin.cn/post/6844904144235413512</a></p></blockquote><p>è¿™äº›èµ„æ–™å¦‚æœèƒ½å…¨éƒ¨è¿‡ä¸€éçš„è¯ï¼Œæˆ‘è¦å–Šä½  Nginx å°ç‹å­äº†ï¼Œä¼°è®¡å…¬å¸é‡åˆ° Nginx é—®é¢˜çš„è¯ï¼Œä½ è‚¯å®šæ˜¯è§£å†³é—®é¢˜çš„é‚£ä¸€ä¸ªã€‚</p>]]></content>
      
      
      <categories>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€é”®éƒ¨ç½²SpringBootåˆ°è¿œç¨‹Dockerå®¹å™¨</title>
      <link href="/article/112210.html"/>
      <url>/article/112210.html</url>
      
        <content type="html"><![CDATA[<h3 id="å…³äº-Docker"><a href="#å…³äº-Docker" class="headerlink" title="å…³äº Docker"></a>å…³äº Docker</h3><p>Docker æ˜¯ç”¨ go è¯­è¨€ç¼–å†™çš„ï¼Œè¿™ä¹Ÿæ˜¯ go è¯­è¨€è¿‘äº›å¹´è¶Šæ¥è¶Šç«çš„åŸå› ä¹‹ä¸€ã€‚å…³äº Dockerï¼Œæœ‰ 3 ä¸ªé‡è¦çš„æ¦‚å¿µéœ€è¦äº†è§£ä¸‹ï¼š</p><ul><li>imageï¼šé•œåƒï¼Œä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥åˆ›å»ºå®¹å™¨ï¼›å¦‚æœä½ æœ‰ Windows è£…æœºç»å†ï¼Œé‚£å¯ä»¥å¾ˆå¥½ç†è§£é•œåƒè¿™ä¸ªè¯çš„å«ä¹‰ï¼Œåæ­£æˆ‘å¹´å°‘çš„æ—¶å€™æ²¡å°‘æŠŠ Windows é•œåƒåˆ»ç›˜é‡è£…ç³»ç»Ÿã€‚</li><li>containerï¼šå®¹å™¨ï¼Œä¸€ä¸ªå¯è¿è¡Œçš„é•œåƒå®ä¾‹ï¼Œé‡Œé¢è¿è¡Œç€ä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥åšä¸€åˆ‡ä½ å½“å‰æ“ä½œç³»ç»Ÿå¯ä»¥åšçš„äº‹æƒ…ã€‚</li><li>Dockerfileï¼šé•œåƒæ„å»ºçš„æ¨¡æ¿ï¼Œæè¿°é•œåƒæ„å»ºçš„æ­¥éª¤ã€‚</li></ul><p>å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ï¼Œé€šè¿‡ Dockerfile æ„å»ºå‡ºé•œåƒï¼Œç„¶åé€šè¿‡é•œåƒæ„å»ºå®¹å™¨ï¼Œå®¹å™¨é‡Œå¯ä»¥è·‘ç¨‹åºã€‚å¦å¤–ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨ä¹‹é—´æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</p><p>å¯¹äºæˆ‘ä»¬å¼€å‘äººå‘˜æ¥è¯´ï¼ŒDocker å¯ä»¥åšåˆ°ï¼š</p><ul><li>ç¼–å†™æœ¬åœ°ä»£ç </li><li>ä½¿ç”¨ Docker å°†ç¨‹åºæ¨é€åˆ°æµ‹è¯•ç¯å¢ƒ</li><li>å‘ç° bug ååœ¨å¼€å‘ç¯å¢ƒä¸‹ä¿®å¤ï¼Œé‡æ–°éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæµ‹è¯•</li><li>æµ‹è¯•å®Œæˆåï¼Œæ¨é€åˆ°ç”Ÿäº§ç¯å¢ƒ</li></ul><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒDocker æä¾›çš„æ˜¯å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œç»†ç»†æƒ³ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯æŒºææ€–çš„ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>ä»¥åæˆ‘ä»¬å¼€å‘äººå‘˜å†è¯´ä»€ä¹ˆâ€œæˆ‘æœ¬åœ°è¿è¡Œçš„å¥½å¥½çš„å‘€â€å°±ç”©ä¸äº†é”…äº†ï¼Œå“ˆå“ˆã€‚</p><p>Java ç¨‹åºå‘˜åº”è¯¥å¯¹ Docker è¿™å¥å®£ä¼ è¯­å¾ˆç†Ÿæ‚‰ï¼š</p><blockquote><p>Buildâ€‚onceï¼ŒRunâ€‚anywhereï¼ˆæ­å»ºä¸€æ¬¡ï¼Œåˆ°å¤„èƒ½ç”¨ï¼‰</p></blockquote><p>Docker é‡‡ç”¨çš„æ˜¯ CS æ¶æ„ï¼Œå®¢æˆ·ç«¯ä¸ Docker å®ˆæŠ¤è¿›ç¨‹äº¤äº’ï¼Œåè€…è´Ÿè´£æ„å»ºã€è¿è¡Œå’Œåˆ†å‘ Docker å®¹å™¨çš„å·¥ä½œã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-5583604e-5ef8-4187-b29b-ff8527829141.png"></p><p>Docker çš„åº”ç”¨åœºæ™¯éå¸¸ä¸°å¯Œï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>è‡ªåŠ¨æ‰“åŒ…å’Œéƒ¨ç½²åº”ç”¨</li><li>åˆ›å»ºè½»é‡ã€ç§æœ‰çš„PaaSç¯å¢ƒ</li><li>è‡ªåŠ¨åŒ–æµ‹è¯•å’ŒæŒç»­é›†æˆ&#x2F;éƒ¨ç½²</li><li>éƒ¨ç½²å¹¶æ‰©å±•Webåº”ç”¨ã€æ•°æ®åº“å’Œåç«¯æœåŠ¡å™¨</li><li>åˆ›å»ºå®‰å…¨æ²™ç›’</li><li>è½»é‡çº§çš„æ¡Œé¢è™šæ‹ŸåŒ–</li></ul><h3 id="å®‰è£…-Docker"><a href="#å®‰è£…-Docker" class="headerlink" title="å®‰è£… Docker"></a>å®‰è£… Docker</h3><p>Docker Engineï¼ˆå¼•æ“ï¼‰éœ€è¦å®‰è£…åœ¨ 64 ä½çš„ Linux æœåŠ¡å™¨ä¸Šï¼ˆ32 ä½ä¸æ”¯æŒï¼‰ï¼Œå¹¶ä¸”éœ€è¦ä¸€äº›å…ˆå†³æ¡ä»¶ï¼ˆé’ˆå¯¹ CentOS ç³»ç»Ÿï¼‰ï¼š</p><blockquote><p>PSï¼šLinux ç¤¾åŒºå·²ä¸å†ç»´æŠ¤ CentOS 8ï¼Œå¯¼è‡´ yum æºéœ€è¦<a href="https://help.aliyun.com/document_detail/405635.htm">åˆ‡æ¢</a>ï¼Œåé¢æ‰“ç®—æŠŠç³»ç»Ÿåˆ‡æ¢ä¸º Anolisæˆ–Alinux</p></blockquote><ul><li>å¿…é¡»æ˜¯ CentOS 7 æˆ–è€… 8ç‰ˆæœ¬ï¼Œä»¥ä¸‹ç‰ˆæœ¬ä¸æ”¯æŒ</li><li>centos-extras å­˜å‚¨åº“å¿…é¡»æ˜¯å¯ç”¨çš„ï¼Œä¸€èˆ¬æ˜¯å¯ç”¨çš„ï¼Œå¦‚æœæ²¡å¯ç”¨çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨å¯ç”¨</li></ul><p>æˆ‘çš„äº‘æœåŠ¡å™¨å®‰è£…çš„æ˜¯ CentOS ç³»ç»Ÿï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»¥ CentOS ä½œä¸ºæ¼”ç¤ºç¯å¢ƒã€‚æˆ‘ä¸ªäººæ›´å–œæ¬¢ RPMï¼ˆRed-Hat Package Managerï¼Œçº¢å¸½è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼‰å®‰è£…åŒ…çš„æ–¹å¼ï¼Œç®€å•é«˜æ•ˆã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå®‰è£… yum-utils å·¥å…·åŒ…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨ yum-utils æä¾›çš„ yum-config-manager å·¥å…·é…ç½® Docker çš„å®‰è£…ä»“åº“ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œå®‰è£… Docker å¼•æ“ï¼ˆåŒ…æ‹¬ Docker Engine, containerd, å’Œ Docker Composeï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure><p>ç¬¬å››æ­¥ï¼Œå¯åŠ¨ Dockerã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p>ç¬¬äº”æ­¥ï¼ŒéªŒè¯ Docker æ˜¯å¦æ­£ç¡®å®‰è£…ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°ä»¥ä¸‹æç¤ºä¿¡æ¯ï¼Œå°±è¡¨æ˜ Docker å®‰è£…æˆåŠŸäº†ï¼</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-e1443e64-810b-46e3-9c1c-f144cdca1a35.png"></p><p>ä»¥ä¸Šæ˜¯ Docker å®˜æ–¹æä¾›çš„å®‰è£…æ–¹å¼ï¼Œç¨æ˜¾å¤æ‚ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ç”¨æ›´ç®€æ´çš„æ–¹å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># é¦–å…ˆå®‰è£… Docker</span><br><span class="line">yum -y install docker</span><br><span class="line"></span><br><span class="line"># ç„¶åå¯åŠ¨ Docker æœåŠ¡</span><br><span class="line">service docker start</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure><p>Docker é’ˆå¯¹ Windows å’Œ macOS ç³»ç»Ÿéƒ½æä¾›äº†æ¡Œé¢ç‰ˆï¼Œå¯ä»¥åˆ°å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ã€‚</p><blockquote><p>Docker ä¸‹è½½åœ°å€ï¼š<a href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></p></blockquote><p>æˆ‘è¿™é‡Œä»¥ macOS ä¸ºä¾‹ï¼ŒM1 èŠ¯ç‰‡å¯ä»¥é€‰æ‹© Apple Chipã€‚ä¸‹è½½å®Œæˆåç›´æ¥å‚»ç“œå¼å®‰è£…å°±å¯ä»¥äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-f4cd508b-c77b-44a1-979f-b4e9e7ff82ef.png"></p><p>å®‰è£…å¹¶å¯åŠ¨æˆåŠŸåçš„ç•Œé¢å¦‚ä¸‹æ‰€ç¤º:</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-c78c5bea-aa4c-472f-aa69-20854211fd02.png"></p><p>æŒ‰ç…§æç¤ºï¼Œåœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤ <code>docker run -d -p 80:80 docker/getting-started</code>ï¼š</p><p>å†æ¬¡å›åˆ° Docker æ¡Œé¢ç‰ˆï¼Œå¯ä»¥çœ‹åˆ°åˆšåˆšé€šè¿‡ 80 ç«¯å£åœ¨ Docker ä¸­è·‘èµ·æ¥çš„ Docker æ•™ç¨‹ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-36708add-535a-41d3-bbcf-68e2750e5f16.png"></p><p>ç‚¹å‡»ã€Œopen in browserã€å›¾æ ‡å°±å¯ä»¥åœ¨æµè§ˆå™¨æ‰“å¼€æ•™ç¨‹æ–‡æ¡£äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-209a79c6-294f-4f0d-9fe1-1ab62190d4ef.png"></p><p>Windows ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡æˆ‘ä¹‹å‰æ¨èçš„ chocolatey å‘½ä»¤è¡Œå·¥å…·å®‰è£…ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-4ef004a5-5b96-41eb-8621-65edfbe64f14.png"></p><p>ï¼ˆWindows çš„å®‰è£…ç­‰ä¸‹ä¸€æ¬¡æ‹¿åˆ°å°ç±³çš„ç¬”è®°æœ¬åï¼Œæˆ‘è£…ä¸€ä¸ªæŠŠè¿™éƒ¨åˆ†è¡¥å……å®Œæ•´ï¼‰</p><h3 id="å¼€å¯-Docker-è¿œç¨‹è®¿é—®æƒé™"><a href="#å¼€å¯-Docker-è¿œç¨‹è®¿é—®æƒé™" class="headerlink" title="å¼€å¯ Docker è¿œç¨‹è®¿é—®æƒé™"></a>å¼€å¯ Docker è¿œç¨‹è®¿é—®æƒé™</h3><p>ä¸ºäº†å°†æˆ‘ä»¬æœ¬åœ°çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Docker æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯ä¸€ä¸‹ Docker çš„è¿œç¨‹è®¿é—®æƒé™ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ Docker é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/lib/systemd/system/docker.service</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œåœ¨ service èŠ‚ç‚¹ä¸‹ç¼–è¾‘ ExecStart å±æ€§ï¼Œå¢åŠ  <code>-H tcp://0.0.0.0:2375</code></p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-a1be68f4-cb1b-45b1-ab6a-b39259a3ef39.png"></p><p>è¿™æ ·å°±ç›¸å½“äºå¯¹å¤–å¼€æ”¾äº† 2375 ç«¯å£ï¼Œå¦‚æœä½ å®‰è£…äº†å®å¡”é¢æ¿ï¼Œè®°å¾—åœ¨å®‰å…¨é¡µæ”¾è¡Œè¯¥ç«¯å£ï¼ŒåŒæ—¶ï¼Œäº‘æœåŠ¡å™¨çš„é˜²ç«å¢™ä¹Ÿè¦æ”¾å¼€è¯¥ç«¯å£ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-9bddcf0e-c6a7-414d-82ef-7881009ea6c9.png"></p><p>é…ç½®å®Œæˆåï¼Œé‡å¯ Dockerã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl restart docker </span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>http://ip:2375/version</code> æµ‹è¯•ä¸€ä¸‹æ˜¯å¦ç”Ÿæ•ˆã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-29852364-5b55-43b4-a7fa-6a9c4a592606.png"></p><p>ä¹‹åï¼Œå¯ä»¥åœ¨ Intellij IDEA ä¸­é…ç½®ä¸€ä¸‹ Docker çš„ TCP socketï¼Œå¦‚æœå‡ºç° connection successful å°±è¡¨æ˜é“¾æ¥æˆåŠŸäº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-a6e42514-8740-48ac-8baf-b97f49cb1818.png"></p><h3 id="ä½¿ç”¨-Docker-éƒ¨ç½²-Spring-Boot"><a href="#ä½¿ç”¨-Docker-éƒ¨ç½²-Spring-Boot" class="headerlink" title="ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot"></a>ä½¿ç”¨ Docker éƒ¨ç½² Spring Boot</h3><p>ç¬¬ä¸€æ­¥ï¼Œæ–°å»ºä¸€ä¸ªç®€å•çš„ Spring Boot é¡¹ç›®ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-3f748cc6-2efe-487d-9799-f02794145aec.png"></p><p>ä¸€ä¸ªéå¸¸ç®€å•çš„ Web é¡¹ç›®ï¼Œåªæœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DockerController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Dockerï¼Œæˆ‘æ˜¯æ²™é›•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@RequestMappingã€@RestController æ³¨è§£æˆ‘ä»¬åœ¨å‰å‡ ä¸ªç« èŠ‚ä»‹ç»è¿‡äº†ï¼Œä¹Ÿå°±æ˜¯è¡¨æ˜æˆ‘ä»¬è¿™æ˜¯ä¸€ä¸ª SpringMVC çš„é¡¹ç›®ï¼Œ<code>/</code> è·¯å¾„æ„å‘³ç€æˆ‘ä»¬åªè¦åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>localhost:8080</code> å°±å¯ä»¥å‘é€è¯·æ±‚äº†ï¼Œå“åº”ç»“æœä¸º â€œDockerï¼Œä½ å¥½â€ã€‚</p><p>å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ Intellij IDEA çš„ HTTP Client éªŒè¯ä¸€ä¸‹ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œæ„å»º Spring Boot é¡¹ç›®çš„ Docker é•œåƒæ–‡ä»¶ Dockerfileã€‚</p><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º Dockerfile æ–‡ä»¶ï¼Œè§ä¸‹å›¾ä½ç½®ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-08d6ce30-8192-4a7e-8bdc-95adb91c7c74.png"></p><p>å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jdk-alpine</span><br><span class="line">ARG JAR_FILE=target/*.jar</span><br><span class="line">COPY $&#123;JAR_FILE&#125; app.jar</span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br></pre></td></tr></table></figure><ul><li><code>FROM openjdk:8-jdk-alpine</code>ï¼šè¡¨ç¤ºä½¿ç”¨ JDK8 ä¸ºåŸºç¡€é•œåƒã€‚</li><li><code>ARG JAR_FILE=target/*.jar</code>ï¼šè¡¨ç¤ºå®šä¹‰ä¸€ä¸ªå‚æ•°åä¸º JAR_FILEï¼Œå€¼ä¸º <code>target/*.jar</code> çš„æ„å»ºå‚æ•°</li><li><code>COPY $&#123;JAR_FILE&#125; app.jar</code>ï¼šè¡¨ç¤ºæŠŠ target ç›®å½•ä¸‹çš„ jar æ–‡ä»¶å¤åˆ¶ä¸€ä»½æ–°çš„åˆ°é•œåƒå†…çš„ app.jar æ–‡ä»¶</li><li><code>ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</code>ï¼šè¡¨ç¤ºé€šè¿‡ <code>java -jar</code> çš„å½¢å¼è¿è¡Œ <code>app.jar</code>ï¼ŒENTRYPOINT ç”¨æ¥é…ç½®å®¹å™¨å¯åŠ¨æ—¶çš„è¿è¡Œå‘½ä»¤ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿è¡Œå‘½ä»¤ï¼Œåé¢æ˜¯ä¸€ä¸ªä¸€ä¸ªå‚æ•°ã€‚</li></ul><p>ç¬¬ä¸‰æ­¥ï¼Œåœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ  Maven çš„ Docker æ’ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.2&lt;/version&gt;</span><br><span class="line">    &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">            &lt;id&gt;build-image&lt;/id&gt;</span><br><span class="line">            &lt;phase&gt;package&lt;/phase&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">                &lt;goal&gt;build&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">    &lt;/executions&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;dockerHost&gt;http://ip:2375&lt;/dockerHost&gt;</span><br><span class="line">        &lt;imageName&gt;itwanger/$&#123;project.artifactId&#125;&lt;/imageName&gt;</span><br><span class="line">        &lt;imageTags&gt;</span><br><span class="line">            &lt;imageTag&gt;$&#123;project.version&#125;&lt;/imageTag&gt;</span><br><span class="line">        &lt;/imageTags&gt;</span><br><span class="line">        &lt;forceTags&gt;true&lt;/forceTags&gt;</span><br><span class="line">        &lt;dockerDirectory&gt;$&#123;project.basedir&#125;&lt;/dockerDirectory&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class="line">                &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class="line">                &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ <code>executions</code> èŠ‚ç‚¹ä¸‹æ·»åŠ  docker:buildï¼Œè¡¨ç¤ºåœ¨æ‰§è¡Œ mvn:package æ‰“åŒ…çš„æ—¶å€™é¡ºå¸¦æ„å»ºä¸€ä¸‹ Docker é•œåƒã€‚</li><li>åœ¨ <code>configuration</code> èŠ‚ç‚¹ä¸‹æ·»åŠ  Docker ä¸»æœºçš„åœ°å€ã€é•œåƒçš„åå­—ã€é•œåƒçš„ç‰ˆæœ¬ã€é•œåƒæ–‡ä»¶çš„ç›®å½•ã€ä»¥åŠ resources èŠ‚ç‚¹ä¸‹é…ç½®çš„ jar åŒ…ä½ç½®å’Œåç§°ç­‰ã€‚</li></ul><p>é…ç½®æå®šåï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯¹é¡¹ç›®è¿›è¡Œæ‰“åŒ…ï¼Œå¯ä»¥ç›´æ¥ç‚¹å‡» Maven é¢æ¿ä¸­çš„ package è¿›è¡Œæ‰“åŒ…ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-1932f285-bb8d-4225-af6e-014ed2c9104b.png"></p><p>é¦–æ¬¡æ‰“åŒ…éœ€è¦ä¸‹è½½ä¸€äº›åŸºç¡€é•œåƒï¼Œæ‰“åŒ…æˆåŠŸåï¼Œå¯ä»¥åœ¨ Docker å®¹å™¨ä¸­æŸ¥çœ‹æˆ‘ä»¬åˆšåˆšæ‰“åŒ…å¥½çš„é•œåƒï¼Œå‘½ä»¤ <code>docker images</code>ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-730b4f5b-d556-4f73-9dfc-b22152d86f08.png"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨è¿™ä¸ªé•œåƒçš„å®¹å™¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name itwanger -p 8080:8080 itwanger/springboot-docker:0.0.1-SNAPSHOT</span><br></pre></td></tr></table></figure><ul><li><code>-d</code>: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›</li><li><code>--name</code>: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§° itwangerï¼›</li><li><code>-p</code>: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£</li></ul><p>ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—® 8080 ç«¯å£ï¼Œå°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨ Docker ä¸ŠæˆåŠŸè¿è¡Œäº†ã€‚</p><p>å½“åˆ©ç”¨ <code>docker run</code> æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š</p><ul><li>æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»ä»“åº“ä¸‹è½½</li><li>åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</li><li>åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚</li><li>ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»</li><li>ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨</li><li>æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº</li><li>æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢</li></ul><h3 id="Intellij-IDEA-ç›´è¿-Docker"><a href="#Intellij-IDEA-ç›´è¿-Docker" class="headerlink" title="Intellij IDEA ç›´è¿ Docker"></a>Intellij IDEA ç›´è¿ Docker</h3><p>æ–°ç‰ˆçš„ Intellij IDEA ä¸­å·²ç»é»˜è®¤ç»§æ‰¿äº† Dockerï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ services é¢æ¿æ‰“å¼€ Dockerï¼Œç›´æ¥è¿›è¡Œæ“ä½œã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/docker-6b4fbbb0-3986-403b-9d7e-7e50cf27b499.png"></p>]]></content>
      
      
      <categories>
          
          <category> Javaä¼ä¸šçº§å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Guava:Googleå¼€æºçš„Javaå·¥å…·åº“ï¼Œå¤ªå¼ºå¤§äº†</title>
      <link href="/article/112213.html"/>
      <url>/article/112213.html</url>
      
        <content type="html"><![CDATA[<h2 id="Guavaå·¥å…·åº“"><a href="#Guavaå·¥å…·åº“" class="headerlink" title="Guavaå·¥å…·åº“"></a>Guavaå·¥å…·åº“</h2><h3 id="å‰ä¸–ä»Šç”Ÿ"><a href="#å‰ä¸–ä»Šç”Ÿ" class="headerlink" title="å‰ä¸–ä»Šç”Ÿ"></a>å‰ä¸–ä»Šç”Ÿ</h3><p>ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯ Guavaã€‚</p><p>æˆ‘ç”± Google å…¬å¸å¼€æºï¼Œç›®å‰åœ¨ GitHub ä¸Šå·²ç»æœ‰ 39.9k çš„é“ç²‰äº†ï¼Œç”±æ­¤å¯ä»¥è¯æ˜æˆ‘çš„å—æ¬¢è¿ç¨‹åº¦ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-01.png"></p><p>æˆ‘çš„èº«ä½“é‡Œä¸»è¦åŒ…å«æœ‰è¿™äº›å¸¸ç”¨çš„æ¨¡å—ï¼šé›†åˆ [collections] ã€ç¼“å­˜ [caching] ã€åŸç”Ÿç±»å‹æ”¯æŒ [primitives support] ã€å¹¶å‘åº“ [concurrency libraries] ã€é€šç”¨æ³¨è§£ [common annotations] ã€å­—ç¬¦ä¸²å¤„ç† [string processing] ã€I&#x2F;O ç­‰ã€‚æ–°ç‰ˆçš„ JDK ä¸­å·²ç»ç›´æ¥æŠŠæˆ‘å¼•å…¥äº†ï¼Œå¯æƒ³è€ŒçŸ¥æˆ‘æœ‰å¤šä¼˜ç§€ï¼Œå¿ä¸ä½éª„å‚²äº†ã€‚</p><p>è¿™ä¹ˆè¯´å§ï¼Œå­¦å¥½å¦‚ä½•ä½¿ç”¨æˆ‘ï¼Œèƒ½è®©ä½ åœ¨ç¼–ç¨‹ä¸­å˜å¾—æ›´å¿«ä¹ï¼Œå†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼</p><h3 id="å¼•å…¥-Guava"><a href="#å¼•å…¥-Guava" class="headerlink" title="å¼•å…¥ Guava"></a>å¼•å…¥ Guava</h3><p>å¦‚æœä½ è¦åœ¨ Maven é¡¹ç›®ä½¿ç”¨æˆ‘çš„è¯ï¼Œéœ€è¦å…ˆåœ¨ pom.xml æ–‡ä»¶ä¸­å¼•å…¥æˆ‘çš„ä¾èµ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;30.1-jre&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ä¸€ç‚¹è¦æ±‚ï¼ŒJDK ç‰ˆæœ¬éœ€è¦åœ¨ 8 ä»¥ä¸Šã€‚</p><h3 id="03ã€åŸºæœ¬å·¥å…·"><a href="#03ã€åŸºæœ¬å·¥å…·" class="headerlink" title="03ã€åŸºæœ¬å·¥å…·"></a>03ã€åŸºæœ¬å·¥å…·</h3><p>Doug Leaï¼Œjava.util.concurrent åŒ…çš„ä½œè€…ï¼Œæ›¾è¯´è¿‡ä¸€å¥è¯ï¼šâ€œ<a href="https://javabetter.cn/exception/npe.html">null çœŸç³Ÿç³•</a>â€ã€‚Tony Hoareï¼Œå›¾çµå¥–å¾—ä¸»ã€å¿«é€Ÿæ’åºç®—æ³•çš„ä½œè€…ï¼Œå½“ç„¶ä¹Ÿæ˜¯ null çš„åˆ›å»ºè€…ï¼Œä¹Ÿæ›¾è¯´è¿‡ç±»ä¼¼çš„è¯ï¼šâ€œnull çš„ä½¿ç”¨ï¼Œè®©æˆ‘æŸå¤±äº†åäº¿ç¾å…ƒã€‚â€é‰´äºæ­¤ï¼Œæˆ‘ç”¨ Optional æ¥è¡¨ç¤ºå¯èƒ½ä¸º null çš„å¯¹è±¡ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/guava-20230329172935.png"></p><p>ä»£ç ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; possible = Optional.of(5);</span><br><span class="line">possible.isPresent(); // returns true</span><br><span class="line">possible.get(); // returns 5</span><br></pre></td></tr></table></figure><p>æˆ‘å¤§å“¥ Java åœ¨ JDK 8 ä¸­æ–°å¢äº† <a href="https://javabetter.cn/java8/optional.html">Optional ç±»</a>ï¼Œæ˜¾ç„¶æ˜¯ä»æˆ‘è¿™å€Ÿé‰´è¿‡å»çš„ï¼Œä¸è¿‡ä»–çš„å’Œæˆ‘çš„æœ‰äº›ä¸åŒã€‚</p><ul><li>æˆ‘çš„ Optional æ˜¯ abstract çš„ï¼Œæ„å‘³ç€æˆ‘å¯ä»¥æœ‰å­ç±»å¯¹è±¡ï¼›æˆ‘å¤§å“¥çš„æ˜¯ final çš„ï¼Œæ„å‘³ç€æ²¡æœ‰å­ç±»å¯¹è±¡ã€‚</li><li>æˆ‘çš„ Optional å®ç°äº† Serializable æ¥å£ï¼Œå¯ä»¥åºåˆ—åŒ–ï¼›æˆ‘å¤§å“¥çš„æ²¡æœ‰ã€‚</li><li>æˆ‘çš„ä¸€äº›æ–¹æ³•å’Œæˆ‘å¤§å“¥çš„ä¹Ÿä¸å°½ç›¸åŒã€‚</li></ul><p>ä½¿ç”¨ Optional é™¤äº†èµ‹äºˆ null è¯­ä¹‰ï¼Œå¢åŠ äº†å¯è¯»æ€§ï¼Œæœ€å¤§çš„ä¼˜ç‚¹åœ¨äºå®ƒæ˜¯ä¸€ç§å‚»ç“œå¼çš„é˜²æŠ¤ã€‚Optional è¿«ä½¿ä½ ç§¯ææ€è€ƒå¼•ç”¨ç¼ºå¤±çš„æƒ…å†µï¼Œå› ä¸ºä½ å¿…é¡»æ˜¾å¼åœ°ä» Optional è·å–å¼•ç”¨ã€‚</p><p>é™¤äº† Optional ä¹‹å¤–ï¼Œæˆ‘è¿˜æä¾›äº†ï¼š</p><ul><li>å‚æ•°æ ¡éªŒ</li><li>å¸¸è§çš„ Object æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ Objects.equalsã€Objects.hashCodeï¼ŒJDK 7 å¼•å…¥çš„ Objects ç±»æä¾›åŒæ ·çš„æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿæ˜¯ä»æˆ‘è¿™å€Ÿé‰´çš„çµæ„Ÿã€‚</li><li>æ›´å¼ºå¤§çš„æ¯”è¾ƒå™¨</li></ul><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><p>é¦–å…ˆæˆ‘æ¥è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸å¯å˜é›†åˆã€‚</p><ul><li>ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œä½¿ç”¨ä¸å¯å˜é›†åˆæ—¢ä¿è¯çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œä¹Ÿå¤§å¤§åœ°å¢å¼ºäº†å¹¶å‘æ—¶çš„æ•ˆç‡ï¼ˆè·Ÿå¹¶å‘é”æ–¹å¼ç›¸æ¯”ï¼‰ã€‚</li><li>å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸éœ€è¦æ”¯æŒä¿®æ”¹æ“ä½œï¼Œä¸å¯å˜çš„é›†åˆå°†ä¼šèŠ‚çœç©ºé—´å’Œæ—¶é—´çš„å¼€é”€ã€‚</li><li>å¯ä»¥å½“ä½œä¸€ä¸ªå¸¸é‡æ¥å¯¹å¾…ï¼Œå¹¶ä¸”é›†åˆä¸­çš„å¯¹è±¡åœ¨ä»¥åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚</li></ul><p>ä¸ JDK ä¸­æä¾›çš„ä¸å¯å˜é›†åˆç›¸æ¯”ï¼Œæˆ‘æä¾›çš„ Immutable æ‰æ˜¯çœŸæ­£çš„ä¸å¯å˜ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæ¥çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ã€‚</p><p>ä¸‹é¢çš„ä»£ç åˆ©ç”¨ JDK çš„ <a href="https://javabetter.cn/common-tool/collections.html"><code>Collections.unmodifiableList(list)</code></a> å¾—åˆ°ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„é›†åˆ unmodifiableListã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List list = new ArrayList();</span><br><span class="line">list.add(&quot;é›·å†›&quot;);</span><br><span class="line">list.add(&quot;ä¹”å¸ƒæ–¯&quot;);</span><br><span class="line"></span><br><span class="line">List unmodifiableList = Collections.unmodifiableList(list);</span><br><span class="line">unmodifiableList.add(&quot;é©¬äº‘&quot;);</span><br></pre></td></tr></table></figure><p>è¿è¡Œä»£ç å°†ä¼šå‡ºç°ä»¥ä¸‹å¼‚å¸¸ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.UnsupportedOperationException</span><br><span class="line">at java.base/java.util.Collections$UnmodifiableCollection.add(Collections.java:1060)</span><br><span class="line">at com.itwanger.guava.NullTest.main(NullTest.java:29)</span><br></pre></td></tr></table></figure><p>å¾ˆå¥½ï¼Œæ‰§è¡Œ <code>unmodifiableList.add()</code> çš„æ—¶å€™æŠ›å‡ºäº† UnsupportedOperationException å¼‚å¸¸ï¼Œè¯´æ˜ <code>Collections.unmodifiableList()</code> è¿”å›äº†ä¸€ä¸ªä¸å¯å˜é›†åˆã€‚ä½†çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠ <code>unmodifiableList.add()</code> æ¢æˆ <code>list.add()</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List list = new ArrayList();</span><br><span class="line">list.add(&quot;é›·å†›&quot;);</span><br><span class="line">list.add(&quot;ä¹”å¸ƒæ–¯&quot;);</span><br><span class="line"></span><br><span class="line">List unmodifiableList = Collections.unmodifiableList(list);</span><br><span class="line">list.add(&quot;é©¬äº‘&quot;);</span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œçš„è¯ï¼Œç¨‹åºå¹¶æ²¡æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”ä½ ä¼šå‘ç° unmodifiableList ä¸­çœŸçš„å¤šäº†ä¸€ä¸ªå…ƒç´ ã€‚è¯´æ˜ä»€ä¹ˆå‘¢ï¼Ÿ</p><p><code>Collections.unmodifiableList(â€¦)</code> å®ç°çš„ä¸æ˜¯çœŸæ­£çš„ä¸å¯å˜é›†åˆï¼Œå½“åŸå§‹é›†åˆè¢«ä¿®æ”¹åï¼Œä¸å¯å˜é›†åˆé‡Œé¢çš„å…ƒç´ ä¹Ÿæ˜¯è·Ÿç€å‘ç”Ÿå˜åŒ–ã€‚</p><p>æˆ‘å°±ä¸ä¼šçŠ¯è¿™ç§é”™ï¼Œæ¥çœ‹ä¸‹é¢çš„ä»£ç ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringArrayList = Lists.newArrayList(&quot;é›·å†›&quot;,&quot;ä¹”å¸ƒæ–¯&quot;);</span><br><span class="line">ImmutableList&lt;String&gt; immutableList = ImmutableList.copyOf(stringArrayList);</span><br><span class="line">immutableList.add(&quot;é©¬äº‘&quot;);</span><br></pre></td></tr></table></figure><p>å°è¯• <code>immutableList.add()</code> çš„æ—¶å€™ä¼šæŠ›å‡º <code>UnsupportedOperationException</code>ã€‚æˆ‘åœ¨æºç ä¸­å·²ç»æŠŠ <code>add()</code> æ–¹æ³•åºŸå¼ƒäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Guaranteed to throw an exception and leave the collection unmodified.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> UnsupportedOperationException always</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@deprecated</span> Unsupported operation.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@CanIgnoreReturnValue</span></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯• <code>stringArrayList.add()</code> ä¿®æ”¹åŸé›†åˆçš„æ—¶å€™ immutableList å¹¶ä¸ä¼šå› æ­¤è€Œå‘ç”Ÿæ”¹å˜ã€‚</p><p>é™¤äº†ä¸å¯å˜é›†åˆä»¥å¤–ï¼Œæˆ‘è¿˜æä¾›äº†æ–°çš„é›†åˆç±»å‹ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>Multisetï¼Œå¯ä»¥å¤šæ¬¡æ·»åŠ ç›¸ç­‰çš„å…ƒç´ ã€‚å½“æŠŠ Multiset çœ‹æˆæ™®é€šçš„ Collection æ—¶ï¼Œå®ƒè¡¨ç°å¾—å°±åƒæ— åºçš„ ArrayListï¼›å½“æŠŠ Multiset çœ‹ä½œ <code>Map&lt;E, Integer&gt;</code> æ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ç¬¦åˆæ€§èƒ½æœŸæœ›çš„æŸ¥è¯¢æ“ä½œã€‚</li><li>Multimapï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠä¸€ä¸ªé”®æ˜ å°„åˆ°å¤šä¸ªå€¼ã€‚</li><li>BiMapï¼Œä¸€ç§ç‰¹æ®Šçš„ Mapï¼Œå¯ä»¥ç”¨ <code>inverse()</code> åè½¬<br> <code>BiMap&lt;K, V&gt;</code> çš„é”®å€¼æ˜ å°„ï¼›ä¿è¯å€¼æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ <code>values()</code> è¿”å› Set è€Œä¸æ˜¯æ™®é€šçš„ Collectionã€‚</li></ul><h3 id="05ã€å­—ç¬¦ä¸²å¤„ç†"><a href="#05ã€å­—ç¬¦ä¸²å¤„ç†" class="headerlink" title="05ã€å­—ç¬¦ä¸²å¤„ç†"></a>05ã€å­—ç¬¦ä¸²å¤„ç†</h3><p>å­—ç¬¦ä¸²è¡¨ç¤ºå­—ç¬¦çš„ä¸å¯å˜åºåˆ—ï¼Œåˆ›å»ºåå°±ä¸èƒ½æ›´æ”¹ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œå­—ç¬¦ä¸²çš„ä½¿ç”¨éå¸¸é¢‘ç¹ï¼Œç†Ÿç»ƒçš„å¯¹å…¶æ“ä½œå¯ä»¥æå¤§çš„æå‡æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚</p><p>æˆ‘æä¾›äº†è¿æ¥å™¨â€”â€”Joinerï¼Œå¯ä»¥ç”¨åˆ†éš”ç¬¦æŠŠå­—ç¬¦ä¸²åºåˆ—è¿æ¥èµ·æ¥ã€‚ä¸‹é¢çš„ä»£ç å°†ä¼šè¿”å›â€œé›·å†›; ä¹”å¸ƒæ–¯â€ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>useForNull(String)</code> æ–¹æ³•ç”¨æŸä¸ªå­—ç¬¦ä¸²æ¥æ›¿æ¢ nullï¼Œè€Œä¸åƒ <code>skipNulls()</code> æ–¹æ³•é‚£æ ·ç›´æ¥å¿½ç•¥ nullã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Joiner joiner = Joiner.on(&quot;; &quot;).skipNulls();</span><br><span class="line">return joiner.join(&quot;é›·å†›&quot;, null, &quot;ä¹”å¸ƒæ–¯&quot;);</span><br></pre></td></tr></table></figure><p>æˆ‘è¿˜æä¾›äº†æ‹†åˆ†å™¨â€”â€” Splitterï¼Œå¯ä»¥æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦æŠŠå­—ç¬¦ä¸²åºåˆ—è¿›è¡Œæ‹†åˆ†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Splitter.on(&#x27;,&#x27;)</span><br><span class="line">        .trimResults()</span><br><span class="line">        .omitEmptyStrings()</span><br><span class="line">        .split(&quot;é›·å†›,ä¹”å¸ƒæ–¯,,   ç«é”…&quot;);</span><br></pre></td></tr></table></figure><h3 id="06ã€ç¼“å­˜"><a href="#06ã€ç¼“å­˜" class="headerlink" title="06ã€ç¼“å­˜"></a>06ã€ç¼“å­˜</h3><p>ç¼“å­˜åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½æ˜¯ç›¸å½“æœ‰ç”¨çš„ã€‚ä½ åº”è¯¥çŸ¥é“ï¼Œæ£€ç´¢ä¸€ä¸ªå€¼çš„ä»£ä»·å¾ˆé«˜ï¼Œå°¤å…¶æ˜¯éœ€è¦ä¸æ­¢ä¸€æ¬¡è·å–å€¼çš„æ—¶å€™ï¼Œå°±åº”å½“è€ƒè™‘ä½¿ç”¨ç¼“å­˜ã€‚</p><p>æˆ‘æä¾›çš„ Cache å’Œ ConcurrentMap å¾ˆç›¸ä¼¼ï¼Œä½†ä¹Ÿä¸å®Œå…¨ä¸€æ ·ã€‚æœ€åŸºæœ¬çš„åŒºåˆ«æ˜¯ ConcurrentMap ä¼šä¸€ç›´ä¿å­˜æ‰€æœ‰æ·»åŠ çš„å…ƒç´ ï¼Œç›´åˆ°æ˜¾å¼åœ°ç§»é™¤ã€‚ç›¸å¯¹åœ°ï¼Œæˆ‘æä¾›çš„ Cache ä¸ºäº†é™åˆ¶å†…å­˜å ç”¨ï¼Œé€šå¸¸éƒ½è®¾å®šä¸ºè‡ªåŠ¨å›æ”¶å…ƒç´ ã€‚</p><p>å¦‚æœä½ æ„¿æ„æ¶ˆè€—ä¸€äº›å†…å­˜ç©ºé—´æ¥æå‡é€Ÿåº¦ï¼Œä½ èƒ½é¢„æ–™åˆ°æŸäº›é”®ä¼šè¢«æŸ¥è¯¢ä¸€æ¬¡ä»¥ä¸Šï¼Œç¼“å­˜ä¸­å­˜æ”¾çš„æ•°æ®æ€»é‡ä¸ä¼šè¶…å‡ºå†…å­˜å®¹é‡ï¼Œå°±å¯ä»¥ä½¿ç”¨ Cacheã€‚</p><p>æ¥ä¸ªç¤ºä¾‹ä½ æ„Ÿå—ä¸‹å§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCache</span><span class="params">()</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">CacheLoader</span> <span class="variable">cacheLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CacheLoader</span>&lt;String, Animal&gt;() &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œä¼šè°ƒç”¨è¿™é‡Œ</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Animal <span class="title function_">load</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    LoadingCache&lt;String, Animal&gt; loadingCache = CacheBuilder.newBuilder()</span><br><span class="line">        .maximumSize(<span class="number">1000</span>) <span class="comment">// å®¹é‡</span></span><br><span class="line">        .expireAfterWrite(<span class="number">3</span>, TimeUnit.SECONDS) <span class="comment">// è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        .removalListener(<span class="keyword">new</span> <span class="title class_">MyRemovalListener</span>()) <span class="comment">// å¤±æ•ˆç›‘å¬å™¨</span></span><br><span class="line">        .build(cacheLoader); <span class="comment">//</span></span><br><span class="line">    loadingCache.put(<span class="string">&quot;ç‹—&quot;</span>, <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;æ—ºè´¢&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    loadingCache.put(<span class="string">&quot;çŒ«&quot;</span>, <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;æ±¤å§†&quot;</span>, <span class="number">3</span>));</span><br><span class="line">    loadingCache.put(<span class="string">&quot;ç‹¼&quot;</span>, <span class="keyword">new</span> <span class="title class_">Animal</span>(<span class="string">&quot;ç°å¤ªç‹¼&quot;</span>, <span class="number">4</span>));</span><br><span class="line"></span><br><span class="line">    loadingCache.invalidate(<span class="string">&quot;çŒ«&quot;</span>); <span class="comment">// æ‰‹åŠ¨å¤±æ•ˆ</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> loadingCache.get(<span class="string">&quot;ç‹¼&quot;</span>);</span><br><span class="line">    System.out.println(animal);</span><br><span class="line">    Thread.sleep(<span class="number">4</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// ç‹¼å·²ç»è‡ªåŠ¨è¿‡å»ï¼Œè·å–ä¸º null å€¼æŠ¥é”™</span></span><br><span class="line">    System.out.println(loadingCache.get(<span class="string">&quot;ç‹¼&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¼“å­˜ç§»é™¤ç›‘å¬å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRemovalListener</span> <span class="keyword">implements</span> <span class="title class_">RemovalListener</span>&lt;String, Animal&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRemoval</span><span class="params">(RemovalNotification&lt;String, Animal&gt; notification)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">reason</span> <span class="operator">=</span> String.format(<span class="string">&quot;key=%s,value=%s,reason=%s&quot;</span>, notification.getKey(), notification.getValue(), notification.getCause());</span><br><span class="line">        System.out.println(reason);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Animal</span><span class="params">(String name, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CacheLoader ä¸­é‡å†™äº† load æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­æ—¶è¢«è°ƒç”¨ï¼Œæˆ‘è¿™é‡Œç›´æ¥è¿”å›äº† nullï¼Œå…¶å®è¿™æ ·ä¼šåœ¨æ²¡æœ‰å‘½ä¸­æ—¶æŠ›å‡º CacheLoader returned null for key å¼‚å¸¸ä¿¡æ¯ã€‚</p><p>MyRemovalListener ä½œä¸ºç¼“å­˜å…ƒç´ å¤±æ•ˆæ—¶çš„ç›‘å¬ç±»ï¼Œåœ¨æœ‰å…ƒç´ ç¼“å­˜å¤±æ•ˆæ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ onRemoval æ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯åŒæ­¥æ–¹æ³•ï¼Œå¦‚æœè¿™é‡Œè€—æ—¶è¾ƒé•¿ï¼Œä¼šé˜»å¡ç›´åˆ°å¤„ç†å®Œæˆã€‚</p><p>LoadingCache å°±æ˜¯ç¼“å­˜çš„ä¸»è¦æ“ä½œå¯¹è±¡äº†ï¼Œå¸¸ç”¨çš„å°±æ˜¯å…¶ä¸­çš„ put å’Œ get æ–¹æ³•äº†ã€‚</p><h3 id="07ã€é›†åˆå·¥å…·"><a href="#07ã€é›†åˆå·¥å…·" class="headerlink" title="07ã€é›†åˆå·¥å…·"></a>07ã€é›†åˆå·¥å…·</h3><p><code>com.google.common.collect</code>åŒ…ä¸‹çš„é›†åˆå·¥å…·ï¼š<code>Lists</code>ä¹Ÿéå¸¸å¼ºå¤§ã€‚</p><h4 id="åˆ›å»ºç©ºé›†åˆ"><a href="#åˆ›å»ºç©ºé›†åˆ" class="headerlink" title="åˆ›å»ºç©ºé›†åˆ"></a>åˆ›å»ºç©ºé›†åˆ</h4><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªç©ºé›†åˆã€‚è¿™æ—¶å¯ä»¥ç”¨Listsçš„<code>newArrayList</code>æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList();</span><br></pre></td></tr></table></figure><h4 id="å¿«é€Ÿåˆå§‹åŒ–é›†åˆ"><a href="#å¿«é€Ÿåˆå§‹åŒ–é›†åˆ" class="headerlink" title="å¿«é€Ÿåˆå§‹åŒ–é›†åˆ"></a>å¿«é€Ÿåˆå§‹åŒ–é›†åˆ</h4><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³ç»™ä¸€ä¸ªé›†åˆä¸­åˆå§‹åŒ–ä¸€äº›å…ƒç´ ã€‚è¿™æ—¶å¯ä»¥ç”¨Listsçš„newArrayListæ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3]</span><br></pre></td></tr></table></figure><h4 id="ç¬›å¡å°”ç§¯"><a href="#ç¬›å¡å°”ç§¯" class="headerlink" title="ç¬›å¡å°”ç§¯"></a>ç¬›å¡å°”ç§¯</h4><p>å¦‚æœä½ æƒ³å°†ä¸¤ä¸ªé›†åˆåš<code>ç¬›å¡å°”ç§¯</code>ï¼ŒListsçš„<code>cartesianProduct</code>æ–¹æ³•å¯ä»¥å¸®ä½ å®ç°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list1 = Lists.newArrayList(1, 2, 3);</span><br><span class="line">List&lt;Integer&gt; list2 = Lists.newArrayList(4,5);</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; productList = Lists.cartesianProduct(list1,list2);</span><br><span class="line">System.out.println(productList);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[1, 4], [1, 5], [2, 4], [2, 5], [3, 4], [3, 5]]</span><br></pre></td></tr></table></figure><h4 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h4><p>å¦‚æœä½ æƒ³å°†ä¸€ä¸ª<code>å¤§é›†åˆ</code>åˆ†æˆè‹¥å¹²ä¸ª<code>å°é›†åˆ</code>ï¼Œå¯ä»¥ä½¿ç”¨Listsçš„<code>partition</code>æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(1, 2, 3, 4, 5);</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; partitionList = Lists.partition(list, 2);</span><br><span class="line">System.out.println(partitionList);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[1, 2], [3, 4], [5]]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œlistæœ‰5æ¡æ•°æ®ï¼Œæˆ‘å°†listé›†åˆæŒ‰å¤§å°ä¸º2ï¼Œåˆ†æˆäº†3é¡µï¼Œå³å˜æˆ3ä¸ªå°é›†åˆã€‚</p><p>è¿™ä¸ªæ˜¯æˆ‘æœ€å–œæ¬¢çš„æ–¹æ³•ä¹‹ä¸€ï¼Œç»å¸¸åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚æœ‰ä¸ªéœ€æ±‚ï¼šç°åœ¨æœ‰5000ä¸ªidï¼Œéœ€è¦è°ƒç”¨æ‰¹é‡ç”¨æˆ·æŸ¥è¯¢æ¥å£ï¼ŒæŸ¥å‡ºç”¨æˆ·æ•°æ®ã€‚ä½†å¦‚æœä½ ç›´æ¥æŸ¥5000ä¸ªç”¨æˆ·ï¼Œå•æ¬¡æ¥å£å“åº”æ—¶é—´å¯èƒ½ä¼šéå¸¸æ…¢ã€‚å¦‚æœæ”¹æˆåˆ†é¡µå¤„ç†ï¼Œæ¯æ¬¡åªæŸ¥500ä¸ªç”¨æˆ·ï¼Œå¼‚æ­¥è°ƒç”¨10æ¬¡æ¥å£ï¼Œå°±ä¸ä¼šæœ‰å•æ¬¡æ¥å£å“åº”æ…¢çš„é—®é¢˜ã€‚</p><h4 id="æµå¤„ç†"><a href="#æµå¤„ç†" class="headerlink" title="æµå¤„ç†"></a>æµå¤„ç†</h4><p>å¦‚æœæˆ‘ä»¬æƒ³æŠŠæŸä¸ªé›†åˆè½¬æ¢æˆå¦å¤–ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥ä½¿ç”¨Listsçš„ <code>transform</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Lists.newArrayList(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);</span><br><span class="line">List&lt;String&gt; transformList = Lists.transform(list, x -&gt; x.toUpperCase());</span><br><span class="line">System.out.println(transformList);</span><br></pre></td></tr></table></figure><p>å°†å°å†™å­—æ¯è½¬æ¢æˆäº†å¤§å†™å­—æ¯ã€‚</p><h4 id="é¢ å€’é¡ºåº"><a href="#é¢ å€’é¡ºåº" class="headerlink" title="é¢ å€’é¡ºåº"></a>é¢ å€’é¡ºåº</h4><p>Listsçš„æœ‰é¢ å€’é¡ºåºçš„æ–¹æ³•<code>reverse</code>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Lists.newArrayList(3, 1, 2);</span><br><span class="line">List&lt;Integer&gt; reverseList = Lists.reverse(list);</span><br><span class="line">System.out.println(reverseList);</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2, 1, 3]</span><br></pre></td></tr></table></figure><p>listçš„åŸå§‹é¡ºåºæ˜¯312ï¼Œä½¿ç”¨<code>reverse</code>æ–¹æ³•é¢ å€’é¡ºåºä¹‹åï¼Œå˜æˆäº†213ã€‚</p><p>Listsè¿˜æœ‰å…¶ä»–çš„å¥½ç”¨çš„å·¥å…·ï¼Œæˆ‘åœ¨è¿™é‡Œåªæ˜¯æŠ›ç –å¼•ç‰ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-4b962b06-a626-4707-9fe9-f5729536d9c5.jpg"></p><h3 id="å°¾å£°"><a href="#å°¾å£°" class="headerlink" title="å°¾å£°"></a>å°¾å£°</h3><p>ä¸Šé¢ä»‹ç»äº†æˆ‘è®¤ä¸ºæœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œä½œä¸º Google å…¬å¸å¼€æºçš„ Java å¼€å‘æ ¸å¿ƒåº“ï¼Œä¸ªäººè§‰å¾—å®ç”¨æ€§è¿˜æ˜¯å¾ˆé«˜çš„ï¼‰ã€‚å¼•å…¥åˆ°ä½ çš„é¡¹ç›®åä¸ä»…èƒ½å¿«é€Ÿçš„å®ç°ä¸€äº›å¼€å‘ä¸­å¸¸ç”¨çš„åŠŸèƒ½ï¼Œè€Œä¸”è¿˜å¯ä»¥è®©ä»£ç æ›´åŠ çš„ä¼˜é›…ç®€æ´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Javaæ ¸å¿ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¸¸ç”¨å·¥å…·ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java8 æ–°ç‰¹æ€§æ€»ç»“</title>
      <link href="/article/112225.html"/>
      <url>/article/112225.html</url>
      
        <content type="html"><![CDATA[<h2 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h2><p>ä¸ºäº†è§£å†³æ¥å£çš„ä¿®æ”¹ä¸ç°æœ‰çš„å®ç°ä¸å…¼å®¹çš„é—®é¢˜ã€‚æ–° interface çš„æ–¹æ³•å¯ä»¥ç”¨<code>default</code> æˆ– <code>static</code>ä¿®é¥°ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ–¹æ³•ä½“ï¼Œå®ç°ç±»ä¹Ÿä¸å¿…é‡å†™æ­¤æ–¹æ³•ã€‚</p><ol><li><code>default</code>ä¿®é¥°çš„æ–¹æ³•ï¼Œæ˜¯æ™®é€šå®ä¾‹æ–¹æ³•ï¼Œå¯ä»¥ç”¨<code>this</code>è°ƒç”¨ï¼Œå¯ä»¥è¢«å­ç±»ç»§æ‰¿ã€é‡å†™ã€‚</li><li><code>static</code>ä¿®é¥°çš„æ–¹æ³•ï¼Œä½¿ç”¨ä¸Šå’Œä¸€èˆ¬ç±»é™æ€æ–¹æ³•ä¸€æ ·ã€‚ä½†å®ƒä¸èƒ½è¢«å­ç±»ç»§æ‰¿ï¼Œåªèƒ½ç”¨<code>Interface</code>è°ƒç”¨ã€‚</li></ol><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InterfaceNew</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sm</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;interfaceæä¾›çš„æ–¹å¼å®ç°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sm2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;interfaceæä¾›çš„æ–¹å¼å®ç°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">def</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;interface defaultæ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">def2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;interface default2æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//é¡»è¦å®ç°ç±»é‡å†™</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InterfaceNew1</span> &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">def</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;InterfaceNew1 defaultæ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰ä¸€ä¸ªç±»æ—¢å®ç°äº† <code>InterfaceNew</code> æ¥å£åˆå®ç°äº† <code>InterfaceNew1</code>æ¥å£ï¼Œå®ƒä»¬éƒ½æœ‰<code>def()</code>ï¼Œå¹¶ä¸” <code>InterfaceNew</code> æ¥å£å’Œ <code>InterfaceNew1</code>æ¥å£æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„è¯ï¼Œè¿™æ—¶å°±å¿…é¡»é‡å†™<code>def()</code>ã€‚ä¸ç„¶çš„è¯ï¼Œç¼–è¯‘çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterfaceNewImpl</span> <span class="keyword">implements</span> <span class="title class_">InterfaceNew</span> , InterfaceNew1&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">InterfaceNewImpl</span> <span class="variable">interfaceNew</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InterfaceNewImpl</span>();</span><br><span class="line">        interfaceNew.def();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">def</span><span class="params">()</span> &#123;</span><br><span class="line">        InterfaceNew1.<span class="built_in">super</span>.def();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ Java 8 ï¼Œæ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆåŒºåˆ«çš„ï¼Ÿ</strong></p><p>å¾ˆå¤šå°ä¼™ä¼´è®¤ä¸ºï¼šâ€œæ—¢ç„¶ interface ä¹Ÿå¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•å®ç°ï¼Œä¼¼ä¹å’Œ abstract class æ²¡å¤šå¤§åŒºåˆ«äº†ã€‚â€</p><p>å…¶å®å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„</p><ol><li>interface å’Œ class çš„åŒºåˆ«ï¼Œå¥½åƒæ˜¯åºŸè¯ï¼Œä¸»è¦æœ‰ï¼š</li></ol><ul><li>æ¥å£å¤šå®ç°ï¼Œç±»å•ç»§æ‰¿</li><li>æ¥å£çš„æ–¹æ³•æ˜¯ public abstract ä¿®é¥°ï¼Œå˜é‡æ˜¯ public static final ä¿®é¥°ã€‚ abstract class å¯ä»¥ç”¨å…¶ä»–ä¿®é¥°ç¬¦</li></ul><ol start="2"><li>interface çš„æ–¹æ³•æ˜¯æ›´åƒæ˜¯ä¸€ä¸ªæ‰©å±•æ’ä»¶ã€‚è€Œ abstract class çš„æ–¹æ³•æ˜¯è¦ç»§æ‰¿çš„ã€‚</li></ol><p>å¼€å§‹æˆ‘ä»¬ä¹Ÿæåˆ°ï¼Œinterface æ–°å¢<code>default</code>å’Œ<code>static</code>ä¿®é¥°çš„æ–¹æ³•ï¼Œä¸ºäº†è§£å†³æ¥å£çš„ä¿®æ”¹ä¸ç°æœ‰çš„å®ç°ä¸å…¼å®¹çš„é—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†è¦æ›¿ä»£<code>abstract class</code>ã€‚åœ¨ä½¿ç”¨ä¸Šï¼Œè¯¥ç”¨ abstract class çš„åœ°æ–¹è¿˜æ˜¯è¦ç”¨ abstract classï¼Œä¸è¦å› ä¸º interface çš„æ–°ç‰¹æ€§è€Œå°†ä¹‹æ›¿æ¢ã€‚</p><h2 id="functional-interface-å‡½æ•°å¼æ¥å£"><a href="#functional-interface-å‡½æ•°å¼æ¥å£" class="headerlink" title="functional interface å‡½æ•°å¼æ¥å£"></a>functional interface å‡½æ•°å¼æ¥å£</h2><p><strong>å®šä¹‰</strong>ï¼šä¹Ÿç§° SAM æ¥å£ï¼Œå³ Single Abstract Method interfacesï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚</p><p>åœ¨ java 8 ä¸­ä¸“é—¨æœ‰ä¸€ä¸ªåŒ…æ”¾å‡½æ•°å¼æ¥å£<code>java.util.function</code>ï¼Œè¯¥åŒ…ä¸‹çš„æ‰€æœ‰æ¥å£éƒ½æœ‰ <code>@FunctionalInterface</code> æ³¨è§£ï¼Œæä¾›å‡½æ•°å¼ç¼–ç¨‹ã€‚</p><p>åœ¨å…¶ä»–åŒ…ä¸­ä¹Ÿæœ‰å‡½æ•°å¼æ¥å£ï¼Œå…¶ä¸­ä¸€äº›æ²¡æœ‰<code>@FunctionalInterface</code> æ³¨è§£ï¼Œä½†æ˜¯åªè¦ç¬¦åˆå‡½æ•°å¼æ¥å£çš„å®šä¹‰å°±æ˜¯å‡½æ•°å¼æ¥å£ï¼Œä¸æ˜¯å¦æœ‰</p><p><code>@FunctionalInterface</code>æ³¨è§£æ— å…³ï¼Œæ³¨è§£åªæ˜¯åœ¨ç¼–è¯‘æ—¶èµ·åˆ°å¼ºåˆ¶è§„èŒƒå®šä¹‰çš„ä½œç”¨ã€‚å…¶åœ¨ Lambda è¡¨è¾¾å¼ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚</p><h2 id="Lambda-è¡¨è¾¾å¼"><a href="#Lambda-è¡¨è¾¾å¼" class="headerlink" title="Lambda è¡¨è¾¾å¼"></a>Lambda è¡¨è¾¾å¼</h2><p>æ¥ä¸‹æ¥è°ˆä¼—æ‰€å‘¨çŸ¥çš„ Lambda è¡¨è¾¾å¼ã€‚å®ƒæ˜¯æ¨åŠ¨ Java 8 å‘å¸ƒçš„æœ€é‡è¦æ–°ç‰¹æ€§ã€‚æ˜¯ç»§æ³›å‹(<code>Generics</code>)å’Œæ³¨è§£(<code>Annotation</code>)ä»¥æ¥æœ€å¤§çš„å˜åŒ–ã€‚</p><p>ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¯ä»¥ä½¿ä»£ç å˜çš„æ›´åŠ ç®€æ´ç´§å‡‘ã€‚è®© java ä¹Ÿèƒ½æ”¯æŒç®€å•çš„<em>å‡½æ•°å¼ç¼–ç¨‹</em>ã€‚</p><blockquote><p>Lambda è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œjava 8 å…è®¸æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’è¿›æ–¹æ³•ä¸­ã€‚</p></blockquote><h3 id="è¯­æ³•æ ¼å¼"><a href="#è¯­æ³•æ ¼å¼" class="headerlink" title="è¯­æ³•æ ¼å¼"></a>è¯­æ³•æ ¼å¼</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(parameters) -&gt; expression æˆ–</span><br><span class="line">(parameters) -&gt;&#123; statements; &#125;</span><br></pre></td></tr></table></figure><h3 id="Lambda-å®æˆ˜"><a href="#Lambda-å®æˆ˜" class="headerlink" title="Lambda å®æˆ˜"></a>Lambda å®æˆ˜</h3><p>æˆ‘ä»¬ç”¨å¸¸ç”¨çš„å®ä¾‹æ¥æ„Ÿå— Lambda å¸¦æ¥çš„ä¾¿åˆ©</p><h4 id="æ›¿ä»£åŒ¿åå†…éƒ¨ç±»"><a href="#æ›¿ä»£åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="æ›¿ä»£åŒ¿åå†…éƒ¨ç±»"></a>æ›¿ä»£åŒ¿åå†…éƒ¨ç±»</h4><p>è¿‡å»ç»™æ–¹æ³•ä¼ åŠ¨æ€å‚æ•°çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨å†…éƒ¨ç±»ã€‚æ¯”å¦‚</p><p><strong>1.<code>Runnable</code> æ¥å£</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                System.out.println(&quot;The runable now is using!&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">&#125;).start();</span><br><span class="line">//ç”¨lambda</span><br><span class="line">new Thread(() -&gt; System.out.println(&quot;It&#x27;s a lambda function!&quot;)).start();</span><br></pre></td></tr></table></figure><p><strong>2.<code>Comparator</code> æ¥å£</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; strings = Arrays.asList(1, 2, 3);</span><br><span class="line"></span><br><span class="line">Collections.sort(strings, new Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">@Override</span><br><span class="line">public int compare(Integer o1, Integer o2) &#123;</span><br><span class="line">    return o1 - o2;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//Lambda</span><br><span class="line">Collections.sort(strings, (Integer o1, Integer o2) -&gt; o1 - o2);</span><br><span class="line">//åˆ†è§£å¼€</span><br><span class="line">Comparator&lt;Integer&gt; comparator = (Integer o1, Integer o2) -&gt; o1 - o2;</span><br><span class="line">Collections.sort(strings, comparator);</span><br></pre></td></tr></table></figure><p><strong>3.<code>Listener</code> æ¥å£</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">JButton button = new JButton();</span><br><span class="line">button.addItemListener(new ItemListener() &#123;</span><br><span class="line">@Override</span><br><span class="line">public void itemStateChanged(ItemEvent e) &#123;</span><br><span class="line">   e.getItem();</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">//lambda</span><br><span class="line">button.addItemListener(e -&gt; e.getItem());</span><br></pre></td></tr></table></figure><p><strong>4.è‡ªå®šä¹‰æ¥å£</strong></p><p>ä¸Šé¢çš„ 3 ä¸ªä¾‹å­æ˜¯æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­æœ€å¸¸è§çš„ï¼Œä»ä¸­ä¹Ÿèƒ½ä½“ä¼šåˆ° Lambda å¸¦æ¥çš„ä¾¿æ·ä¸æ¸…çˆ½ã€‚å®ƒåªä¿ç•™å®é™…ç”¨åˆ°çš„ä»£ç ï¼ŒæŠŠæ— ç”¨ä»£ç å…¨éƒ¨çœç•¥ã€‚é‚£å®ƒå¯¹æ¥å£æœ‰æ²¡æœ‰è¦æ±‚å‘¢ï¼Ÿæˆ‘ä»¬å‘ç°è¿™äº›åŒ¿åå†…éƒ¨ç±»åªé‡å†™äº†æ¥å£çš„ä¸€ä¸ªæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿåªæœ‰ä¸€ä¸ªæ–¹æ³•é¡»è¦é‡å†™ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„<strong>å‡½æ•°å¼æ¥å£</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦æ–¹æ³•çš„å‚æ•°æ˜¯å‡½æ•°å¼æ¥å£éƒ½å¯ä»¥ç”¨ Lambda è¡¨è¾¾å¼ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface Comparator&lt;T&gt;&#123;&#125;</span><br><span class="line"></span><br><span class="line">@FunctionalInterface</span><br><span class="line">public interface Runnable&#123;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªå‡½æ•°å¼æ¥å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface LambdaInterface &#123;</span><br><span class="line"> void f();</span><br><span class="line">&#125;</span><br><span class="line">//ä½¿ç”¨</span><br><span class="line">public class LambdaClass &#123;</span><br><span class="line">    public static void forEg() &#123;</span><br><span class="line">        lambdaInterfaceDemo(()-&gt; System.out.println(&quot;è‡ªå®šä¹‰å‡½æ•°å¼æ¥å£&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">    //å‡½æ•°å¼æ¥å£å‚æ•°</span><br><span class="line">    static void lambdaInterfaceDemo(LambdaInterface i)&#123;</span><br><span class="line">        i.f();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é›†åˆè¿­ä»£"><a href="#é›†åˆè¿­ä»£" class="headerlink" title="é›†åˆè¿­ä»£"></a>é›†åˆè¿­ä»£</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">void lamndaFor() &#123;</span><br><span class="line">        List&lt;String&gt; strings = Arrays.asList(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;);</span><br><span class="line">        //ä¼ ç»Ÿforeach</span><br><span class="line">        for (String s : strings) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">        //Lambda foreach</span><br><span class="line">        strings.forEach((s) -&gt; System.out.println(s));</span><br><span class="line">        //or</span><br><span class="line">        strings.forEach(System.out::println);</span><br><span class="line">     //map</span><br><span class="line">        Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line">        map.forEach((k,v)-&gt;System.out.println(v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•çš„å¼•ç”¨"><a href="#æ–¹æ³•çš„å¼•ç”¨" class="headerlink" title="æ–¹æ³•çš„å¼•ç”¨"></a>æ–¹æ³•çš„å¼•ç”¨</h4><p>Java 8 å…è®¸ä½¿ç”¨ <code>::</code> å…³é”®å­—æ¥ä¼ é€’æ–¹æ³•æˆ–è€…æ„é€ å‡½æ•°å¼•ç”¨ï¼Œæ— è®ºå¦‚ä½•ï¼Œè¡¨è¾¾å¼è¿”å›çš„ç±»å‹å¿…é¡»æ˜¯ functional-interfaceã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaClassSuper</span> &#123;</span><br><span class="line">    LambdaInterface <span class="title function_">sf</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaClass</span> <span class="keyword">extends</span> <span class="title class_">LambdaClassSuper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LambdaInterface <span class="title function_">staticF</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LambdaInterface <span class="title function_">f</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1.è°ƒç”¨é™æ€å‡½æ•°ï¼Œè¿”å›ç±»å‹å¿…é¡»æ˜¯functional-interface</span></span><br><span class="line">        <span class="type">LambdaInterface</span> <span class="variable">t</span> <span class="operator">=</span> LambdaClass::staticF;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.å®ä¾‹æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">        <span class="type">LambdaClass</span> <span class="variable">lambdaClass</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LambdaClass</span>();</span><br><span class="line">        <span class="type">LambdaInterface</span> <span class="variable">lambdaInterface</span> <span class="operator">=</span> lambdaClass::f;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.è¶…ç±»ä¸Šçš„æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">        <span class="type">LambdaInterface</span> <span class="variable">superf</span> <span class="operator">=</span> <span class="built_in">super</span>::sf;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. æ„é€ æ–¹æ³•è°ƒç”¨</span></span><br><span class="line">        <span class="type">LambdaInterface</span> <span class="variable">tt</span> <span class="operator">=</span> LambdaClassSuper::<span class="keyword">new</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¿é—®å˜é‡"><a href="#è®¿é—®å˜é‡" class="headerlink" title="è®¿é—®å˜é‡"></a>è®¿é—®å˜é‡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int i = 0;</span><br><span class="line">Collections.sort(strings, (Integer o1, Integer o2) -&gt; o1 - i);</span><br><span class="line">//i =3;</span><br></pre></td></tr></table></figure><p>lambda è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨å¤–è¾¹å˜é‡ï¼Œä½†æ˜¯è¯¥å˜é‡é»˜è®¤æ‹¥æœ‰ final å±æ€§ï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¦‚æœä¿®æ”¹ï¼Œç¼–è¯‘æ—¶å°±æŠ¥é”™ã€‚</p><h2 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h2><p>java æ–°å¢äº† <code>java.util.stream</code> åŒ…ï¼Œå®ƒå’Œä¹‹å‰çš„æµå¤§åŒå°å¼‚ã€‚ä¹‹å‰æ¥è§¦æœ€å¤šçš„æ˜¯èµ„æºæµï¼Œæ¯”å¦‚<code>java.io.FileInputStream</code>ï¼Œé€šè¿‡æµæŠŠæ–‡ä»¶ä»ä¸€ä¸ªåœ°æ–¹è¾“å…¥åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå®ƒåªæ˜¯å†…å®¹æ¬è¿å·¥ï¼Œå¯¹æ–‡ä»¶å†…å®¹ä¸åšä»»ä½•<em>CRUD</em>ã€‚</p><p><code>Stream</code>ä¾ç„¶ä¸å­˜å‚¨æ•°æ®ï¼Œä¸åŒçš„æ˜¯å®ƒå¯ä»¥æ£€ç´¢(Retrieve)å’Œé€»è¾‘å¤„ç†é›†åˆæ•°æ®ã€åŒ…æ‹¬ç­›é€‰ã€æ’åºã€ç»Ÿè®¡ã€è®¡æ•°ç­‰ã€‚å¯ä»¥æƒ³è±¡æˆæ˜¯ Sql è¯­å¥ã€‚</p><p>å®ƒçš„æºæ•°æ®å¯ä»¥æ˜¯ <code>Collection</code>ã€<code>Array</code> ç­‰ã€‚ç”±äºå®ƒçš„æ–¹æ³•å‚æ•°éƒ½æ˜¯å‡½æ•°å¼æ¥å£ç±»å‹ï¼Œæ‰€ä»¥ä¸€èˆ¬å’Œ Lambda é…åˆä½¿ç”¨ã€‚</p><h3 id="æµç±»å‹"><a href="#æµç±»å‹" class="headerlink" title="æµç±»å‹"></a>æµç±»å‹</h3><ol><li>stream ä¸²è¡Œæµ</li><li>parallelStream å¹¶è¡Œæµï¼Œå¯å¤šçº¿ç¨‹æ‰§è¡Œ</li></ol><h3 id="å¸¸ç”¨æ–¹æ³•"><a href="#å¸¸ç”¨æ–¹æ³•" class="headerlink" title="å¸¸ç”¨æ–¹æ³•"></a>å¸¸ç”¨æ–¹æ³•</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹<code>java.util.stream.Stream</code>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* è¿”å›ä¸€ä¸ªä¸²è¡Œæµ</span><br><span class="line">*/</span><br><span class="line">default Stream&lt;E&gt; stream()</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿”å›ä¸€ä¸ªå¹¶è¡Œæµ</span><br><span class="line">*/</span><br><span class="line">default Stream&lt;E&gt; parallelStream()</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿”å›Tçš„æµ</span><br><span class="line">*/</span><br><span class="line">public static&lt;T&gt; Stream&lt;T&gt; of(T t)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿”å›å…¶å…ƒç´ æ˜¯æŒ‡å®šå€¼çš„é¡ºåºæµã€‚</span><br><span class="line">*/</span><br><span class="line">public static&lt;T&gt; Stream&lt;T&gt; of(T... values) &#123;</span><br><span class="line">    return Arrays.stream(values);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿‡æ»¤ï¼Œè¿”å›ç”±ä¸ç»™å®špredicateåŒ¹é…çš„è¯¥æµçš„å…ƒç´ ç»„æˆçš„æµ</span><br><span class="line">*/</span><br><span class="line">Stream&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* æ­¤æµçš„æ‰€æœ‰å…ƒç´ æ˜¯å¦ä¸æä¾›çš„predicateåŒ¹é…ã€‚</span><br><span class="line">*/</span><br><span class="line">boolean allMatch(Predicate&lt;? super T&gt; predicate)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* æ­¤æµä»»æ„å…ƒç´ æ˜¯å¦æœ‰ä¸æä¾›çš„predicateåŒ¹é…ã€‚</span><br><span class="line">*/</span><br><span class="line">boolean anyMatch(Predicate&lt;? super T&gt; predicate);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿”å›ä¸€ä¸ª Streamçš„æ„å»ºå™¨ã€‚</span><br><span class="line">*/</span><br><span class="line">public static&lt;T&gt; Builder&lt;T&gt; builder();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* ä½¿ç”¨ Collectorå¯¹æ­¤æµçš„å…ƒç´ è¿›è¡Œå½’çº³</span><br><span class="line">*/</span><br><span class="line">&lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¿”å›æ­¤æµä¸­çš„å…ƒç´ æ•°ã€‚</span><br><span class="line">*/</span><br><span class="line">long count();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿”å›ç”±è¯¥æµçš„ä¸åŒå…ƒç´ ï¼ˆæ ¹æ® Object.equals(Object) ï¼‰ç»„æˆçš„æµã€‚</span><br><span class="line">*/</span><br><span class="line">Stream&lt;T&gt; distinct();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * éå†</span><br><span class="line">*/</span><br><span class="line">void forEach(Consumer&lt;? super T&gt; action);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* ç”¨äºè·å–æŒ‡å®šæ•°é‡çš„æµï¼ŒæˆªçŸ­é•¿åº¦ä¸èƒ½è¶…è¿‡ maxSize ã€‚</span><br><span class="line">*/</span><br><span class="line">Stream&lt;T&gt; limit(long maxSize);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* ç”¨äºæ˜ å°„æ¯ä¸ªå…ƒç´ åˆ°å¯¹åº”çš„ç»“æœ</span><br><span class="line">*/</span><br><span class="line">&lt;R&gt; Stream&lt;R&gt; map(Function&lt;? super T, ? extends R&gt; mapper);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* æ ¹æ®æä¾›çš„ Comparatorè¿›è¡Œæ’åºã€‚</span><br><span class="line">*/</span><br><span class="line">Stream&lt;T&gt; sorted(Comparator&lt;? super T&gt; comparator);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* åœ¨ä¸¢å¼ƒæµçš„ç¬¬ä¸€ä¸ª nå…ƒç´ åï¼Œè¿”å›ç”±è¯¥æµçš„ nå…ƒç´ ç»„æˆçš„æµã€‚</span><br><span class="line">*/</span><br><span class="line">Stream&lt;T&gt; skip(long n);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* è¿”å›ä¸€ä¸ªåŒ…å«æ­¤æµçš„å…ƒç´ çš„æ•°ç»„ã€‚</span><br><span class="line">*/</span><br><span class="line">Object[] toArray();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* ä½¿ç”¨æä¾›çš„ generatorå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«æ­¤æµçš„å…ƒç´ çš„æ•°ç»„ï¼Œä»¥åˆ†é…è¿”å›çš„æ•°ç»„ï¼Œä»¥åŠåˆ†åŒºæ‰§è¡Œæˆ–è°ƒæ•´å¤§å°å¯èƒ½éœ€è¦çš„ä»»ä½•å…¶ä»–æ•°ç»„ã€‚</span><br><span class="line">*/</span><br><span class="line">&lt;A&gt; A[] toArray(IntFunction&lt;A[]&gt; generator);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* åˆå¹¶æµ</span><br><span class="line">*/</span><br><span class="line">public static &lt;T&gt; Stream&lt;T&gt; concat(Stream&lt;? extends T&gt; a, Stream&lt;? extends T&gt; b)</span><br></pre></td></tr></table></figure><h3 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h3><p>æœ¬æ–‡åˆ—å‡º <code>Stream</code> å…·æœ‰ä»£è¡¨æ€§çš„æ–¹æ³•ä¹‹ä½¿ç”¨ï¼Œæ›´å¤šçš„ä½¿ç”¨æ–¹æ³•è¿˜æ˜¯è¦çœ‹ Apiã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">  List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;def&quot;</span>, <span class="string">&quot;gkh&quot;</span>, <span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    <span class="comment">//è¿”å›ç¬¦åˆæ¡ä»¶çš„stream</span></span><br><span class="line">    Stream&lt;String&gt; stringStream = strings.stream().filter(s -&gt; <span class="string">&quot;abc&quot;</span>.equals(s));</span><br><span class="line">    <span class="comment">//è®¡ç®—æµç¬¦åˆæ¡ä»¶çš„æµçš„æ•°é‡</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stringStream.count();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//forEachéå†-&gt;æ‰“å°å…ƒç´ </span></span><br><span class="line">    strings.stream().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//limit è·å–åˆ°1ä¸ªå…ƒç´ çš„stream</span></span><br><span class="line">    Stream&lt;String&gt; limit = strings.stream().limit(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//toArray æ¯”å¦‚æˆ‘ä»¬æƒ³çœ‹è¿™ä¸ªlimitStreamé‡Œé¢æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚è½¬æ¢æˆString[],æ¯”å¦‚å¾ªç¯</span></span><br><span class="line">    String[] array = limit.toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//map å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œè¿”å›æ–°æµ</span></span><br><span class="line">    Stream&lt;String&gt; map = strings.stream().map(s -&gt; s + <span class="string">&quot;22&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//sorted æ’åºå¹¶æ‰“å°</span></span><br><span class="line">    strings.stream().sorted().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Collectors collect æŠŠabcæ”¾å…¥å®¹å™¨ä¸­</span></span><br><span class="line">    List&lt;String&gt; collect = strings.stream().filter(string -&gt; <span class="string">&quot;abc&quot;</span>.equals(string)).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//æŠŠlistè½¬ä¸ºstringï¼Œå„å…ƒç´ ç”¨ï¼Œå·éš”å¼€</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">mergedString</span> <span class="operator">=</span> strings.stream().filter(string -&gt; !string.isEmpty()).collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹æ•°ç»„çš„ç»Ÿè®¡ï¼Œæ¯”å¦‚ç”¨</span></span><br><span class="line">    List&lt;Integer&gt; number = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">IntSummaryStatistics</span> <span class="variable">statistics</span> <span class="operator">=</span> number.stream().mapToInt((x) -&gt; x).summaryStatistics();</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ—è¡¨ä¸­æœ€å¤§çš„æ•° : &quot;</span>+statistics.getMax());</span><br><span class="line">    System.out.println(<span class="string">&quot;åˆ—è¡¨ä¸­æœ€å°çš„æ•° : &quot;</span>+statistics.getMin());</span><br><span class="line">    System.out.println(<span class="string">&quot;å¹³å‡æ•° : &quot;</span>+statistics.getAverage());</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰€æœ‰æ•°ä¹‹å’Œ : &quot;</span>+statistics.getSum());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//concat åˆå¹¶æµ</span></span><br><span class="line">    List&lt;String&gt; strings2 = Arrays.asList(<span class="string">&quot;xyz&quot;</span>, <span class="string">&quot;jqx&quot;</span>);</span><br><span class="line">    Stream.concat(strings2.stream(),strings.stream()).count();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨æ„ ä¸€ä¸ªStreamåªèƒ½æ“ä½œä¸€æ¬¡ï¼Œä¸èƒ½æ–­å¼€ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line">    <span class="type">Stream</span> <span class="variable">stream</span> <span class="operator">=</span> strings.stream();</span><br><span class="line">    <span class="comment">//ç¬¬ä¸€æ¬¡ä½¿ç”¨</span></span><br><span class="line">    stream.limit(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//ç¬¬äºŒæ¬¡ä½¿ç”¨</span></span><br><span class="line">    stream.forEach(System.out::println);</span><br><span class="line">    <span class="comment">//æŠ¥é”™ java.lang.IllegalStateException: stream has already been operated upon or closed</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½†æ˜¯å¯ä»¥è¿™æ ·, è¿ç»­ä½¿ç”¨</span></span><br><span class="line">    stream.limit(<span class="number">2</span>).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å»¶è¿Ÿæ‰§è¡Œ"><a href="#å»¶è¿Ÿæ‰§è¡Œ" class="headerlink" title="å»¶è¿Ÿæ‰§è¡Œ"></a>å»¶è¿Ÿæ‰§è¡Œ</h3><p>åœ¨æ‰§è¡Œè¿”å› <code>Stream</code> çš„æ–¹æ³•æ—¶ï¼Œå¹¶ä¸ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰è¿”å›ä¸€ä¸ªé <code>Stream</code> çš„æ–¹æ³•åæ‰æ‰§è¡Œã€‚å› ä¸ºæ‹¿åˆ° <code>Stream</code> å¹¶ä¸èƒ½ç›´æ¥ç”¨ï¼Œè€Œæ˜¯éœ€è¦å¤„ç†æˆä¸€ä¸ªå¸¸è§„ç±»å‹ã€‚è¿™é‡Œçš„ <code>Stream</code> å¯ä»¥æƒ³è±¡æˆæ˜¯äºŒè¿›åˆ¶æµï¼ˆ2 ä¸ªå®Œå…¨ä¸ä¸€æ ·çš„ä¸œä¸œï¼‰ï¼Œæ‹¿åˆ°ä¹Ÿçœ‹ä¸æ‡‚ã€‚</p><p>æˆ‘ä»¬ä¸‹é¢åˆ†è§£ä¸€ä¸‹ <code>filter</code> æ–¹æ³•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void laziness()&#123;</span><br><span class="line">  List&lt;String&gt; strings = Arrays.asList(&quot;abc&quot;, &quot;def&quot;, &quot;gkh&quot;, &quot;abc&quot;);</span><br><span class="line">  Stream&lt;Integer&gt; stream = strings.stream().filter(new Predicate() &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public boolean test(Object o) &#123;</span><br><span class="line">        System.out.println(&quot;Predicate.test æ‰§è¡Œ&quot;);</span><br><span class="line">        return true;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">   System.out.println(&quot;count æ‰§è¡Œ&quot;);</span><br><span class="line">   stream.count();</span><br><span class="line">&#125;</span><br><span class="line">/*-------æ‰§è¡Œç»“æœ--------*/</span><br><span class="line">count æ‰§è¡Œ</span><br><span class="line">Predicate.test æ‰§è¡Œ</span><br><span class="line">Predicate.test æ‰§è¡Œ</span><br><span class="line">Predicate.test æ‰§è¡Œ</span><br><span class="line">Predicate.test æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>æŒ‰æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯å…ˆæ‰“å° 4 æ¬¡ã€Œ<code>Predicate.test</code> æ‰§è¡Œã€ï¼Œå†æ‰“å°ã€Œ<code>count</code> æ‰§è¡Œã€ã€‚å®é™…ç»“æœæ°æ°ç›¸åã€‚è¯´æ˜ filter ä¸­çš„æ–¹æ³•å¹¶æ²¡æœ‰ç«‹åˆ»æ‰§è¡Œï¼Œè€Œæ˜¯ç­‰è°ƒç”¨<code>count()</code>æ–¹æ³•åæ‰æ‰§è¡Œã€‚</p><p>ä¸Šé¢éƒ½æ˜¯ä¸²è¡Œ <code>Stream</code> çš„å®ä¾‹ã€‚å¹¶è¡Œ <code>parallelStream</code> åœ¨ä½¿ç”¨æ–¹æ³•ä¸Šå’Œä¸²è¡Œä¸€æ ·ã€‚ä¸»è¦åŒºåˆ«æ˜¯ <code>parallelStream</code> å¯å¤šçº¿ç¨‹æ‰§è¡Œï¼Œæ˜¯åŸºäº ForkJoin æ¡†æ¶å®ç°çš„ï¼Œæœ‰æ—¶é—´å¤§å®¶å¯ä»¥äº†è§£ä¸€ä¸‹ <code>ForkJoin</code> æ¡†æ¶å’Œ <code>ForkJoinPool</code>ã€‚è¿™é‡Œå¯ä»¥ç®€å•çš„ç†è§£å®ƒæ˜¯é€šè¿‡çº¿ç¨‹æ± æ¥å®ç°çš„ï¼Œè¿™æ ·å°±ä¼šæ¶‰åŠåˆ°çº¿ç¨‹å®‰å…¨ï¼Œçº¿ç¨‹æ¶ˆè€—ç­‰é—®é¢˜ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä»£ç æ¥ä½“éªŒä¸€ä¸‹å¹¶è¡Œæµçš„å¤šçº¿ç¨‹æ‰§è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void parallelStreamTest()&#123;</span><br><span class="line">   List&lt;Integer&gt; numbers = Arrays.asList(1, 2, 5, 4);</span><br><span class="line">   numbers.parallelStream() .forEach(num-&gt;System.out.println(Thread.currentThread().getName()+&quot;&gt;&gt;&quot;+num));</span><br><span class="line">&#125;</span><br><span class="line">//æ‰§è¡Œç»“æœ</span><br><span class="line"><span class="meta prompt_">main&gt;</span><span class="language-bash">&gt;5</span></span><br><span class="line">ForkJoinPool.commonPool-worker-2&gt;&gt;4</span><br><span class="line">ForkJoinPool.commonPool-worker-11&gt;&gt;1</span><br><span class="line">ForkJoinPool.commonPool-worker-9&gt;&gt;2</span><br></pre></td></tr></table></figure><p>ä»ç»“æœä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œfor-each ç”¨åˆ°çš„æ˜¯å¤šçº¿ç¨‹ã€‚</p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä»æºç å’Œå®ä¾‹ä¸­æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä¸€äº› stream çš„ç‰¹ç‚¹</p><ol><li>é€šè¿‡ç®€å•çš„é“¾å¼ç¼–ç¨‹ï¼Œä½¿å¾—å®ƒå¯ä»¥æ–¹ä¾¿åœ°å¯¹éå†å¤„ç†åçš„æ•°æ®è¿›è¡Œå†å¤„ç†ã€‚</li><li>æ–¹æ³•å‚æ•°éƒ½æ˜¯å‡½æ•°å¼æ¥å£ç±»å‹</li><li>ä¸€ä¸ª Stream åªèƒ½æ“ä½œä¸€æ¬¡ï¼Œæ“ä½œå®Œå°±å…³é—­äº†ï¼Œç»§ç»­ä½¿ç”¨è¿™ä¸ª stream ä¼šæŠ¥é”™ã€‚</li><li>Stream ä¸ä¿å­˜æ•°æ®ï¼Œä¸æ”¹å˜æ•°æ®æº</li></ol><h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><p>ä½¿ç”¨ <code>Optional</code> è§£å†³ NPEï¼ˆ<code>java.lang.NullPointerException</code>ï¼‰é—®é¢˜ï¼Œå®ƒå°±æ˜¯ä¸º NPE è€Œç”Ÿçš„ï¼Œå…¶ä¸­å¯ä»¥åŒ…å«ç©ºå€¼æˆ–éç©ºå€¼ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡æºç é€æ­¥æ­å¼€ <code>Optional</code> çš„çº¢ç›–å¤´ã€‚</p><p>å‡è®¾æœ‰ä¸€ä¸ª <code>Zoo</code> ç±»ï¼Œé‡Œé¢æœ‰ä¸ªå±æ€§ <code>Dog</code>ï¼Œéœ€æ±‚è¦è·å– <code>Dog</code> çš„ <code>age</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Zoo</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> Dog dog;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ ç»Ÿè§£å†³ NPE çš„åŠæ³•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Zoo zoo = getZoo();</span><br><span class="line">if(zoo != null)&#123;</span><br><span class="line">   Dog dog = zoo.getDog();</span><br><span class="line">   if(dog != null)&#123;</span><br><span class="line">      int age = dog.getAge();</span><br><span class="line">      System.out.println(age);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å±‚å±‚åˆ¤æ–­å¯¹è±¡éç©ºï¼Œæœ‰äººè¯´è¿™ç§æ–¹å¼å¾ˆä¸‘é™‹ä¸ä¼˜é›…ï¼Œæˆ‘å¹¶ä¸è¿™ä¹ˆè®¤ä¸ºã€‚åè€Œè§‰å¾—å¾ˆæ•´æ´ï¼Œæ˜“è¯»ï¼Œæ˜“æ‡‚ã€‚ä½ ä»¬è§‰å¾—å‘¢ï¼Ÿ</p><p><code>Optional</code> æ˜¯è¿™æ ·çš„å®ç°çš„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(zoo).map(o -&gt; o.getDog()).map(d -&gt; d.getAge()).ifPresent(age -&gt;</span><br><span class="line">    System.out.println(age)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯ç®€æ´äº†å¾ˆå¤šå‘¢ï¼Ÿ</p><h3 id="å¦‚ä½•åˆ›å»ºä¸€ä¸ª-Optional"><a href="#å¦‚ä½•åˆ›å»ºä¸€ä¸ª-Optional" class="headerlink" title="å¦‚ä½•åˆ›å»ºä¸€ä¸ª Optional"></a>å¦‚ä½•åˆ›å»ºä¸€ä¸ª Optional</h3><p>ä¸Šä¾‹ä¸­<code>Optional.ofNullable</code>æ˜¯å…¶ä¸­ä¸€ç§åˆ›å»º Optional çš„æ–¹å¼ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å®ƒçš„å«ä¹‰å’Œå…¶ä»–åˆ›å»º Optional çš„æºç æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Common instance for &#123;<span class="doctag">@code</span> empty()&#125;. å…¨å±€EMPTYå¯¹è±¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Optional&lt;?&gt; EMPTY = <span class="keyword">new</span> <span class="title class_">Optional</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Optionalç»´æŠ¤çš„å€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> T value;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¦‚æœvalueæ˜¯nullå°±è¿”å›EMPTYï¼Œå¦åˆ™å°±è¿”å›of(T)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Optional&lt;T&gt; <span class="title function_">ofNullable</span><span class="params">(T value)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> value == <span class="literal">null</span> ? empty() : of(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è¿”å› EMPTY å¯¹è±¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>&lt;T&gt; Optional&lt;T&gt; <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">   Optional&lt;T&gt; t = (Optional&lt;T&gt;) EMPTY;</span><br><span class="line">   <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è¿”å›Optionalå¯¹è±¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Optional&lt;T&gt; <span class="title function_">of</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Optional</span>&lt;&gt;(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ç§æœ‰æ„é€ æ–¹æ³•ï¼Œç»™valueèµ‹å€¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="title function_">Optional</span><span class="params">(T value)</span> &#123;</span><br><span class="line">  <span class="built_in">this</span>.value = Objects.requireNonNull(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ‰€ä»¥å¦‚æœof(T value) çš„valueæ˜¯nullï¼Œä¼šæŠ›å‡ºNullPointerExceptionå¼‚å¸¸ï¼Œè¿™æ ·è²Œä¼¼å°±æ²¡å¤„ç†NPEé—®é¢˜</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">requireNonNull</span><span class="params">(T obj)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (obj == <span class="literal">null</span>)</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">  <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ofNullable</code> æ–¹æ³•å’Œ<code>of</code>æ–¹æ³•å”¯ä¸€åŒºåˆ«å°±æ˜¯å½“ value ä¸º null æ—¶ï¼Œ<code>ofNullable</code> è¿”å›çš„æ˜¯<code>EMPTY</code>ï¼Œof ä¼šæŠ›å‡º <code>NullPointerException</code> å¼‚å¸¸ã€‚å¦‚æœéœ€è¦æŠŠ <code>NullPointerException</code> æš´æ¼å‡ºæ¥å°±ç”¨ <code>of</code>ï¼Œå¦åˆ™å°±ç”¨ <code>ofNullable</code>ã€‚</p><p><strong><code>map()</code> å’Œ <code>flatMap()</code> æœ‰ä»€ä¹ˆåŒºåˆ«çš„ï¼Ÿ</strong></p><p><code>map</code> å’Œ <code>flatMap</code> éƒ½æ˜¯å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œä½†ä¸åŒçš„æ˜¯<code>map</code>è¿”å›ä¸€ä¸ªæ–°çš„é›†åˆï¼Œ<code>flatMap</code>æ˜¯å°†æ¯ä¸ªå…ƒç´ éƒ½æ˜ å°„ä¸ºä¸€ä¸ªé›†åˆï¼Œæœ€åå†å°†è¿™ä¸ªé›†åˆå±•å¹³ã€‚</p><p>åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œå¦‚æœ<code>map</code>è¿”å›çš„æ˜¯æ•°ç»„ï¼Œé‚£ä¹ˆæœ€åå¾—åˆ°çš„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œä½¿ç”¨<code>flatMap</code>å°±æ˜¯ä¸ºäº†å°†è¿™ä¸ªäºŒç»´æ•°ç»„å±•å¹³å˜æˆä¸€ä¸ªä¸€ç»´æ•°ç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapAndFlatMapExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String[]&gt; listOfArrays = Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;orange&quot;</span>, <span class="string">&quot;grape&quot;</span>, <span class="string">&quot;pear&quot;</span>&#125;,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;kiwi&quot;</span>, <span class="string">&quot;melon&quot;</span>, <span class="string">&quot;pineapple&quot;</span>&#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        List&lt;String[]&gt; mapResult = listOfArrays.stream()</span><br><span class="line">                .map(array -&gt; Arrays.stream(array).map(String::toUpperCase).toArray(String[]::<span class="keyword">new</span>))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Using map:&quot;</span>);</span><br><span class="line">        System.out.println(mapResult);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; flatMapResult = listOfArrays.stream()</span><br><span class="line">                .flatMap(array -&gt; Arrays.stream(array).map(String::toUpperCase))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Using flatMap:&quot;</span>);</span><br><span class="line">        System.out.println(flatMapResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Using map:</span><br><span class="line">[[APPLE, BANANA, CHERRY], [ORANGE, GRAPE, PEAR], [KIWI, MELON, PINEAPPLE]]</span><br><span class="line"></span><br><span class="line">Using flatMap:</span><br><span class="line">[APPLE, BANANA, CHERRY, ORANGE, GRAPE, PEAR, KIWI, MELON, PINEAPPLE]</span><br></pre></td></tr></table></figure><p>æœ€ç®€å•çš„ç†è§£å°±æ˜¯<code>flatMap()</code>å¯ä»¥å°†<code>map()</code>çš„ç»“æœå±•å¼€ã€‚</p><p>åœ¨<code>Optional</code>é‡Œé¢ï¼Œå½“ä½¿ç”¨<code>map()</code>æ—¶ï¼Œå¦‚æœæ˜ å°„å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªæ™®é€šå€¼ï¼Œå®ƒä¼šå°†è¿™ä¸ªå€¼åŒ…è£…åœ¨ä¸€ä¸ªæ–°çš„<code>Optional</code>ä¸­ã€‚è€Œä½¿ç”¨<code>flatMap</code>æ—¶ï¼Œå¦‚æœæ˜ å°„å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª<code>Optional</code>ï¼Œå®ƒä¼šå°†è¿™ä¸ªè¿”å›çš„<code>Optional</code>å±•å¹³ï¼Œä¸å†åŒ…è£…æˆåµŒå¥—çš„<code>Optional</code>ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯¹æ¯”çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨flatMapçš„ä»£ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cityUsingFlatMap</span> <span class="operator">=</span> getUserById(userId)</span><br><span class="line">                .flatMap(OptionalExample::getAddressByUser)</span><br><span class="line">                .map(Address::getCity)</span><br><span class="line">                .orElse(<span class="string">&quot;Unknown&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;User&#x27;s city using flatMap: &quot;</span> + cityUsingFlatMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸ä½¿ç”¨flatMapçš„ä»£ç </span></span><br><span class="line">        Optional&lt;Optional&lt;Address&gt;&gt; optionalAddress = getUserById(userId)</span><br><span class="line">                .map(OptionalExample::getAddressByUser);</span><br><span class="line"></span><br><span class="line">        String cityWithoutFlatMap;</span><br><span class="line">        <span class="keyword">if</span> (optionalAddress.isPresent()) &#123;</span><br><span class="line">            Optional&lt;Address&gt; addressOptional = optionalAddress.get();</span><br><span class="line">            <span class="keyword">if</span> (addressOptional.isPresent()) &#123;</span><br><span class="line">                <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> addressOptional.get();</span><br><span class="line">                cityWithoutFlatMap = address.getCity();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cityWithoutFlatMap = <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cityWithoutFlatMap = <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;User&#x27;s city without flatMap: &quot;</span> + cityWithoutFlatMap);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>Stream</code>å’Œ<code>Optional</code>ä¸­æ­£ç¡®ä½¿ç”¨<code>flatMap</code>å¯ä»¥å‡å°‘å¾ˆå¤šä¸å¿…è¦çš„ä»£ç ã€‚</p><h3 id="åˆ¤æ–­-value-æ˜¯å¦ä¸º-null"><a href="#åˆ¤æ–­-value-æ˜¯å¦ä¸º-null" class="headerlink" title="åˆ¤æ–­ value æ˜¯å¦ä¸º null"></a>åˆ¤æ–­ value æ˜¯å¦ä¸º null</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* valueæ˜¯å¦ä¸ºnull</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPresent</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¦‚æœvalueä¸ä¸ºnullæ‰§è¡Œconsumer.accept</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ifPresent</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> T&gt; consumer)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (value != <span class="literal">null</span>)</span><br><span class="line">    consumer.accept(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–-value"><a href="#è·å–-value" class="headerlink" title="è·å– value"></a>è·å– value</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Return the value if present, otherwise invoke &#123;<span class="doctag">@code</span> other&#125; and return</span></span><br><span class="line"><span class="comment">* the result of that invocation.</span></span><br><span class="line"><span class="comment">* å¦‚æœvalue != null è¿”å›valueï¼Œå¦åˆ™è¿”å›otherçš„æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">orElseGet</span><span class="params">(Supplier&lt;? extends T&gt; other)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="literal">null</span> ? value : other.get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¦‚æœvalue != null è¿”å›valueï¼Œå¦åˆ™è¿”å›T</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">orElse</span><span class="params">(T other)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="literal">null</span> ? value : other;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å¦‚æœvalue != null è¿”å›valueï¼Œå¦åˆ™æŠ›å‡ºå‚æ•°è¿”å›çš„å¼‚å¸¸</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> &lt;X <span class="keyword">extends</span> <span class="title class_">Throwable</span>&gt; T <span class="title function_">orElseThrow</span><span class="params">(Supplier&lt;? extends X&gt; exceptionSupplier)</span> <span class="keyword">throws</span> X &#123;</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> exceptionSupplier.get();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* valueä¸ºnullæŠ›å‡ºNoSuchElementExceptionï¼Œä¸ä¸ºç©ºè¿”å›valueã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>(<span class="string">&quot;No value present&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿‡æ»¤å€¼"><a href="#è¿‡æ»¤å€¼" class="headerlink" title="è¿‡æ»¤å€¼"></a>è¿‡æ»¤å€¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 1. å¦‚æœæ˜¯emptyè¿”å›empty</span></span><br><span class="line"><span class="comment">* 2. predicate.test(value)==true è¿”å›thisï¼Œå¦åˆ™è¿”å›empty</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> Optional&lt;T&gt; <span class="title function_">filter</span><span class="params">(Predicate&lt;? <span class="built_in">super</span> T&gt; predicate)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(predicate);</span><br><span class="line">        <span class="keyword">if</span> (!isPresent())</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> predicate.test(value) ? <span class="built_in">this</span> : empty();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>çœ‹å®Œ <code>Optional</code> æºç ï¼Œ<code>Optional</code> çš„æ–¹æ³•çœŸçš„éå¸¸ç®€å•ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å¦‚æœåšå†³ä¸æƒ³çœ‹è§ <code>NPE</code>ï¼Œå°±ä¸è¦ç”¨ <code>of()</code>ã€ <code>get()</code>ã€<code>flatMap(..)</code>ã€‚æœ€åå†ç»¼åˆç”¨ä¸€ä¸‹ <code>Optional</code> çš„é«˜é¢‘æ–¹æ³•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional.ofNullable(zoo).map(o -&gt; o.getDog()).map(d -&gt; d.getAge()).filter(v-&gt;v==1).orElse(3);</span><br></pre></td></tr></table></figure><h2 id="Date-Time-API"><a href="#Date-Time-API" class="headerlink" title="Date-Time API"></a>Date-Time API</h2><p>è¿™æ˜¯å¯¹<code>java.util.Date</code>å¼ºæœ‰åŠ›çš„è¡¥å……ï¼Œè§£å†³äº† Date ç±»çš„å¤§éƒ¨åˆ†ç—›ç‚¹ï¼š</p><ol><li>éçº¿ç¨‹å®‰å…¨</li><li>æ—¶åŒºå¤„ç†éº»çƒ¦</li><li>å„ç§æ ¼å¼åŒ–ã€å’Œæ—¶é—´è®¡ç®—ç¹ç</li><li>è®¾è®¡æœ‰ç¼ºé™·ï¼ŒDate ç±»åŒæ—¶åŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼›è¿˜æœ‰ä¸€ä¸ª java.sql.Dateï¼Œå®¹æ˜“æ··æ·†ã€‚</li></ol><p>æˆ‘ä»¬ä»å¸¸ç”¨çš„æ—¶é—´å®ä¾‹æ¥å¯¹æ¯” java.util.Date å’Œæ–° Date æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ç”¨<code>java.util.Date</code>çš„ä»£ç è¯¥æ”¹æ”¹äº†ã€‚</p><h3 id="java-time-ä¸»è¦ç±»"><a href="#java-time-ä¸»è¦ç±»" class="headerlink" title="java.time ä¸»è¦ç±»"></a>java.time ä¸»è¦ç±»</h3><p><code>java.util.Date</code> æ—¢åŒ…å«æ—¥æœŸåˆåŒ…å«æ—¶é—´ï¼Œè€Œ <code>java.time</code> æŠŠå®ƒä»¬è¿›è¡Œäº†åˆ†ç¦»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime.class //æ—¥æœŸ+æ—¶é—´ format: yyyy-MM-ddTHH:mm:ss.SSS</span><br><span class="line">LocalDate.class //æ—¥æœŸ format: yyyy-MM-dd</span><br><span class="line">LocalTime.class //æ—¶é—´ format: HH:mm:ss</span><br></pre></td></tr></table></figure><h3 id="æ ¼å¼åŒ–"><a href="#æ ¼å¼åŒ–" class="headerlink" title="æ ¼å¼åŒ–"></a>æ ¼å¼åŒ–</h3><p><strong>Java 8 ä¹‹å‰:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">oldFormat</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">    <span class="comment">//format yyyy-MM-dd</span></span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">date</span>  <span class="operator">=</span> sdf.format(now);</span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;date format : %s&quot;</span>, date));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//format HH:mm:ss</span></span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">sdft</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;HH:mm:ss&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> sdft.format(now);</span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;time format : %s&quot;</span>, time));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//format yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">sdfdt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">datetime</span> <span class="operator">=</span> sdfdt.format(now);</span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;dateTime format : %s&quot;</span>, datetime));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java 8 ä¹‹å:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">newFormat</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//format yyyy-MM-dd</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;date format : %s&quot;</span>, date));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//format HH:mm:ss</span></span><br><span class="line">    <span class="type">LocalTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalTime.now().withNano(<span class="number">0</span>);</span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;time format : %s&quot;</span>, time));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//format yyyy-MM-dd HH:mm:ss</span></span><br><span class="line">    <span class="type">LocalDateTime</span> <span class="variable">dateTime</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    <span class="type">DateTimeFormatter</span> <span class="variable">dateTimeFormatter</span> <span class="operator">=</span> DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">dateTimeStr</span> <span class="operator">=</span> dateTime.format(dateTimeFormatter);</span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;dateTime format : %s&quot;</span>, dateTimeStr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²è½¬æ—¥æœŸæ ¼å¼"><a href="#å­—ç¬¦ä¸²è½¬æ—¥æœŸæ ¼å¼" class="headerlink" title="å­—ç¬¦ä¸²è½¬æ—¥æœŸæ ¼å¼"></a>å­—ç¬¦ä¸²è½¬æ—¥æœŸæ ¼å¼</h3><p><strong>Java 8 ä¹‹å‰:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å·²å¼ƒç”¨</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2021-01-26&quot;</span>);</span><br><span class="line"><span class="comment">//æ›¿æ¢ä¸º</span></span><br><span class="line"><span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> sdf.parse(<span class="string">&quot;2021-01-26&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>Java 8 ä¹‹å:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">LocalDate date = LocalDate.of(2021, 1, 26);</span><br><span class="line">LocalDate.parse(&quot;2021-01-26&quot;);</span><br><span class="line"></span><br><span class="line">LocalDateTime dateTime = LocalDateTime.of(2021, 1, 26, 12, 12, 22);</span><br><span class="line">LocalDateTime.parse(&quot;2021-01-26 12:12:22&quot;);</span><br><span class="line"></span><br><span class="line">LocalTime time = LocalTime.of(12, 12, 22);</span><br><span class="line">LocalTime.parse(&quot;12:12:22&quot;);</span><br></pre></td></tr></table></figure><p><strong>Java 8 ä¹‹å‰</strong> è½¬æ¢éƒ½éœ€è¦å€ŸåŠ© <code>SimpleDateFormat</code> ç±»ï¼Œè€Œ<strong>Java 8 ä¹‹å</strong>åªéœ€è¦ <code>LocalDate</code>ã€<code>LocalTime</code>ã€<code>LocalDateTime</code>çš„ <code>of</code> æˆ– <code>parse</code> æ–¹æ³•ã€‚</p><h3 id="æ—¥æœŸè®¡ç®—"><a href="#æ—¥æœŸè®¡ç®—" class="headerlink" title="æ—¥æœŸè®¡ç®—"></a>æ—¥æœŸè®¡ç®—</h3><p>ä¸‹é¢ä»…ä»¥<strong>ä¸€å‘¨åæ—¥æœŸ</strong>ä¸ºä¾‹ï¼Œå…¶ä»–å•ä½ï¼ˆå¹´ã€æœˆã€æ—¥ã€1&#x2F;2 æ—¥ã€æ—¶ç­‰ç­‰ï¼‰å¤§åŒå°å¼‚ã€‚å¦å¤–ï¼Œè¿™äº›å•ä½éƒ½åœ¨ <em>java.time.temporal.ChronoUnit</em> æšä¸¾ä¸­å®šä¹‰ã€‚</p><p><strong>Java 8 ä¹‹å‰:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterDay</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="comment">//ä¸€å‘¨åçš„æ—¥æœŸ</span></span><br><span class="line">     <span class="type">SimpleDateFormat</span> <span class="variable">formatDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">     <span class="type">Calendar</span> <span class="variable">ca</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">     ca.add(Calendar.DATE, <span class="number">7</span>);</span><br><span class="line">     <span class="type">Date</span> <span class="variable">d</span> <span class="operator">=</span> ca.getTime();</span><br><span class="line">     <span class="type">String</span> <span class="variable">after</span> <span class="operator">=</span> formatDate.format(d);</span><br><span class="line">     System.out.println(<span class="string">&quot;ä¸€å‘¨åæ—¥æœŸï¼š&quot;</span> + after);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//ç®—ä¸¤ä¸ªæ—¥æœŸé—´éš”å¤šå°‘å¤©ï¼Œè®¡ç®—é—´éš”å¤šå°‘å¹´ï¼Œå¤šå°‘æœˆæ–¹æ³•ç±»ä¼¼</span></span><br><span class="line">     <span class="type">String</span> <span class="variable">dates1</span> <span class="operator">=</span> <span class="string">&quot;2021-12-23&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">dates2</span> <span class="operator">=</span> <span class="string">&quot;2021-02-26&quot;</span>;</span><br><span class="line">     <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">     <span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> format.parse(dates1);</span><br><span class="line">     <span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> format.parse(dates2);</span><br><span class="line">     <span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> (<span class="type">int</span>) ((date1.getTime() - date2.getTime()) / (<span class="number">1000</span> * <span class="number">3600</span> * <span class="number">24</span>));</span><br><span class="line">     System.out.println(dates1 + <span class="string">&quot;å’Œ&quot;</span> + dates2 + <span class="string">&quot;ç›¸å·®&quot;</span> + day + <span class="string">&quot;å¤©&quot;</span>);</span><br><span class="line">     <span class="comment">//ç»“æœï¼š2021-02-26å’Œ2021-12-23ç›¸å·®300å¤©</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java 8 ä¹‹å:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pushWeek</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="comment">//ä¸€å‘¨åçš„æ—¥æœŸ</span></span><br><span class="line">     <span class="type">LocalDate</span> <span class="variable">localDate</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">     <span class="comment">//æ–¹æ³•1</span></span><br><span class="line">     <span class="type">LocalDate</span> <span class="variable">after</span> <span class="operator">=</span> localDate.plus(<span class="number">1</span>, ChronoUnit.WEEKS);</span><br><span class="line">     <span class="comment">//æ–¹æ³•2</span></span><br><span class="line">     <span class="type">LocalDate</span> <span class="variable">after2</span> <span class="operator">=</span> localDate.plusWeeks(<span class="number">1</span>);</span><br><span class="line">     System.out.println(<span class="string">&quot;ä¸€å‘¨åæ—¥æœŸï¼š&quot;</span> + after);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//ç®—ä¸¤ä¸ªæ—¥æœŸé—´éš”å¤šå°‘å¤©ï¼Œè®¡ç®—é—´éš”å¤šå°‘å¹´ï¼Œå¤šå°‘æœˆ</span></span><br><span class="line">     <span class="type">LocalDate</span> <span class="variable">date1</span> <span class="operator">=</span> LocalDate.parse(<span class="string">&quot;2021-02-26&quot;</span>);</span><br><span class="line">     <span class="type">LocalDate</span> <span class="variable">date2</span> <span class="operator">=</span> LocalDate.parse(<span class="string">&quot;2021-12-23&quot;</span>);</span><br><span class="line">     <span class="type">Period</span> <span class="variable">period</span> <span class="operator">=</span> Period.between(date1, date2);</span><br><span class="line">     System.out.println(<span class="string">&quot;date1 åˆ° date2 ç›¸éš”ï¼š&quot;</span></span><br><span class="line">                + period.getYears() + <span class="string">&quot;å¹´&quot;</span></span><br><span class="line">                + period.getMonths() + <span class="string">&quot;æœˆ&quot;</span></span><br><span class="line">                + period.getDays() + <span class="string">&quot;å¤©&quot;</span>);</span><br><span class="line">   <span class="comment">//æ‰“å°ç»“æœæ˜¯ â€œdate1 åˆ° date2 ç›¸éš”ï¼š0å¹´9æœˆ27å¤©â€</span></span><br><span class="line">     <span class="comment">//è¿™é‡Œperiod.getDays()å¾—åˆ°çš„å¤©æ˜¯æŠ›å»å¹´æœˆä»¥å¤–çš„å¤©æ•°ï¼Œå¹¶ä¸æ˜¯æ€»å¤©æ•°</span></span><br><span class="line">     <span class="comment">//å¦‚æœè¦è·å–çº¯ç²¹çš„æ€»å¤©æ•°åº”è¯¥ç”¨ä¸‹é¢çš„æ–¹æ³•</span></span><br><span class="line">     <span class="type">long</span> <span class="variable">day</span> <span class="operator">=</span> date2.toEpochDay() - date1.toEpochDay();</span><br><span class="line">     System.out.println(date1 + <span class="string">&quot;å’Œ&quot;</span> + date2 + <span class="string">&quot;ç›¸å·®&quot;</span> + day + <span class="string">&quot;å¤©&quot;</span>);</span><br><span class="line">     <span class="comment">//æ‰“å°ç»“æœï¼š2021-02-26å’Œ2021-12-23ç›¸å·®300å¤©</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–æŒ‡å®šæ—¥æœŸ"><a href="#è·å–æŒ‡å®šæ—¥æœŸ" class="headerlink" title="è·å–æŒ‡å®šæ—¥æœŸ"></a>è·å–æŒ‡å®šæ—¥æœŸ</h3><p>é™¤äº†æ—¥æœŸè®¡ç®—ç¹çï¼Œè·å–ç‰¹å®šä¸€ä¸ªæ—¥æœŸä¹Ÿå¾ˆéº»çƒ¦ï¼Œæ¯”å¦‚è·å–æœ¬æœˆæœ€åä¸€å¤©ï¼Œç¬¬ä¸€å¤©ã€‚</p><p><strong>Java 8 ä¹‹å‰:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getDay</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="comment">//è·å–å½“å‰æœˆç¬¬ä¸€å¤©ï¼š</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        c.set(Calendar.DAY_OF_MONTH, <span class="number">1</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">first</span> <span class="operator">=</span> format.format(c.getTime());</span><br><span class="line">        System.out.println(<span class="string">&quot;first day:&quot;</span> + first);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–å½“å‰æœˆæœ€åä¸€å¤©</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">ca</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        ca.set(Calendar.DAY_OF_MONTH, ca.getActualMaximum(Calendar.DAY_OF_MONTH));</span><br><span class="line">        <span class="type">String</span> <span class="variable">last</span> <span class="operator">=</span> format.format(ca.getTime());</span><br><span class="line">        System.out.println(<span class="string">&quot;last day:&quot;</span> + last);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å½“å¹´æœ€åä¸€å¤©</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">currCal</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.clear();</span><br><span class="line">        calendar.set(Calendar.YEAR, currCal.get(Calendar.YEAR));</span><br><span class="line">        calendar.roll(Calendar.DAY_OF_YEAR, -<span class="number">1</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">time</span> <span class="operator">=</span> calendar.getTime();</span><br><span class="line">        System.out.println(<span class="string">&quot;last day:&quot;</span> + format.format(time));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Java 8 ä¹‹å:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getDayNew</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">today</span> <span class="operator">=</span> LocalDate.now();</span><br><span class="line">    <span class="comment">//è·å–å½“å‰æœˆç¬¬ä¸€å¤©ï¼š</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">firstDayOfThisMonth</span> <span class="operator">=</span> today.with(TemporalAdjusters.firstDayOfMonth());</span><br><span class="line">    <span class="comment">// å–æœ¬æœˆæœ€åä¸€å¤©</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">lastDayOfThisMonth</span> <span class="operator">=</span> today.with(TemporalAdjusters.lastDayOfMonth());</span><br><span class="line">    <span class="comment">//å–ä¸‹ä¸€å¤©ï¼š</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">nextDay</span> <span class="operator">=</span> lastDayOfThisMonth.plusDays(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//å½“å¹´æœ€åä¸€å¤©</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">lastday</span> <span class="operator">=</span> today.with(TemporalAdjusters.lastDayOfYear());</span><br><span class="line">    <span class="comment">//2021å¹´æœ€åä¸€ä¸ªå‘¨æ—¥ï¼Œå¦‚æœç”¨Calendaræ˜¯ä¸å¾—çƒ¦æ­»ã€‚</span></span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">lastMondayOf2021</span> <span class="operator">=</span> LocalDate.parse(<span class="string">&quot;2021-12-31&quot;</span>).with(TemporalAdjusters.lastInMonth(DayOfWeek.SUNDAY));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>java.time.temporal.TemporalAdjusters</code> é‡Œé¢è¿˜æœ‰å¾ˆå¤šä¾¿æ·çš„ç®—æ³•ï¼Œè¿™é‡Œå°±ä¸å¸¦å¤§å®¶çœ‹ Api äº†ï¼Œéƒ½å¾ˆç®€å•ï¼Œçœ‹äº†ç§’æ‡‚ã€‚</p><h3 id="JDBC-å’Œ-java8"><a href="#JDBC-å’Œ-java8" class="headerlink" title="JDBC å’Œ java8"></a>JDBC å’Œ java8</h3><p>ç°åœ¨ jdbc æ—¶é—´ç±»å‹å’Œ java8 æ—¶é—´ç±»å‹å¯¹åº”å…³ç³»æ˜¯</p><ol><li><code>Date</code> â€”&gt; <code>LocalDate</code></li><li><code>Time</code> â€”&gt; <code>LocalTime</code></li><li><code>Timestamp</code> â€”&gt; <code>LocalDateTime</code></li></ol><p>è€Œä¹‹å‰ç»Ÿç»Ÿå¯¹åº” <code>Date</code>ï¼Œä¹Ÿåªæœ‰ <code>Date</code>ã€‚</p><h3 id="æ—¶åŒº"><a href="#æ—¶åŒº" class="headerlink" title="æ—¶åŒº"></a>æ—¶åŒº</h3><blockquote><p>æ—¶åŒºï¼šæ­£å¼çš„æ—¶åŒºåˆ’åˆ†ä¸ºæ¯éš”ç»åº¦ 15Â° åˆ’åˆ†ä¸€ä¸ªæ—¶åŒºï¼Œå…¨çƒå…± 24 ä¸ªæ—¶åŒºï¼Œæ¯ä¸ªæ—¶åŒºç›¸å·® 1 å°æ—¶ã€‚ä½†ä¸ºäº†è¡Œæ”¿ä¸Šçš„æ–¹ä¾¿ï¼Œå¸¸å°† 1 ä¸ªå›½å®¶æˆ– 1 ä¸ªçœä»½åˆ’åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚æˆ‘å›½å¹…å‘˜å®½å¹¿ï¼Œå¤§æ¦‚æ¨ªè·¨ 5 ä¸ªæ—¶åŒºï¼Œå®é™…ä¸Šåªç”¨ä¸œå…«æ—¶åŒºçš„æ ‡å‡†æ—¶å³åŒ—äº¬æ—¶é—´ä¸ºå‡†ã€‚</p></blockquote><p><code>java.util.Date</code> å¯¹è±¡å®è´¨ä¸Šå­˜çš„æ˜¯ 1970 å¹´ 1 æœˆ 1 æ—¥ 0 ç‚¹ï¼ˆ GMTï¼‰è‡³ Date å¯¹è±¡æ‰€è¡¨ç¤ºæ—¶åˆ»æ‰€ç»è¿‡çš„æ¯«ç§’æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸ç®¡åœ¨å“ªä¸ªæ—¶åŒº new Dateï¼Œå®ƒè®°å½•çš„æ¯«ç§’æ•°éƒ½ä¸€æ ·ï¼Œå’Œæ—¶åŒºæ— å…³ã€‚ä½†åœ¨ä½¿ç”¨ä¸Šåº”è¯¥æŠŠå®ƒè½¬æ¢æˆå½“åœ°æ—¶é—´ï¼Œè¿™å°±æ¶‰åŠåˆ°äº†æ—¶é—´çš„å›½é™…åŒ–ã€‚<code>java.util.Date</code> æœ¬èº«å¹¶ä¸æ”¯æŒå›½é™…åŒ–ï¼Œéœ€è¦å€ŸåŠ© <code>TimeZone</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//åŒ—äº¬æ—¶é—´ï¼šWed Jan 27 14:05:29 CST 2021</span><br><span class="line">Date date = new Date();</span><br><span class="line"></span><br><span class="line">SimpleDateFormat bjSdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">//åŒ—äº¬æ—¶åŒº</span><br><span class="line">bjSdf.setTimeZone(TimeZone.getTimeZone(&quot;Asia/Shanghai&quot;));</span><br><span class="line">System.out.println(&quot;æ¯«ç§’æ•°:&quot; + date.getTime() + &quot;, åŒ—äº¬æ—¶é—´:&quot; + bjSdf.format(date));</span><br><span class="line"></span><br><span class="line">//ä¸œäº¬æ—¶åŒº</span><br><span class="line">SimpleDateFormat tokyoSdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line">tokyoSdf.setTimeZone(TimeZone.getTimeZone(&quot;Asia/Tokyo&quot;));  // è®¾ç½®ä¸œäº¬æ—¶åŒº</span><br><span class="line">System.out.println(&quot;æ¯«ç§’æ•°:&quot; + date.getTime() + &quot;, ä¸œäº¬æ—¶é—´:&quot; + tokyoSdf.format(date));</span><br><span class="line"></span><br><span class="line">//å¦‚æœç›´æ¥printä¼šè‡ªåŠ¨è½¬æˆå½“å‰æ—¶åŒºçš„æ—¶é—´</span><br><span class="line">System.out.println(date);</span><br><span class="line">//Wed Jan 27 14:05:29 CST 2021</span><br></pre></td></tr></table></figure><p>åœ¨æ–°ç‰¹æ€§ä¸­å¼•å…¥äº† <code>java.time.ZonedDateTime</code> æ¥è¡¨ç¤ºå¸¦æ—¶åŒºçš„æ—¶é—´ã€‚å®ƒå¯ä»¥çœ‹æˆæ˜¯ <code>LocalDateTime + ZoneId</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//å½“å‰æ—¶åŒºæ—¶é—´</span><br><span class="line">ZonedDateTime zonedDateTime = ZonedDateTime.now();</span><br><span class="line">System.out.println(&quot;å½“å‰æ—¶åŒºæ—¶é—´: &quot; + zonedDateTime);</span><br><span class="line"></span><br><span class="line">//ä¸œäº¬æ—¶é—´</span><br><span class="line">ZoneId zoneId = ZoneId.of(ZoneId.SHORT_IDS.get(&quot;JST&quot;));</span><br><span class="line">ZonedDateTime tokyoTime = zonedDateTime.withZoneSameInstant(zoneId);</span><br><span class="line">System.out.println(&quot;ä¸œäº¬æ—¶é—´: &quot; + tokyoTime);</span><br><span class="line"></span><br><span class="line">// ZonedDateTime è½¬ LocalDateTime</span><br><span class="line">LocalDateTime localDateTime = tokyoTime.toLocalDateTime();</span><br><span class="line">System.out.println(&quot;ä¸œäº¬æ—¶é—´è½¬å½“åœ°æ—¶é—´: &quot; + localDateTime);</span><br><span class="line"></span><br><span class="line">//LocalDateTime è½¬ ZonedDateTime</span><br><span class="line">ZonedDateTime localZoned = localDateTime.atZone(ZoneId.systemDefault());</span><br><span class="line">System.out.println(&quot;æœ¬åœ°æ—¶åŒºæ—¶é—´: &quot; + localZoned);</span><br><span class="line"></span><br><span class="line">//æ‰“å°ç»“æœ</span><br><span class="line">å½“å‰æ—¶åŒºæ—¶é—´: 2021-01-27T14:43:58.735+08:00[Asia/Shanghai]</span><br><span class="line">ä¸œäº¬æ—¶é—´: 2021-01-27T15:43:58.735+09:00[Asia/Tokyo]</span><br><span class="line">ä¸œäº¬æ—¶é—´è½¬å½“åœ°æ—¶é—´: 2021-01-27T15:43:58.735</span><br><span class="line">å½“åœ°æ—¶åŒºæ—¶é—´: 2021-01-27T15:53:35.618+08:00[Asia/Shanghai]</span><br></pre></td></tr></table></figure><h3 id="å°ç»“-2"><a href="#å°ç»“-2" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>é€šè¿‡ä¸Šé¢æ¯”è¾ƒæ–°è€ <code>Date</code> çš„ä¸åŒï¼Œå½“ç„¶åªåˆ—å‡ºéƒ¨åˆ†åŠŸèƒ½ä¸Šçš„åŒºåˆ«ï¼Œæ›´å¤šåŠŸèƒ½è¿˜å¾—è‡ªå·±å»æŒ–æ˜ã€‚æ€»ä¹‹ date-time-api ç»™æ—¥æœŸæ“ä½œå¸¦æ¥äº†ç¦åˆ©ã€‚åœ¨æ—¥å¸¸å·¥ä½œä¸­é‡åˆ° date ç±»å‹çš„æ“ä½œï¼Œç¬¬ä¸€è€ƒè™‘çš„æ˜¯ date-time-apiï¼Œå®åœ¨è§£å†³ä¸äº†å†è€ƒè™‘è€çš„ Dateã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬æ¢³ç†æ€»ç»“çš„ java 8 æ–°ç‰¹æ€§æœ‰</p><ul><li>Interface &amp; functional Interface</li><li>Lambda</li><li>Stream</li><li>Optional</li><li>Date time-api</li></ul>]]></content>
      
      
      <categories>
          
          <category> Javaæ ¸å¿ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hutool:å›½äº§è‰¯å¿ƒå·¥å…·åŒ…ï¼Œè®©ä½ çš„ä»£ç æ›´é…¸çˆ½</title>
      <link href="/article/112215.html"/>
      <url>/article/112215.html</url>
      
        <content type="html"><![CDATA[<h1 id="Hutoolå·¥å…·ç±»åº“"><a href="#Hutoolå·¥å…·ç±»åº“" class="headerlink" title="Hutoolå·¥å…·ç±»åº“"></a>Hutoolå·¥å…·ç±»åº“</h1><p>è¯»è€…ç¾¤é‡Œæœ‰ä¸ªå°ä¼™ä¼´æ„Ÿæ…¨è¯´ï¼Œâ€œHutool è¿™æ¬¾å¼€æºç±»åº“å¤ªå‰å®³äº†ï¼ŒåŸºæœ¬ä¸Šè¯¥æœ‰è¯¥çš„å·¥å…·ç±»ï¼Œå®ƒé‡Œé¢éƒ½æœ‰ã€‚â€è®²çœŸçš„ï¼Œæˆ‘å¹³å¸¸å·¥ä½œä¸­ä¹Ÿç»å¸¸ç”¨ Hutoolï¼Œå®ƒç¡®å®å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç®€åŒ–æ¯ä¸€è¡Œä»£ç ï¼Œä½¿ Java æ‹¥æœ‰å‡½æ•°å¼è¯­è¨€èˆ¬çš„ä¼˜é›…ï¼Œè®© Java è¯­è¨€å˜å¾—â€œç”œç”œçš„â€ã€‚</p><p>Hutool çš„ä½œè€…åœ¨<a href="https://hutool.cn/">å®˜ç½‘</a>ä¸Šè¯´ï¼ŒHutool æ˜¯ Hu+tool çš„è‡ªé€ è¯ï¼ˆå¥½åƒä¸ç”¨è¯´ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çŒœå¾—åˆ°ï¼‰ï¼Œâ€œHuâ€ç”¨æ¥è‡´æ•¬ä»–çš„â€œå‰ä»»â€å…¬å¸ï¼Œâ€œtoolâ€å°±æ˜¯å·¥å…·çš„æ„æ€ï¼Œè°éŸ³å°±æœ‰æ„æ€äº†ï¼Œâ€œç³Šæ¶‚â€ï¼Œå¯“æ„è¿½æ±‚â€œä¸‡äº‹éƒ½ä½œç³Šæ¶‚è§‚ï¼Œæ— æ‰€è°“å¤±ï¼Œæ— æ‰€è°“å¾—â€ï¼ˆä¸€ä¸ªå¼€æºç±»åº“ï¼Œä¸Šå‡åˆ°äº†å“²å­¦çš„é«˜åº¦ï¼Œä½œè€…å‰å®³äº†ï¼‰ã€‚</p><p>çœ‹äº†ä¸€ä¸‹å¼€å‘å›¢é˜Ÿçš„ä¸€ä¸ªæˆå‘˜ä»‹ç»ï¼Œä¸€ä¸ª Java åç«¯å·¥å…·çš„ä½œè€…ç«Ÿç„¶çˆ±å‰ç«¯ã€çˆ±æ•°ç ï¼Œçˆ±ç¾å¥³ï¼Œå—¯å—¯å—¯ï¼Œç¡®å®â€œéš¾å¾—ç³Šæ¶‚â€ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-01.png"></p><p>åºŸè¯å°±è¯´åˆ°è¿™ï¼Œæ¥å§ï¼Œå®æ“èµ°èµ·ï¼</p><h3 id="å¼•å…¥-Hutool"><a href="#å¼•å…¥-Hutool" class="headerlink" title="å¼•å…¥ Hutool"></a>å¼•å…¥ Hutool</h3><p>Maven é¡¹ç›®åªéœ€è¦åœ¨ pom.xml æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.4.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>Hutool çš„è®¾è®¡æ€æƒ³æ˜¯å°½é‡å‡å°‘é‡å¤çš„å®šä¹‰ï¼Œè®©é¡¹ç›®ä¸­çš„ util åŒ…å°½é‡å°‘ã€‚ä¸€ä¸ªå¥½çš„è½®å­å¯ä»¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…â€œå¤åˆ¶ç²˜è´´â€ï¼Œä»è€ŒèŠ‚çœæˆ‘ä»¬å¼€å‘äººå‘˜å¯¹é¡¹ç›®ä¸­å…¬ç”¨ç±»åº“å’Œå…¬ç”¨å·¥å…·æ–¹æ³•çš„å°è£…æ—¶é—´ã€‚åŒæ—¶å‘¢ï¼Œæˆç†Ÿçš„å¼€æºåº“ä¹Ÿå¯ä»¥æœ€å¤§é™åº¦çš„é¿å…å°è£…ä¸å®Œå–„å¸¦æ¥çš„ bugã€‚</p><p>å°±åƒä½œè€…åœ¨å®˜ç½‘ä¸Šè¯´çš„é‚£æ ·ï¼š</p><ul><li>ä»¥å‰ï¼Œæˆ‘ä»¬æ‰“å¼€æœç´¢å¼•æ“ -&gt; æœâ€œJava MD5 åŠ å¯†â€ -&gt; æ‰“å¼€æŸç¯‡åšå®¢ -&gt; å¤åˆ¶ç²˜è´´ -&gt; æ”¹æ”¹ï¼Œå˜å¾—å¥½ç”¨äº›</li><li>æœ‰äº† Hutool ä»¥åå‘¢ï¼Œå¼•å…¥ Hutool -&gt; ç›´æ¥ <code>SecureUtil.md5()</code></li></ul><p>Hutool å¯¹ä¸ä»…å¯¹ JDK åº•å±‚çš„æ–‡ä»¶ã€æµã€åŠ å¯†è§£å¯†ã€è½¬ç ã€æ­£åˆ™ã€çº¿ç¨‹ã€XMLç­‰åšäº†å°è£…ï¼Œè¿˜æä¾›äº†ä»¥ä¸‹è¿™äº›ç»„ä»¶ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-02.png"></p><p>éå¸¸å¤šï¼Œéå¸¸å…¨é¢ï¼Œé‰´äºæ­¤ï¼Œæˆ‘åªæŒ‘é€‰ä¸€äº›æˆ‘å–œæ¬¢çš„æ¥ä»‹ç»ä¸‹ï¼ˆå·å·åœ°å‘Šè¯‰ä½ ï¼Œæˆ‘å°±æ˜¯æƒ³å·æ‡’ï¼‰ã€‚</p><h3 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h3><p>ç±»å‹è½¬æ¢åœ¨ Java å¼€å‘ä¸­å¾ˆå¸¸è§ï¼Œå°¤å…¶æ˜¯ä» HttpRequest ä¸­è·å–å‚æ•°çš„æ—¶å€™ï¼Œå‰ç«¯ä¼ é€’çš„æ˜¯æ•´å‹ï¼Œä½†åç«¯åªèƒ½å…ˆè·å–åˆ°å­—ç¬¦ä¸²ï¼Œç„¶åå†è°ƒç”¨ <code>parseXXX()</code> æ–¹æ³•è¿›è¡Œè½¬æ¢ï¼Œè¿˜è¦åŠ ä¸Šåˆ¤ç©ºï¼Œå¾ˆç¹çã€‚</p><p>Hutool çš„ Convert ç±»å¯ä»¥ç®€åŒ–è¿™ä¸ªæ“ä½œï¼Œå¯ä»¥å°†ä»»æ„å¯èƒ½çš„ç±»å‹è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ï¼ŒåŒæ—¶ç¬¬äºŒä¸ªå‚æ•° defaultValue å¯ç”¨äºåœ¨è½¬æ¢å¤±è´¥æ—¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">param</span> <span class="operator">=</span> <span class="string">&quot;10&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">paramInt</span> <span class="operator">=</span> Convert.toInt(param);</span><br><span class="line"><span class="type">int</span> <span class="variable">paramIntDefault</span> <span class="operator">=</span> Convert.toInt(param, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ—¥æœŸï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> <span class="string">&quot;2020å¹´09æœˆ29æ—¥&quot;</span>;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> Convert.toDate(dateStr);</span><br></pre></td></tr></table></figure><p>æŠŠå­—ç¬¦ä¸²è½¬æˆ Unicodeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">unicodeStr</span> <span class="operator">=</span> <span class="string">&quot;é©¬æ–¯å…‹&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">unicode</span> <span class="operator">=</span> Convert.strToUnicode(unicodeStr);</span><br></pre></td></tr></table></figure><h3 id="æ—¥æœŸæ—¶é—´"><a href="#æ—¥æœŸæ—¶é—´" class="headerlink" title="æ—¥æœŸæ—¶é—´"></a>æ—¥æœŸæ—¶é—´</h3><p>JDK è‡ªå¸¦çš„ Date å’Œ Calendar ä¸å¤ªå¥½ç”¨ï¼ŒHutool å°è£…çš„ DateUtil ç”¨èµ·æ¥å°±èˆ’æœå¤šäº†ï¼</p><p>è·å–å½“å‰æ—¥æœŸï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> DateUtil.date();</span><br></pre></td></tr></table></figure><p><code>DateUtil.date()</code> è¿”å›çš„å…¶å®æ˜¯ DateTimeï¼Œå®ƒç»§æ‰¿è‡ª Date å¯¹è±¡ï¼Œé‡å†™äº† <code>toString()</code> æ–¹æ³•ï¼Œè¿”å› <code>yyyy-MM-dd HH:mm:ss</code> æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p><p>æœ‰äº›å°ä¼™ä¼´æ˜¯ä¸æ˜¯æƒ³çœ‹çœ‹æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶é—´ï¼Œè¾“å‡ºä¸€ä¸‹ç»™å¤§å®¶çœ‹çœ‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(date);// 2020-09-29 04:28:02</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²è½¬æ—¥æœŸï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> <span class="string">&quot;2020-09-29&quot;</span>;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> DateUtil.parse(dateStr);</span><br></pre></td></tr></table></figure><p><code>DateUtil.parse()</code> ä¼šè‡ªåŠ¨è¯†åˆ«ä¸€äº›å¸¸ç”¨çš„æ ¼å¼ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>yyyy-MM-dd HH:mm:ss</li><li>yyyy-MM-dd</li><li>HH:mm:ss</li><li>yyyy-MM-dd HH:mm</li><li>yyyy-MM-dd HH:mm:ss.SSS</li></ul><p>è¿˜å¯ä»¥è¯†åˆ«å¸¦ä¸­æ–‡çš„ï¼š</p><ul><li>å¹´æœˆæ—¥æ—¶åˆ†ç§’</li></ul><p>æ ¼å¼åŒ–æ—¶é—´å·®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">dateStr1</span> <span class="operator">=</span> <span class="string">&quot;2020-09-29 22:33:23&quot;</span>;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> DateUtil.parse(dateStr1);</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">dateStr2</span> <span class="operator">=</span> <span class="string">&quot;2020-10-01 23:34:27&quot;</span>;</span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> DateUtil.parse(dateStr2);</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">betweenDay</span> <span class="operator">=</span> DateUtil.between(date1, date2, DateUnit.MS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š2å¤©1å°æ—¶1åˆ†4ç§’</span></span><br><span class="line"><span class="type">String</span> <span class="variable">formatBetween</span> <span class="operator">=</span> DateUtil.formatBetween(betweenDay, BetweenFormater.Level.SECOND);</span><br></pre></td></tr></table></figure><p>æ˜Ÿåº§å’Œå±ç›¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°„æ‰‹åº§</span></span><br><span class="line"><span class="type">String</span> <span class="variable">zodiac</span> <span class="operator">=</span> DateUtil.getZodiac(Month.DECEMBER.getValue(), <span class="number">10</span>);</span><br><span class="line"><span class="comment">// è›‡</span></span><br><span class="line"><span class="type">String</span> <span class="variable">chineseZodiac</span> <span class="operator">=</span> DateUtil.getChineseZodiac(<span class="number">1989</span>);</span><br></pre></td></tr></table></figure><h3 id="IO-æµç›¸å…³"><a href="#IO-æµç›¸å…³" class="headerlink" title="IO æµç›¸å…³"></a>IO æµç›¸å…³</h3><p><a href="https://javabetter.cn/io/shangtou.html">IO æ“ä½œåŒ…æ‹¬è¯»å’Œå†™</a>ï¼Œåº”ç”¨çš„åœºæ™¯ä¸»è¦åŒ…æ‹¬ç½‘ç»œæ“ä½œå’Œæ–‡ä»¶æ“ä½œï¼ŒåŸç”Ÿçš„ Java ç±»åº“åŒºåˆ†<a href="https://javabetter.cn/io/reader-writer.html">å­—ç¬¦æµ</a>å’Œ<a href="https://javabetter.cn/io/stream.html">å­—èŠ‚æµ</a>ï¼Œå­—èŠ‚æµ InputStream å’Œ OutputStream å°±æœ‰å¾ˆå¤šå¾ˆå¤šç§ï¼Œä½¿ç”¨èµ·æ¥è®©äººå¤´çš®å‘éº»ã€‚</p><p>Hutool å°è£…äº†æµæ“ä½œå·¥å…·ç±» IoUtilã€æ–‡ä»¶è¯»å†™æ“ä½œå·¥å…·ç±» FileUtilã€æ–‡ä»¶ç±»å‹åˆ¤æ–­å·¥å…·ç±» FileTypeUtil ç­‰ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedInputStream</span> <span class="variable">in</span> <span class="operator">=</span> FileUtil.getInputStream(<span class="string">&quot;hutool/origin.txt&quot;</span>);</span><br><span class="line"><span class="type">BufferedOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> FileUtil.getOutputStream(<span class="string">&quot;hutool/to.txt&quot;</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">copySize</span> <span class="operator">=</span> IoUtil.copy(in, out, IoUtil.DEFAULT_BUFFER_SIZE);</span><br></pre></td></tr></table></figure><p>åœ¨ IO æ“ä½œä¸­ï¼Œæ–‡ä»¶çš„æ“ä½œç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†ä½¿ç”¨é¢‘ç‡ä¹Ÿå¾ˆé«˜ï¼Œå‡ ä¹æ‰€æœ‰çš„é¡¹ç›®ä¸­éƒ½èººç€ä¸€ä¸ªå« FileUtil æˆ–è€… FileUtils çš„å·¥å…·ç±»ã€‚Hutool çš„ FileUtil ç±»åŒ…å«ä»¥ä¸‹å‡ ç±»æ“ä½œï¼š</p><ul><li>æ–‡ä»¶æ“ä½œï¼šåŒ…æ‹¬æ–‡ä»¶ç›®å½•çš„æ–°å»ºã€åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ã€æ”¹åç­‰</li><li>æ–‡ä»¶åˆ¤æ–­ï¼šåˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦éç©ºï¼Œæ˜¯å¦ä¸ºç›®å½•ï¼Œæ˜¯å¦ä¸ºæ–‡ä»¶ç­‰ç­‰</li><li>ç»å¯¹è·¯å¾„ï¼šé’ˆå¯¹ ClassPath ä¸­çš„æ–‡ä»¶è½¬æ¢ä¸ºç»å¯¹è·¯å¾„æ–‡ä»¶</li><li>æ–‡ä»¶åï¼šä¸»æ–‡ä»¶åï¼Œæ‰©å±•åçš„è·å–</li><li>è¯»æ“ä½œï¼šåŒ…æ‹¬ getReaderã€readXXX æ“ä½œ</li><li>å†™æ“ä½œï¼šåŒ…æ‹¬ getWriterã€writeXXX æ“ä½œ</li></ul><p>é¡ºå¸¦è¯´è¯´ classpathã€‚</p><p>åœ¨å®é™…ç¼–ç å½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦ä»æŸäº›æ–‡ä»¶é‡Œé¢è¯»å–ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚é…ç½®æ–‡ä»¶ã€æ–‡æœ¬æ–‡ä»¶ã€å›¾ç‰‡ç­‰ç­‰ï¼Œé‚£è¿™äº›æ–‡ä»¶é€šå¸¸æ”¾åœ¨ä»€ä¹ˆä½ç½®å‘¢ï¼Ÿ</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-03.png"></p><p>æ”¾åœ¨é¡¹ç›®ç»“æ„å›¾ä¸­çš„ resources ç›®å½•ä¸‹ï¼Œå½“é¡¹ç›®ç¼–è¯‘åï¼Œä¼šå‡ºç°åœ¨ classes ç›®å½•ä¸‹ã€‚å¯¹åº”ç£ç›˜ä¸Šçš„ç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-04.png"></p><p>å½“æˆ‘ä»¬è¦è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œæˆ‘æ˜¯ä¸å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸ä¸€æ ·çš„è¯ï¼Œæ–‡ä»¶çš„è·¯å¾„æ ‡è¯†ç¬¦ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚æœ€å¥½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚</p><p>å‡è®¾åœ¨ <code>src/resources</code> ä¸‹æ”¾äº†ä¸€ä¸ªæ–‡ä»¶ origin.txtï¼Œæ–‡ä»¶çš„è·¯å¾„å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtil.getInputStream(&quot;origin.txt&quot;)</span><br></pre></td></tr></table></figure><p>å‡è®¾æ–‡ä»¶æ”¾åœ¨ <code>src/resources/hutool</code> ç›®å½•ä¸‹ï¼Œåˆ™è·¯å¾„å‚æ•°æ”¹ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileUtil.getInputStream(&quot;hutool/origin.txt&quot;)</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²å·¥å…·"><a href="#å­—ç¬¦ä¸²å·¥å…·" class="headerlink" title="å­—ç¬¦ä¸²å·¥å…·"></a>å­—ç¬¦ä¸²å·¥å…·</h3><p>Hutool å°è£…çš„å­—ç¬¦ä¸²å·¥å…·ç±» StrUtil å’Œ Apache Commons Lang åŒ…ä¸­çš„ StringUtils ç±»ä¼¼ï¼Œä½œè€…è®¤ä¸ºä¼˜åŠ¿åœ¨äº Str æ¯” String çŸ­ï¼Œå°½ç®¡æˆ‘ä¸è§‰å¾—ã€‚ä¸è¿‡ï¼Œæˆ‘å€’æ˜¯æŒºå–œæ¬¢å…¶ä¸­çš„ä¸€ä¸ªæ–¹æ³•çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">template</span> <span class="operator">=</span> <span class="string">&quot;&#123;&#125;ï¼Œä¸€æšæ²‰é»˜ä½†æœ‰è¶£çš„ç¨‹åºå‘˜ï¼Œå–œæ¬¢ä»–çš„æ–‡ç« çš„è¯ï¼Œè¯·å¾®ä¿¡æœç´¢&#123;&#125;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> StrUtil.format(template, <span class="string">&quot;é©¬æ–¯å…‹&quot;</span>, <span class="string">&quot;é©¬æ–¯å…‹&quot;</span>);</span><br><span class="line"><span class="comment">// é©¬æ–¯å…‹ï¼Œä¸€æšæ²‰é»˜ä½†æœ‰è¶£çš„ç¨‹åºå‘˜ï¼Œå–œæ¬¢ä»–çš„æ–‡ç« çš„è¯ï¼Œè¯·å¾®ä¿¡æœç´¢é©¬æ–¯å…‹</span></span><br></pre></td></tr></table></figure><h3 id="åå°„å·¥å…·"><a href="#åå°„å·¥å…·" class="headerlink" title="åå°„å·¥å…·"></a>åå°„å·¥å…·</h3><p>åå°„æœºåˆ¶å¯ä»¥è®© Java å˜å¾—æ›´åŠ çµæ´»ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåå°„å¯ä»¥åšåˆ°äº‹åŠåŠŸå€çš„æ•ˆæœã€‚Hutool å°è£…çš„åå°„å·¥å…· ReflectUtil åŒ…æ‹¬ï¼š</p><ul><li>è·å–æ„é€ æ–¹æ³•</li><li>è·å–å­—æ®µ</li><li>è·å–å­—æ®µå€¼</li><li>è·å–æ–¹æ³•</li><li>æ‰§è¡Œæ–¹æ³•ï¼ˆå¯¹è±¡æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itwanger.hutool.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ReflectUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReflectDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReflectDemo</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ„é€ æ–¹æ³•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯é©¬æ–¯å…‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">ReflectDemo</span> <span class="variable">reflectDemo</span> <span class="operator">=</span> ReflectUtil.newInstance(ReflectDemo.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ„é€ æ–¹æ³•</span></span><br><span class="line">        Constructor[] constructors = ReflectUtil.getConstructors(ReflectDemo.class);</span><br><span class="line">        <span class="keyword">for</span> (Constructor constructor : constructors) &#123;</span><br><span class="line">            System.out.println(constructor.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å­—æ®µ</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> ReflectUtil.getField(ReflectDemo.class, <span class="string">&quot;id&quot;</span>);</span><br><span class="line">        field.setInt(reflectDemo, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// è·å–å­—æ®µå€¼</span></span><br><span class="line">        System.out.println(ReflectUtil.getFieldValue(reflectDemo, field));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line">        Method[] methods = ReflectUtil.getMethods(ReflectDemo.class);</span><br><span class="line">        <span class="keyword">for</span> (Method m : methods) &#123;</span><br><span class="line">            System.out.println(m.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æŒ‡å®šæ–¹æ³•</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectUtil.getMethod(ReflectDemo.class, <span class="string">&quot;print&quot;</span>);</span><br><span class="line">        System.out.println(method.getName());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">        ReflectUtil.invoke(reflectDemo, <span class="string">&quot;print&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‹ç¼©å·¥å…·"><a href="#å‹ç¼©å·¥å…·" class="headerlink" title="å‹ç¼©å·¥å…·"></a>å‹ç¼©å·¥å…·</h3><p>åœ¨ Java ä¸­ï¼Œå¯¹æ–‡ä»¶ã€æ–‡ä»¶å¤¹æ‰“åŒ…å‹ç¼©æ˜¯ä¸€ä»¶å¾ˆç¹ççš„äº‹æƒ…ï¼ŒHutool å°è£…çš„ ZipUtil é’ˆå¯¹ java.util.zip åŒ…åšäº†ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æå®šå‹ç¼©å’Œè§£å‹ï¼Œå¹¶ä¸”è‡ªåŠ¨å¤„ç†æ–‡ä»¶å’Œç›®å½•çš„é—®é¢˜ï¼Œä¸å†éœ€è¦ç”¨æˆ·åˆ¤æ–­ï¼Œå¤§å¤§ç®€åŒ–çš„å‹ç¼©è§£å‹çš„å¤æ‚åº¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZipUtil.zip(&quot;hutool&quot;, &quot;hutool.zip&quot;);</span><br><span class="line">File unzip = ZipUtil.unzip(&quot;hutool.zip&quot;, &quot;hutoolzip&quot;);</span><br></pre></td></tr></table></figure><h3 id="èº«ä»½è¯å·¥å…·"><a href="#èº«ä»½è¯å·¥å…·" class="headerlink" title="èº«ä»½è¯å·¥å…·"></a>èº«ä»½è¯å·¥å…·</h3><p>Hutool å°è£…çš„ IdcardUtil å¯ä»¥ç”¨æ¥å¯¹èº«ä»½è¯è¿›è¡ŒéªŒè¯ï¼Œæ”¯æŒå¤§é™† 15 ä½ã€18 ä½èº«ä»½è¯ï¼Œæ¸¯æ¾³å° 10 ä½èº«ä»½è¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">ID_18</span> <span class="operator">=</span> <span class="string">&quot;321083197812162119&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">ID_15</span> <span class="operator">=</span> <span class="string">&quot;150102880730303&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">valid</span> <span class="operator">=</span> IdcardUtil.isValidCard(ID_18);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">valid15</span> <span class="operator">=</span> IdcardUtil.isValidCard(ID_15);</span><br></pre></td></tr></table></figure><h3 id="æ‰©å±•-HashMap"><a href="#æ‰©å±•-HashMap" class="headerlink" title="æ‰©å±• HashMap"></a>æ‰©å±• HashMap</h3><p>Java ä¸­çš„ HashMap æ˜¯å¼ºç±»å‹çš„ï¼Œè€Œ Hutool å°è£…çš„ Dict å¯¹é”®çš„ç±»å‹è¦æ±‚æ²¡é‚£ä¹ˆä¸¥æ ¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dict</span> <span class="variable">dict</span> <span class="operator">=</span> Dict.create()</span><br><span class="line">        .set(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>)</span><br><span class="line">        .set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;é©¬æ–¯å…‹&quot;</span>)</span><br><span class="line">        .set(<span class="string">&quot;birthday&quot;</span>, DateTime.now());</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> dict.getInt(<span class="string">&quot;age&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> dict.getStr(<span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="æ§åˆ¶å°æ‰“å°"><a href="#æ§åˆ¶å°æ‰“å°" class="headerlink" title="æ§åˆ¶å°æ‰“å°"></a>æ§åˆ¶å°æ‰“å°</h3><p>æœ¬åœ°ç¼–ç çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ <code>System.out</code> æ‰“å°ç»“æœï¼Œä½†æ˜¯å¾€å¾€ä¸€äº›å¤æ‚çš„å¯¹è±¡ä¸æ”¯æŒç›´æ¥æ‰“å°ï¼Œæ¯”å¦‚è¯´æ•°ç»„ï¼Œéœ€è¦è°ƒç”¨ <code>Arrays.toString</code>ã€‚Hutool å°è£…çš„ Console ç±»å€Ÿé‰´äº† JavaScript ä¸­çš„ <code>console.log()</code>ï¼Œä½¿å¾—æ‰“å°å˜æˆäº†ä¸€ä¸ªéå¸¸ä¾¿æ·çš„æ–¹å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsoleDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰“å°å­—ç¬¦ä¸²</span></span><br><span class="line">        Console.log(<span class="string">&quot;é©¬æ–¯å…‹ï¼Œä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°å­—ç¬¦ä¸²æ¨¡æ¿</span></span><br><span class="line">        Console.log(<span class="string">&quot;æ´›é˜³æ˜¯&#123;&#125;æœå¤éƒ½&quot;</span>,<span class="number">13</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> [] ints = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">        <span class="comment">// æ‰“å°æ•°ç»„</span></span><br><span class="line">        Console.log(ints);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—æ®µéªŒè¯å™¨"><a href="#å­—æ®µéªŒè¯å™¨" class="headerlink" title="å­—æ®µéªŒè¯å™¨"></a>å­—æ®µéªŒè¯å™¨</h3><p>åš Web å¼€å‘çš„æ—¶å€™ï¼Œåç«¯é€šå¸¸éœ€è¦å¯¹è¡¨å•æäº¤è¿‡æ¥çš„æ•°æ®è¿›è¡ŒéªŒè¯ã€‚Hutool å°è£…çš„ Validator å¯ä»¥è¿›è¡Œå¾ˆå¤šæœ‰æ•ˆçš„æ¡ä»¶éªŒè¯ï¼š</p><ul><li>æ˜¯ä¸æ˜¯é‚®ç®±</li><li>æ˜¯ä¸æ˜¯ IP V4ã€V6</li><li>æ˜¯ä¸æ˜¯ç”µè¯å·ç </li><li>ç­‰ç­‰</li></ul><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-05.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Validator.isEmail(&quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">Validator.isMobile(&quot;itwanger.com&quot;);</span><br></pre></td></tr></table></figure><h3 id="åŒå‘æŸ¥æ‰¾-Map"><a href="#åŒå‘æŸ¥æ‰¾-Map" class="headerlink" title="åŒå‘æŸ¥æ‰¾ Map"></a>åŒå‘æŸ¥æ‰¾ Map</h3><p><a href="https://javabetter.cn/common-tool/guava.html">Guava</a> ä¸­æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„ Map ç»“æ„ï¼Œå«åš BiMapï¼Œå®ç°äº†ä¸€ç§åŒå‘æŸ¥æ‰¾çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ® key æŸ¥æ‰¾ valueï¼Œä¹Ÿå¯ä»¥æ ¹æ® value æŸ¥æ‰¾ keyï¼ŒHutool ä¹Ÿæä¾›è¿™ç§ Map ç»“æ„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">BiMap&lt;String, String&gt; biMap = new BiMap&lt;&gt;(new HashMap&lt;&gt;());</span><br><span class="line">biMap.put(&quot;wanger&quot;, &quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">biMap.put(&quot;wangsan&quot;, &quot;æ²‰é»˜ç‹ä¸‰&quot;);</span><br><span class="line"></span><br><span class="line">// get value by key</span><br><span class="line">biMap.get(&quot;wanger&quot;);</span><br><span class="line">biMap.get(&quot;wangsan&quot;);</span><br><span class="line"></span><br><span class="line">// get key by value</span><br><span class="line">biMap.getKey(&quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">biMap.getKey(&quot;æ²‰é»˜ç‹ä¸‰&quot;);</span><br></pre></td></tr></table></figure><p>åœ¨å®é™…çš„å¼€å‘å·¥ä½œä¸­ï¼Œå…¶å®æˆ‘æ›´å€¾å‘äºä½¿ç”¨ Guava çš„ BiMapï¼Œè€Œä¸æ˜¯ Hutool çš„ã€‚è¿™é‡Œæä¸€ä¸‹ï¼Œä¸»è¦æ˜¯æˆ‘å‘ç°äº† Hutool åœ¨çº¿æ–‡æ¡£ä¸Šçš„ä¸€å¤„é”™è¯¯ï¼Œæäº†ä¸ª issueï¼ˆä»ä¸­å¯ä»¥çœ‹å‡ºæˆ‘ä¸€é¢—ä¸€ä¸ä¸è‹Ÿçš„å¿ƒå’Œä¸€åŒæ¸…æ¾ˆæ˜äº®çš„å¤§çœ¼ç›å•Šï¼‰ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-06.png"></p><h3 id="å›¾ç‰‡å·¥å…·"><a href="#å›¾ç‰‡å·¥å…·" class="headerlink" title="å›¾ç‰‡å·¥å…·"></a>å›¾ç‰‡å·¥å…·</h3><p>Hutool å°è£…çš„ ImgUtil å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾ã€è£å‰ªã€è½¬ä¸ºé»‘ç™½ã€åŠ æ°´å°ç­‰æ“ä½œã€‚</p><p>ç¼©æ”¾å›¾ç‰‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImgUtil.scale(</span><br><span class="line">        FileUtil.file(&quot;hutool/wangsan.jpg&quot;),</span><br><span class="line">        FileUtil.file(&quot;hutool/wangsan_small.jpg&quot;),</span><br><span class="line">        0.5f</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è£å‰ªå›¾ç‰‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImgUtil.cut(</span><br><span class="line">        FileUtil.file(&quot;hutool/wangsan.jpg&quot;),</span><br><span class="line">        FileUtil.file(&quot;hutool/wangsan_cut.jpg&quot;),</span><br><span class="line">        new Rectangle(200, 200, 100, 100)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æ·»åŠ æ°´å°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ImgUtil.pressText(//</span><br><span class="line">        FileUtil.file(&quot;hutool/wangsan.jpg&quot;),</span><br><span class="line">        FileUtil.file(&quot;hutool/wangsan_logo.jpg&quot;),</span><br><span class="line">        &quot;é©¬æ–¯å…‹&quot;, Color.WHITE,</span><br><span class="line">        new Font(&quot;é»‘ä½“&quot;, Font.BOLD, 100),</span><br><span class="line">        0,</span><br><span class="line">        0,</span><br><span class="line">        0.8f</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¶æœºè®©å¤§å®¶æ¬£èµä¸€ä¸‹äºŒå“¥å¸…æ°”çš„çœŸå®¹ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-07.png"></p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><blockquote><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒJava ä¸­å¹¿æ³›åº”ç”¨çš„é…ç½®æ–‡ä»¶ Properties å­˜åœ¨ä¸€ä¸ªç‰¹åˆ«å¤§çš„è¯Ÿç—…ï¼šä¸æ”¯æŒä¸­æ–‡ã€‚æ¯æ¬¡ä½¿ç”¨æ—¶ï¼Œå¦‚æœæƒ³å­˜æ”¾ä¸­æ–‡å­—ç¬¦ï¼Œå°±å¿…é¡»å€ŸåŠ© IDE ç›¸å…³æ’ä»¶æ‰èƒ½è½¬ä¸º Unicode ç¬¦å·ï¼Œè€Œè¿™ç§åäººç±»çš„ç¬¦å·åœ¨å‘½ä»¤è¡Œä¸‹æ ¹æœ¬æ²¡æ³•çœ‹ã€‚</p></blockquote><p>äºæ˜¯ï¼ŒHutool çš„ Setting è¿ç”¨è€Œç”Ÿã€‚Setting é™¤äº†å…¼å®¹ Properties æ–‡ä»¶æ ¼å¼å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›ç‰¹æœ‰åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>å„ç§ç¼–ç æ–¹å¼æ”¯æŒ</li><li>å˜é‡æ”¯æŒ</li><li>åˆ†ç»„æ”¯æŒ</li></ul><p>å…ˆæ•´ä¸ªé…ç½®æ–‡ä»¶ example.settingï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=é©¬æ–¯å…‹</span><br><span class="line">age=18</span><br></pre></td></tr></table></figure><p>å†æ¥è¯»å–å’Œæ›´æ–°é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SettingDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">SETTING</span> <span class="operator">=</span> <span class="string">&quot;hutool/example.setting&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ– Setting</span></span><br><span class="line">        <span class="type">Setting</span> <span class="variable">setting</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setting</span>(SETTING);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»å–</span></span><br><span class="line">        setting.getStr(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;é©¬æ–¯å…‹&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åœ¨é…ç½®æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨åŠ è½½</span></span><br><span class="line">        setting.autoLoad(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡ä»£ç æ–¹å¼å¢åŠ é”®å€¼å¯¹</span></span><br><span class="line">        setting.set(<span class="string">&quot;birthday&quot;</span>, <span class="string">&quot;2020å¹´09æœˆ29æ—¥&quot;</span>);</span><br><span class="line">        setting.store(SETTING);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—å·¥å‚"><a href="#æ—¥å¿—å·¥å‚" class="headerlink" title="æ—¥å¿—å·¥å‚"></a>æ—¥å¿—å·¥å‚</h3><p>Hutool å°è£…çš„æ—¥å¿—å·¥å‚ LogFactory å…¼å®¹äº†å„å¤§æ—¥å¿—æ¡†æ¶ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿéå¸¸ç®€ä¾¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogDemo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;éš¾å¾—ç³Šæ¶‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆé€šè¿‡ <code>LogFactory.get()</code> è‡ªåŠ¨è¯†åˆ«å¼•å…¥çš„æ—¥å¿—æ¡†æ¶ï¼Œä»è€Œåˆ›å»ºå¯¹åº”æ—¥å¿—æ¡†æ¶çš„é—¨é¢ Log å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>debug()</code>ã€<code>info()</code> ç­‰æ–¹æ³•è¾“å‡ºæ—¥å¿—ã€‚</p><p>å¦‚æœä¸æƒ³åˆ›å»º Log å¯¹è±¡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ StaticLogï¼Œé¡¾åæ€ä¹‰ï¼Œä¸€ä¸ªæä¾›äº†é™æ€æ–¹æ³•çš„æ—¥å¿—ç±»ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StaticLog.info(&quot;çˆ½å•Š &#123;&#125;.&quot;, &quot;é©¬æ–¯å…‹çš„æ–‡ç« &quot;);</span><br></pre></td></tr></table></figure><h3 id="ç¼“å­˜å·¥å…·"><a href="#ç¼“å­˜å·¥å…·" class="headerlink" title="ç¼“å­˜å·¥å…·"></a>ç¼“å­˜å·¥å…·</h3><p>CacheUtil æ˜¯ Hutool å°è£…çš„åˆ›å»ºç¼“å­˜çš„å¿«æ·å·¥å…·ç±»ï¼Œå¯ä»¥åˆ›å»ºä¸åŒçš„ç¼“å­˜å¯¹è±¡ï¼š</p><ul><li>FIFOCacheï¼šå…ˆå…¥å…ˆå‡ºï¼Œå…ƒç´ ä¸åœçš„åŠ å…¥ç¼“å­˜ç›´åˆ°ç¼“å­˜æ»¡ä¸ºæ­¢ï¼Œå½“ç¼“å­˜æ»¡æ—¶ï¼Œæ¸…ç†è¿‡æœŸç¼“å­˜å¯¹è±¡ï¼Œæ¸…ç†åä¾æ—§æ»¡åˆ™åˆ é™¤å…ˆå…¥çš„ç¼“å­˜ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Cache&lt;String, String&gt; fifoCache = CacheUtil.newFIFOCache(3);</span><br><span class="line">fifoCache.put(&quot;key1&quot;, &quot;æ²‰é»˜ç‹ä¸€&quot;);</span><br><span class="line">fifoCache.put(&quot;key2&quot;, &quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">fifoCache.put(&quot;key3&quot;, &quot;æ²‰é»˜ç‹ä¸‰&quot;);</span><br><span class="line">fifoCache.put(&quot;key4&quot;, &quot;æ²‰é»˜ç‹å››&quot;);</span><br><span class="line"></span><br><span class="line">// å¤§å°ä¸º 3ï¼Œæ‰€ä»¥ key3 æ”¾å…¥å key1 è¢«æ¸…é™¤</span><br><span class="line">String value1 = fifoCache.get(&quot;key1&quot;);</span><br></pre></td></tr></table></figure><ul><li>LFUCacheï¼Œæœ€å°‘ä½¿ç”¨ï¼Œæ ¹æ®ä½¿ç”¨æ¬¡æ•°æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦è¢«æŒç»­ç¼“å­˜ï¼Œå½“ç¼“å­˜æ»¡æ—¶æ¸…ç†è¿‡æœŸå¯¹è±¡ï¼Œæ¸…ç†åä¾æ—§æ»¡çš„æƒ…å†µä¸‹æ¸…é™¤æœ€å°‘è®¿é—®çš„å¯¹è±¡å¹¶å°†å…¶ä»–å¯¹è±¡çš„è®¿é—®æ•°å‡å»è¿™ä¸ªæœ€å°‘è®¿é—®æ•°ï¼Œä»¥ä¾¿æ–°å¯¹è±¡è¿›å…¥åå¯ä»¥å…¬å¹³è®¡æ•°ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Cache&lt;String, String&gt; lfuCache = CacheUtil.newLFUCache(3);</span><br><span class="line"></span><br><span class="line">lfuCache.put(&quot;key1&quot;, &quot;æ²‰é»˜ç‹ä¸€&quot;);</span><br><span class="line">// ä½¿ç”¨æ¬¡æ•°+1</span><br><span class="line">lfuCache.get(&quot;key1&quot;);</span><br><span class="line">lfuCache.put(&quot;key2&quot;, &quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">lfuCache.put(&quot;key3&quot;, &quot;æ²‰é»˜ç‹ä¸‰&quot;);</span><br><span class="line">lfuCache.put(&quot;key4&quot;, &quot;æ²‰é»˜ç‹å››&quot;);</span><br><span class="line"></span><br><span class="line">// ç”±äºç¼“å­˜å®¹é‡åªæœ‰ 3ï¼Œå½“åŠ å…¥ç¬¬ 4 ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæœ€å°‘ä½¿ç”¨çš„å°†è¢«ç§»é™¤ï¼ˆ2,3è¢«ç§»é™¤ï¼‰</span><br><span class="line">String value2 = lfuCache.get(&quot;key2&quot;);</span><br><span class="line">String value3 = lfuCache.get(&quot;key3&quot;);</span><br></pre></td></tr></table></figure><ul><li>LRUCacheï¼Œæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼Œæ ¹æ®ä½¿ç”¨æ—¶é—´æ¥åˆ¤å®šå¯¹è±¡æ˜¯å¦è¢«æŒç»­ç¼“å­˜ï¼Œå½“å¯¹è±¡è¢«è®¿é—®æ—¶æ”¾å…¥ç¼“å­˜ï¼Œå½“ç¼“å­˜æ»¡äº†ï¼Œæœ€ä¹…æœªè¢«ä½¿ç”¨çš„å¯¹è±¡å°†è¢«ç§»é™¤ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Cache&lt;String, String&gt; lruCache = CacheUtil.newLRUCache(3);</span><br><span class="line"></span><br><span class="line">lruCache.put(&quot;key1&quot;, &quot;æ²‰é»˜ç‹ä¸€&quot;);</span><br><span class="line">lruCache.put(&quot;key2&quot;, &quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">lruCache.put(&quot;key3&quot;, &quot;æ²‰é»˜ç‹ä¸‰&quot;);</span><br><span class="line">// ä½¿ç”¨æ—¶é—´è¿‘äº†</span><br><span class="line">lruCache.get(&quot;key1&quot;);</span><br><span class="line">lruCache.put(&quot;key4&quot;, &quot;æ²‰é»˜ç‹å››&quot;);</span><br><span class="line"></span><br><span class="line">// ç”±äºç¼“å­˜å®¹é‡åªæœ‰ 3ï¼Œå½“åŠ å…¥ç¬¬ 4 ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œæœ€ä¹…ä½¿ç”¨çš„å°†è¢«ç§»é™¤ï¼ˆ2ï¼‰</span><br><span class="line">String value2 = lruCache.get(&quot;key2&quot;);</span><br><span class="line">System.out.println(value2);</span><br></pre></td></tr></table></figure><h3 id="åŠ å¯†è§£å¯†"><a href="#åŠ å¯†è§£å¯†" class="headerlink" title="åŠ å¯†è§£å¯†"></a>åŠ å¯†è§£å¯†</h3><p>åŠ å¯†åˆ†ä¸ºä¸‰ç§ï¼š</p><ul><li>å¯¹ç§°åŠ å¯†ï¼ˆsymmetricï¼‰ï¼Œä¾‹å¦‚ï¼šAESã€DES ç­‰</li><li>éå¯¹ç§°åŠ å¯†ï¼ˆasymmetricï¼‰ï¼Œä¾‹å¦‚ï¼šRSAã€DSA ç­‰</li><li>æ‘˜è¦åŠ å¯†ï¼ˆdigestï¼‰ï¼Œä¾‹å¦‚ï¼šMD5ã€SHA-1ã€SHA-256ã€HMAC ç­‰</li></ul><p>Hutool é’ˆå¯¹è¿™ä¸‰ç§æƒ…å†µéƒ½åšäº†å°è£…ï¼š</p><ul><li>å¯¹ç§°åŠ å¯† SymmetricCrypto</li><li>éå¯¹ç§°åŠ å¯† AsymmetricCrypto</li><li>æ‘˜è¦åŠ å¯† Digester</li></ul><p>å¿«é€ŸåŠ å¯†å·¥å…·ç±» SecureUtil æœ‰ä»¥ä¸‹è¿™äº›æ–¹æ³•ï¼š</p><p>1ï¼‰å¯¹ç§°åŠ å¯†</p><ul><li>SecureUtil.aes</li><li>SecureUtil.des</li></ul><p>2ï¼‰éå¯¹ç§°åŠ å¯†</p><ul><li>SecureUtil.rsa</li><li>SecureUtil.dsa</li></ul><p>3ï¼‰æ‘˜è¦åŠ å¯†</p><ul><li>SecureUtil.md5</li><li>SecureUtil.sha1</li><li>SecureUtil.hmac</li><li>SecureUtil.hmacMd5</li><li>SecureUtil.hmacSha1</li></ul><p>åªå†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ä½œä¸ºå‚è€ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureUtilDemo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">AES</span> <span class="variable">aes</span> <span class="operator">=</span> SecureUtil.aes();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encry</span> <span class="operator">=</span> aes.encryptHex(<span class="string">&quot;é©¬æ–¯å…‹&quot;</span>);</span><br><span class="line">        System.out.println(encry);</span><br><span class="line">        <span class="type">String</span> <span class="variable">oo</span> <span class="operator">=</span> aes.decryptStr(encry);</span><br><span class="line">        System.out.println(oo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18ã€å…¶ä»–ç±»åº“"><a href="#18ã€å…¶ä»–ç±»åº“" class="headerlink" title="18ã€å…¶ä»–ç±»åº“"></a>18ã€å…¶ä»–ç±»åº“</h3><p>Hutool ä¸­çš„ç±»åº“è¿˜æœ‰å¾ˆå¤šï¼Œå°¤å…¶æ˜¯ä¸€äº›å¯¹ç¬¬ä¸‰æ–¹ç±»åº“çš„è¿›ä¸€æ­¥å°è£…ï¼Œæ¯”å¦‚é‚®ä»¶å·¥å…· MailUtilï¼ŒäºŒç»´ç å·¥å…· QrCodeUtilï¼ŒEmoji å·¥å…· EmojiUtilï¼Œå°ä¼™ä¼´ä»¬å¯ä»¥å‚è€ƒ Hutool çš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://www.hutool.cn/">https://www.hutool.cn/</a></p><p>é¡¹ç›®æºç åœ°å€ï¼š<a href="https://github.com/looly/hutool">https://github.com/looly/hutool</a></p>]]></content>
      
      
      <categories>
          
          <category> Javaæ ¸å¿ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¸¸ç”¨å·¥å…·ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æŠŠé¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨</title>
      <link href="/article/112216.html"/>
      <url>/article/112216.html</url>
      
        <content type="html"><![CDATA[<h2 id="äº‘æœåŠ¡å™¨"><a href="#äº‘æœåŠ¡å™¨" class="headerlink" title="äº‘æœåŠ¡å™¨"></a>äº‘æœåŠ¡å™¨</h2><p>æˆ‘ä»¬éœ€è¦ä¸€å°äº‘æœåŠ¡å™¨ï¼Œæˆ‘ä¹‹å‰ç™½å«–è¿‡ä¸€å°ä¸ç‰ˆçš„ï¼Œ1 æ ¸1G å†…å­˜ï¼Œå¹¶ä¸”å·²ç»å®‰è£…äº†å®å¡”é¢æ¿ã€‚</p><p>è¿™æ˜¯ä»å®å¡”é¢æ¿é¦–é¡µçœ‹åˆ°çš„æœåŠ¡å™¨é…ç½®è¯¦æƒ…ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10ef01787c-ee09-4474-a182-70bd6a2daf72.png"></p><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p>ç™»å½•å®å¡”é¢æ¿ï¼Œç‚¹å‡»ã€Œæ•°æ®åº“ã€â†’ã€Œæ·»åŠ æ•°æ®åº“ã€ï¼Œå¡«å†™æ•°æ®åº“åï¼Œå®å¡”é¢æ¿ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå’Œæ•°æ®åº“åŒåçš„è´¦å·ï¼Œæ³¨æ„è®¿é—®æƒé™é€‰æ‹©ã€Œæœ¬åœ°æœåŠ¡å™¨ã€ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10b64e7890-552d-47d5-91bd-03d74bff7974.png"></p><p>åœ¨ codingmore æ ç›®ä¸­ç‚¹å‡»ã€Œå¯¼å…¥ã€ã€Œä»æœ¬åœ°ä¸Šä¼ ã€ç¼–ç¨‹å–µçš„æ•°æ®åº“æ–‡ä»¶ã€‚ä¸Šä¼ å®Œæˆåç‚¹å‡»å¯¼å…¥ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10eec6b672-9089-414b-9f69-65cae18ae45d.png"></p><p>DB æ–‡ä»¶æ”¾åœ¨ coding-more&#x2F;doc ç›®å½•ä¸‹ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-102f8aa2a1-1443-49e6-85d0-6b983863d161.png"></p><p>å»ºè®®å…ˆåšä¸€æ¬¡å¤‡ä»½ï¼Œç‚¹å‡»ã€Œæ— å¤‡ä»½ã€ã€Œå¤‡ä»½ã€å°±å¯ä»¥å°†æˆ‘ä»¬çš„æ•°æ®åº“æ–‡ä»¶å¤‡ä»½ä¸‹æ¥äº†ï¼Œå¦‚æœåé¢æƒ³æ¢å¤çš„è¯ï¼Œç›´æ¥ç‚¹å‡»ã€Œæ¢å¤ã€å°±å¯ä»¥äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10c8edb874-95ad-405c-a57c-9c8b9fab8f6e.png"></p><p>è®°ä½ç”¨æˆ·åï¼Œå¹¶å¤åˆ¶å¯†ç ï¼Œç„¶ååœ¨æ•°æ®åº“æ¡ç›®ä¸­ç‚¹å‡»ã€Œç®¡ç†ã€</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1032b5cafc-74ef-4e62-b65d-7e36980c14ed.png"></p><p>å¡«å†™ç”¨æˆ·åå’Œå¯†ç åï¼Œç‚¹å‡»æ‰§è¡Œã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-105579299a-bc0c-495d-a41b-31d9214835f3.png"></p><p>å°±å¯ä»¥çœ‹åˆ°ç¼–ç¨‹å–µçš„æ•°æ®åº“æ–‡ä»¶äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-100877b273-1ba2-40ed-8f96-0031c75e3680.png"></p><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p><a href="https://javabetter.cn/nginx/nginx.html">Nginx</a> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç† Web æœåŠ¡å™¨ï¼ŒåŸºæœ¬ä¸Šå°±å˜æˆäº†ä¸€ä¸ªæœåŠ¡å™¨å¿…é¡»å®‰è£…çš„å‰ç½®æ¡ä»¶ä¹‹ä¸€ã€‚</p><p>å®å¡”é¢æ¿ä¸­å®‰è£… Nginx æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åœ¨è½¯ä»¶å•†åº—ä¸­æœã€ŒNginxã€å°±å¯ä»¥ç‚¹å‡»å®‰è£…äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10cedec531-ae0e-402c-87ca-ee705a469288.png"></p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>å®å¡”é¢æ¿ä¸­å®‰è£… Redis ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥åœ¨è½¯ä»¶å•†åº—ä¸­æœã€ŒRedisã€å°±å¯ä»¥ç‚¹å‡»å®‰è£…äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10eab69fa2-b7cd-419a-a290-0cc0da2b30c3.png"></p><h2 id="é¡¹ç›®æ‰“åŒ…"><a href="#é¡¹ç›®æ‰“åŒ…" class="headerlink" title="é¡¹ç›®æ‰“åŒ…"></a>é¡¹ç›®æ‰“åŒ…</h2><h3 id="1ï¼‰codingmore-admin"><a href="#1ï¼‰codingmore-admin" class="headerlink" title="1ï¼‰codingmore-admin"></a>1ï¼‰codingmore-admin</h3><p>ç¼–ç¨‹å–µçš„ç®¡ç†åç«¯ï¼Œæ³¨æ„ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒä¸‹çš„ MySQL ç”¨æˆ·åå’Œå¯†ç ï¼Œåœ¨ application-prod.yml æ–‡ä»¶ä¸­ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-100a38b5dd-ecd4-4734-bf6a-448397fa5463.png"></p><p>ç„¶åæŠŠ application.yml æ–‡ä»¶ä¸­çš„ active ä¿®æ”¹ä¸º prod ç”Ÿäº§ç¯å¢ƒã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10dd44a2ce-600d-43b1-8707-4de25287eed9.png"></p><p>æ›¿æ¢ OSS é…ç½®ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-108ebb40d9-64a1-43cd-89fd-4b83e47025de.png"></p><h3 id="2ï¼‰codingmore-web"><a href="#2ï¼‰codingmore-web" class="headerlink" title="2ï¼‰codingmore-web"></a>2ï¼‰codingmore-web</h3><p>ç¼–ç¨‹å–µçš„ Web å‰ç«¯ï¼ˆç½‘ç«™é—¨æˆ·ã€æ–‡ç« å±•ç¤º&#x2F;æ–‡ç« è¯¦æƒ…ç­‰ï¼‰ï¼Œæ³¨æ„ä¿®æ”¹ç”Ÿäº§ç¯å¢ƒä¸‹çš„ MySQL ç”¨æˆ·åå’Œå¯†ç ï¼Œåœ¨ application-prod.yml æ–‡ä»¶ä¸­ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1066ba1162-a198-45e4-87ad-717c62fae6c7.png"></p><p>ç„¶åæŠŠ application.yml æ–‡ä»¶ä¸­çš„ active ä¿®æ”¹ä¸º prod ç”Ÿäº§ç¯å¢ƒã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10560633b8-439d-418e-a3bb-61f21efbae9f.png"></p><p>ç„¶åå°±å¯ä»¥åŒå‡» Maven çš„ package æ‰“åŒ…äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1089745ff7-9222-4d49-b6b9-66fbddba1e52.png"></p><h3 id="3ï¼‰codingmore-admin-web"><a href="#3ï¼‰codingmore-admin-web" class="headerlink" title="3ï¼‰codingmore-admin-web"></a>3ï¼‰codingmore-admin-web</h3><p>admin ç®¡ç†ç«¯çš„å‰ç«¯ç•Œé¢ã€‚åœ¨ Visual Studio Code ä¸­ï¼Œç°åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ <code>yarn install</code> å®‰è£…é¡¹ç›®çš„ä¾èµ–æ’ä»¶ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10d6a9cbaf-fd70-4567-b6b0-b2c50b61407a.png"></p><p>å†æ‰§è¡Œ <code>yarn run build</code> å°±å¯ä»¥æ„å»º codingmore-admin-web çš„é™æ€é¡µé¢äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-101aedea50-7f21-4199-9ff2-c264b614e711.png"></p><p>ä¼šåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª dist ç›®å½•ï¼Œé‡Œé¢å°±æ˜¯æ‰“åŒ…å¥½çš„ç®¡ç†ç«¯é™æ€é¡µé¢ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10128e58f4-172a-4c77-acf1-324ed310412c.png"></p><p>æ‰“åŒ…çš„æ—¶å€™æœ‰ä¸¤ä¸ªè¦ç‚¹è¦è¡¥å……ä¸‹ï¼Œåœ¨ config ç›®å½•ä¸‹æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œdev.env.js æ˜¯å¼€å‘ç¯å¢ƒä¸‹çš„ä¸€äº›é…ç½®ï¼Œindex.js æ˜¯ä¸»é…ç½®ï¼Œprod.env.js æ˜¯ç”Ÿäº§ç¯å¢ƒä¸‹çš„é…ç½®ã€‚</p><p>ä¸ºäº†æé«˜ç½‘ç«™çš„æ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦å…³é—­ source mapï¼Œè®¾ç½® <code>productionSourceMap: false</code>ï¼ŒåŒæ—¶å¼€å¯ js å’Œ css çš„æ–‡ä»¶å‹ç¼©åŠŸèƒ½ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10c2b78cd1-4c55-4fce-9c7a-0afbdd21a659.png"></p><p>è¿™æ ·æ‰“åŒ…åçš„æ–‡ä»¶å¤§å°å°±ä¼šå°å¾ˆå¤šï¼Œæ”¾åˆ°æœåŠ¡å™¨ä¸Šä¹Ÿèƒ½å‡å°‘ç½‘ç»œè¯·æ±‚çš„å“åº”æ—¶é—´ã€‚</p><p>å¯ä»¥çœ‹å¾—å‡ºï¼Œæœ€å¤§çš„ä¸€ä¸ª js æ–‡ä»¶ä¸º 3.7Mï¼Œå‹ç¼©ç‰ˆåªæœ‰ 662kbï¼Œä½“ç§¯ç¼©å°äº†äº”å€ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1009d6dc89-05a3-4a43-972b-bbad4bdd34e5.png"></p><h2 id="å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨"><a href="#å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨" class="headerlink" title="å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨"></a>å°†æ‰“åŒ…å¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨</h2><p>åœ¨å®å¡”é¢æ¿ä¸­ç‚¹å‡»ã€ŒFTPã€ã€Œæ·»åŠ  FTPã€ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1047c54369-e3af-48ea-8143-ea1dbce36894.png"></p><p>ç‚¹å‡»ã€Œæ ¹ç›®å½•ã€</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-103cdb501e-0145-48b2-ac3f-96b6e99e8ecf.png"></p><p>è·³è½¬åˆ°æ–‡ä»¶é¡µã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-106d8e3ef4-e032-4c2d-b872-c7ede968a051.png"></p><p>ç‚¹å‡»ä¸Šä¼ ï¼Œåœ¨ target ç›®å½•ä¸‹é€‰æ‹©ä¸Šä¼ çš„ä¸¤ä¸ª jar åŒ…ï¼Œadmin å’Œ webã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10b1544314-3fc7-4fba-a9e5-28a1760d3517.png"></p><p>ç‚¹å‡»ã€Œå¼€å§‹ä¸Šä¼ ã€</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10ffe802fb-da43-404a-aaaf-f5b5eb4bdcc3.png"></p><p>è¿˜æœ‰ codingmore-admin-web çš„é™æ€æ–‡ä»¶ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10f55854dd-b6a5-4a46-8232-e21bb03b788f.png"></p><h2 id="ä¸€é”®éƒ¨ç½²"><a href="#ä¸€é”®éƒ¨ç½²" class="headerlink" title="ä¸€é”®éƒ¨ç½²"></a>ä¸€é”®éƒ¨ç½²</h2><p>åœ¨è½¯ä»¶å•†åº—é‡Œæœã€Œ<strong>Java</strong>ã€å…³é”®å­—ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªã€Œ<strong>Java é¡¹ç›®ä¸€é”®éƒ¨ç½² 3.5</strong>ã€çš„æ’ä»¶ï¼Œå®‰è£…å®ƒã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10e784ae11-5d73-41c3-929e-60f7c1114f73.png"></p><p>è¿›å…¥ã€ŒJava é¡¹ç›®ä¸€é”®éƒ¨ç½²ã€é¢æ¿ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-102724c169-4f6c-4208-aa3e-ab4936a14e7a.png"></p><p>å¯ä»¥åœ¨ã€Œå®¹å™¨ç®¡ç†ã€é¢æ¿ä¸­é€‰æ‹© Tomcat 8 å®‰è£…ä¸‹ï¼Œå¦‚æœæ²¡æœ‰å®‰è£… JDKï¼Œåœ¨å®‰è£… Tomcat 8 çš„æ—¶å€™ä¼šé»˜è®¤å®‰è£…ä¸€ä¸ª JDK 1.8ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1059bcd44e-be2d-4c7b-81c3-c974f5c9a33a.png"></p><p>è¿›å…¥ Spring Boot é¢æ¿ï¼Œç‚¹å‡»ã€Œæ·»åŠ é¡¹ç›®ã€ï¼Œç‚¹å‡»ã€Œé¡¹ç›®è·¯å¾„ã€å³ä¾§çš„æ–‡ä»¶å¤¹å›¾æ ‡ï¼Œå°±å¯ä»¥ä¸Šä¼ éƒ¨ç½²æˆ‘ä»¬çš„ Spring Boot é¡¹ç›®äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10f39e778b-2d59-4087-bd89-86d71231ff6e.png"></p><h3 id="codingmore-webï¼ˆç½‘ç«™å‰ç«¯ï¼‰"><a href="#codingmore-webï¼ˆç½‘ç«™å‰ç«¯ï¼‰" class="headerlink" title="codingmore-webï¼ˆç½‘ç«™å‰ç«¯ï¼‰"></a>codingmore-webï¼ˆç½‘ç«™å‰ç«¯ï¼‰</h3><p>å…ˆé€‰æ‹© codingmore-webã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-108d03852e-c207-442d-9ce9-770c6a16710b.png"></p><p>å¡«å†™åŸŸåï¼ˆç¼–ç¨‹å–µçš„åŸŸåä¸º <a href="codingmore.top">codingmore.top</a>ï¼‰ï¼Œä¿®æ”¹ç«¯å£å·ä¸º 8081ï¼Œapplication.yml æ–‡ä»¶ä¸­å®šä¹‰çš„ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10358f631c-27c8-4460-a00e-5c17a3077f28.png"></p><p>ç‚¹å‡»ç¡®å®šã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1099646018-e244-421c-9232-4f40c4e07444.png"></p><p>å¯ä»¥çœ‹åˆ°æœåŠ¡å·²ç»åœ¨å¯åŠ¨äº†ï¼Œç‚¹ã€Œæ—¥å¿—ã€çœ‹ä¸€ä¸‹ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1053ab9712-5874-4650-92da-e6978803c4de.png"></p><p>æ²¡é—®é¢˜ã€‚</p><p>ä¹Ÿå¯ä»¥åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ä½¿ç”¨ç»ˆç«¯å·¥å…·çœ‹æ—¥å¿—ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-107242861b-2cfc-4eb2-8414-6afade214a74.png"></p><p>åœ¨å®‰å…¨é¢æ¿é‡Œç¡®è®¤ä¸€ä¸‹ 8081 ç«¯å£æ˜¯å¦æ”¾å¼€ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-109c7d80a2-fb84-43b9-86fc-670221607b22.png"></p><p>ç¡®è®¤æ”¾å¼€åï¼Œæ‰“å¼€ Chrome æµè§ˆå™¨çš„æ— ç—•æ¨¡å¼ï¼Œè¾“å…¥ IP+ç«¯å£å·ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-109f8efbcd-3e6f-4877-ad90-b766dda67879.png"></p><p>é€šè¿‡åŸŸå+ç«¯å£å·çš„å½¢å¼ä¹Ÿå¯ä»¥è®¿é—®åˆ°ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10f50b5c71-35bd-439c-bb82-07348a5155d3.png"></p><h3 id="codingmore-adminï¼ˆç½‘ç«™ç®¡ç†ç«¯ï¼‰"><a href="#codingmore-adminï¼ˆç½‘ç«™ç®¡ç†ç«¯ï¼‰" class="headerlink" title="codingmore-adminï¼ˆç½‘ç«™ç®¡ç†ç«¯ï¼‰"></a>codingmore-adminï¼ˆç½‘ç«™ç®¡ç†ç«¯ï¼‰</h3><p>å†æ¬¡è¿›å…¥ ã€ŒJava é¡¹ç›®ä¸€é”®éƒ¨ç½²ã€Spring Boot é¢æ¿ä¸­ï¼Œæ·»åŠ  codingmore-admin é¡¹ç›®ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1001b5b9f3-05f8-4fdf-9c8a-111ec449826f.png"></p><p>ç¨ç­‰ç‰‡åˆ»ï¼Œæ¥çœ‹ä¸€ä¸‹æ—¥å¿—ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-103a4c0249-f250-4199-ba3c-eeb1ca005bd0.png"></p><p>å¯åŠ¨æ²¡é—®é¢˜ã€‚</p><p>codingmore-admin åªæ˜¯ä¸€ä¸ªåç«¯æœåŠ¡ï¼Œç•Œé¢æ˜¯ç”¨ vue å®Œæˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­¤æ—¶å¯ä»¥é€šè¿‡ Swagger æ¥ç¡®è®¤ä¸€ä¸‹æ¥å£æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><p>å…ˆæ”¾è¡Œ 9002 ç«¯å£ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10f6b25066-3ffa-4dfc-a61c-b6ebb16e339b.png"></p><p>åœ¨æµè§ˆå™¨åœ°å€æ é‡Œè¾“å…¥ <code>http://www.codingmore.top:9002/doc.html</code>ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”¨ Knife4j+Swagger ç”Ÿæˆçš„ API æ–‡æ¡£æ¥å£ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-10a04aa484-a7f1-48f1-a3ff-1525b9bd7035.png"></p><p>OKï¼Œè¿™æ ·å°±å¯ä»¥éªŒè¯æˆ‘ä»¬çš„ admin ç«¯æœåŠ¡ä¹Ÿæ­£ç¡®è¿è¡Œäº†ã€‚</p><p>éšåï¼Œä¸ºäº†å‡å°‘æœåŠ¡å™¨è¢«æ”»å‡»çš„å¯èƒ½æ€§ï¼Œæˆ‘ä»¬å…³æ‰ 9002 çš„ç«¯å£ã€‚</p><h2 id="Nginx-é…ç½®"><a href="#Nginx-é…ç½®" class="headerlink" title="Nginx é…ç½®"></a>Nginx é…ç½®</h2><h3 id="codingmore-web"><a href="#codingmore-web" class="headerlink" title="codingmore-web"></a>codingmore-web</h3><p>åŸŸå+ç«¯å£å·è™½ç„¶å¯ä»¥è®¿é—®ï¼Œä½†ä¸å¤Ÿä¼˜é›…ï¼Œæˆ‘ä»¬æƒ³ç›´æ¥è®¿é—®åŸŸå codingmore.topï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å¯ä»¥ä½¿ç”¨ <a href="https://javabetter.cn/nginx/nginx.html">Nginx</a> è¿›è¡Œç«¯å£è½¬å‘ã€‚</p><p>Nginx çš„å®ç°åŸç†æ˜¯ï¼Œç”¨ Nginx ç›‘å¬ 80 ç«¯å£ï¼Œå½“æœ‰ HTTP è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå°† HTTP è¯·æ±‚çš„ HOST ç­‰ä¿¡æ¯ä¸é…ç½®æ–‡ä»¶è¿›è¡ŒåŒ¹é…å¹¶è½¬å‘ç»™å¯¹åº”çš„ç«¯å£ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œå½“ç”¨æˆ·è®¿é—® codingmore.top æ—¶ï¼ŒNginx ä»é…ç½®æ–‡ä»¶ä¸­å¾—çŸ¥è¿™æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚ï¼Œäºæ˜¯å°†æ­¤è¯·æ±‚è½¬å‘ç»™ 8081 ç«¯å£çš„åº”ç”¨å¤„ç†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">upstream codingmore_web_pool&#123;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  codingmore.top;</span><br><span class="line">    access_log logs/codingmore_web.log;</span><br><span class="line">    error_log logs/codingmore_web.error;</span><br><span class="line">    </span><br><span class="line">    #å°†æ‰€æœ‰è¯·æ±‚è½¬å‘ç»™poolæ± çš„åº”ç”¨å¤„ç†</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://codingmore_web_pool;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯æ‰€è°“çš„ç«¯å£è½¬å‘ï¼Œç”±è½¯ä»¶ç»Ÿä¸€ç›‘å¬æŸä¸ªåŸŸåä¸Šçš„æŸä¸ªç«¯å£ï¼ˆä¸€èˆ¬æ˜¯80ç«¯å£ï¼‰ï¼Œå½“è®¿é—®æœåŠ¡å™¨çš„åŸŸåå’Œç«¯å£ç¬¦åˆè¦æ±‚æ—¶ï¼Œå°±æŒ‰ç…§é…ç½®è½¬å‘ç»™æŒ‡å®šçš„ Tomcat æœåŠ¡å™¨å¤„ç†ã€‚æˆ‘ä»¬å¸¸ç”¨çš„ Nginx ä¹Ÿæœ‰ç«¯å£è½¬å‘åŠŸèƒ½ã€‚</p><p>OKï¼ŒåŸç†äº†è§£å®Œåï¼Œæˆ‘ä»¬æŠŠè¿™æ®µé…ç½®å¤åˆ¶åˆ°å®å¡”é¢æ¿ä¸­çš„ Nginx é…ç½®ä¸­ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1053849d03-ca6c-4871-9103-b65238557c50.png"></p><p>ç‚¹å‡»ã€Œä¿å­˜ã€ã€‚</p><p>å†åœ¨æµè§ˆå™¨ä¸­è®¿é—® <a href="http://www.codingmore.top/">codingmore.top</a> å°±å¯ä»¥è¯·æ±‚åˆ°å†…å®¹äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-106302a681-0dbe-4d76-ac54-243ef67914c7.png"></p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬é¡ºå¸¦æŠŠ 8081 ç«¯å£ç»™å…³æ‰ï¼Œå‡å°‘ä¸€ä¸ªæœåŠ¡å™¨è¢«æ”»å‡»çš„å¯èƒ½æ€§ã€‚</p><p>OKï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº† codingmore-web ä¹Ÿå°±æ˜¯ç¼–ç¨‹å–µğŸ±å‰ç«¯çš„æœåŠ¡éƒ¨ç½²äº†ã€‚</p><h3 id="codingmore-admin-web"><a href="#codingmore-admin-web" class="headerlink" title="codingmore-admin-web"></a>codingmore-admin-web</h3><p>codingmore-admin-web æ‰“åŒ…åçš„æ–‡ä»¶æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ Nginx é‡Œæ·»åŠ  admin çš„é…ç½®è·¯å¾„å°± OK äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">upstream codingmore_web_pool&#123;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  codingmore.top;</span><br><span class="line">    access_log /home/www/codingmore_web.log;</span><br><span class="line">    error_log /home/www/codingmore_web.error;</span><br><span class="line"></span><br><span class="line">    location /admin &#123;</span><br><span class="line">        alias /www/wwwroot/itwanger/dist/; # æ ¹ç›®å½•</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    #å°†æ‰€æœ‰è¯·æ±‚è½¬å‘ç»™poolæ± çš„åº”ç”¨å¤„ç†</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://codingmore_web_pool;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ server ä¸­å¢åŠ äº†ä¸€ä¸ª admin çš„ locationï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬è®¿é—® <a href="http://codingmore.top/admin">codingmore.top&#x2F;admin</a> çš„æ—¶å€™ï¼Œå°±å»è¯·æ±‚ <code>/www/wwwroot/itwanger/dist/</code> ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶ã€‚</p><p>è¿™é‡Œè®²ä¸€ä¸‹ root å’Œ alias çš„åŒºåˆ«ï¼š</p><ul><li>rootï¼šå®é™…è®¿é—®çš„åœ°å€å‰ç¼€æ˜¯  root  + è¯·æ±‚çš„ pathè·¯å¾„ï¼Œå³ <code>admin =&gt;  /www/wwwroot/itwanger/dist/admin</code></li><li>alias:  å®é™…è®¿é—®çš„å°±æ˜¯ <code>/www/wwwroot/itwanger/dist</code></li></ul><p>æ³¨æ„ä¸¤è€…çš„åŒºåˆ«ã€‚æˆ‘ä»¬æ¥è®¿é—®ä¸‹<a href="http://codingmore.top/admin">codingmore.top&#x2F;admin</a>ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/codingmore/images/2022-06-1050bb8a6a-aeee-4514-a62a-cd87cb82b3d4.png"></p><p>OKã€‚</p><p>ç¼–ç¨‹å–µğŸ±æ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œå‰ç«¯çš„è¯·æ±‚å¦‚ä½•è®¿é—®åç«¯çš„ API æ¥å£å‘¢ï¼Ÿç®€å•èŠä¸€ä¸‹ã€‚</p><p>æ‰“å¼€ codingmore-admin-web&#x2F;config&#x2F;prod.env.js æ–‡ä»¶ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª VUE_APP_BASE_API å±æ€§ï¼Œå®ƒçš„å€¼ä¸º <code>/api</code>ï¼Œä¹Ÿå°±æ„å‘³ç€å‰ç«¯çš„è¯·æ±‚ä¼šå‘é€åˆ° <code>/api</code> è¿™ä¸ªå‰ç¼€è·¯å¾„ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x27;use strict&#x27;</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  NODE_ENV: &#x27;&quot;production&quot;&#x27;,</span><br><span class="line">  VUE_APP_BASE_API: &#x27;&quot;/api&quot;&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£æˆ‘ä»¬çš„ codingmore-admin åç«¯æœåŠ¡æ˜¯è·‘åœ¨ 9002 ç«¯å£ä¸‹çš„ï¼Œè¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ Nginx ä¸­å¢åŠ ä¸€ä¸ªè·¯å¾„ï¼Œå°† api å‰ç¼€çš„è¯·æ±‚è½¬å‘åˆ° 9002 ä¸‹ã€‚</p><p>OKï¼Œæ¥çœ‹ä¸€ä¸‹å®Œæ•´çš„é…ç½®å†…å®¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">upstream codingmore_web_pool&#123;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream codingmore_admin_pool&#123;</span><br><span class="line">    server 127.0.0.1:9002/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  codingmore.top;</span><br><span class="line">    access_log /home/www/codingmore_web.log;</span><br><span class="line">    error_log /home/www/codingmore_web.error;</span><br><span class="line"></span><br><span class="line">    location /admin &#123;</span><br><span class="line">        alias /www/wwwroot/itwanger/dist/; # æ ¹ç›®å½•</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /api/ &#123;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://codingmore_admin_pool;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    #å°†æ‰€æœ‰è¯·æ±‚è½¬å‘ç»™poolæ± çš„åº”ç”¨å¤„ç†</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass http://codingmore_web_pool;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaä¼ä¸šçº§å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€ç›‘å¬å™¨</title>
      <link href="/article/112212.html"/>
      <url>/article/112212.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…ˆè¯´ä½œç”¨ã€‚</p><ul><li>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ï¼šå½“æœ‰ä¸€å †è¯·æ±‚ï¼Œåªå¸Œæœ›ç¬¦åˆé¢„æœŸçš„è¯·æ±‚è¿›æ¥ã€‚</li><li>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰ï¼šæƒ³è¦å¹²æ¶‰é¢„æœŸçš„è¯·æ±‚ã€‚</li><li>ç›‘å¬å™¨ï¼ˆListenerï¼‰ï¼šæƒ³è¦ç›‘å¬è¿™äº›è¯·æ±‚å…·ä½“åšäº†ä»€ä¹ˆã€‚</li></ul><p>å†è¯´åŒºåˆ«ã€‚</p><p>è¿‡æ»¤å™¨æ˜¯åœ¨è¯·æ±‚è¿›å…¥å®¹å™¨åï¼Œä½†è¿˜æ²¡æœ‰è¿›å…¥ Servlet ä¹‹å‰è¿›è¡Œé¢„å¤„ç†çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-2a28621b-2cc1-4d29-87a1-cf6a01d95443.png"></p><p>æ‹¦æˆªå™¨æ˜¯åœ¨è¯·æ±‚è¿›å…¥æ§åˆ¶å™¨ï¼ˆControllerï¼‰ ä¹‹å‰è¿›è¡Œé¢„å¤„ç†çš„ã€‚</p><p>è™šçº¿å†…å°±æ˜¯è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„ä½œç”¨èŒƒå›´ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-dd48851b-c123-4fd8-b82d-9ae87b33745d.png"></p><p>è¿‡æ»¤å™¨ä¾èµ–äº Servlet å®¹å™¨ï¼Œè€Œæ‹¦æˆªå™¨ä¾èµ–äº Spring çš„ IoC å®¹å™¨ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ³¨å…¥çš„æ–¹å¼è·å–å®¹å™¨å½“ä¸­çš„å¯¹è±¡ã€‚</p><p>ç›‘å¬å™¨ç”¨äºç›‘å¬ Web åº”ç”¨ä¸­æŸäº›å¯¹è±¡çš„åˆ›å»ºã€é”€æ¯ã€å¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤ç­‰åŠ¨ä½œï¼Œç„¶ååšå‡ºç›¸åº”çš„å¤„ç†ã€‚</p><h2 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h2><ul><li>è¿‡æ»¤æ•æ„Ÿè¯æ±‡ï¼ˆé˜²æ­¢sqlæ³¨å…¥ï¼‰</li><li>è®¾ç½®å­—ç¬¦ç¼–ç </li><li>URLçº§åˆ«çš„æƒé™è®¿é—®æ§åˆ¶</li><li>å‹ç¼©å“åº”ä¿¡æ¯</li></ul><p>è¿‡æ»¤å™¨çš„åˆ›å»ºå’Œé”€æ¯éƒ½ç”± Web æœåŠ¡å™¨è´Ÿè´£ï¼ŒWeb åº”ç”¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œåˆ›å»ºè¿‡æ»¤å™¨å¯¹è±¡ï¼Œä¸ºåç»­çš„è¯·æ±‚è¿‡æ»¤åšå¥½å‡†å¤‡ã€‚</p><p>è¿‡æ»¤å™¨å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œä¸€ä¸ªä¸ªè¿‡æ»¤å™¨ç»„åˆèµ·æ¥å°±æˆäº† FilterChainï¼Œä¹Ÿå°±æ˜¯è¿‡æ»¤å™¨é“¾ã€‚</p><p>åœ¨ Spring ä¸­ï¼Œè¿‡æ»¤å™¨éƒ½é»˜è®¤ç»§æ‰¿äº† OncePerRequestFilterï¼Œé¡¾åæ€ä¹‰ï¼ŒOncePerRequestFilter çš„ä½œç”¨å°±æ˜¯ç¡®ä¿ä¸€æ¬¡è¯·æ±‚åªé€šè¿‡ä¸€æ¬¡è¿‡æ»¤å™¨ï¼Œè€Œä¸é‡å¤æ‰§è¡Œã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-aaa1c537-c8ed-4c5d-b27f-93c1409f2748.png"></p><p>åœ¨ç¼–ç¨‹å–µå®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡ç»§æ‰¿ OncePerRequestFilter æ¥å®ç° JWT ç™»å½•æˆæƒè¿‡æ»¤çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                    HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                    FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="comment">// ä»å®¢æˆ·ç«¯è¯·æ±‚ä¸­è·å– JWT</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">authHeader</span> <span class="operator">=</span> request.getHeader(<span class="built_in">this</span>.tokenHeader);</span><br><span class="line">        <span class="comment">// è¯¥ JWT æ˜¯æˆ‘ä»¬è§„å®šçš„æ ¼å¼ï¼Œä»¥ tokenHead å¼€å¤´</span></span><br><span class="line">        <span class="keyword">if</span> (authHeader != <span class="literal">null</span> &amp;&amp; authHeader.startsWith(<span class="built_in">this</span>.tokenHead)) &#123;</span><br><span class="line">            <span class="comment">// The part after &quot;Bearer &quot;</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">authToken</span> <span class="operator">=</span> authHeader.substring(<span class="built_in">this</span>.tokenHead.length());</span><br><span class="line">            <span class="comment">// ä» JWT ä¸­è·å–ç”¨æˆ·å</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> jwtTokenUtil.getUserNameFromToken(authToken);</span><br><span class="line">            LOGGER.info(<span class="string">&quot;checking username:&#123;&#125;&quot;</span>, username);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// SecurityContextHolder æ˜¯ SpringSecurity çš„ä¸€ä¸ªå·¥å…·ç±»</span></span><br><span class="line">            <span class="comment">// ä¿å­˜åº”ç”¨ç¨‹åºä¸­å½“å‰ä½¿ç”¨äººçš„å®‰å…¨ä¸Šä¸‹æ–‡</span></span><br><span class="line">            <span class="keyword">if</span> (username != <span class="literal">null</span> &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ ¹æ®ç”¨æˆ·åè·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">                <span class="type">UserDetails</span> <span class="variable">userDetails</span> <span class="operator">=</span> <span class="built_in">this</span>.userDetailsService.loadUserByUsername(username);</span><br><span class="line">                <span class="comment">// éªŒè¯ token æ˜¯å¦è¿‡æœŸ</span></span><br><span class="line">                <span class="keyword">if</span> (jwtTokenUtil.validateToken(authToken, userDetails)) &#123;</span><br><span class="line">                    <span class="comment">// å°†ç™»å½•ç”¨æˆ·ä¿å­˜åˆ°å®‰å…¨ä¸Šä¸‹æ–‡ä¸­</span></span><br><span class="line">                    <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authentication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(userDetails,</span><br><span class="line">                            <span class="literal">null</span>, userDetails.getAuthorities());</span><br><span class="line">                    authentication.setDetails(<span class="keyword">new</span> <span class="title class_">WebAuthenticationDetailsSource</span>().buildDetails(request));</span><br><span class="line">                    SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ©ç”¨ Spring Initializr æ¥æ–°å»ºä¸€ä¸ª Web é¡¹ç›® codingmore-filter-interceptor-listenerã€‚</p><p>æ·»åŠ ä¸€ä¸ªè¿‡æ»¤å™¨ MyFilter ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;, filterName = &quot;myFilter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.init(filterConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        chain.doFilter(request,response);</span><br><span class="line">        System.out.println(<span class="string">&quot;Execute cost=&quot;</span>+(System.currentTimeMillis()-start));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Filter.<span class="built_in">super</span>.destroy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@WebFilter æ³¨è§£ç”¨äºå°†ä¸€ä¸ªç±»å£°æ˜ä¸ºè¿‡æ»¤å™¨ï¼ŒurlPatterns å±æ€§ç”¨æ¥æŒ‡å®šè¿‡æ»¤å™¨çš„ URL åŒ¹é…æ¨¡å¼ï¼ŒfilterName ç”¨æ¥å®šä¹‰è¿‡æ»¤å™¨çš„åå­—ã€‚</p><p>MyFilter è¿‡æ»¤å™¨çš„é€»è¾‘éå¸¸ç®€å•ï¼Œé‡å†™äº† Filter çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œåœ¨ doFilter æ–¹æ³•ä¸­åŠ å…¥äº†æ—¶é—´æˆ³çš„è®°å½•ã€‚</p><p>ç„¶åæˆ‘ä»¬åœ¨é¡¹ç›®å…¥å£ç±»ä¸ŠåŠ ä¸Š @ServletComponentScan æ³¨è§£ï¼Œè¿™æ ·è¿‡æ»¤å™¨å°±ä¼šè‡ªåŠ¨æ³¨å†Œã€‚</p><p>å¯åŠ¨æœåŠ¡å™¨ï¼Œè®¿é—®ä»»æ„çš„ URLã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-c865b6d2-30d3-435b-a930-c732caed17ce.png"></p><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><ul><li>ç™»å½•éªŒè¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•</li><li>æƒé™éªŒè¯ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®èµ„æºï¼Œå¦‚æ ¡éªŒtoken</li><li>æ—¥å¿—è®°å½•ï¼Œè®°å½•è¯·æ±‚æ“ä½œæ—¥å¿—ï¼ˆç”¨æˆ·ipï¼Œè®¿é—®æ—¶é—´ç­‰ï¼‰ï¼Œä»¥ä¾¿ç»Ÿè®¡è¯·æ±‚è®¿é—®é‡</li><li>å¤„ç†cookieã€æœ¬åœ°åŒ–ã€å›½é™…åŒ–ã€ä¸»é¢˜ç­‰</li><li>æ€§èƒ½ç›‘æ§ï¼Œç›‘æ§è¯·æ±‚å¤„ç†æ—¶é•¿ç­‰</li></ul><p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç®€å•çš„æ‹¦æˆªå™¨ LoggerInterceptorï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;preHandle&#123;&#125;...&quot;</span>,request.getRequestURI());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HandlerInterceptor.<span class="built_in">super</span>.postHandle(request, response, handler, modelAndView);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HandlerInterceptor.<span class="built_in">super</span>.afterCompletion(request, response, handler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªæ‹¦æˆªå™¨å¿…é¡»å®ç° HandlerInterceptor æ¥å£ï¼ŒpreHandle æ–¹æ³•æ˜¯ Controller æ–¹æ³•è°ƒç”¨å‰æ‰§è¡Œï¼ŒpostHandle  æ˜¯ Controller æ–¹æ³•æ­£å¸¸è¿”å›åæ‰§è¡Œï¼ŒafterCompletion æ–¹æ³•æ— è®º Controller æ–¹æ³•æ˜¯å¦æŠ›å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œã€‚</p><p>åªæœ‰ preHandle è¿”å› true çš„è¯ï¼Œå…¶ä»–ä¸¤ä¸ªæ–¹æ³•æ‰ä¼šæ‰§è¡Œã€‚</p><p>å¦‚æœ preHandle è¿”å› false çš„è¯ï¼Œè¡¨ç¤ºä¸éœ€è¦è°ƒç”¨Controlleræ–¹æ³•ç»§ç»­å¤„ç†äº†ï¼Œé€šå¸¸åœ¨è®¤è¯æˆ–è€…å®‰å…¨æ£€æŸ¥å¤±è´¥æ—¶ç›´æ¥è¿”å›é”™è¯¯å“åº”ã€‚</p><p>å†æ¥ä¸€ä¸ª InterceptorConfig å¯¹æ‹¦æˆªå™¨è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoggerInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Configuration æ³¨è§£ç”¨äºå®šä¹‰é…ç½®ç±»ï¼Œå¹²æ‰äº†ä»¥å¾€ Spring ç¹ççš„ xml é…ç½®æ–‡ä»¶ã€‚</p><p>ç¼–å†™ä¸€ä¸ªç”¨äºè¢«æ‹¦æˆªçš„æ§åˆ¶å™¨ MyInterceptorControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/myinterceptor&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptorController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç«é”…æ˜¯å‚»X&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@RestController æ³¨è§£ç›¸å½“äº @Controller + @ResponseBody æ³¨è§£ï¼Œ@ResponseBody æ³¨è§£ç”¨äºå°† Controller æ–¹æ³•è¿”å›çš„å¯¹è±¡ï¼Œé€šè¿‡é€‚å½“çš„ HttpMessageConverter è½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼åï¼Œå†™å…¥åˆ° Response å¯¹è±¡çš„ body æ•°æ®åŒºï¼Œé€šå¸¸ç”¨æ¥è¿”å› JSON æˆ–è€… XML æ•°æ®ï¼Œè¿”å› JSON æ•°æ®çš„æƒ…å†µæ¯”è¾ƒå¤šã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-27c3f03f-8cca-4cbe-84cb-005075c0b8c9.png"></p><p>å¯åŠ¨æœåŠ¡å™¨ï¼Œè®¿é—® <code>http://localhost:8080/myinterceptor/hello</code>ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-dcd99eeb-c00e-4a7a-a1c2-f8c5ca952aed.png"></p><p>åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ‹¦æˆªå™¨ä¸­çš„æ—¥å¿—ä¿¡æ¯ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-20bb0987-77c8-4069-a59f-bbd2d5584d8c.png"></p><p>æ— è®ºæ˜¯è¿‡æ»¤å™¨è¿˜æ˜¯æ‹¦æˆªå™¨ï¼Œéƒ½å±äºAOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰æ€æƒ³çš„å…·ä½“å®ç°ã€‚é™¤äº†è¿™ä¸¤ç§å®ç°ä¹‹å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§æ›´çµæ´»çš„AOPå®ç°æŠ€æœ¯ï¼Œå³ Aspectï¼Œåœ¨ç¼–ç¨‹å–µå®æˆ˜é¡¹ç›®é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ° Aspect å…·ä½“å®ç°ã€‚</p><p>æ¯”å¦‚è¯´ç»Ÿä¸€æ—¥å¿—åˆ‡é¢ WebLogAspectï¼Œå°±æ˜¯ç”¨æ¥è®°å½•è¯·æ±‚ä¿¡æ¯çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebLogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(WebLogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.codingmore.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">webLog</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;webLog()&quot;, returning = &quot;ret&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterReturning</span><span class="params">(Object ret)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;webLog()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//è·å–å½“å‰è¯·æ±‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        webLog.setStartTime(startTime);</span><br><span class="line">        webLog.setUri(request.getRequestURI());</span><br><span class="line">        logMap.put(<span class="string">&quot;parameter&quot;</span>,webLog.getParameter());</span><br><span class="line">        logMap.put(<span class="string">&quot;spendTime&quot;</span>,webLog.getSpendTime());</span><br><span class="line">        logMap.put(<span class="string">&quot;description&quot;</span>,webLog.getDescription());</span><br><span class="line">        LOGGER.info(<span class="string">&quot;&#123;&#125;&quot;</span>, JSONUtil.parse(webLog));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ–¹æ³•å’Œä¼ å…¥çš„å‚æ•°è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">getParameter</span><span class="params">(Method method, Object[] args)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ‹¦æˆªåçš„è¯·æ±‚ä¿¡æ¯å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/springboot/Filter-Interceptor-Listener-7a4b219d-bd3e-435e-a2dc-93f4fe4e8cc2.png"></p>]]></content>
      
      
      <categories>
          
          <category> Javaä¼ä¸šçº§å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸ç”¨Javaå·¥å…·ç±»ï¼šIPUtilã€CollectionUtilsã€MDCã€ClassUtilsã€BeanUtilsã€ReflectionUtils</title>
      <link href="/article/112220.html"/>
      <url>/article/112220.html</url>
      
        <content type="html"><![CDATA[<h1 id="å¸¸ç”¨å·¥å…·ç±»"><a href="#å¸¸ç”¨å·¥å…·ç±»" class="headerlink" title="å¸¸ç”¨å·¥å…·ç±»"></a>å¸¸ç”¨å·¥å…·ç±»</h1><p>é™¤äº†æˆ‘ä»¬å‰é¢æåˆ°çš„ Java åŸç”Ÿå·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ <a href="https://javabetter.cn/common-tool/arrays.html">Arrays</a>ã€<a href="https://javabetter.cn/common-tool/Objects.html">Objects</a>ã€<a href="https://javabetter.cn/common-tool/collections.html">Collections</a>ã€<a href="https://javabetter.cn/common-tool/scanner.html">Scanner</a> ç­‰ï¼Œè¿˜æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„å·¥å…·ç±»ï¼Œæ¯”å¦‚è¯´ <a href="https://javabetter.cn/common-tool/hutool.html">Hutool</a>ã€<a href="https://javabetter.cn/common-tool/guava.html">Guava</a> ç­‰ï¼Œä»¥åŠæˆ‘ä»¬ä»Šå¤©ä»‹ç»çš„ IpUtilã€CollectionUtilsã€StringUtilsã€MDCã€ClassUtilsã€BeanUtilsã€ReflectionUtils ç­‰ç­‰ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šèƒ½å¤Ÿæé«˜æˆ‘ä»¬çš„ç”Ÿäº§æ•ˆç‡ã€‚</p><p>å½“ç„¶äº†ï¼Œå¦‚æœèƒ½å¥½å¥½çœ‹ä¸€ä¸‹å®ƒä»¬çš„æºç ï¼Œå¯¹æŠ€æœ¯åŠŸåº•çš„æå‡ï¼Œä¹Ÿæ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚</p><h3 id="IpUtilï¼šè·å–æœ¬æœº-Ip"><a href="#IpUtilï¼šè·å–æœ¬æœº-Ip" class="headerlink" title="IpUtilï¼šè·å–æœ¬æœº Ip"></a>IpUtilï¼šè·å–æœ¬æœº Ip</h3><p>è·å–æœ¬æœº IP ç®—æ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªéœ€æ±‚åœºæ™¯äº†ï¼Œæ¯”å¦‚ä¸šåŠ¡æŠ¥è­¦ï¼Œå¯èƒ½å°±ä¼šå¸¦ä¸Šå‡ºé—®é¢˜çš„æœºå™¨ IPï¼Œæ–¹ä¾¿ç›´æ¥ä¸Šå»çœ‹æ—¥å¿—å®šä½é—®é¢˜ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•è·å–æœºå™¨ IP å‘¢ï¼Ÿ</p><h4 id="åŸºæœ¬æ–¹æ³•"><a href="#åŸºæœ¬æ–¹æ³•" class="headerlink" title="åŸºæœ¬æ–¹æ³•"></a>åŸºæœ¬æ–¹æ³•</h4><p>å¦‚ä½•è·å–æœºå™¨ IPï¼Ÿå¦‚æœäº†è§£ InetAddress è¿™ä¸ªå·¥å…·ç±»ï¼Œå°±å¾ˆå®¹æ˜“å†™å‡ºä¸€ä¸ªç®€å•çš„å·¥å…·ç±»ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLocalIP</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å®ç°æœ‰é—®é¢˜ä¹ˆï¼Ÿ</p><p>å½“ç„¶æ²¡é—®é¢˜ï¼Œæ‹¿æˆ‘æœ¬æœºå’Œé˜¿é‡ŒæœåŠ¡å™¨æ‰§è¡Œä¸€ä¸‹ï¼Œå¹¶æ²¡æœ‰é—®é¢˜å¦‚å®çš„è¾“å‡ºäº†é¢„æœŸçš„ IP</p><p>æœ¬æœºæ‰§è¡Œåæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/utils-20230330093633.png"></p><p>é˜¿é‡Œäº‘æœºå™¨æ‰§è¡Œåæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/utils-20230330095801.png"></p><h4 id="è¿›é˜¶ç‰ˆ"><a href="#è¿›é˜¶ç‰ˆ" class="headerlink" title="è¿›é˜¶ç‰ˆ"></a>è¿›é˜¶ç‰ˆ</h4><p>åšä¸€ç‚¹ç®€å•çš„æ”¹åŠ¨ï¼Œè·å– IPV4 çš„åœ°å€ï¼Œæºç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLocalIpByNetcard</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æšä¸¾æ‰€æœ‰çš„ç½‘ç»œæ¥å£</span></span><br><span class="line">        <span class="keyword">for</span> (Enumeration&lt;NetworkInterface&gt; e = NetworkInterface.getNetworkInterfaces(); e.hasMoreElements(); ) &#123;</span><br><span class="line">            <span class="comment">// è·å–å½“å‰ç½‘ç»œæ¥å£</span></span><br><span class="line">            <span class="type">NetworkInterface</span> <span class="variable">item</span> <span class="operator">=</span> e.nextElement();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// éå†å½“å‰ç½‘ç»œæ¥å£çš„æ‰€æœ‰åœ°å€</span></span><br><span class="line">            <span class="keyword">for</span> (InterfaceAddress address : item.getInterfaceAddresses()) &#123;</span><br><span class="line">                <span class="comment">// å¿½ç•¥å›ç¯åœ°å€å’Œæœªå¯ç”¨çš„ç½‘ç»œæ¥å£</span></span><br><span class="line">                <span class="keyword">if</span> (item.isLoopback() || !item.isUp()) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰åœ°å€æ˜¯ IPv4 åœ°å€ï¼Œåˆ™è¿”å›å…¶å­—ç¬¦ä¸²è¡¨ç¤º</span></span><br><span class="line">                <span class="keyword">if</span> (address.getAddress() <span class="keyword">instanceof</span> Inet4Address) &#123;</span><br><span class="line">                    <span class="type">Inet4Address</span> <span class="variable">inet4Address</span> <span class="operator">=</span> (Inet4Address) address.getAddress();</span><br><span class="line">                    <span class="keyword">return</span> inet4Address.getHostAddress();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½• IPv4 åœ°å€ï¼Œåˆ™è¿”å›æœ¬åœ°ä¸»æœºåœ°å€</span></span><br><span class="line">        <span class="keyword">return</span> InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SocketException | UnknownHostException e) &#123;</span><br><span class="line">        <span class="comment">// æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ®µä»£ç åªè¿”å›æœ¬æœºçš„ IPv4 åœ°å€ï¼Œå¹¶ä¸”åªè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„åœ°å€ã€‚å¦‚æœæœ¬æœºæœ‰å¤šä¸ªç½‘ç»œæ¥å£æˆ–è€…æ¯ä¸ªæ¥å£æœ‰å¤šä¸ªåœ°å€ï¼Œåˆ™å¯èƒ½æ— æ³•è¿”å›é¢„æœŸçš„åœ°å€ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä»»ä½• IPv4 åœ°å€ï¼Œåˆ™ä¼šè¿”å›æœ¬åœ°ä¸»æœºåœ°å€ã€‚</p><p>å†æ¬¡æµ‹è¯•ï¼Œè¾“å‡ºå¦‚ä¸‹</p><p><img src="https://cdn.tobebetterjavaer.com/stutymore/utils-20230330100334.png"></p><h4 id="å®Œæ•´å·¥å…·ç±»"><a href="#å®Œæ•´å·¥å…·ç±»" class="headerlink" title="å®Œæ•´å·¥å…·ç±»"></a>å®Œæ•´å·¥å…·ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IPUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_IP</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›´æ¥æ ¹æ®ç¬¬ä¸€ä¸ªç½‘å¡åœ°å€ä½œä¸ºå…¶å†…ç½‘ipv4åœ°å€ï¼Œé¿å…è¿”å› 127.0.0.1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å†…ç½‘ IPv4 åœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLocalIpByNetcard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æšä¸¾æ‰€æœ‰çš„ç½‘ç»œæ¥å£</span></span><br><span class="line">            <span class="keyword">for</span> (Enumeration&lt;NetworkInterface&gt; e = NetworkInterface.getNetworkInterfaces(); e.hasMoreElements(); ) &#123;</span><br><span class="line">                <span class="comment">// è·å–å½“å‰ç½‘ç»œæ¥å£</span></span><br><span class="line">                <span class="type">NetworkInterface</span> <span class="variable">item</span> <span class="operator">=</span> e.nextElement();</span><br><span class="line">                <span class="comment">// éå†å½“å‰ç½‘ç»œæ¥å£çš„æ‰€æœ‰åœ°å€</span></span><br><span class="line">                <span class="keyword">for</span> (InterfaceAddress address : item.getInterfaceAddresses()) &#123;</span><br><span class="line">                    <span class="comment">// å¿½ç•¥å›ç¯åœ°å€å’Œæœªå¯ç”¨çš„ç½‘ç»œæ¥å£</span></span><br><span class="line">                    <span class="keyword">if</span> (item.isLoopback() || !item.isUp()) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// å¦‚æœå½“å‰åœ°å€æ˜¯ IPv4 åœ°å€ï¼Œåˆ™è¿”å›å…¶å­—ç¬¦ä¸²è¡¨ç¤º</span></span><br><span class="line">                    <span class="keyword">if</span> (address.getAddress() <span class="keyword">instanceof</span> Inet4Address) &#123;</span><br><span class="line">                        <span class="type">Inet4Address</span> <span class="variable">inet4Address</span> <span class="operator">=</span> (Inet4Address) address.getAddress();</span><br><span class="line">                        <span class="keyword">return</span> inet4Address.getHostAddress();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åœ°å€ï¼Œåˆ™è¿”å›æœ¬åœ°ä¸»æœºåœ°å€</span></span><br><span class="line">            <span class="keyword">return</span> InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SocketException | UnknownHostException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æœ¬åœ°ä¸»æœºåœ°å€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æœ¬åœ°ä¸»æœºåœ°å€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getLocalIP</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> InetAddress.getLocalHost().getHostAddress();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IPUtil ç±»ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ <code>getLocalIpByNetcard()</code> å’Œ <code>getLocalIP()</code>ã€‚å‰è€…æ˜¯è·å–æœ¬æœºçš„å†…ç½‘ IPv4 åœ°å€ï¼Œé¿å…äº†è¿”å› 127.0.0.1 çš„é—®é¢˜ã€‚åè€…æ˜¯è·å–æœ¬åœ°ä¸»æœºåœ°å€ï¼Œå¦‚æœæœ¬æœºæœ‰å¤šä¸ª IP åœ°å€ï¼Œåˆ™å¯èƒ½è¿”å›å…¶ä¸­çš„ä»»æ„ä¸€ä¸ªã€‚</p><h3 id="MDCï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å‚æ•°ä¼ é€’å·¥å…·ç±»"><a href="#MDCï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å‚æ•°ä¼ é€’å·¥å…·ç±»" class="headerlink" title="MDCï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å‚æ•°ä¼ é€’å·¥å…·ç±»"></a>MDCï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å‚æ•°ä¼ é€’å·¥å…·ç±»</h3><p><code>MDC</code> æ˜¯ <a href="https://javabetter.cn/gongju/slf4j.html"><code>org.slf4j</code></a> åŒ…ä¸‹çš„ä¸€ä¸ªç±»ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Mapped Diagnostic Contextï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å­˜æ”¾è¯Šæ–­æ—¥å¿—çš„å®¹å™¨ã€‚</p><p>MDC çš„åº•å±‚æ˜¯ç”¨äº† <a href="https://javabetter.cn/thread/ThreadLocal.html"><code>ThreadLocal</code></a> æ¥ä¿å­˜æ•°æ®çš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨å®ƒä¼ é€’å‚æ•°ã€‚</p><p>ä¾‹å¦‚ç°åœ¨æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šæˆ‘ä»¬ä½¿ç”¨<code>RestTemplate</code>è°ƒç”¨è¿œç¨‹æ¥å£æ—¶ï¼Œæœ‰æ—¶éœ€è¦åœ¨<code>header</code>ä¸­ä¼ é€’ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼štraceIdï¼Œsource ç­‰ï¼Œä¾¿äºåœ¨æŸ¥è¯¢æ—¥å¿—æ—¶èƒ½å¤Ÿä¸²è”ä¸€æ¬¡å®Œæ•´çš„è¯·æ±‚é“¾è·¯ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚</p><p>è¿™ç§ä¸šåŠ¡åœºæ™¯å°±èƒ½é€šè¿‡<code>ClientHttpRequestInterceptor</code>æ¥å£å®ç°ï¼Œå…·ä½“åšæ³•å¦‚ä¸‹ï¼š</p><p>ç¬¬ä¸€æ­¥ï¼Œå®šä¹‰ä¸€ä¸ª LogFilter æ‹¦æˆªæ‰€æœ‰æ¥å£è¯·æ±‚ï¼Œåœ¨ MDC ä¸­è®¾ç½® traceIdï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        MdcUtil.add(UUID.randomUUID().toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;è®°å½•è¯·æ±‚æ—¥å¿—&quot;</span>);</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        System.out.println(<span class="string">&quot;è®°å½•å“åº”æ—¥å¿—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œå®ç°<code>ClientHttpRequestInterceptor</code>æ¥å£ï¼ŒMDC ä¸­è·å–å½“å‰è¯·æ±‚çš„ traceIdï¼Œç„¶åè®¾ç½®åˆ° header ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ClientHttpRequestInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ClientHttpResponse <span class="title function_">intercept</span><span class="params">(HttpRequest request, <span class="type">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        request.getHeaders().set(<span class="string">&quot;traceId&quot;</span>, MdcUtil.get());</span><br><span class="line">        <span class="keyword">return</span> execution.execute(request, body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œå®šä¹‰é…ç½®ç±»ï¼Œé…ç½®ä¸Šé¢å®šä¹‰çš„<code>RestTemplateInterceptor</code>ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">        restTemplate.setInterceptors(Collections.singletonList(restTemplateInterceptor()));</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplateInterceptor <span class="title function_">restTemplateInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplateInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ MdcUtil å…¶å®æ˜¯åˆ©ç”¨ MDC å·¥å…·åœ¨ ThreadLocal ä¸­å­˜å‚¨å’Œè·å– traceId</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MdcUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TRACE_ID</span> <span class="operator">=</span> <span class="string">&quot;TRACE_ID&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MDC.get(TRACE_ID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        MDC.put(TRACE_ID, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™ä¸ªä¾‹å­ä¸­æ²¡æœ‰æ¼”ç¤º MdcUtil ç±»çš„ add æ–¹æ³•å…·ä½“è°ƒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ filter ä¸­æ‰§è¡Œæ¥å£æ–¹æ³•ä¹‹å‰ï¼Œç”Ÿæˆ traceIdï¼Œè°ƒç”¨ MdcUtil ç±»çš„ add æ–¹æ³•æ·»åŠ åˆ° MDC ä¸­ï¼Œç„¶ååœ¨åŒä¸€ä¸ªè¯·æ±‚çš„å…¶ä»–åœ°æ–¹å°±èƒ½é€šè¿‡ MdcUtil ç±»çš„ get æ–¹æ³•è·å–åˆ°è¯¥ traceIdã€‚</p><p>èƒ½ä½¿ç”¨ MDC ä¿å­˜ traceId ç­‰å‚æ•°çš„æ ¹æœ¬åŸå› æ˜¯ï¼Œç”¨æˆ·è¯·æ±‚åˆ°åº”ç”¨æœåŠ¡å™¨ï¼ŒTomcat ä¼šä»çº¿ç¨‹æ± ä¸­åˆ†é…ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†è¯¥è¯·æ±‚ã€‚</p><p>é‚£ä¹ˆè¯¥è¯·æ±‚çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¿å­˜åˆ° MDC çš„ ThreadLocal ä¸­çš„å‚æ•°ï¼Œä¹Ÿæ˜¯è¯¥çº¿ç¨‹ç‹¬äº«çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h3 id="ClassUtils"><a href="#ClassUtils" class="headerlink" title="ClassUtils"></a>ClassUtils</h3><p>spring çš„<code>org.springframework.util</code>åŒ…ä¸‹çš„<code>ClassUtils</code>ç±»ï¼Œå®ƒé‡Œé¢æœ‰å¾ˆå¤šè®©æˆ‘ä»¬æƒŠå–œçš„åŠŸèƒ½ã€‚</p><p>å®ƒé‡Œé¢åŒ…å«äº†ç±»å’Œå¯¹è±¡ç›¸å…³çš„å¾ˆå¤šéå¸¸å®ç”¨çš„æ–¹æ³•ã€‚</p><h4 id="è·å–å¯¹è±¡çš„æ‰€æœ‰æ¥å£"><a href="#è·å–å¯¹è±¡çš„æ‰€æœ‰æ¥å£" class="headerlink" title="è·å–å¯¹è±¡çš„æ‰€æœ‰æ¥å£"></a>è·å–å¯¹è±¡çš„æ‰€æœ‰æ¥å£</h4><p>å¦‚æœä½ æƒ³è·å–æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„<code>getAllInterfaces</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt;[] allInterfaces = ClassUtils.getAllInterfaces(<span class="keyword">new</span> <span class="title class_">User</span>());</span><br></pre></td></tr></table></figure><h4 id="è·å–æŸä¸ªç±»çš„åŒ…å"><a href="#è·å–æŸä¸ªç±»çš„åŒ…å" class="headerlink" title="è·å–æŸä¸ªç±»çš„åŒ…å"></a>è·å–æŸä¸ªç±»çš„åŒ…å</h4><p>å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„åŒ…åï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„<code>getPackageName</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String packageName = ClassUtils.getPackageName(User.class);</span><br><span class="line">System.out.println(packageName);</span><br></pre></td></tr></table></figure><h4 id="åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»"><a href="#åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»" class="headerlink" title="åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»"></a>åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»</h4><p>å¦‚æœä½ æƒ³åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦å†…éƒ¨ç±»ï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„<code>isInnerClass</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(ClassUtils.isInnerClass(User.class));</span><br></pre></td></tr></table></figure><h4 id="åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡"><a href="#åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡" class="headerlink" title="åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡"></a>åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡</h4><p>å¦‚æœä½ æƒ³åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ ClassUtils çš„<code>isCglibProxy</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(ClassUtils.isCglibProxy(new User()));</span><br></pre></td></tr></table></figure><p>ClassUtils è¿˜æœ‰å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œç­‰å¾…ç€ä½ å»å‘æ˜ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢çš„å†…å®¹ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-c58920ac-cf04-4d95-ad29-90339a086569.jpg"></p><h3 id="BeanUtils"><a href="#BeanUtils" class="headerlink" title="BeanUtils"></a>BeanUtils</h3><p>Spring ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<code>JavaBean</code>çš„å·¥å…·ç±»ï¼Œå®ƒåœ¨<code>org.springframework.beans</code>åŒ…ä¸‹é¢ï¼Œå®ƒçš„åå­—å«åšï¼š<code>BeanUtils</code>ã€‚</p><p>è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹è¿™ä¸ªå·¥å…·å¯ä»¥å¸¦ç»™æˆ‘ä»¬å“ªäº›æƒŠå–œã€‚</p><h4 id="æ‹·è´å¯¹è±¡çš„å±æ€§"><a href="#æ‹·è´å¯¹è±¡çš„å±æ€§" class="headerlink" title="æ‹·è´å¯¹è±¡çš„å±æ€§"></a>æ‹·è´å¯¹è±¡çš„å±æ€§</h4><p>æ›¾å‡ ä½•æ—¶ï¼Œä½ æœ‰æ²¡æœ‰è¿™æ ·çš„éœ€æ±‚ï¼šæŠŠæŸä¸ªå¯¹è±¡ä¸­çš„æ‰€æœ‰å±æ€§ï¼Œéƒ½æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚è¿™æ—¶å°±èƒ½ä½¿ç”¨ BeanUtils çš„<code>copyProperties</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User user1 = new User();</span><br><span class="line">user1.setId(1L);</span><br><span class="line">user1.setName(&quot;é©¬æ–¯å…‹&quot;);</span><br><span class="line">user1.setAddress(&quot;ä¸­å›½&quot;);</span><br><span class="line"></span><br><span class="line">User user2 = new User();</span><br><span class="line">BeanUtils.copyProperties(user1, user2);</span><br><span class="line">System.out.println(user2);</span><br></pre></td></tr></table></figure><h4 id="å®ä¾‹åŒ–æŸä¸ªç±»"><a href="#å®ä¾‹åŒ–æŸä¸ªç±»" class="headerlink" title="å®ä¾‹åŒ–æŸä¸ªç±»"></a>å®ä¾‹åŒ–æŸä¸ªç±»</h4><p>å¦‚æœä½ æƒ³é€šè¿‡åå°„å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ BeanUtils çš„<code>instantiateClass</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> BeanUtils.instantiateClass(User.class);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure><h4 id="è·å–æŒ‡å®šç±»çš„æŒ‡å®šæ–¹æ³•"><a href="#è·å–æŒ‡å®šç±»çš„æŒ‡å®šæ–¹æ³•" class="headerlink" title="è·å–æŒ‡å®šç±»çš„æŒ‡å®šæ–¹æ³•"></a>è·å–æŒ‡å®šç±»çš„æŒ‡å®šæ–¹æ³•</h4><p>å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„æŒ‡å®šæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ BeanUtils çš„<code>findDeclaredMethod</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Method declaredMethod = BeanUtils.findDeclaredMethod(User.class, &quot;getId&quot;);</span><br><span class="line">System.out.println(declaredMethod.getName());</span><br></pre></td></tr></table></figure><h4 id="è·å–æŒ‡å®šæ–¹æ³•çš„å‚æ•°"><a href="#è·å–æŒ‡å®šæ–¹æ³•çš„å‚æ•°" class="headerlink" title="è·å–æŒ‡å®šæ–¹æ³•çš„å‚æ•°"></a>è·å–æŒ‡å®šæ–¹æ³•çš„å‚æ•°</h4><p>å¦‚æœä½ æƒ³è·å–æŸä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ BeanUtils çš„<code>findPropertyForMethod</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Method declaredMethod = BeanUtils.findDeclaredMethod(User.class, &quot;getId&quot;);</span><br><span class="line">PropertyDescriptor propertyForMethod = BeanUtils.findPropertyForMethod(declaredMethod);</span><br><span class="line">System.out.println(propertyForMethod.getName());</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ å¯¹ BeanUtils æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢å†…å®¹ï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-629ecd75-259b-46aa-b1dd-82606cfc92ee.jpg"></p><h3 id="ReflectionUtils"><a href="#ReflectionUtils" class="headerlink" title="ReflectionUtils"></a>ReflectionUtils</h3><p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨<code>åå°„</code>åŠŸèƒ½ï¼Œå¦‚æœä½¿ç”¨æœ€åŸå§‹çš„æ–¹æ³•æ¥å¼€å‘ï¼Œä»£ç é‡ä¼šéå¸¸å¤šï¼Œè€Œä¸”å¾ˆéº»çƒ¦ï¼Œå®ƒéœ€è¦å¤„ç†ä¸€å¤§å †å¼‚å¸¸ä»¥åŠè®¿é—®æƒé™ç­‰é—®é¢˜ã€‚</p><p>å¥½æ¶ˆæ¯æ˜¯ Spring ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<code>ReflectionUtils</code>å·¥å…·ï¼Œå®ƒåœ¨<code>org.springframework.util</code>åŒ…ä¸‹é¢ã€‚</p><h4 id="è·å–æ–¹æ³•"><a href="#è·å–æ–¹æ³•" class="headerlink" title="è·å–æ–¹æ³•"></a>è·å–æ–¹æ³•</h4><p>å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„<code>findMethod</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(User.class, <span class="string">&quot;getId&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="è·å–å­—æ®µ"><a href="#è·å–å­—æ®µ" class="headerlink" title="è·å–å­—æ®µ"></a>è·å–å­—æ®µ</h4><p>å¦‚æœä½ æƒ³è·å–æŸä¸ªç±»çš„æŸä¸ªå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„<code>findField</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> ReflectionUtils.findField(User.class, <span class="string">&quot;id&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œæ–¹æ³•"><a href="#æ‰§è¡Œæ–¹æ³•" class="headerlink" title="æ‰§è¡Œæ–¹æ³•"></a>æ‰§è¡Œæ–¹æ³•</h4><p>å¦‚æœä½ æƒ³é€šè¿‡åå°„è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œä¼ é€’å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„<code>invokeMethod</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReflectionUtils.invokeMethod(method, springContextsUtil.getBean(beanName), param);</span><br></pre></td></tr></table></figure><h4 id="åˆ¤æ–­å­—æ®µæ˜¯å¦å¸¸é‡"><a href="#åˆ¤æ–­å­—æ®µæ˜¯å¦å¸¸é‡" class="headerlink" title="åˆ¤æ–­å­—æ®µæ˜¯å¦å¸¸é‡"></a>åˆ¤æ–­å­—æ®µæ˜¯å¦å¸¸é‡</h4><p>å¦‚æœä½ æƒ³åˆ¤æ–­æŸä¸ªå­—æ®µæ˜¯å¦å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„<code>isPublicStaticFinal</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Field field = ReflectionUtils.findField(User.class, &quot;id&quot;);</span><br><span class="line">System.out.println(ReflectionUtils.isPublicStaticFinal(field));</span><br></pre></td></tr></table></figure><h4 id="åˆ¤æ–­æ˜¯å¦-equals-æ–¹æ³•"><a href="#åˆ¤æ–­æ˜¯å¦-equals-æ–¹æ³•" class="headerlink" title="åˆ¤æ–­æ˜¯å¦ equals æ–¹æ³•"></a>åˆ¤æ–­æ˜¯å¦ equals æ–¹æ³•</h4><p>å¦‚æœä½ æƒ³åˆ¤æ–­æŸä¸ªæ–¹æ³•æ˜¯å¦ equals æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ ReflectionUtils ç±»çš„<code>isEqualsMethod</code>æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Method method = ReflectionUtils.findMethod(User.class, &quot;getId&quot;);</span><br><span class="line">System.out.println(ReflectionUtils.isEqualsMethod(method));</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaæ ¸å¿ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…·ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>eså…¥é—¨çŸ¥è¯†</title>
      <link href="/article/112211.html"/>
      <url>/article/112211.html</url>
      
        <content type="html"><![CDATA[<h3 id="Elasticsearch-æ˜¯ä»€ä¹ˆ"><a href="#Elasticsearch-æ˜¯ä»€ä¹ˆ" class="headerlink" title="Elasticsearch æ˜¯ä»€ä¹ˆ"></a>Elasticsearch æ˜¯ä»€ä¹ˆ</h3><blockquote><p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€RESTful é£æ ¼çš„æœç´¢å’Œæ•°æ®åˆ†æå¼•æ“ï¼Œèƒ½å¤Ÿè§£å†³ä¸æ–­æ¶Œç°å‡ºçš„å„ç§ç”¨ä¾‹ã€‚ ä½œä¸º Elastic Stack çš„æ ¸å¿ƒï¼Œå®ƒé›†ä¸­å­˜å‚¨æ‚¨çš„æ•°æ®ï¼Œå¸®åŠ©æ‚¨å‘ç°æ„æ–™ä¹‹ä¸­ä»¥åŠæ„æ–™ä¹‹å¤–çš„æƒ…å†µã€‚</p></blockquote><p>ä»¥ä¸Šå¼•ç”¨æ¥è‡ªäºå®˜æ–¹ï¼Œä¸å¾—ä¸è¯´ï¼Œè§£é‡Šå¾—è›®æ–‡è‰ºçš„ã€‚æ„æ–™ä¹‹ä¸­å’Œæ„æ–™ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªè¯è®©æˆ‘æƒ³èµ·æ¥äº†æŸä¸€å¹´çš„é«˜è€ƒä½œæ–‡é¢˜ï¼ˆæƒ…ç†ä¹‹ä¸­å’Œæ„æ–™ä¹‹å¤–ï¼‰ã€‚</p><p>Elastic Stack åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ•´ä¸ªæ¶æ„å›¾å¦‚ä¸‹å›¾ï¼ˆæ¥æºäºç½‘ç»œï¼Œä¾µåˆ ï¼‰æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-04b04318-25c9-4eb5-895e-9c608a4b26f9.jpg"></p><p>ä¿¡æ¯é‡æ¯”è¾ƒå¤šï¼Œå¯¹å§ï¼Ÿé‚£å°±è®°ä½ä¸€å¥è¯å§ï¼ŒElasticsearch æ˜¯ Elastic Stack çš„æ ¸å¿ƒã€‚</p><p>å›½å†…å¤–çš„å¾ˆå¤šçŸ¥åå…¬å¸éƒ½åœ¨ç”¨ Elasticsearchï¼Œæ¯”å¦‚è¯´æ»´æ»´ã€ä»Šæ—¥å¤´æ¡ã€è°·æ­Œã€å¾®è½¯ç­‰ç­‰ã€‚Elasticsearch æœ‰å¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´å…¨æ–‡æœç´¢ã€è´­ç‰©æ¨èã€é™„è¿‘å®šä½æ¨èç­‰ç­‰ã€‚</p><p>ç†è®ºæ–¹é¢çš„å†…å®¹å°±ä¸è¯´å¤ªå¤šäº†ï¼Œæˆ‘æ€•å°ä¼™ä¼´ä»¬ä¼šæ„Ÿåˆ°æ¯ç‡¥ã€‚æ¯•ç«Ÿå…¥é—¨å˜›ï¼Œå®æˆ˜æ‰é‡è¦ã€‚</p><h3 id="å®‰è£…-Elasticsearch"><a href="#å®‰è£…-Elasticsearch" class="headerlink" title="å®‰è£… Elasticsearch"></a>å®‰è£… Elasticsearch</h3><p>Elasticsearch æ˜¯ç”± Java å¼€å‘çš„ï¼Œæ‰€ä»¥æ—©æœŸçš„ç‰ˆæœ¬éœ€è¦å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£… JDK è¿›è¡Œæ”¯æŒã€‚åæ¥çš„ç‰ˆæœ¬ä¸­å†…ç½®äº† Java ç¯å¢ƒï¼Œæ‰€ä»¥ç›´æ¥ä¸‹è½½å°±è¡Œäº†ã€‚Elasticsearch é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿæœ‰ä¸åŒçš„å®‰è£…åŒ…ï¼Œæˆ‘ä»¬è¿™ç¯‡å…¥é—¨çš„æ–‡ç« å°±ä»¥ Windows ä¸ºä¾‹å§ã€‚</p><p>ä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</p><p><a href="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p><p>æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ 7.6.2ï¼Œ280M å·¦å³ã€‚ä½†æˆ‘ç¡¬ç”Ÿç”ŸèŠ±äº† 10 åˆ†é’Ÿçš„æ—¶é—´æ‰ä¸‹è½½å®Œæ¯•ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿é€šçš„ 200M å¸¦å®½ä¸ç»™åŠ›ï¼Œè¿˜æ˜¯å®˜ç½‘æœ¬èº«ä¸‹è½½çš„é€Ÿåº¦å°±æ…¢ï¼Œåæ­£æˆ‘å»æ´—äº† 6 é¢—è‘¡è„åƒå®Œåè¿˜æ²¡ä¸‹è½½å®Œã€‚</p><p>Elasticsearch æ˜¯å…å®‰è£…çš„ï¼Œåªéœ€è¦æŠŠ zip åŒ…è§£å‹å°±å¯ä»¥äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-07da0521-74eb-4a90-b17f-59258e622609.jpg"></p><p>1ï¼‰bin ç›®å½•ä¸‹æ˜¯ä¸€äº›è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…æ‹¬ Elasticsearch çš„å¯åŠ¨æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>2ï¼‰config ç›®å½•ä¸‹æ˜¯ä¸€äº›é…ç½®æ–‡ä»¶ã€‚</p><p>3ï¼‰jdk ç›®å½•ä¸‹æ˜¯å†…ç½®çš„ Java è¿è¡Œç¯å¢ƒã€‚</p><p>4ï¼‰lib ç›®å½•ä¸‹æ˜¯ä¸€äº› Java ç±»åº“æ–‡ä»¶ã€‚</p><p>5ï¼‰logs ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€äº›æ—¥å¿—æ–‡ä»¶ã€‚</p><p>6ï¼‰modules ç›®å½•ä¸‹æ˜¯ä¸€äº› Elasticsearch çš„æ¨¡å—ã€‚</p><p>7ï¼‰plugins ç›®å½•ä¸‹å¯ä»¥æ”¾ä¸€äº› Elasticsearch çš„æ’ä»¶ã€‚</p><p>ç›´æ¥åŒå‡» bin ç›®å½•ä¸‹çš„ elasticsearch.bat æ–‡ä»¶å°±å¯ä»¥å¯åŠ¨ Elasticsearch æœåŠ¡äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-7dd19afd-1aeb-49b6-a07c-f11e139fe3d3.jpg"></p><p>è¾“å‡ºçš„æ—¥å¿—ä¿¡æ¯æœ‰ç‚¹å¤šï¼Œä¸ç”¨ç»†çœ‹ï¼Œæ³¨æ„çœ‹åˆ°æœ‰â€œstartedâ€çš„å­—æ ·å°±è¡¨æ˜å¯åŠ¨æˆåŠŸäº†ã€‚ä¸ºäº†è¿›ä¸€æ­¥ç¡®è®¤ Elasticsearch æœ‰æ²¡æœ‰å¯åŠ¨æˆåŠŸï¼Œå¯ä»¥åœ¨æµè§ˆå™¨çš„åœ°å€æ é‡Œè¾“å…¥ <code>http://localhost:9200</code> è¿›è¡ŒæŸ¥çœ‹ï¼ˆ9200 æ˜¯ Elasticsearch çš„é»˜è®¤ç«¯å£å·ï¼‰ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-51f269c2-7482-494a-8a04-6585f20176a7.jpg"></p><p>ä½ çœ‹ï¼Œä¸ºäº† Searchã€‚</p><p>é‚£å¦‚ä½•åœæ­¢æœåŠ¡å‘¢ï¼Ÿå¯ä»¥ç›´æ¥æŒ‰ä¸‹ <code>Ctrl+C</code> ç»„åˆé”®â€”â€”ç²—æš´ã€å£å’šã€‚</p><h3 id="å®‰è£…-Kibana"><a href="#å®‰è£…-Kibana" class="headerlink" title="å®‰è£… Kibana"></a>å®‰è£… Kibana</h3><p>é€šè¿‡ Kibanaï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ Elasticsearch æœåŠ¡è¿›è¡Œå¯è§†åŒ–æ“ä½œï¼Œå°±åƒåœ¨ Linux æ“ä½œç³»ç»Ÿä¸‹å®‰è£…ä¸€ä¸ªå›¾å½¢åŒ–ç•Œé¢ä¸€æ ·ã€‚</p><p>ä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</p><p><a href="https://www.elastic.co/cn/downloads/kibana">https://www.elastic.co/cn/downloads/kibana</a></p><p>æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ 7.6.2ï¼Œ284M å·¦å³ï¼Œä½“ç§¯å’Œ Elasticsearch å·®ä¸å¤šã€‚é€‰æ‹©ä¸‹è½½ Windows ç‰ˆï¼Œzip æ ¼å¼çš„ï¼Œå®Œæˆåç›´æ¥è§£å‹å°±è¡Œäº†ã€‚ä¸‹è½½çš„è¿‡ç¨‹ä¸­åˆå»æ´—äº† 6 é¢—è‘¡è„åƒï¼Œç‹—å¤´ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-12372ee6-acc0-4425-964b-ca32886f17ce.jpg"></p><p>åŒ…ç›®å½•ä¸å†ä¸€ä¸€è§£é‡Šäº†ï¼Œè¿›å…¥ bin ç›®å½•ä¸‹ï¼ŒåŒå‡»è¿è¡Œ kibana.bat æ–‡ä»¶ï¼Œå¯åŠ¨ Kibana æœåŠ¡ã€‚æ•´ä¸ªè¿‡ç¨‹æ¯” Elasticsearch è¦æ…¢ä¸€äº›ï¼Œå½“çœ‹åˆ° <code>[Kibana][http] http server running</code> çš„ä¿¡æ¯åï¼Œè¯´æ˜æœåŠ¡å¯åŠ¨æˆåŠŸäº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-784d70ef-b6e7-4312-85f1-36ace9b2a5bd.jpg"></p><p>åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>http://localhost:5601</code> æŸ¥çœ‹ Kibana çš„å›¾å½¢åŒ–ç•Œé¢ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-e6f64545-a925-4bb4-a25e-44129832fb4e.jpg"></p><p>ç”±äºå½“å‰çš„ Elasticsearch æœåŠ¡ç«¯ä¸­è¿˜æ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰æ‹©ã€ŒTry Our Sample Dataã€å¯¼å…¥ Kibana æä¾›çš„æ¨¡æ‹Ÿæ•°æ®ä½“éªŒä¸€ä¸‹ã€‚ä¸‹å›¾æ˜¯å¯¼å…¥ç”µå•†æ•°æ®åº“çš„çœ‹æ¿é¡µé¢ï¼Œæ˜¯ä¸æ˜¯å¾ˆä¸°å¯Œï¼Ÿ</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-a16d99ff-272d-43bb-aa94-23b240cc464b.jpg"></p><p>æ‰“å¼€ Dev Tools é¢æ¿ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªç®€å•çš„ DSL æŸ¥è¯¢è¯­å¥ï¼ˆä¸€ç§å®Œå…¨åŸºäº JSON çš„ç‰¹å®šäºé¢†åŸŸçš„è¯­è¨€ï¼‰ï¼Œç‚¹å‡»ã€Œè¿è¡Œã€æŒ‰é’®åå°±å¯ä»¥çœ‹åˆ° JSON æ ¼å¼çš„æ•°æ®äº†ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-5c44bd79-d3a9-49fb-9414-04dc38840cfb.jpg"></p><h3 id="Elasticsearch-çš„å…³é”®æ¦‚å¿µ"><a href="#Elasticsearch-çš„å…³é”®æ¦‚å¿µ" class="headerlink" title="Elasticsearch çš„å…³é”®æ¦‚å¿µ"></a>Elasticsearch çš„å…³é”®æ¦‚å¿µ</h3><p>åœ¨è¿›è¡Œä¸‹ä¸€æ­¥ä¹‹å‰ï¼Œéœ€è¦å…ˆæ¥ç†è§£ Elasticsearch ä¸­çš„å‡ ä¸ªå…³é”®æ¦‚å¿µï¼Œæ¯”å¦‚è¯´ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Œä»€ä¹ˆæ˜¯ç±»å‹ï¼Œä»€ä¹ˆæ˜¯æ–‡æ¡£ç­‰ç­‰ã€‚Elasticsearch æ—¢ç„¶æ˜¯ä¸€ä¸ªæ•°æ®å¼•æ“ï¼Œå®ƒé‡Œé¢çš„ä¸€äº›æ¦‚å¿µå°±å’Œ MySQL æœ‰ä¸€å®šçš„å…³ç³»ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-ad2b2f8c-5a19-4c5e-9bc7-cf7ba17830bf.jpg"></p><p>çœ‹å®Œä¸Šé¢è¿™å¹…å›¾ï¼ˆæ¥æºäºç½‘ç»œï¼Œä¾µåˆ ï¼‰ï¼Œæ˜¯ä¸æ˜¯ç¬é—´å°±æ¸…æ™°äº†ã€‚å‘ Elasticsearch ä¸­å­˜å‚¨æ•°æ®ï¼Œå…¶å®å°±æ˜¯å‘ Elasticsearch ä¸­çš„ index ä¸‹é¢çš„ type ä¸­å­˜å‚¨ JSON ç±»å‹çš„æ•°æ®ã€‚</p><h3 id="åœ¨-Java-ä¸­ä½¿ç”¨-Elasticsearch"><a href="#åœ¨-Java-ä¸­ä½¿ç”¨-Elasticsearch" class="headerlink" title="åœ¨ Java ä¸­ä½¿ç”¨ Elasticsearch"></a>åœ¨ Java ä¸­ä½¿ç”¨ Elasticsearch</h3><p>æœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¼šé—®ï¼Œâ€œå¤§å“¥ï¼Œæˆ‘æ˜¯ä¸€å Java ç¨‹åºå‘˜ï¼Œæˆ‘è¯¥å¦‚ä½•åœ¨ Java ä¸­ä½¿ç”¨ Elasticsearch å‘¢ï¼Ÿâ€è¿™ä¸ªé—®é¢˜é—®å¾—å¥½ï¼Œè¿™å°±æ¥ï¼Œè¿™å°±æ¥ã€‚</p><p>Elasticsearch æ—¢ç„¶å†…ç½®äº† Java è¿è¡Œç¯å¢ƒï¼Œè‡ªç„¶å°±æä¾›äº†ä¸€ç³»åˆ— API ä¾›æˆ‘ä»¬æ“ä½œã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨é¡¹ç›®ä¸­æ·»åŠ  Elasticsearch å®¢æˆ·ç«¯ä¾èµ–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;7.6.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œæ–°å»ºæµ‹è¯•ç±» ElasticsearchTestï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>, <span class="string">&quot;http&quot;</span>)));</span><br><span class="line"></span><br><span class="line">        <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(<span class="string">&quot;writer&quot;</span>)</span><br><span class="line">                .id(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .source(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ç«é”…&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;age&quot;</span>, <span class="number">18</span>,</span><br><span class="line">                        <span class="string">&quot;memo&quot;</span>, <span class="string">&quot;ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜&quot;</span>);</span><br><span class="line">        <span class="type">IndexResponse</span> <span class="variable">indexResponse</span> <span class="operator">=</span> client.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="type">GetRequest</span> <span class="variable">getRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>(<span class="string">&quot;writer&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">GetResponse</span> <span class="variable">getResponse</span> <span class="operator">=</span> client.get(getRequest, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sourceAsString</span> <span class="operator">=</span> getResponse.getSourceAsString();</span><br><span class="line"></span><br><span class="line">        System.out.println(sourceAsString);</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1ï¼‰RestHighLevelClient ä¸º Elasticsearch æä¾›çš„ REST å®¢æˆ·ç«¯ï¼Œå¯ä»¥é€šè¿‡ HTTP çš„å½¢å¼è¿æ¥åˆ° Elasticsearch æœåŠ¡å™¨ï¼Œå‚æ•°ä¸ºä¸»æœºåå’Œç«¯å£å·ã€‚</p><p>æœ‰äº† RestHighLevelClient å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ Elasticsearch æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚å¹¶è·å–å“åº”ã€‚</p><p>2ï¼‰IndexRequest ç”¨äºå‘ Elasticsearch æœåŠ¡å™¨ç«¯æ·»åŠ ä¸€ä¸ªç´¢å¼•ï¼Œå‚æ•°ä¸ºç´¢å¼•å…³é”®å­—ï¼Œæ¯”å¦‚è¯´â€œwriterâ€ï¼Œè¿˜å¯ä»¥æŒ‡å®š idã€‚é€šè¿‡ source çš„æ–¹å¼å¯ä»¥å‘å½“å‰ç´¢å¼•ä¸­æ·»åŠ æ–‡æ¡£æ•°æ®æºï¼ˆé”®å€¼å¯¹çš„å½¢å¼ï¼‰ã€‚</p><p>æœ‰äº† IndexRequest å¯¹è±¡åï¼Œå¯ä»¥è°ƒç”¨å®¢æˆ·ç«¯çš„ <code>index()</code> æ–¹æ³•å‘ Elasticsearch æœåŠ¡å™¨æ·»åŠ ç´¢å¼•ã€‚</p><p>3ï¼‰GetRequest ç”¨äºå‘ Elasticsearch æœåŠ¡å™¨ç«¯å‘é€ä¸€ä¸ª get è¯·æ±‚ï¼Œå‚æ•°ä¸ºç´¢å¼•å…³é”®å­—ï¼Œä»¥åŠ idã€‚</p><p>æœ‰äº† GetRequest å¯¹è±¡åï¼Œå¯ä»¥è°ƒç”¨å®¢æˆ·ç«¯çš„ <code>get()</code> æ–¹æ³•å‘ Elasticsearch æœåŠ¡å™¨è·å–ç´¢å¼•ã€‚<code>getSourceAsString()</code> ç”¨äºä»å“åº”ä¸­è·å–æ–‡æ¡£æ•°æ®æºï¼ˆJSON å­—ç¬¦ä¸²çš„å½¢å¼ï¼‰ã€‚</p><p>å¥½äº†ï¼Œæ¥çœ‹ä¸€ä¸‹ç¨‹åºçš„è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;ç«é”…&quot;,&quot;age&quot;:18,&quot;memo&quot;:&quot;ä¸€æšæœ‰è¶£çš„ç¨‹åºå‘˜&quot;&#125;</span><br></pre></td></tr></table></figure><p>å®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸï¼Œperfectï¼</p><p>ä¹Ÿå¯ä»¥é€šè¿‡ Kibana çš„ Dev Tools é¢æ¿æŸ¥çœ‹â€œwriterâ€ç´¢å¼•ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/elasticsearch/rumen-64baa243-0075-436e-a070-f28813fee284.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
